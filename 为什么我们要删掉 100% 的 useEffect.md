# ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åˆ æ‰Â 100%Â çš„Â useEffect

# TLDR

**å› ä¸ºæœ¬æ–‡ç¯‡å¹…å¾ˆé•¿ï¼ˆå¤§æ¦‚Â 3wÂ ä¸­æ–‡å­—ç¬¦ï¼‰ï¼Œæ‰€ä»¥æå‰å¯¹å„ä¸ªç« èŠ‚è¿›è¡Œäº†ä»‹ç»ï¼Œå¤§å®¶å¯ä»¥æŒ‰ç« èŠ‚é¡ºåºé˜…è¯»ï¼Œä¹Ÿå¯ä»¥å…ˆæŒ‘æ„Ÿå…´è¶£çš„ç« èŠ‚å…ˆè¡Œé˜…è¯»ï¼š**

*   ç¬¬ä¸€ç« ï¼šå¯ä»¥é€‰æ‹©ä»…é˜…è¯»åŠ ç²—éƒ¨åˆ†ï¼Œä¸»è¦æ˜¯è®²èƒŒæ™¯å’Œç›®æ ‡ï¼Œç§»é™¤æ‰€æœ‰Â useEffectÂ æ˜¯æˆ‘ä»¬å®ç°ç›®æ ‡çš„å…³é”®è¿‡ç¨‹ä¹‹ä¸€ã€‚
    
*   ç¬¬äºŒç« ï¼šå›é¡¾äº†æˆ‘ä»ä¼ ç»Ÿçš„Â ClassÂ ç»„ä»¶è¿‡æ¸¡åˆ°Â ReactÂ HookÂ æ—¶çš„å­¦ä¹ æ„Ÿå—ã€‚
    
*   ç¬¬ä¸‰ç« ï¼šåˆ—ä¸¾äº†æˆ‘ä»¬å›¢é˜Ÿåœ¨å®é™…ä½¿ç”¨Â useEffectÂ æ—¶é‡åˆ°çš„å„ç§å®é™…é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¤§å¤§é™ä½äº†æˆ‘ä»¬åœ¨å¤æ‚ä¸­åå°åœºæ™¯ä¸­çš„ç ”å‘æ•ˆç‡ã€‚
    
*   ç¬¬å››ç« ï¼šä»‹ç»äº†Â useInitÂ è§£å†³æ–¹æ¡ˆï¼šç”¨Â InitÂ HookÂ å’Œå°‘é‡çš„Â WatchÂ HookÂ æ¥å®Œå…¨ä»£æ›¿Â useEffectï¼Œæºç è¯¦è§Â [fool-proofing-hooks](https://github.com/ZCY-FE/fool-proofing-hooks)ã€‚
    
*   ç¬¬äº”ç« ï¼šè¾©è¯åœ°åˆ†æäº†Â ReactÂ HookÂ ä¸­Â EffectÂ æ¦‚å¿µå’Œâ€œåŒæ­¥â€çš„è®¾è®¡å“²å­¦ï¼Œå¹¶è®¨è®ºäº†è¿™äº›è®¾è®¡åˆ°åº•å¸¦æ¥äº†ä»€ä¹ˆæ”¶ç›Šã€‚
    
*   ç¬¬å…­ç« ï¼šè¡¥å……ä»‹ç»äº†Â useInitÂ è§£å†³æ–¹æ¡ˆçš„è®¾è®¡ç”±æ¥ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£è¿™å¥—æ–°çš„Â ReactÂ HookÂ ç¼–ç èŒƒå¼ã€‚
    

# ä¸€ã€èƒŒæ™¯

## Â 1ã€èŠèŠä»£ç å±å±±

æœ€è¿‘å‡ å¹´å­¦ä¹ åˆ°äº†ä¸€ä¸ªå¾ˆé‡è¦çš„è§‚ç‚¹ï¼š**åœ¨é‡æ„ä¸€ä¸ªå±å±±é¡¹ç›®æ—¶ï¼Œæœ€é‡è¦çš„æŒ‡æ ‡å°±æ˜¯å¦‚ä½•ä¿è¯ä¸‹ä¸€æ¬¡é‡æ„ä¸ä¼šå¾ˆå¿«åˆ°æ¥ï¼Œæ‰€ä»¥é‡æ„çš„æŠ€æœ¯æ–¹æ¡ˆä¸­å¿…é¡»è¦åŒ…å«å¦‚ä½•è®©ä»£ç â€œä¿é²œâ€çš„æ–¹æ³•ï¼Œå¦åˆ™é‡æ„ç»“æŸåï¼Œæ¢ä¸€å‡ æ‹¨äººç»´æŠ¤å‡ ä¸ªæ¥å›ï¼Œæ•´ä¸ªä»£ç ä»“åº“åˆä¼šè¿…é€ŸåŠ£åŒ–æˆå±å±±ã€‚**

**çŸ¥ä¹é—®é¢˜**_**â€œä¸ºä»€ä¹ˆç¥–ä¼ ä»£ç è¢«ç§°ä¸ºã€Œå±å±±ã€ï¼Ÿâ€**_**ä¸­**Â [**ç¨‹å¢¨Morgançš„å›ç­”**](https://www.zhihu.com/question/272065178/answer/591282072)Â **ä»****ç»æµå­¦çš„è§’åº¦****åˆ†æäº†å†™å‡ºå¥½ä»£ç çš„å®¢è§‚æ¡ä»¶**ã€‚ä¸è¿‡å…¶ä¸­è¯´åˆ°çš„ç®¡ç†å±‚é—®é¢˜æœªå¿…æ˜¯å› ä¸ºçŸ­è§†ï¼Œè€Œæ˜¯è§†è§’ä¸ä¸€æ ·ï¼šä½œä¸ºç¨‹åºå‘˜æˆ‘ä»¬è‚¯å®šå¸Œæœ›æœ‰å……è¶³çš„æ—¶é—´å’Œç²¾åŠ›å»åšæœ€å¥½çš„è®¾è®¡ï¼Œå†™æœ€å¥½çš„ä»£ç ï¼›ä½†æ˜¯åœ¨ç«äº‰æ¿€çƒˆçš„å¸‚åœºç¯å¢ƒä¸­ï¼Œå¾ˆå¤šæ—¶å€™å¿«é€Ÿæ”¯æŒä¸šåŠ¡è½åœ°æ‰èƒ½æŠ¢å å¸‚åœºä»½é¢å’Œç”¨æˆ·å¿ƒæ™ºï¼Œå› æ­¤å°±æœ‰äº†å„ç§å€’æ’é¡¹ç›®ã€‚å½“ç„¶ä½œä¸ºæ‰“å·¥äººè°ä¹Ÿä¸æƒ³å¤©å¤©åŠ ç­ï¼Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µéœ€è¦æœ‰é«˜è´¨é‡ä»£ç çš„æ”¯æ’‘ï¼Œåœ¨è¿™äº›åœºæ™¯ä¸­å°±å¿…é¡»æŠ•å…¥å……è¶³çš„æ—¶é—´å’Œç²¾åŠ›å»åšå¥½ç¼–ç å‰çš„è®¾è®¡å·¥ä½œï¼šæ¯”å¦‚å·²ç»åˆæ­¥å æ®å¸‚åœºçš„äº§å“éœ€è¦é€šè¿‡å‘¨æœŸæ€§çš„é«˜æ•ˆè¿­ä»£è¿›ä¸€æ­¥å·©å›ºå¸‚åœºåœ°ä½ï¼Œæ¯”å¦‚å…¬å¸çš„æˆ˜ç•¥å°±æ˜¯é€šè¿‡è¶Šçº§çš„äº§å“ä½“éªŒæ¥å¸å¼•ç”¨æˆ·â€¦â€¦

Â **è¿™äº›æ€è€ƒè®©æˆ‘è§‰å¾—å¹²å‡€æ•´æ´çš„ä»£ç å¯èƒ½åœ¨å¾ˆå¤šæ—¶å€™å°±æ˜¯ä¸ç¬¦åˆç»æµå­¦è§„å¾‹çš„ã€‚**ä¸¾ä¸ªä¸æ°å½“çš„æ¯”å–»ï¼šæˆ‘ä»¬æ— æ³•è¦æ±‚ä¸€åº§æ‘©å¤©å¤§æ¥¼çš„æ–½å·¥ç°åœºåœ¨æ–½å·¥æœŸé—´æ¯å¤©éƒ½ä¿æŒä¸€å°˜ä¸æŸ“ã€å„ç±»ç®¡çº¿å¸ƒå±€åšåˆ°æœ€å¥½çš„æ¨¡å—åŒ–å’Œæœ€å¥½çš„å¸ƒå±€è®¾è®¡ï¼Œèƒ½ä¿è¯æœ€åŸºæœ¬çš„å®‰å…¨å’Œè´¨é‡è¿™ä¸¤ä¸ªè¦æ±‚å°±å·²ç»éå¸¸å¥½äº†ã€‚å¦‚æœé•¿è¿œçš„æœªæ¥ä¸šåŠ¡éœ€è¦è½¬å‹ï¼Œæ²¡æœ‰äººèƒ½é¢„çŸ¥â€œåœ¨è¿™åº§å¤§æ¥¼ä¸Šè¿›è¡Œç¿»ä¿®æ”¹é€ â€å’Œâ€œæ¢åœ°çš®ç”¨æ–°æŠ€æœ¯å»ºé€ ä¸€æ ‹æ–°çš„å¤§æ¥¼â€å“ªä¸ªèƒ½è®©æˆ‘ä»¬å®Œæˆæœªæ¥çš„å•†ä¸šç›®æ ‡ã€‚

**ä¸è¿‡ä½œä¸ºæŠ€æœ¯äººå‘˜ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬è¦ç»§ç»­ç»´æŠ¤å’Œè¿­ä»£å±å±±ä»£ç æ—¶ï¼Œé™¤äº†ä¸æ–­åœ°æé«˜å¯¹å±å±±ä»£ç çš„é€‚åº”èƒ½åŠ›ï¼Œæ›´è¦ä»å±å±±ä»£ç çš„é—®é¢˜ä¸­åæ€å¦‚ä½•å»é¿å‘ã€‚**

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒ³èµ·äº†å¤šå¹´å‰å½“å…¥è¡Œæ—¶è¢«æ¨èé˜…è¯»è¿‡çš„ä¸€æœ¬å…³äºè½¯ä»¶æ„å»ºçš„å·¨è‘—[ã€ŠÂ CodeÂ CompleteÂ ä»£ç å¤§å…¨Â ã€‹](https://book.douban.com/subject/1477390/)ï¼Œå½“å¹´åªæ˜¯æµ…è¯»äº†å‡ ç« ä¹‹åå°±å†ä¹Ÿæ²¡æœ‰çœ‹è¿‡ã€‚åœ¨å›çœ‹æ‰€æœ‰æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜æ—¶ï¼Œå…¶å®ç»å¤§å¤šæ•°çš„è§£å†³æ€è·¯æˆ–è€…è¯´æœ€ä½³å®è·µæ—©å·²åœ¨è¿™æœ¬ç¼–å†™äºÂ 2006Â å¹´çš„ä¹¦ä¸­è¢«åˆ—å‡ºæ¥äº†ï¼Œåªæ˜¯å› ä¸ºä¹¦ä¸­æ–‡å­—æ¯”ä¾‹è¾ƒé«˜ï¼Œä¸”åˆ—ä¸¾çš„å„ç§ä»£ç ç¤ºä¾‹æ‰€ç”¨çš„ç¼–ç¨‹è¯­è¨€å’Œæˆ‘ä»¬ç›®å‰å·¥ä½œä¸­ç”¨çš„æŠ€æœ¯æ ˆå¹¶ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¾ˆéš¾ä¸€ä¸‹å­ä»£å…¥åˆ°æˆ‘ä»¬æ—¥å¸¸çš„ç¼–ç å·¥ä½œä¸­ï¼Œä½†æ˜¯å…³äºè½¯ä»¶æ„å»ºçš„æ ¸å¿ƒæ€æƒ³éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯éœ€è¦æˆ‘ä»¬çœ‹è¿™æœ¬ä¹¦æ—¶å¤šèŠ±ç‚¹æ—¶é—´ï¼Œé™ä¸‹å¿ƒæ¥å°†è¿™äº›ç†å¿µåº”ç”¨åˆ°æˆ‘ä»¬å½“ä¸‹çš„ç¼–ç å·¥ä½œä¸­ã€‚

ä¸‹é¢æˆ‘åŸºäºè‡ªå·±çš„ç†è§£æ¥ä»‹ç»ä¸¤ä¸ªç¼–ç è¿‡ç¨‹ä¸­è¦ç¡®ä¿çš„è¦ç‚¹ï¼Œä¹Ÿæ˜¯æœ¬æ–‡çš„å‡ºå‘ç‚¹ï¼Œåœ¨[ã€ŠÂ CodeÂ CompleteÂ ä»£ç å¤§å…¨Â ã€‹](https://book.douban.com/subject/1477390/)ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ç†å¿µä»‹ç»ï¼š

## 2ã€ç¡®ä¿ä»£ç æ„å›¾æ¸…æ™°æ˜ç¡®

ReactÂ HookÂ å‘å¸ƒäºÂ 2018Â å¹´ï¼Œæœ€è¿‘ä¸€æ¬¡çœ‹åˆ°è®¨è®ºå®˜æ–¹Â HookÂ çš„æŠ€æœ¯æ–‡ç« æ˜¯å…³äºÂ useMemoÂ å’ŒÂ useCallbackÂ çš„[ã€ŠÂ è¯·åˆ æ‰99%çš„useMemoÂ ã€‹](https://mp.weixin.qq.com/s/aQclSEHFER-Tsr2LaYtm-A)å’Œ[ã€Šã€Œå¥½æ–‡ç¿»è¯‘ã€ä¸ºä»€ä¹ˆä½ å¯ä»¥åˆ é™¤Â 90%Â çš„Â useMemoÂ å’ŒÂ useCallbackÂ ï¼Ÿã€‹](https://juejin.cn/post/7251802404877893689)ã€‚

å¯¹äºÂ useMemoÂ å’ŒÂ useCallbackï¼Œæˆ‘ä¸ªäººçš„ç»“è®ºæ›´ç®€å•ç²—æš´ï¼š**æ²¡äº‹åˆ«åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨Â useMemoÂ å’ŒÂ useCallbackï¼Œçº¯çº¯å¢åŠ ä»£ç å™ªéŸ³ï¼Œä¸ç”¨è¿™ä¸¤ä¸ªÂ HookÂ ä¸éœ€è¦ç†ç”±ï¼Œç”¨åˆ°çš„åœ°æ–¹åˆ™éœ€è¦æ˜ç¡®è¯´æ˜ç†ç”±ã€‚**å¹¶ä¸”å¾ˆå¤šé¡µé¢çš„æ€§èƒ½/ä½“éªŒçŸ­æ¿å¤§å¤šä¹Ÿä¸åœ¨Â jsÂ çš„æ‰§è¡Œé˜¶æ®µã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥ç­‰åˆ°é¡µé¢çœŸçš„é‡åˆ°æ­¤ç±»æ€§èƒ½é—®é¢˜æ—¶å†æ¥è€ƒè™‘è¿™äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¹¶ä¸”åœ¨å‡½æ•°ç»„ä»¶çš„æ—¶ä»£ï¼ŒPureComponentÂ å¼çš„ä¼˜åŒ–æ–¹æ¡ˆåœ¨è¿­ä»£ä¸­æ˜¯æå…¶è„†å¼±çš„ï¼Œåº”è¯¥ä¼˜å…ˆç”¨å…¶ä»–æ–¹å¼è§£å†³æ€§èƒ½é—®é¢˜ï¼Œæ¯”å¦‚æ›´åˆç†çš„ç»„ä»¶è®¾è®¡ã€‚

æåˆ°ä»¥ä¸Šè¿™ä¸¤ç¯‡æ–‡ç« çš„åŸå› æ˜¯ï¼Œæ–‡ç« ä¸­æåˆ°çš„ä¸€ä¸ªé—®é¢˜ç‚¹å’Œæœ¬æ–‡çš„å…¶ä¸­ä¸€ä¸ªå‡ºå‘ç‚¹æ˜¯ååˆ†ç±»ä¼¼çš„ï¼š

![Google Chrome Canary 2025-02-19 00.12.07.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/aab4552d-acf2-4d8b-9ab6-c96983317ef9.png)

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/d8c02504-4fec-40c4-b139-a67a4eb9b90a.png)

å³ï¼šæˆ‘ä»¬å¦‚ä½•ä¿è¯è‡ªå·±ä»£ç çš„æ„å›¾åœ¨åç»­çš„è¿­ä»£ä¸­è¢«æ­£ç¡®ä¸”ç²¾å‡†åœ°ä¼ è¾¾ç»™åæ¥äººè€Œä¸è¢«ç ´åï¼Ÿå¦åˆ™æˆ‘ä»¬å°±åªèƒ½ä¸æ–­åœ°å»å“å‘³å±å±±ä»£ç ï¼Œè‰°éš¾åœ°ä»ä¸­æŠ¿å‡ºå‰äººçš„æ™ºæ…§ï¼Œå› ä¸ºåœ¨æ¯ä¸ªé¡¹ç›®çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éƒ½æ—¢æ˜¯å‰äººï¼Œä¹Ÿæ˜¯åæ¥äººã€‚

## 3ã€ç¡®ä¿ä»£ç ç»“æ„çš„ä¸€è‡´æ€§

æœ¬æ–‡çš„å¦ä¸€ä¸ªå‡ºå‘ç‚¹èµ·æºäºæˆ‘ä¸ªäººï¼šæˆ‘åœ¨çœ‹è‡ªå·±è¿‡å¾€å†™çš„ä¸šåŠ¡ä»£ç æ—¶ï¼Œå‘ç°å¦‚æœè®©æˆ‘å†å†™ä¸€æ¬¡ï¼Œåœ¨ä¸€äº›é€»è¾‘ç»†èŠ‚çš„è®¾è®¡ä¸Šï¼Œå¯èƒ½ä¼šæœ‰ç‚¹ä¸ä¸€æ ·ã€‚å¹¶ä¸æ˜¯å› ä¸ºè¿™æ®µæ—¶é—´é—´éš”ä¸­æˆ‘è‡ªå·±æœ‰äº†ä»€ä¹ˆæˆé•¿æˆ–è€…æ–°çš„è§è§£ï¼Œè€Œæ˜¯å½“æ—¶å†™ä»£ç çš„æ—¶å€™æœ‰Â WayÂ AÂ å’ŒÂ WayÂ BÂ ä¸¤ç§æ€è·¯ç¡®å®å·®ä¸å¤šï¼Œéšä¾¿é€‰äº†Â Aï¼ˆç¡®å®å·®ä¸å¤šæ‰€ä»¥å½“æ—¶æƒ³å†å¤šä¹Ÿæ²¡ç”¨ï¼Œä¸€äº›ä¸å½±å“æœ€ç»ˆæ•ˆæœçš„å®ç°ç»†èŠ‚æˆ‘ä»¬ä¹Ÿæ²¡æ—¶é—´å»çº ç»“ï¼‰ã€‚è¿‡æ®µæ—¶é—´åå†æ¥çœ‹è¿™ä¸ªä»£ç æˆ‘ä¼šå†æ¬¡çº ç»“ä¸€ä¼šï¼šâ€œæ˜¯ä¸æ˜¯ç”¨Â WayÂ BÂ å¾ˆå¥½å‘¢ï¼Œæ‰€ä»¥è¿™æ¬¡çš„æ–°å¢åŠŸèƒ½æˆ‘è¯•è¯•ç”¨Â WayÂ BÂ è¿­ä»£ä¸Šå»å§â€Â orÂ â€œä¹‹å‰æ—¢ç„¶ç”¨çš„æ˜¯Â WayÂ AÂ é‚£ä¹ˆç»§ç»­ç”¨Â WayÂ AÂ å§ï¼Œä¿æŒä¸€è‡´æ€§â€ã€‚å¯¼è‡´å®é™…ä¸Šåç»­æ¯æ¬¡è¿­ä»£åŠŸèƒ½æ—¶æˆ‘éƒ½è¦çº ç»“ä¸€éï¼Œä»£ç ä¸€è‡´æ€§ä¹Ÿæ²¡é‚£ä¹ˆå¥½ã€‚

ä½œä¸ºä¸€ä¸ªè€ç‰Œå¼ºè¿«ç—‡ï¼Œæˆ‘å†³å®šç»™è‡ªå·±å®šä¸€ä¸ªæ¸…æ™°çš„è§„åˆ™ï¼Œåœ¨å®ç°åŒä¸€ç±»åŠŸèƒ½æ—¶ï¼Œå°½é‡è®©ä»£ç èƒ½å¤Ÿä¿æŒè·¨è¶Šæ—¶é—´çš„ç»“æ„ä¸€è‡´æ€§ï¼Œä½†æ˜¯å¾ˆå¿«æˆ‘å‘ç°ï¼Œæˆ‘è¦èŠ±æ›´å¤šçš„ç²¾åŠ›å’Œä¸€èµ·åä½œçš„åŒäº‹å»æ²Ÿé€šå’ŒåŒæ­¥æˆ‘çš„æƒ³æ³•ï¼Œè€Œä¸”è¿™ä¸ªè¿›å±•å¾ˆæ…¢ä¸”ä¸å¯å¤åˆ¶ã€‚å› æ­¤æˆ‘å‘ç°è¿™ä¸ªé—®é¢˜å¯¹å›¢é˜Ÿçš„æ„ä¹‰æ¯”å¯¹ä¸ªäººè¦å¤§å¾—å¤šï¼Œåœ¨å¼€å‘åä½œä¸­æˆ‘ä»¬æ¯å¤©éƒ½åœ¨é‡åˆ°ä»£ç ç»“æ„ä¸€è‡´æ€§ã€ä»¥åŠè§„èŒƒæ‰§è¡Œä¸€è‡´æ€§ç­‰é—®é¢˜çš„æŒ‘æˆ˜ã€‚

## 4ã€æ›´é«˜çš„ç›®æ ‡

**ä¸Šè¿°è¿™äº›é—®é¢˜æœ€ç»ˆä¼šå½±å“æ•´ä¸ªé¡¹ç›®é•¿æœŸçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œç›´æ¥å†³å®šå›¢é˜Ÿå¹³æ—¶çš„å¼€å‘æ•ˆç‡ï¼Œé—´æ¥å½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚è€Œä¸”åªæœ‰è§£å†³äº†ä»¥ä¸Šè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å¹³æ—¶å¼€å‘çš„æ—¶å€™æ‰æœ‰ç²¾åŠ›çœŸæ­£å»å…³æ³¨å’Œè®¨è®ºä¸€äº›æ›´é«˜çº§ã€æ›´é‡è¦çš„ä¸œè¥¿ï¼Œä¾‹å¦‚æ€ä¹ˆå°†å¤æ‚çš„éœ€æ±‚è½¬å˜ä¸ºæ‹¥æœ‰æœ€ä½³è®¾è®¡çš„ä¸šåŠ¡ç»„ä»¶ã€å¦‚ä½•å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘è¿›è¡Œåˆç†çš„åˆ†å±‚æ‹†åˆ†ç­‰ç­‰ã€‚**

è¦è§£å†³ä¸Šè¿°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå…¶å®è¦æ±‚å¾ˆç®€å•ï¼Œè½åœ°å´å¾ˆéš¾ï¼š

*   **ä»£ç æ„å›¾çš„æ­£ç¡®ä¼ è¾¾**ï¼šä»£ç å¯ä»¥çœ‹ä¸Šå»å¹³å¹³æ— å¥‡ä½†ä¸€å®šè¦ç¡®ä¿æœ€é«˜çš„å¯è¯»æ€§ï¼Œå¿…è¦æ—¶å†™ä¸€äº›æ³¨é‡Šï¼Œåƒä¸‡åˆ«åœ¨ä¸šåŠ¡ä»£ç ä¸­ç‚«æŠ€ï¼Œè¶Šæ¥è¿‘è‡ªç„¶è¯­è¨€çš„ä»£ç å¯è¯»æ€§è¶Šå¼ºã€‚è¦æ˜¯å†™å¾—è¿äº§å“éƒ½èƒ½çœ‹å¾—æ‡‚ï¼Œä½ æ˜¯æœ€ç‰›çš„ï¼
    
*   **ä¿æŒä»£ç ç»“æ„ä¸€è‡´æ€§**ï¼šå¯¹èƒ½ç”¨çš„å¼€å‘å·¥å…·è¿›è¡Œç²¾æŒ‘ç»†é€‰ï¼Œç¼©å‡å¼€å‘ä¸­å®ç°æ–¹å¼çš„å¯é€‰é¡¹ã€‚åœ¨æœ€æ–°ç‰ˆæœ¬çš„æµ·æ‹‰é²å¤§é™†ä¸­ï¼Œä½ åªèƒ½è£…å¤‡å¤§å¸ˆä¹‹å‰‘ï¼Œä½™æ–™å»ºé€ ä¹Ÿä¸è¡Œï¼Œèµ¶ç´§å»æ•‘å…¬ä¸»ï¼Œè¶Šå¿«è¶Šå¥½ï¼
    

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°Â useEffectÂ æ˜¯ä¸€ä¸ªç»•ä¸è¿‡å»çš„è¯é¢˜ã€‚å½“ç„¶ä¹Ÿæœ‰å…¶ä»–è¯é¢˜ï¼Œæˆ‘ä»¬å†…éƒ¨æš‚ä¸”æŠŠè¿™äº›è¯é¢˜éƒ½å½’åˆ°äº†å‰ç«¯çš„ç ”å‘èŒƒå¼ä¸­ã€‚åœ¨æ­£æ–‡å…·ä½“å±•å¼€ä¹‹å‰å®¹è®¸æˆ‘å…ˆå ä¸ªç”²ï¼š**æœ¬æ–‡çš„éƒ¨åˆ†è§‚ç‚¹è¾ƒä¸ºä¸»è§‚****ï¼Œå› ä¸ºæ²¡æœ‰æ¡ä»¶è¿›è¡Œè¯¦å°½çš„æ²Ÿé€šè°ƒç ”å’Œæ•°æ®ç»Ÿè®¡ï¼Œä½†æ˜¯æ¬¢è¿å¤§å®¶å‚ä¸è®¨è®ºã€‚**

# äºŒã€åˆè§Â ReactÂ Hook

## 1ã€ç¬¬ä¸€å°è±¡

æœ¬äººå¤§æ¦‚åœ¨Â 19Â å¹´å¼€å§‹å­¦ä¹ å’Œä½¿ç”¨Â ReactÂ Hookï¼Œä½œä¸ºä¸€ä¸ªæœ‰Â ClassÂ ComponentÂ ç±»ç»„ä»¶å¼€å‘ç»éªŒçš„æ–°æ‰‹ï¼Œç®€å•å›å¿†å’Œæ€»ç»“äº†å½“æ—¶é€šè¿‡å®˜æ–¹æ–‡æ¡£å­¦ä¹ å‡½æ•°ç»„ä»¶è¿‡ç¨‹ä¸­çš„å…³é”®ç–‘é—®/æ„Ÿæ…¨ï¼š

*   æ¯æ¬¡å‡½æ•°ç»„ä»¶Â updateÂ å°±æ˜¯ç®€å•åœ°æŠŠæœ€å¤–å±‚å‡½æ•°é‡æ–°æ‰§è¡Œä¸€éï¼Œæ‹¿åˆ°Â UIÂ è§†å›¾æ¸²æŸ“ç»“æœï¼Œé‚£ä¹ˆï¼š
    
    *   æ—¢ç„¶æ¯æ¬¡æ‰§è¡Œéƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œé‚£ç»„ä»¶å†…å¤šæ¬¡è°ƒç”¨Â useStateÂ æ—¶ä¸ºä»€ä¹ˆä¸éœ€è¦ä¼ å…¥ç‰¹å®šçš„Â keyÂ æ¥åŒºåˆ†è¿™äº›Â stateï¼Œä¸ç„¶åº”è¯¥ä¼šä¹±å¥—ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯åŸºäºé¡ºåºè€Œä¸æ˜¯åŸºäºÂ keyï¼Œç±»ä¼¼Â MapÂ å’ŒÂ ArrayÂ çš„åŒºåˆ«ï¼‰
        
    *   æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™æ‰€æœ‰æ–¹æ³•éƒ½è¦é‡æ–°å®šä¹‰ä¸€éï¼Œæ„Ÿè§‰ç›¸æ¯”ç±»ç»„ä»¶ï¼Œå¥½æµªè´¹å•Šã€‚ç”¨äº†Â useCallbackÂ ä¹Ÿé¿å…ä¸äº†å®šä¹‰ç¯èŠ‚ï¼Œåªæ˜¯æ¯æ¬¡å®šä¹‰å®Œäº†ï¼Œå†æ¥ä¸ªåˆ¤æ–­é€»è¾‘æ¥å†³å®šè¦ä¸è¦ç”¨ï¼Œæ„Ÿè§‰æ›´æµªè´¹äº†ï¼ï¼ˆä¸“é—¨æœ‰ä¸ªÂ [FAQ](https://zh-hans.legacy.reactjs.org/docs/hooks-faq.html#are-hooks-slow-because-of-creating-functions-in-render)Â ä¹Ÿè®²åˆ°è¿™ä¸ªäº†ï¼‰
        

*   å½“æˆ‘å¼€å§‹è¯•å›¾åœ¨å‡½æ•°ç»„ä»¶ä¸­å¯»æ‰¾å¯¹æ ‡ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘å¯¹Â useEffectÂ çš„ç†è§£å¦‚ä¸‹ï¼š
    
    *   å½“Â useEffectÂ ç¬¬äºŒä¸ªå‚æ•°ä¸ä¼ æ—¶ï¼Œå°±ç­‰åŒäºÂ componentDidUpdateÂ è¿™ä¸ªç±»ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚
        
    *   å½“Â useEffectÂ ä¾èµ–ä¼ å…¥ç©ºæ•°ç»„Â \[\]Â æ—¶å¯ä»¥å®ç°Â componentDidMountÂ å’ŒÂ componentWillUnmountÂ çš„èƒ½åŠ›ï¼Œä½†æ˜¯è¿™ä¸ªåœºæ™¯èƒ½ä¸èƒ½ç»™ä¸ªè¯­ä¹‰æ›´å¥½çš„Â APIÂ å‘½åï¼Œæ¯”å¦‚Â useDidMountï¼Œæ¯æ¬¡éƒ½è¦ä¼ å…¥ç©ºæ•°ç»„ä¹Ÿå¾ˆå¤šä½™ã€‚
        
    *   å½“Â useEffectÂ ä¼ å…¥çŠ¶æ€ä¾èµ–æ—¶ï¼Œæ¯å½“ä¾èµ–æ•°ç»„ä¸­çš„çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼ŒuseEffectÂ çš„å›è°ƒå‡½æ•°ä¸­çš„å‰¯ä½œç”¨é€»è¾‘å°±ä¼šæ‰§è¡Œã€‚
        
    *   å½“Â useEffectÂ ä¼ å…¥ä¾èµ–å¹¶å®ç°ä¸€äº›Â addEventListenerÂ ä¹‹ç±»çš„äº‹æƒ…æ—¶ï¼Œä¸ºäº†è§£å†³é—­åŒ…é—®é¢˜ï¼Œç«Ÿç„¶ä¼šåœ¨æ¯æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯åå»è§£ç»‘ã€å†ç»‘å®šã€è§£ç»‘ã€å†ç»‘å®š......Â ä»¿ä½›é—­åŒ…é—®é¢˜æœ¬èº«æ‰æ˜¯å‡½æ•°ç»„ä»¶Â +Â useEffectÂ å¸¦æ¥çš„Â â€œå‰¯ä½œç”¨â€ã€‚
        

## 2ã€å‰¯ä½œç”¨çš„æ¦‚å¿µ

æœ€åå°±æ˜¯å¯¹äºæ‰€è°“çš„Â effectÂ æœ¬èº«ï¼Œä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Œåœ¨å½“æ—¶çš„[React](https://zh-hans.legacy.reactjs.org/docs/hooks-effect.html)Â å®˜æ–¹æ–‡æ¡£æ˜¯è¿™ä¹ˆæè¿°çš„ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/27749bf4-defe-4763-8e47-b64bec6da89e.png)

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/e3284e89-6901-4610-92cf-79522c3eacc3.png)

å½“æ—¶ä¹Ÿæ²¡æœ‰å¤šæƒ³ï¼Œå°±å¤§æ¦‚çŸ¥é“äº†Â UIÂ æ¸²æŸ“ï¼ˆçŠ¶æ€Â ->Â JSXï¼‰ä¹‹å¤–çš„é€»è¾‘éƒ½å±äºå‰¯ä½œç”¨çš„èŒƒç•´ã€‚

## 3ã€ç›‘å¬æ€ç»´Â vsÂ Â å‰¯ä½œç”¨æ€ç»´

å½“æˆ‘å¼€å§‹åœ¨ä¸šåŠ¡ä¸­ä½¿ç”¨Â useEffectÂ å¹¶å°è¯•æŠŠæ‰€æœ‰çš„Â httpÂ æ¥å£è¯·æ±‚éƒ½æ”¾åˆ°é‡Œé¢æ—¶ï¼Œæˆ‘çªç„¶æ„Ÿè§‰åˆ°ï¼š**å¦‚æœè¿™ä¹ˆå†™ä»£ç ï¼ŒuseEffectÂ ä¸å°±æ˜¯Â VueÂ 2Â é‡Œçš„Â watchÂ ä¹ˆï¼Ÿ**

```tsx
useEffect(() => {
  fetchListData();
}, [pageNo, pageSize]);
```

å› ä¸ºæˆ‘Â VueÂ çš„å®é™…ä½¿ç”¨ç»éªŒè¾ƒå°‘ï¼ŒçŸ¥é“Â watchÂ è¿™ä¸ªÂ APIÂ ä½†æ˜¯æ²¡çœŸæ­£ç”¨è¿‡ï¼Œæ‰€ä»¥åœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹å‰æˆ‘ä¸€ç›´ä»¥ä¸ºÂ VueÂ çš„Â watchÂ Â æ˜¯ä»¥æ•°ç»„å½¢å¼å£°æ˜ç›‘å¬é¡¹çš„ï¼Œå†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œæˆ‘ç‰¹æ„å»æŸ¥äº†ä¸€ä¸‹ï¼Œå‘ç°Â VueÂ 2Â ä¸­ä¸€æ¬¡åªèƒ½ç›‘å¬ä¸€ä¸ªçŠ¶æ€ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/cf79253b-eba6-4b97-a795-c5987fa0f1e7.png)

åœ¨æˆ‘çš„ç ”å‘ä¹ æƒ¯ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šé¿å…ä½¿ç”¨Â VueÂ watchÂ å’ŒÂ ReactÂ componentDidUpdateÂ ç­‰Â APIÂ å»å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ä¼˜å…ˆç”¨å…¶ä»–æ–¹å¼ï¼Œå› ä¸ºç›‘å¬ç±»çš„é€»è¾‘æ˜¯å¾ˆéš¾ç»´æŠ¤çš„ã€‚ç„¶è€Œå½“Â ReactÂ HookÂ æŠŠæ•°æ®è¯·æ±‚éƒ½è§†ä¸ºå‰¯ä½œç”¨æ—¶ï¼Œç»“åˆÂ useEffectÂ é‚£ä¸å°±æ˜¯åœ¨å¼•å¯¼æ‰€æœ‰å¼€å‘è€…å°è¯•ç”¨ç›‘å¬çš„é€»è¾‘å»å®ç°ä¸šåŠ¡é€»è¾‘ä¹ˆï¼Œæƒ³è±¡ä¸€ä¸‹å°±è§‰å¾—å¾ˆå¯æ€•ã€‚å½“ç„¶æˆ‘ä¹Ÿå¯ä»¥é€‰æ‹©ç»§ç»­ä¿æŒåŸæœ¬çš„ç ”å‘ä¹ æƒ¯ï¼ŒæŠŠç”±ç”¨æˆ·äº‹ä»¶ï¼ˆé¼ æ ‡ã€é”®ç›˜ã€è§¦å±ç­‰æ“ä½œï¼‰è§¦å‘çš„è¯·æ±‚å†™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚æ‰€ä»¥å½“æ—¶å¯¹äºå¦‚ä½•ä½¿ç”¨Â useEffectÂ æˆ‘çº ç»“äº†å¾ˆä¹…ï¼Œä¸ºäº†å›å¿†å½“æ—¶çš„å­¦ä¹ è¿‡ç¨‹ï¼Œæˆ‘ç”šè‡³è¿˜æ‰¾åˆ°äº†ä¸€ä»½Â 3Â å¹´å‰çš„ç¬”è®°ï¼Œå¯¹äºä»€ä¹ˆæ—¶å€™è¦ç”¨ç›‘å¬çš„æ€ç»´è¿›è¡Œäº†æ€»ç»“ï¼ˆç°åœ¨çœ‹æ¥æ˜¯å®Œå…¨é”™è¯¯çš„ï¼‰ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/0a37bdf9-8e79-49b2-bcd1-ed815bfec976.png)

å…¶å®åœ¨è¿™å‡ å¹´ç»å†äº†æ›´å¤šçš„ä¸šåŠ¡å®æˆ˜â€œç£¨ç‚¼â€åï¼Œæˆ‘æ—©å·²å¿˜è®°äº†å½“æ—¶å†™åœ¨æˆ‘ç¬”è®°ä¸­çš„è¿™ä¸ªç»“è®ºï¼Œå¦‚æœè®©æˆ‘ç»™ä¸€ä¸ªå¦‚ä½•åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨Â useEffectÂ çš„æ–°ç»“è®ºï¼šæˆ‘åªä¼šåœ¨ä¸ºäº†æ¨¡æ‹ŸÂ componentDidMountÂ å’ŒÂ componentWillUnmountÂ è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ—¶ä¸»åŠ¨ä½¿ç”¨ç©ºæ•°ç»„Â \[\]Â ä¾èµ–çš„Â useEffectï¼›å¯¹äºå…¶ä»–å¤§éƒ¨åˆ†åœºæ™¯ä¸­çš„å‰¯ä½œç”¨é€»è¾‘ï¼Œæˆ‘ä¸€å®šä¼šä¼˜å…ˆå°†è¿™äº›é€»è¾‘ç›´æ¥å®ç°åœ¨ç”¨æˆ·äº‹ä»¶å“åº”å‡½æ•°ä¸­ï¼›å®åœ¨ä¸‡ä¸å¾—å·²æ—¶ï¼Œæˆ‘æ‰ä¼šç”¨Â useEffectÂ å»æ¨¡æ‹ŸÂ componentDidUpdateÂ ç”Ÿå‘½å‘¨æœŸä¸­çš„ç›‘å¬ç±»é€»è¾‘ã€‚

ä½†æ˜¯å½“å¹´çš„è¿™ä¸ªè®¤çŸ¥ä¸€ç›´ä¿ç•™äº†ä¸‹æ¥ï¼ŒåŒ…æ‹¬åœ¨çœ‹å…¶ä»–åŒäº‹çš„ä»£ç æ—¶æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆå»è§£è¯»ï¼Œå¹¶ä¸”æŒç»­åˆ°ç°åœ¨ï¼Œå³ï¼š

**â€œuseEffectÂ +Â depsï¼ˆéç©ºæ•°ç»„ï¼‰â€Â Â =Â Â â€œç›‘å¬çŠ¶æ€/å±æ€§åæ‰§è¡Œç‰¹å®šé€»è¾‘â€**

å¹¶ä¸”åœ¨å‡†å¤‡å†™è¿™ç¯‡æ–‡ç« æœŸé—´ï¼Œæˆ‘ç‰¹æ„è§‚å¯Ÿè¿‡åŒäº‹ä¹‹é—´çš„æŠ€æœ¯è®¨è®ºï¼ŒåŒ…æ‹¬å„ç§ç¤¾åŒºé‡Œçš„æŠ€æœ¯æ–‡ç« ï¼Œå½“æˆ‘ä»¬æåŠÂ useEffectÂ æ—¶ï¼Œâ€œç›‘å¬â€è¿™ä¸ªè¯å‡ºç°çš„é¢‘ç‡æ˜¯å¾ˆé«˜çš„ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/323cc6b3-80e3-4768-a254-3f086056944a.png)

ç„¶è€Œè®¤çœŸé˜…è¯»è¿‡å®˜æ–¹æ–‡æ¡£çš„äººéƒ½çŸ¥é“ï¼ŒuseEffectÂ çš„è®¾è®¡æ„å›¾å¹¶ä¸æ˜¯è®©æˆ‘ä»¬ç”¨äºå®ç°ç›‘å¬ç±»é€»è¾‘ï¼Œè€Œæ˜¯ç”¨äºå®ç°å‰¯ä½œç”¨ã€‚ä¸è¿‡ä¸¤ç§ç†è§£æ–¹å¼æˆ–è€…è¯´æ€ç»´æ¨¡å¼å†™å‡ºæ¥çš„ä»£ç åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ®Šé€”åŒå½’ã€‚

ä¸ªäººè®¤ä¸ºæœ‰ä¸€ä¸ªé—®é¢˜å¯ä»¥åˆ¤æ–­ä½ æ—¥å¸¸ä½¿ç”¨Â useEffectÂ æ—¶ç”¨çš„æ˜¯ç›‘å¬æ€ç»´ï¼Œè¿˜æ˜¯ç”¨å‰¯ä½œç”¨æ€ç»´ï¼š**ä½ ä¼šå…ˆå£°æ˜Â useEffectÂ ä¾èµ–æ•°ç»„çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Ÿè¿˜æ˜¯å…ˆå®ç°Â useEffectÂ å›è°ƒå‡½æ•°ä¸­çš„æ‰€æœ‰é€»è¾‘ï¼Ÿ**

# ä¸‰ã€ç°å®ä¸­çš„Â useEffectÂ åœ°ç‹±

åœ¨ç¬¬ä¸€ç« ä»‹ç»çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘åˆ†ç±»æ€»ç»“äº†æˆ‘è®¤ä¸ºåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­Â useEffectÂ å­˜åœ¨çš„é—®é¢˜ï¼Œä»¥ä¸‹å¤§éƒ¨åˆ†ä»£ç ç¤ºä¾‹å¹¶æ²¡æœ‰å¼•èµ·å®é™…åŠŸèƒ½çš„Â bugã€‚ä½†æ˜¯å°±åƒæ–‡æœ¬ç¬¬ä¸€ç« ä¸­æ‰€è¯´çš„ï¼Œè¿™äº›é—®é¢˜æœ€ç»ˆä¼šå½±å“æ•´ä¸ªé¡¹ç›®é•¿æœŸçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œç›´æ¥å†³å®šå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡ï¼Œé—´æ¥å½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚

## 1ã€å¤§é‡ä¸å¤Ÿå¥å£®çš„ç©ºä¾èµ–

åœ¨æˆ‘ä»¬çš„å‰ç«¯å·¥ç¨‹ä¸­ï¼Œä½¿ç”¨Â useEffectÂ æ—¶ä¾èµ–æ•°ç»„ä¸ºç©ºçš„æƒ…å†µå¤§æ¦‚å æ¯”Â 50%ï¼Œä¾‹å¦‚ï¼š

```tsx
useEffect(() => {
  fetchProjectList({
    pageNo: 1,
    pageSize: 10,
  });
}, []);
```

è¿™ä¸ªä»£ç çš„é—®é¢˜å¦‚ä¸‹ï¼š

### è¯­ä¹‰åŒ–é—®é¢˜

å¦‚æœåªæ˜¯ä¸ºäº†æ›¿ä»£Â componentDidMountï¼ŒÂ ä½¿ç”¨ä¾‹å¦‚Â ahooksÂ çš„Â useMountÂ å¯èƒ½ä¼šæ›´è¯­ä¹‰åŒ–ï¼Œä¸”å¯ä»¥å°‘å†™ä¸€ä¸ªç©ºæ•°ç»„ã€‚

### åˆ¤æ–­ä¾èµ–é—®é¢˜

å¦‚æœåœ¨å·¥ç¨‹ä¸­å‚è€ƒÂ [ä»£ç æ£€æŸ¥ï¼ˆLintingï¼‰](https://zh-hans.react.dev/learn/editor-setup#linting)å¯ç”¨Â react-hooks/exhaustive-depsÂ è¿™ä¸ªå®˜æ–¹Â ESLintÂ è§„åˆ™åï¼Œå®é™…ä¸Šè¿˜ä¼šæœ‰ä¸€ä¸ªæç¤ºï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/59e41ef1-0da6-4603-ac87-2ebadf351f37.png)

å‡è®¾å¼€å‘è€…çš„æ„å›¾å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯åªè¦åœ¨Â componentDidMountÂ ä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

```tsx
const ProjectListComponent = (props) => {
  const [dataSource, setDataSource] = useState({
    total: 0,
    list: [],
  });
  
  const fetchProjectList = async (params = {}) => {
    const result = await fetchProjectData({ // fetchProjectData æ˜¯åœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰çš„è¯·æ±‚å‡½æ•°
      pageNo: 1,
      pageSize: 10,
      ...params,
    });
    setDataSource(result);
  };
  
  // ...... ä¸­é—´éš”äº† 100 è¡Œå…¶ä»–ä»£ç  ......
  
  useEffect(() => {
    fetchProjectList({
      pageNo: 1,
      pageSize: 10,
    });
  }, []); // ğŸŸ¢ useEffect ä¸­æ²¡æœ‰ç”¨åˆ°ä»»ä½•å¦‚ props å’Œ state è¿™æ ·çš„å“åº”å¼å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ ä¾èµ–é¡¹
  
  return (
    <div>
      ......
    </div>
  );
};
```

ç›®å‰çœ‹æ¥å› ä¸ºÂ fetchProjectListÂ çš„å®ç°ä¸Šæ²¡æœ‰ç”¨åˆ°ä»»ä½•å¦‚Â propsÂ å’ŒÂ stateÂ è¿™æ ·çš„å“åº”å¼å€¼ï¼ˆå‚è€ƒ[ä¾èµ–åº”è¯¥å’Œä»£ç ä¿æŒä¸€è‡´](https://zh-hans.react.dev/learn/removing-effect-dependencies#dependencies-should-match-the-code)ï¼‰ã€‚å½“ç„¶å¦‚æœÂ fetchProjectDataÂ æ˜¯ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°ï¼Œä¹Ÿè¦å†çœ‹ä¸€ä¸‹Â fetchProjectDataÂ çš„å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬å‡è®¾å®ƒæ˜¯å¤–éƒ¨å‡½æ•°ã€‚

ç„¶åå‡è®¾åŠå¹´åå¦ä¸€ä¸ªå¼€å‘äººå‘˜éœ€è¦åœ¨è¿™ä¸ªåŠŸèƒ½åŸºç¡€ä¸Šè¿­ä»£ï¼Œåœ¨Â fetchProjectDataÂ å¯¹åº”çš„æ¥å£ä¸­å¢åŠ å…¥å‚Â bizIdï¼Œè€ŒÂ bizIdÂ æ¥æºäºç»„ä»¶å¤–éƒ¨ï¼š

```tsx
const ProjectListComponent = (props) => {
  const { bizId } = props;
  
  const [dataSource, setDataSource] = useState({
    total: 0,
    list: [],
  });
  
  const fetchProjectList = async (params = {}) => {
    const result = await fetchProjectData({
      bizId, // è¿­ä»£è¿‡ç¨‹ä¸­åœ¨è¯·æ±‚æ–¹æ³•ä¸­æ·»åŠ äº† bizId è¿™ä¸ª props å…¥å‚
      pageNo: 1,
      pageSize: 10,
      ...params,
    });
    setDataSource(result);
  };
  
  // ...... ä¸­é—´éš”äº† 100 è¡Œå…¶ä»–ä»£ç  ......
  
  useEffect(() => {
    fetchProjectList({
      pageNo: 1,
      pageSize: 10,
    });
  }, []); // ğŸ”´ å¿˜äº†æ·»åŠ  bizId è¿™ä¸ªä¾èµ–é¡¹ï¼Œä½†å¦‚æœ bizId æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œå…¶å®ä¹Ÿä¸ä¼šæœ‰åŠŸèƒ½æ€§é—®é¢˜
  
  return (
    <div>
      ......
    </div>
  );
};
```

å¾ˆç®€å•ï¼Œç¬¬äºŒä¸ªå¼€å‘äººå‘˜ç›´æ¥é€ä¼ Â bizIdÂ åˆ°äº†è¯·æ±‚çš„å…¥å‚ä¸­ï¼Œä½†æ˜¯å¿˜è®°å°†Â bizIdÂ æ”¾åˆ°Â useEffectÂ çš„ä¾èµ–ä¸­ã€‚ä½†å¦‚æœÂ bizIdÂ æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œå…¶å®ä¹Ÿä¸ä¼šæœ‰åŠŸèƒ½æ€§é—®é¢˜ï¼Œä¸‡ä¸€åœ¨æ•´ä¸ªé¡µé¢çš„ç”Ÿå‘½å‘¨æœŸä¸­çš„Â bizIdÂ æ˜¯ä¼šå˜åŒ–çš„ï¼Œé‚£ä¹ˆå°±å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæˆ‘çŒœæµ‹è¿™ç§Â bugÂ å¯èƒ½ä¼šåœ¨å¼€å‘é˜¶æ®µé€ƒé€¸ï¼Œå¤§æ¦‚ç‡åœ¨æµ‹è¯•é˜¶æ®µè¢«æµ‹è¯•äººå‘˜å‘ç°ã€‚

**ä½†æ˜¯ä¸šåŠ¡è¿˜æœ‰å¾ˆå¤šç±»ä¼¼çš„å› ä¸ºæ¼å†™ä¾èµ–å¯¼è‡´çš„é—®é¢˜ï¼Œå¯èƒ½å› ä¸ºåŸæœ¬çš„ä¾èµ–é¡¹è¾ƒå¤šï¼Œå¯¼è‡´æ¼ä¾èµ–é—®é¢˜å¾ˆéš¾è¢«å‘ç°ï¼Œå¯èƒ½è¦åˆ°çœŸçº¿ä¸ŠæŸä¸ªçœŸå®ç”¨æˆ·çš„è¿›è¡Œé¡µé¢æ“ä½œæ‰ä¼šå‘ç°ï¼š**

```tsx
// å‡è®¾ä»¥ä¸‹ä»£ç é—æ¼äº†ä¾èµ– stateD
// å› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒstateD ä¼šå’Œå…¶ä»–çŠ¶æ€ä¸€èµ·æ”¹å˜ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºä»€ä¹ˆé—®é¢˜
// ä½†æ˜¯å½“æŸä¸ªç”¨æˆ·æ“ä½œå¯¼è‡´ stateD ä¼šå•ç‹¬å˜åŒ–æ—¶å°±ä¼šå‡ºé—®é¢˜ï¼Œå‰¯ä½œç”¨å›è°ƒæ²¡æœ‰è¢«è§¦å‘
// è€Œä¸”è¿™ç§é—®é¢˜éå¸¸å®¹æ˜“åœ¨æµ‹è¯•é˜¶æ®µé€ƒé€¸ï¼Œåœ¨ Code Review ç¯èŠ‚ä¹Ÿéš¾ä»¥å‘ç°
useEffect(() => {
  // ......
}, [stateA, stateB, stateC, /* stateD, */ stateE, stateF, stateG]);

```

å¦‚æœæƒ³è¦åœ¨å¼€å‘é˜¶æ®µéå¸¸è‡ªç„¶åœ°å‘ç°è¿™ç±»é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªæ ‡å‡†çš„åŠæ³•å°±æ˜¯æŠŠÂ react-hooks/exhaustive-depsÂ è¿™ä¸ªÂ ESLintÂ è§„åˆ™ä»Â warnÂ çº§ä¿®æ”¹ä¸ºÂ errorÂ çº§ã€‚ä¸å†ç”¨è‚‰çœ¼å»åˆ¤æ–­å„ä¸ªå‡½æ•°çš„å®ç°ä¸­æ˜¯å¦åŒ…å«Â stateÂ å’ŒÂ propsï¼Œè€Œæ˜¯æ— è„‘è·Ÿç€Â linterÂ æç¤ºèµ°ã€‚

```tsx
const ProjectListComponent = (props) => {
  const { bizId } = props;
  
  const [dataSource, setDataSource] = useState({
    total: 0,
    list: [],
  });

  // ğŸŸ¡ å¦‚æœ fetchProjectList åªåœ¨ useEffect ä¸­ç”¨åˆ°ï¼Œä½ è¿˜å¯ä»¥ç›´æ¥å°†å…¶å®šä¹‰åœ¨ useEffect å†…éƒ¨ï¼Œé¿å…ä½¿ç”¨ useCallback
  const fetchProjectList = useCallback(
    async (params = {}) => {
      const result = await fetchProjectData({
        bizId,
        pageNo: 1,
        pageSize: 10,
        ...params,
      });
      setDataSource(result);
    },
    [bizId],
  );
  
  // ...... ä¸­é—´éš”äº† 100 è¡Œå…¶ä»–ä»£ç  ......
  
  useEffect(() => {
    fetchProjectList({
      pageNo: 1,
      pageSize: 10,
    });
  }, [fetchProjectList]); // ğŸŸ¢ å®Œå…¨æ ¹æ® linter æç¤ºæ·»åŠ ä¾èµ–é¡¹
  
  return (
    <div>
      ......
    </div>
  );
};
```

Â å¦‚æœä¸€ä¸ªå‰ç«¯å›¢é˜Ÿå†³å®šæŠŠÂ ESLintÂ è§„åˆ™è°ƒæ•´ä¸ºÂ errorÂ çº§ï¼Œé‚£ä¹ˆå°±èƒ½å½»åº•é¢„é˜²å¯èƒ½ä¼šåˆ°æ¥çš„Â bugï¼Œå¹¶ä¸”å¤§å¤šæ•°çš„ç©ºä¾èµ–Â useEffectÂ éƒ½ä¸å°†å†æ˜¯ç©ºä¾èµ–ã€‚ä¸çŸ¥é“æœ‰å¤šå°‘å›¢é˜Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼Œè‡³å°‘ç›®å‰æˆ‘ä»¬æ²¡æœ‰è¿™ä¹ˆåšï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿™ä¹ˆåšæœ€å¤§çš„é—®é¢˜å°±æ˜¯åç»­é˜…è¯»è¿™äº›ä»£ç æ—¶ï¼Œæ²¡æ³•åŒºåˆ†å“ªäº›é€»è¾‘å®é™…ä¸Šæ˜¯åªä¼šåœ¨Â componentDidMountÂ æ—¶æ‰§è¡Œçš„ï¼ˆå³æƒ³çŸ¥é“åœ¨ä¸Šä¾‹ä¸­çš„Â bizIdÂ æ˜¯å¦ä¼šå˜åŒ–ï¼Œåªçœ‹å½“å‰ç»„ä»¶çš„ä»£ç æ˜¯æ— æ³•çŸ¥æ™“çš„ï¼‰ï¼Œå³å‰åºå¼€å‘è€…çš„éƒ¨åˆ†ä»£ç æ„å›¾ä¿¡æ¯å®Œå…¨ä¸¢å¤±äº†ã€‚

è¿™è¿èƒŒäº†è½¯ä»¶å·¥ç¨‹ä¸­çš„ä¸€æ¡é‡è¦åŸåˆ™â€œä¼˜å…ˆå»ä¹¦å†™èƒ½å¤Ÿè‡ªè¯´æ˜çš„ä»£ç â€ï¼Œå³ä¼˜å…ˆç”¨ä»£ç æœ¬èº«è€Œéæ³¨é‡Šç­‰å…¶ä»–å½¢å¼æ¥è¯´æ˜ä»£ç æ„å›¾ï¼ˆåœ¨[ã€ŠÂ CodeÂ CompleteÂ ä»£ç å¤§å…¨Â ã€‹](https://book.douban.com/subject/1477390/)ä¸­å°±æœ‰ä¸€ä¸ªç« èŠ‚å°±è®¨è®ºäº†è¿™ä¸ªè¯é¢˜ï¼‰ã€‚

å½“æˆ‘è¦åœ¨æ­¤åŸºç¡€ä¸Šç»§ç»­å¼€å‘æ—¶ï¼Œæœ€ä¿é™©çš„æ–¹å¼å°±æ˜¯å‡å®šæ‰€æœ‰Â useEffectÂ ä¸­ä¾èµ–çš„çŠ¶æ€éƒ½æ˜¯ä¼šä¸æ–­å˜åŒ–çš„ï¼Œæˆ‘ä¼šè®¤ä¸ºåœ¨è¿™ç§å‡è®¾çš„å‰æä¸‹å†™ä»£ç å¯¹å¿ƒæ™ºçš„æ¶ˆè€—å¾ˆå¤§ï¼Œå› ä¸ºä½ å¯èƒ½è¿˜è¦è€ƒè™‘å½“å‰ç»„ä»¶ä¸­é™¤äº†Â useEffectÂ ä¹‹å¤–çš„é€»è¾‘æ˜¯å¦ä¹Ÿæ”¯æŒè¿™äº›ä¾èµ–ä¸æ–­å˜åŒ–ï¼Œæ¯”å¦‚æ‰€æœ‰çš„å­ç»„ä»¶ï¼ˆç‰¹åˆ«æ˜¯é‚£äº›äºŒã€ä¸‰æ–¹åŒ…å†…çš„ç»„ä»¶ï¼Œå› ä¸ºå†å²åŸå› æˆ–è€…å…¬å¸å†…å›¢é˜Ÿè§„èŒƒå·®å¼‚ï¼Œè¿™äº›ç»„ä»¶è¢«ç¼–å†™æ—¶å¯èƒ½æ²¡æœ‰è¢«é™åˆ¶å¿…é¡»ä¸¥æ ¼éµå®ˆÂ react-hooks/exhaustive-depsÂ è§„åˆ™ï¼‰ã€‚

å¦‚æœæˆ‘ä»¬ä¾æ—§å°†è¿™ä¸ªÂ ESLintÂ è§„åˆ™ä¿æŒä¸ºÂ warnÂ çº§ï¼Œé™¤äº†å®¹æ˜“å‡ºç°çš„Â bugÂ ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼šåœ¨é˜…è¯»ä»–äººçš„ä»£ç æ—¶ï¼Œreact-hooks/exhaustive-depsÂ è¿™ä¸ªÂ ESLintÂ è§„åˆ™å®Œå…¨æ— æ³•å¸®æˆ‘ä»¬åˆ¤æ–­å†å²ä»£ç ä¸­çš„ç©ºä¾èµ–æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºè§„åˆ™æ— æ³•åˆ¤æ–­äººçš„æ„å›¾å’Œå¯¹éœ€æ±‚çš„ç†è§£ï¼Œè¿˜æ˜¯è¦æˆ‘ä»¬ç”¨è‚‰çœ¼å»åˆ¤æ–­ï¼Œè¿™ä¼šå¼•å‘ä¸€ä¸ªæ¶æ€§å¾ªç¯ï¼šä¸æ–­é™ä½å¼€å‘è€…å¯¹äºÂ react-hooks/exhaustive-depsÂ è¿™ä¸ªè§„åˆ™çš„ä½¿ç”¨é¢‘ç‡å’Œä¿¡ä»»åº¦ï¼ˆåŒ…æ‹¬å¼€å‘äººå‘˜åœ¨è‡ªå·±å¼€å‘çš„æ—¶å€™ï¼‰ã€‚

æ‰€ä»¥å¯¹äºâ€œåˆ¤æ–­ä¾èµ–â€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸¤ç§æ–¹å¼å„æœ‰åƒç§‹ï¼Œä¹Ÿå„æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„è§£å†³åŠæ³•ã€‚

å¯¹äºç›®å‰Â react-hooks/exhaustive-depsÂ çš„ä½¿ç”¨æƒ…å†µï¼Œæˆ‘ç®€å•åœ¨å›¢é˜Ÿå†…åšè¿‡ä¸€ä¸ªè°ƒæŸ¥ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/ff5856f3-7ffe-408b-b18c-0247bca14694.png)

ä»è¿™ä¸ªç®€å•çš„è°ƒæŸ¥å¯ä»¥å¾—å‡ºä¸€ä¸ªå›¢é˜Ÿå†…çš„åˆæ­¥ç»“è®ºï¼Œç›®å‰èƒ½å¤Ÿè¾ƒå¥½éµå®ˆè¿™ä¸ªÂ ESLintÂ è§„åˆ™çš„äººåº”è¯¥ä¸åˆ°Â 50%ï¼Œè¿˜æœ‰å¾ˆå¤šäººä¼šé€šè¿‡äººå·¥é˜…è¯»ä»£ç æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ·»åŠ ä¾èµ–é¡¹ï¼ˆä¸€èˆ¬éƒ½æ˜¯åœ¨æ¨¡æ‹ŸÂ componentDidMountÂ æ—¶å°±å¿½ç•¥Â linterÂ è§„åˆ™æ ¡éªŒäº†ï¼‰

æˆ‘è‡ªå·±é€‰äº†ã€cã€‘å®Œå…¨ä¸çœ‹ï¼Œå› ä¸ºæˆ‘åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨Â useEffectÂ æ˜¯ä¸ºäº†æ¨¡æ‹ŸÂ componentDidMountï¼Œåœ¨é˜…è¯»ä»–äººä»£ç æ—¶æˆ‘ä¹Ÿç”¨ç›‘å¬æ€ç»´å»ç†è§£ã€‚ä½†æ˜¯å®Œå…¨ä¸å‚è€ƒÂ linterÂ æç¤ºï¼Œä¼šå¯¹å¼€å‘è€…çš„ç»†å¿ƒç¨‹åº¦è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€Œä¸”è„‘å­ä¸èƒ½çŠ¯æµ‘ï¼Œå› ä¸ºä¸€äº›å¤æ‚åœºæ™¯ä¸­ä¼šæœ‰å¾ˆå¤šå±‚çº§çš„çˆ¶å­å‡½æ•°ï¼Œéœ€è¦äººå·¥å»æ’æŸ¥æ‰€æœ‰çš„çˆ¶å­å‡½æ•°ä¸­ç”¨åˆ°çš„å“åº”å¼å€¼ã€‚

## 2ã€useCallbackÂ çš„ä¼ æŸ“æ€§

### å¤§é‡çš„å†—ä½™ä»£ç 

å½“æˆ‘åœ¨é˜…è¯»é‚£äº›æŒ‰ç…§å®˜æ–¹æ¨èä¸¥æ ¼éµå®ˆÂ react-hooks/exhaustive-depsÂ è§„åˆ™çš„åŒäº‹å†™çš„ä»£ç æ—¶ï¼Œæˆ‘è§‰å¾—è¿™äº›ä»£ç ä¹Ÿå¼€å§‹å˜å¾—è¶Šæ¥è¶Šå†—ä½™ï¼š

```tsx
/**
 * ğŸŸ¡ å› ä¸ºè¿™äº› doSomething æ–¹æ³•è¦è¢«å¤ç”¨ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥å®šä¹‰åœ¨æŸä¸ª useEffect å†…éƒ¨
 */

const doSomethingX = useCallback(() => {
  // ......
}, [/* ...... */]);

// ......

const doSomethingG = useCallback(() => {
  // ......
}, [doSomethingX]);

const doSomethingF = useCallback(() => {
  // ......
}, [propsA, propsC]);

const doSomethingE = useCallback(() => {
  // ......
}, [stateB, propsF]);

const doSomethingD = useCallback(() => {
  // ......
}, [stateA, propsD]);

const doSomethingC = useCallback(() => {
  // ......
}, [stateC, doSomethingG]);

const doSomethingB = useCallback(() => {
  // ......
}, [doSomethingE, doSomethingF]);

const doSomethingA = useCallback(() => {
  // ......
}, [stateA, stateB, doSomethingD]);

useEffect(() => {
  doSomethingA();
  doSomethingB();
}, [doSomethingA, doSomethingB]);

useEffect(() => {
  if (stateA) {
    doSomethingC();
  }
}, [stateA, doSomethingC]);
```

**åªè¦çˆ¶çº§å‡½æ•°è¢«Â useCallbackÂ åŒ…è£¹äº†ï¼Œæ‰€æœ‰çš„å­å­å­™å­™çš„å‡½æ•°éƒ½å¿…é¡»è¦è¢«Â useCallbackÂ åŒ…è£¹ï¼Œè¿™äº›Â useCallbackÂ å’ŒÂ depsÂ ä¸ä»£è¡¨ä»»ä½•ä¸šåŠ¡æ„ä¹‰ï¼Œå…¨éƒ¨éƒ½æ˜¯ä»£ç å™ªéŸ³ï¼Œå¼€å‘è€…ä¸ºä»€ä¹ˆè¦å…³å¿ƒè¿™äº›ä¸œè¥¿ï¼Ÿè®©æˆ‘æ„Ÿè§‰ä¸æ˜¯Â ReactÂ åœ¨ç»™æˆ‘ä»¬ææ•ˆï¼Œè€Œæ˜¯æˆ‘ä»¬åœ¨ç»™Â ReactÂ å½“ç‰›é©¬ã€‚**

### éš¾ä»¥è‡ªåŠ¨åŒ–

é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½é¿å…è¿™ä¸ªé—®é¢˜å‘¢ï¼ŒReactÂ å½“åˆåœ¨å®˜æ–¹æ–‡æ¡£å¯æ˜¯ç»™æˆ‘ä»¬ç”»äº†é¥¼çš„ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/a4618fba-6cf0-4d91-b9df-163fd06e3294.png)

å¦‚æœè¿™ä¸ªé¥¼èƒ½åƒåˆ°ï¼Œé‚£æ—¢ä¸ç”¨å¼€å‘è€…å­å“§å­å“§å¹²è‹¦åŠ›ï¼Œåœ¨æºç ä¸­ä¹Ÿä¸ä¼šå‡ºç°è¿™äº›Â useCallbackÂ å’ŒÂ depsÂ é€ æˆä»£ç å™ªéŸ³ã€‚ä½†æ˜¯å½“æˆ‘å¦‚ç¬¬äºŒç« ä¸­è¯´çš„ç”¨â€œç›‘å¬â€å»ç†è§£Â useEffectÂ æ—¶ï¼Œå°±å‘ç°äº†è¿™ä¸ªåŠŸèƒ½è²Œä¼¼æ— æ³•å®ç°ï¼Œå› ä¸ºç›‘å¬äº†ä»€ä¹ˆçŠ¶æ€ï¼Œå¹¶ä¸æ„å‘³ç€æˆ‘å¤„ç†ç›‘å¬å›è°ƒçš„æ—¶å€™åªèƒ½ç”¨åˆ°è¿™äº›çŠ¶æ€ï¼š

```tsx
const [timestamp, setTimestamp] = useState(0);
const [firstName, setFirstName] = useState('Hua');
const [lastName, setLastName] = useState('Li');

useEffect(() => {
  // ä»…åœ¨å§“åå˜åŒ–çš„æ—¶å€™è¿›è¡Œæ‰“å°
  console.log(`Name was changed to ${firstName} ${lastName} at ${timestamp}.`)
}, [lastName, firstName]); // ğŸŸ¡ å¦‚æœç›‘å¬äº† timestampï¼Œé‚£ä¹ˆæ¯å½“ timestamp å˜åŒ–æ—¶å°±ä¼šæ‰“å° `Name was changed ...`ï¼Œä½†å®é™… name æ²¡å˜
```

å¦‚ä¸Šçš„ä¾‹å­ä¸­ï¼Œè‹¥è¦å®ç°è¿™ä¸ªæ‰“å°è¯‰æ±‚ï¼Œä¾èµ–æ•°ç»„ä¸­çš„çŠ¶æ€å’Œå›è°ƒå‡½æ•°ä¸­çœŸå®ä½¿ç”¨åˆ°çš„çŠ¶æ€å°±æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ„å»ºè¿‡ç¨‹æ˜¯æ— æ³•åŒºåˆ†è¿™ç§åœºæ™¯å’Œå¸¸è§„çš„å‰¯ä½œç”¨åœºæ™¯çš„ã€‚**é™¤éå¯¹è¿™ä¸ªçŠ¶æ€é‡å°±æ˜¯ä¸ä¸€è‡´çš„åœºæ™¯é€šè¿‡æ³¨é‡Šç­‰çš„å½¢å¼è¿›è¡Œæ ‡è®°ï¼Œç„¶è€Œä»Â ReactÂ HookÂ æ¨å‡ºåˆ°ç°åœ¨å·²ç»è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œåšè¿™ä¸ªäº‹æƒ…çš„å‰æå°±è¦å¯¹æ•´ä¸ªÂ ReactÂ HookÂ ç”Ÿæ€ä»¥åŠæ‰€æœ‰å…¬å¸è‡ªå·±çš„ä¸šåŠ¡ä»£ç åšä¸€æ¬¡å¤§æ’æŸ¥æ ‡è®°å‡ºè¿™ç§åœºæ™¯ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤ªå¯èƒ½çš„ã€‚**

## 3ã€è¿‡åº¦çš„å“åº”å¼ç¼–ç¨‹

### useEffectÂ vsÂ äº‹ä»¶å“åº”å‡½æ•°

ReactÂ è¿™ä¸ªå‰ç«¯æ¡†æ¶çš„åå­—ä¹‹æ‰€ä»¥å«åšÂ â€œReactâ€ï¼Œæˆ‘çŒœåº”è¯¥æ˜¯å› ä¸ºç›¸æ¯”äºÂ jQueryÂ ç­‰ä¸Šä¸€ä»£å¼€å‘æ¨¡å¼ï¼Œåœ¨Â ReactÂ ä¸­å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ¡†æ¶ä¼šæ ¹æ®çŠ¶æ€çš„å˜åŒ–æ¥è‡ªåŠ¨æ›´æ–°Â UIÂ è§†å›¾ï¼Œè€Œä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨DOMÂ APIÂ ä¿®æ”¹Â UIÂ è§†å›¾ï¼Œå³å®ç°äº†ä¸€ç§ä»çŠ¶æ€åˆ°Â UIÂ è§†å›¾çš„å“åº”å¼ç¼–ç¨‹ï¼ˆReactiveÂ Programmingï¼‰ã€‚

å½“æˆ‘ä»¬å°†æ‰€æœ‰çš„å‰¯ä½œç”¨é€»è¾‘ï¼ˆæ•°æ®è¯·æ±‚ã€è®¾ç½®è®¢é˜…ç­‰ï¼‰éƒ½å†™åœ¨äº†Â useEffectÂ ä¸­æ—¶ï¼Œå…¶å®å°±æ˜¯å®ç°äº†ä»çŠ¶æ€åˆ°å‰¯ä½œç”¨é€»è¾‘çš„å“åº”å¼ç¼–ç¨‹ï¼Œæ›´ç›´ç™½åœ°è¯´å°±æ˜¯Â reactÂ è‡ªåŠ¨åœ°ç›‘å¬æˆ‘ä»¬å£°æ˜çš„ä¾èµ–ï¼Œè‡ªåŠ¨åœ°æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚è¿™å’Œæˆ‘ä»¬åœ¨ä½¿ç”¨Â ClassÂ ComponentÂ ç±»ç»„ä»¶å¼€å‘æ—¶ï¼Œå°†ç»„ä»¶çš„æ‰€æœ‰çš„å‰¯ä½œç”¨é€»è¾‘éƒ½å†™åœ¨Â componentDidUpdateÂ ä¸­æ˜¯æ²¡æœ‰æœ¬è´¨å·®åˆ«çš„ã€‚

æˆ‘è®¤ä¸ºè¿™ä¹ˆåšæœ€å¤§çš„é—®é¢˜ä¸åœ¨äºé¦–æ¬¡å¼€å‘é˜¶æ®µï¼Œè€Œåœ¨äºé˜…è¯»å†å²ä»£ç é€»è¾‘å’Œè¿­ä»£å¼€å‘æ—¶ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªåå°é¡¹ç›®åˆ—è¡¨é¡µï¼Œä»¥åŠå¸¸è§çš„åº•éƒ¨é¡µç ç¿»é¡µåŠŸèƒ½ï¼š

```tsx
// æ¸²æŸ“è¿‡ç¨‹ä¹Ÿä¾èµ– pageNo å’Œ projectList è¿™ä¸¤ä¸ªçŠ¶æ€
const [pageNo, setPageNo] = useState(1);
const [projectList, setProjectList] = useState([]);

const handlePageNoBtnClick = (targetPageNo) => {
  setPageNo(targetPageNo);
};

const handleNextPageBtnClick = () => {
  const targetPageNo = pageNo + 1;
  setPageNo(targetPageNo);
};

const handlePrevPageBtnClick = () => {
  const targetPageNo = pageNo - 1;
  setPageNo(targetPageNo);
};

// ğŸŸ¡ å½“ fetchProjectList å†…çš„é€»è¾‘è¢«ä¿®æ”¹åï¼Œéš¾ä»¥è¯„ä¼°è¿™ä¸ªæ”¹åŠ¨çš„å½±å“é¢
const fetchProjectList = useCallback(
  async () => {
    const query = qs.stringify({
      projectType: props.projectType, // projectType æ˜¯é€šè¿‡ props è·å¾—çš„ 
      pageSize: 20,
      pageNo,
    });
    const response = await fetch(`/project/list?${query}`);
    const json = await response.json();
    setProjectList(json);
  },
  [pageNo, props.projectType],
);

useEffect(() => {
  fetchProjectList();
}, [fetchProjectList]);
```

æ¯”å¦‚å½“æˆ‘ä»¬ä¿®æ”¹äº†Â fetchProjectListÂ å†…çš„é€»è¾‘ï¼Œæ¯”å¦‚å¢åŠ äº†ä¸€ä¸ªçŠ¶æ€ä¾èµ–Â pageSizeï¼Œæˆ‘ä»¬éœ€è¦æ¢³ç†å“ªäº›åœºæ™¯ä¼šè§¦å‘æ¥å£è¯·æ±‚å¹¶å°†æ­¤ä½œä¸ºæµ‹è¯•é‡ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ç»å†ä»¥ä¸‹æ­¥éª¤ï¼š

*   æ˜ç¡®Â fetchProjectListÂ ä¼šåœ¨å“ªäº›åœºæ™¯ä¸­è¢«è°ƒç”¨ï¼š
    
    *   è‹¥åªåœ¨è¿™ä¸ªÂ useEffectÂ ä¸­è¢«è°ƒç”¨ï¼Œåªéœ€è¦çœ‹Â useCallbackÂ ä¾èµ–ä»€ä¹ˆæ—¶å€™ä¼šå˜åŒ–å³å¯
        
    *   è‹¥è¿˜æœ‰Â useEffectÂ ä¹‹å¤–çš„åœ°æ–¹è°ƒç”¨ï¼Œåˆ™éœ€è¦å•ç‹¬åˆ—å‡ºæ¥
        
*   æ˜ç¡®Â pageNoÂ ä¼šåœ¨å“ªäº›åœºæ™¯ä¸­å˜åŒ–ï¼š
    
    *   å…ˆæ‰¾åˆ°Â pageNoÂ å¯¹åº”çš„Â setPageNo
        
    *   å†æ‰¾åˆ°æ‰€æœ‰å¼•ç”¨å¹¶æ‰§è¡ŒÂ setPageNoÂ çš„åœ°æ–¹
        
*   æ˜ç¡®Â pageSizeÂ ä¼šåœ¨å“ªäº›åœºæ™¯ä¸­å˜åŒ–ï¼š
    
    *   å…ˆæ‰¾åˆ°Â pageSizeÂ å¯¹åº”çš„Â setPageSize
        
    *   å†æ‰¾åˆ°æ‰€æœ‰å¼•ç”¨å¹¶æ‰§è¡ŒÂ setPageSizeÂ çš„åœ°æ–¹
        
*   æ˜ç¡®Â props.projectTypeÂ ä¼šåœ¨å“ªäº›åœºæ™¯ä¸­å˜åŒ–ï¼š
    
    *   å…ˆæ‰¾åˆ°çˆ¶ç»„ä»¶ä¸­çš„Â projectType={stateX}
        
    *   å†æ‰¾åˆ°Â stateXÂ å¯¹åº”çš„Â setStateX
        
    *   æœ€åæ‰¾åˆ°æ‰€æœ‰å¼•ç”¨å¹¶æ‰§è¡ŒÂ setStateXÂ çš„åœ°æ–¹
        
*   åˆ†æä»¥ä¸Šä¸‰ä¸ªçŠ¶æ€å˜åŒ–çš„åœºæ™¯
    
    *   åˆå¹¶å› ä¸ºçŠ¶æ€åˆå§‹åŒ–æˆ–è€…åŒæ—¶æ”¹å˜è€Œåˆå¹¶è¯·æ±‚çš„æƒ…å†µ
        
    *   æœ€åå¾—åˆ°æˆ‘ä»¬éœ€è¦çš„é‡ç‚¹æµ‹è¯•çš„åœºæ™¯
        

ä»¥ä¸Šè¿‡ç¨‹éå¸¸ç¹çï¼Œåœ¨æ›´å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ä¸­ä¼šå¤§å¤§é™ä½ä»£ç çš„å¯è¯»æ€§ï¼Œå°±æ˜¯æˆ‘åœ¨ç¬¬äºŒç« æåˆ°è¿‡è¿™å¾ˆå¯æ€•çš„åŸå› ï¼šå“åº”å¼çš„è®¾è®¡ä¼šå°†åŸæœ¬è¿è´¯çš„å‡½æ•°è°ƒç”¨é“¾è¢«åˆ‡åˆ†æˆå¾ˆå¤šä¸ªå‰¯ä½œç”¨é€»è¾‘ç‰‡æ®µ+äº‹ä»¶å“åº”å‡½æ•°ç‰‡æ®µï¼Œæ¯ä¸ªé€»è¾‘ç‰‡æ®µå†…çš„å‡½æ•°è°ƒç”¨é“¾æ˜¯å®Œæ•´çš„ï¼Œç‰‡æ®µå’Œç‰‡æ®µä¹‹é—´çš„å…³ç³»åˆ™æ˜¯æå…¶åˆ†æ•£çš„ï¼ˆåƒä¸€äº›çŠ¶æ€ç®¡ç†æ–¹æ¡ˆä¸­çš„Â dispatchÂ æ–¹æ³•ï¼Œå…¶å®ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œå³ä¸¢å¤±äº†ç›´æ¥çš„è°ƒç”¨å…³ç³»ï¼‰ã€‚

ä½œä¸ºå¯¹æ¯”ï¼Œå¦‚æœå°†é¡¹ç›®åˆ—è¡¨æ¥å£çš„è¯·æ±‚é€»è¾‘å®ç°åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼š

```tsx
// æ¸²æŸ“è¿‡ç¨‹ä¹Ÿä¾èµ– pageNo å’Œ projectList è¿™ä¸¤ä¸ªçŠ¶æ€
const [pageNo, setPageNo] = useState(1);
const [projectList, setProjectList] = useState([]);

// ğŸŸ¢ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰¾åˆ° fetchProjectList è¢«è°ƒç”¨çš„åœ°æ–¹
const fetchProjectList = async (params = {}) => {
  const query = qs.stringify({
    projectType: params.projectType || props.projectType, // ä¼˜å…ˆä» params ä¸­è¯»å– projectType
    pageSize: 20,
    pageNo: params?.pageNo ?? 1,
  });
  const response = await fetch(`/project/list?${query}`);
  const json = await response.json();
  setProjectList(json);
};

const handlePageNoBtnClick = (targetPageNo) => {
  setPageNo(targetPageNo);
  fetchProjectList({ pageNo: targetPageNo });
};

const handleNextPageBtnClick = () => {
  const targetPageNo = pageNo + 1;
  setPageNo(targetPageNo);
  fetchProjectList({ pageNo: targetPageNo });
};

const handlePrevPageBtnClick = () => {
  const targetPageNo = pageNo - 1;
  setPageNo(targetPageNo);
  fetchProjectList({ pageNo: targetPageNo });
};

// ğŸŸ¡ å¦‚æœ props.projectType æ˜¯ä¼šå˜åŒ–çš„
// å¦‚æœ projectType å˜åŒ–æ—¶ï¼Œæœ¬ç»„ä»¶å†…çš„æ‰€æœ‰ state çŠ¶æ€éƒ½åº”è¯¥é‡ç½®
//   å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­å¼•ç”¨æœ¬ç»„ä»¶æ—¶å¢åŠ  key å±æ€§ï¼Œå³ key={projectType}
//   æ¯å½“ projectType å˜åŒ–æ—¶ï¼Œå½“å‰ç»„ä»¶å®ä¾‹ä¼šè¢«é”€æ¯ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶å®ä¾‹
// å¦‚æœ projectType å˜åŒ–æ—¶ï¼Œæœ¬ç»„ä»¶å†…çš„éƒ¨åˆ† state çŠ¶æ€è¿˜æ˜¯è¦ä¿ç•™ï¼ˆå‡è®¾ pageNoã€projectList ä¹‹å¤–è¿˜æœ‰åˆ«çš„ state çŠ¶æ€ï¼‰
//   åˆ™å¯ä»¥å®šä¹‰ä¸€ä¸ª refreshProjectListByType æ–¹æ³•é€šè¿‡ ref æš´éœ²ç»™çˆ¶ç»„ä»¶
//   è®©çˆ¶ç»„ä»¶åœ¨æ”¹å˜ projectType ä¹‹åæ‰‹åŠ¨è°ƒç”¨ refreshProjectListByType æ–¹æ³•
useImperativeHandle(ref, () => ({
  refreshProjectListByType: (targetProjectType) => {
    setPageNo(1);
    setProjectList([]);
    fetchProjectList({ projectType: targetProjectType });
  },
}));

useEffect(() => {
  fetchProjectList();
}, []);
```

å½“ä¿®æ”¹äº†Â fetchProjectListÂ å†…çš„é€»è¾‘æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ç”¨æˆ·äº‹ä»¶å“åº”å‡½æ•°ä¸­ä¸»åŠ¨æ§åˆ¶äº†è¯·æ±‚çš„è§¦å‘æ—¶æœºï¼Œè€Œä¸æ˜¯è®©è¯·æ±‚åœ¨Â useEffectÂ ä¸­â€œè‡ªåŠ¨è§¦å‘â€ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æ‰€æœ‰å¼•ç”¨Â fetchProjectListÂ çš„åœ°æ–¹å°±å¯ä»¥äº†ï¼Œä¸€æ­¥æå®šï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/b281bb57-1269-47ee-825b-f50088d2f998.png)

ä¸è¿‡è¿™æ ·å®ç°è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚å·®å¼‚ï¼šå¯¹æ¯”Â useEffectÂ çš„å®ç°æ–¹å¼ï¼Œè¿™é‡Œçš„Â fetchProjectListÂ éœ€è¦å¢åŠ Â paramsÂ å…¥å‚ã€‚æˆ‘æ›¾è®¾æƒ³è¿‡ä¸ºä»€ä¹ˆä¸èƒ½åƒç±»ç»„ä»¶çš„Â this.setStateÂ ä¸€æ ·å¢åŠ ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°å‚æ•°ï¼š

```tsx
/**
 * ç±»ç»„ä»¶
 */
this.setState(
  {
    pageNo: targetPageNo,
  },
  () => {
    // ç­‰çŠ¶æ€å·²ç»å®Œæˆå˜æ›´åå†è§¦å‘è¯·æ±‚ï¼Œè¿™æ ·å°±æ— éœ€å†è®¾ç½®å‡½æ•°å…¥å‚
    this.fetchProjectList();
  }
);

/**
 * å‡½æ•°ç»„ä»¶
 * å‡è®¾ useState çš„ set å‡½æ•°ä¹Ÿæ”¯æŒç¬¬äºŒä¸ªå›è°ƒå‡½æ•°å‚æ•°
 */
setPageNo(targetPageNo, () => {
  // è¿™ä¸ªå›è°ƒæ‰§è¡Œçš„æ—¶å€™ï¼ŒçŠ¶æ€å·²ç»å˜æ›´å¥½äº†
  
  fetchProjectList(); // ğŸ”´ ä½†æ˜¯å› ä¸ºé—­åŒ…é—®é¢˜ fetchProjectList ä¸­æ‹¿åˆ°çš„ pageNo è¿˜æ˜¯æ—§å€¼
  
  fetchProjectList({ pageNo: targetPageNo }); // ğŸŸ¢ æ‰€ä»¥åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å°† state ç±»çš„å‚æ•°ä¹Ÿä½œä¸ºå‡½æ•°å…¥å‚é‡æ–°ä¼ é€’ä¸€é
});
```

ä¸ºä»€ä¹ˆå‰¯ä½œç”¨é€»è¾‘å“åº”å¼ä¼šæœ‰ä¸Šè¿°éš¾ä»¥æ’æŸ¥å®é™…è°ƒç”¨æ–¹çš„é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºÂ UIÂ è§†å›¾å“åº”å¼è®¾è®¡æˆ‘ä»¬è²Œä¼¼æ²¡æœ‰æ„ŸçŸ¥åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œæˆ‘è®¤ä¸ºä¸»è¦æ˜¯å› ä¸ºå‰¯ä½œç”¨é€»è¾‘å¤§å¤šæ—¶å€™ä¼šæœ‰å¤šä¸ªçŠ¶æ€ä¾èµ–ï¼Œä½†æ˜¯é˜…è¯»å’Œæ¢³ç†Â UIÂ è§†å›¾é€»è¾‘æ—¶ï¼Œæˆ‘ä»¬ä¸€æ¬¡å¤§å¤šåªçœ‹ä¸€ä¸ªçŠ¶æ€å³å¯ï¼Œæ¯”å¦‚ï¼šâ€œlistÂ æ•°æ®ä»å“ªæ¥ï¼Ÿâ€ã€â€œvisibleÂ ä»€ä¹ˆæ—¶å€™ä¼šå˜æˆÂ trueÂ ï¼Ÿâ€ç­‰ç­‰ã€‚è€Œä¸”Â UIÂ å“åº”å¼ï¼ˆæˆ–è€…è¯´çŠ¶æ€æœºçš„è®¾è®¡ï¼‰ç¡®å®æ¯”ä¸Šä¸€ä»£ç›´æ¥æ“ä½œÂ DOMÂ çš„å¼€å‘æ¨¡å¼è¦ä¾¿æ·ã€‚

å¦‚æœä½ å¹³å¸¸ä¹Ÿæ˜¯è¿™ä¹ˆä½¿ç”¨Â useEffectÂ çš„ï¼Œå´æ²¡æœ‰æ˜æ˜¾åœ°æ„Ÿå—åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¯èƒ½æ˜¯å› ä¸ºä½ å¯¹å½“å‰åœ¨å¼€å‘çš„å‰ç«¯å·¥ç¨‹éå¸¸ç†Ÿæ‚‰ï¼ˆä»£ç éƒ½æ˜¯ä½ å†™çš„ï¼‰ï¼Œæˆ–è€…å¯¹è¿™ä¸€ç±»åŠŸèƒ½çš„é€»è¾‘éå¸¸ç†Ÿæ‚‰ï¼ˆæ¯”å¦‚å¸¸è§çš„åˆ—è¡¨æŸ¥è¯¢ï¼‰ï¼Œä½ è‡ªç„¶åœ°èƒ½æƒ³åˆ°æµ‹è¯•é‡ç‚¹è€Œä¸ç”¨ä»”ç»†æ¢³ç†ä»£ç é€»è¾‘ï¼Œè¿™ä¸ªå…¶å®å°±æ˜¯ä¸¥é‡ä¾èµ–å¼€å‘è€…çš„ç´ è´¨å’Œä¸šåŠ¡çŸ¥è¯†ä¼ é€’çš„æ•ˆç‡ã€‚

å½“æˆ‘ä»¬é€æ¸ä¹ æƒ¯åœ¨ä¸€äº›ç›¸å¯¹ç®€å•çš„åŠŸèƒ½åœºæ™¯ä¸­æŠŠè¿™ç±»å‰¯ä½œç”¨é€»è¾‘éƒ½å†™åœ¨Â useEffectÂ ä¸­åï¼ŒæŸä¸€å¤©æˆ‘ä»¬è¦å»å®ç°ä¸€äº›é€»è¾‘æ›´åŠ å¤æ‚çš„äº¤äº’åŠŸèƒ½æ—¶ï¼Œä¼šè‡ªç„¶è€Œç„¶åœ°å»ä¿æŒè¿™ç§ç ”å‘ä¹ æƒ¯ï¼Œåœ¨æ­£å‘å¼€å‘çš„æ—¶å€™ä½ å¯èƒ½æ„Ÿå—ä¸åˆ°å¤§çš„é˜»åŠ›ï¼Œä½†æ˜¯å½“å¼€å‘å®Œæˆåï¼Œæ¢å¦ä¸€ååŒäº‹æ¥è¿›è¡ŒÂ CodeÂ ReviewÂ æ—¶ï¼Œä¸æå‰äº†è§£éœ€æ±‚çš„æƒ…å†µä¸‹æ ¹æœ¬ä¸èƒ½å¿«é€Ÿçœ‹æ‡‚ä»£ç é€»è¾‘ã€‚

ä¸¾ä¸€ä¸ªæ¯”åˆ—è¡¨ç¿»é¡µå†ç•¥å¾®å¤æ‚ä¸€ç‚¹çš„ç¤ºä¾‹è®©å¤§å®¶æ›´æ¸…æ™°åœ°æ„Ÿå—åˆ°è¿™ä¸ªé—®é¢˜ã€‚æ¯”å¦‚åœ¨ä¸€ä¸ªé¡¹ç›®è¯¦æƒ…é¡µä¸­ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½æœ‰è‹¥å¹²ä¸ªå…¬å‘Šï¼Œç”¨æˆ·å¯ä»¥å•é€‰æŸä¸ªå…¬å‘Šï¼Œè¢«é€‰ä¸­çš„å…¬å‘Šä¼šè‡ªåŠ¨å±•ç¤ºç›¸å…³çš„å‘å¸ƒä¿¡æ¯å’Œé—®é¢˜åé¦ˆä¿¡æ¯ï¼š

```tsx
/**
 * ä»¥ä¸‹æ‰€æœ‰çš„ useXxxInfo/List ç±»ä¸šåŠ¡è‡ªå®šä¹‰ Hook éƒ½å°è£…äº†åœ¨ useEffect ä¸­è¿›è¡Œæ¥å£è¯·æ±‚çš„é€»è¾‘ï¼Œå¤šä¸ª Hook ä¹‹é—´ç›¸äº’è”åŠ¨
 */

const ProjectDetailPage = (props) => {
  const { projectId } = props;

  // selectedAnnouncementId ä¸º UI æ¸²æŸ“ä¸­ä¼šç”¨åˆ°çš„ä¸€ä¸ª state
  const [selectedAnnouncementId, setSelectedAnnouncementId] = useState(null);

  // æ¯å½“ projectId å˜åŒ–æ—¶ï¼š
  //   useProjectInfo å†…éƒ¨ä¼šè‡ªåŠ¨è¯·æ±‚é¡¹ç›®è¯¦æƒ…æ¥å£
  const projectInfo: ProjectInfo | null = useProjectInfo(projectId);

  // æ¯å½“ projectId å’Œ bizId å˜åŒ–æ—¶ï¼š
  //   è‹¥ä¸¤è€…éƒ½æœ‰å€¼æ—¶ï¼ŒuseAnnouncementList å†…éƒ¨ä¼šè‡ªåŠ¨è¯·æ±‚å…¬å‘Šåˆ—è¡¨æ¥å£
  //   å¦åˆ™ announcementList ä¼šå˜æˆç©ºæ•°ç»„
  const announcementList: Announcement[] = useAnnouncementList({
    projectId: projectInfo?.id,
    bizId: projectInfo?.bizId,
  });

  // æ¯å½“ selectedAnnouncementId å˜åŒ–æ—¶ï¼š
  //   è‹¥ selectedAnnouncementId æœ‰å€¼ï¼ŒusePublishInfo å†…éƒ¨ä¼šè‡ªåŠ¨è¯·æ±‚è¯¥å…¬å‘Šå¯¹åº”çš„å‘å¸ƒç›¸å…³ä¿¡æ¯
  //   å¦åˆ™ publishInfo å˜æˆ null
  const publishInfo: PublishInfo | null = usePublishInfo({
    announcementId: selectedAnnouncementId,
  });

  // æ¯å½“ selectedAnnouncementId å˜åŒ–æ—¶ï¼š
  //   è‹¥ selectedAnnouncementId æœ‰å€¼ä¸” isAllowFeedback ä¸ºçœŸï¼Œåˆ™ useFeedbackList å†…éƒ¨ä¼šè‡ªåŠ¨è¯·æ±‚è¯¥å…¬å‘Šå‘å¸ƒåçš„ç”¨æˆ·åé¦ˆä¿¡æ¯
  //   å¦åˆ™ feedbackList å˜æˆ []
  const feedbackList: FeedbackInfo[] = useFeedbackList({
    announcementId: selectedAnnouncementId,
    isAllowFeedback: projectInfo?.isAllowFeedback,
  });

  // ç”¨æˆ·å•é€‰é€‰ä¸­æŸæ¡å…¬å‘Šä¿¡æ¯
  const handleAnnouncementRowSelect = (row) => {
    // ğŸ”´ ä»è¿™ä¸ªäº‹ä»¶å“åº”å‡½æ•°ä¸­ï¼Œæ ¹æœ¬çœ‹ä¸å‡ºè¿™ä¸ªç”¨æˆ·æ“ä½œåˆ°åº•è§¦å‘äº†ä»€ä¹ˆé€»è¾‘
    setSelectedAnnouncementId(row.id);
  };

  // ...
};

```

**è¿™ä¸ªç¤ºä¾‹å’Œå®˜æ–¹æ–‡æ¡£æåˆ°è¿‡çš„**Â [**é“¾å¼è®¡ç®—**](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#chains-of-computations)Â **å¾ˆç›¸ä¼¼ï¼Œåªæ˜¯è¿™é‡Œçš„Â useEffectÂ ä¸­çœŸçš„æœ‰è¯·æ±‚æ•°æ®ç±»çš„å‰¯ä½œç”¨ï¼Œé—®é¢˜åœ¨äºæˆ‘ä»¬å¾ˆéš¾ç›´è§‚åœ°ä»è¿™ç§ä»£ç ä¸­çœ‹å‡ºæ¥æŸä¸ªç”¨æˆ·äº‹ä»¶è¢«è§¦å‘ä¹‹åï¼ŒJavaScirptÂ åˆ°åº•ä¼šæ‰§è¡Œäº›ä»€ä¹ˆé€»è¾‘ï¼Œå¹¶ä¸”çœŸå®é¡¹ç›®ä¸­ä¸å¯èƒ½æœ‰è¿™ä¹ˆå¤šæ³¨é‡Šï¼Œå¹¶ä¸”åœ¨ä¸€äº›é€»è¾‘æ›´åŠ å¤æ‚çš„ç”¨æˆ·äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œå¯èƒ½éœ€è¦åŒæ—¶è§¦å‘æäº¤ç±»æ¥å£è¯·æ±‚å’Œæ•°æ®æŸ¥è¯¢ç±»æ¥å£è¯·æ±‚ã€‚**

æ‰€ä»¥æˆ‘ä»¬å»æ‰æ³¨é‡Šï¼Œæ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚æ¥ç¼–ç ï¼Œè€Œä¸æ˜¯ä¸€è‚¡è„‘å°†æ‰€æœ‰è¯·æ±‚éƒ½æ”¾åˆ°Â useEffectÂ ä¸­ï¼Œç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨é€»è¾‘éƒ½ç§»åˆ°Â selectÂ äº‹ä»¶å“åº”å‡½æ•°ä¸­ï¼š

```tsx
const ProjectDetailPage = (props) => {
  const { projectId } = props;

  const [projectInfo, setProjectInfo] = useState<ProjectInfo | null>(null);
  const [announcementList, setAnnouncementList] = useState<Announcement[]>([]);
  const [publishInfo, setPublishInfo] = useState<PublishInfo | null>(null);
  const [feedbackList, setFeedbackList] = useState<FeedbackInfo[]>([]);

  const [selectedAnnouncementId, setSelectedAnnouncementId] = useState(null);

  const fetchPublishInfoById = async (id) => {
    const info = await fetchPublishInfo({ announcementId: id });
    setPublishInfo(info);
  };

  const fetchFeedbackListIfNeed = async (id) => {
    if (projectInfo?.isAllowFeedback) {
      const list = await fetchFeedbackList({ announcementId: id });
      setFeedbackList(list);
    } else {
      setFeedbackList([]);
    }
  };

  // ç”¨æˆ·å•é€‰é€‰ä¸­æŸæ¡å…¬å‘Šä¿¡æ¯
  const handleAnnouncementRowSelect = async (row) => {
    // ğŸŸ¢ é€šè¿‡ç”¨æˆ·äº‹ä»¶å“åº”å‡½æ•°ï¼Œå¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹å‡ºè¿™ä¸ªç”¨æˆ·äº‹ä»¶è§¦å‘äº†ä»€ä¹ˆé€»è¾‘
    const id = row.id;
    setSelectedAnnouncementId(id);
    fetchPublishInfoById(id);
    fetchFeedbackListIfNeed(id);
  };

  // é¡µé¢åˆå§‹åŒ–é€»è¾‘
  const init = async () => {
    const info = await fetchProjectInfo(projectId);
    setProjectInfo(info);
    const list = await fetchAnnouncementList({
      projectId: info.id,
      bizId: info.bizId,
    });
    setAnnouncementList(list);
  };

  useEffect(() => {
    init();
  }, []); // ğŸŸ¡ ä¸šåŠ¡ä¸Šå¯ä»¥ç¡®å®š projectId ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥å£°æ˜äº†ç©ºä¾èµ–

  // ...
};
```

**æ”¹å†™ä¹‹åé€»è¾‘å˜å¾—æ¸…æ™°å¤šäº†ï¼Œè‡ªå®šä¹‰Â HookÂ ä¹‹é—´çš„è”åŠ¨é€»è¾‘å˜æˆäº†ç®€å•çš„ä¸²è¡Œæˆ–è€…å¹¶è¡Œé€»è¾‘ã€‚**ä½†ä½ å¯èƒ½å‘ç°ä»£ç è¡Œæ•°çªç„¶å˜å¤šäº†ï¼Œå› ä¸ºæˆ‘ä»¬æŠŠå¾ˆå¤šåŸæœ¬è‡ªå®šä¹‰Â HookÂ ä¸­çš„å‡½æ•°å’ŒÂ stateÂ éƒ½ä¸´æ—¶æŒªäº†å‡ºæ¥ï¼Œæœ¬æ–‡åç»­ä¼šåœ¨ä»‹ç»æˆ‘ä»¬çš„Â useEffectÂ çš„æ›¿ä»£æ–¹æ¡ˆæ—¶å†è®¨è®ºå¦‚ä½•å°è£…ä¸€ä¸ªè‡ªå®šä¹‰Â Hookã€‚

è¿™é‡Œå†æä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼Œæ”¹å†™åä»£ç çš„Â handleAnnouncementRowSelectÂ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå…¶å®è¿˜åšäº†å­å‡½æ•°çš„æ‹†åˆ†ã€‚å¹¶ä¸æ˜¯åªæœ‰ä»£ç éœ€è¦å¤ç”¨æ—¶æˆ‘ä»¬æ‰åº”è¯¥åˆ›å»ºå­å‡½æ•°ï¼Œå¼ºçƒˆæ¨èæ‰€æœ‰äººéƒ½é˜…è¯»ä¸€ä¸‹[ã€ŠÂ CodeÂ CompleteÂ ä»£ç å¤§å…¨Â ã€‹](https://book.douban.com/subject/1477390/)ä¸­çš„ç¬¬Â 7Â ç« Â _â€œé«˜è´¨é‡çš„å­ç¨‹åºâ€_Â å­¦ä¹ å¦‚ä½•é€šè¿‡æ‹†åˆ†å­å‡½æ•°é™ä½é€»è¾‘å¤æ‚åº¦ã€å¯¹å…³é”®è¿‡ç¨‹è¿›è¡ŒæŠ½è±¡ã€‚æ¯”å¦‚ä¸€ä¸ªæ›´å¤æ‚çš„æäº¤æ“ä½œï¼Œå¦‚æœæŒ‰ä¹¦ä¸­ä»‹ç»çš„åŸåˆ™æ¥å†™ï¼Œä¸è®ºè¿‡ç¨‹å¤šä¹ˆå¤æ‚ï¼Œé€»è¾‘éƒ½ä¼šå¾ˆæ¸…æ™°ï¼š

```tsx
/** ç‚¹å‡» æäº¤ */
const handleSubmitClick = async () => {
  // å‰ç«¯æ ¡éªŒå¹¶ä¿å­˜
  await validateAndSaveForm();
  // åç«¯æ ¡éªŒ
  await validateFormByBackend();
  // ç¡®è®¤æ˜¯å¦éœ€è¦é‡æ–°ç”Ÿæˆå…¬å‘Š
  await checkRegenerateAnnouncement();
  // ç¡®è®¤æ˜¯å¦éœ€è¦é‡æ–°ç”Ÿæˆé‡‡è´­æ–‡ä»¶
  await checkRegeneratePurchaseFile();
  // æäº¤è¡¨å•
  await submitForm();
  // å”¤èµ·å·¥ä½œæµ
  await launchWorkflow();
  // åˆ·æ–°è¡¨å•å˜æˆè¯¦æƒ…æ€
  await refreshForm();
};
```

ä¸è¿‡è¦è®©äº‹ä»¶å“åº”å‡½æ•°ä¸­çš„ä»£ç éƒ½å†™æˆè¿™ç§éå¸¸ä¼˜é›…çš„ä¸²è¡Œé€»è¾‘ï¼Œå…¶å®éœ€è¦ä¸€äº›é¢å¤–çš„å‰ç«¯æŠ€å·§ã€‚å› ä¸ºå¾ˆå¯èƒ½å…¶ä¸­ä¸€ä¸ªä¸­é—´è¿‡ç¨‹æ˜¯å”¤èµ·ä¸€ä¸ªå¼¹æ¡†è®©ç”¨æˆ·åœ¨å¼¹æ¡†ä¸­æ‰§è¡Œä¸€äº›æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨äº‹ä»¶å“åº”å‡½æ•°ä¸­çš„é€»è¾‘å¾ˆå¯èƒ½å°±ä¼šä»¥Â setSomeModalVisible(true)Â ç»“å°¾ï¼Œä½†å…¶å®æ•´ä¸ªæäº¤è¿‡ç¨‹æ‰æ‰§è¡Œäº†ä¸€åŠï¼Œå¯¼è‡´äº‹ä»¶å“åº”å‡½æ•°ä¸­æ— æ³•åŒ…å«å®Œæ•´çš„å¤„ç†é€»è¾‘ã€‚è¿™ç§æ—¶å€™å¾€å¾€éœ€è¦æˆ‘ä»¬ä»å½“å‰çš„äº‹ä»¶å“åº”å‡½æ•°æœ«å°¾è·³è·ƒåˆ°Â handleSomeModalOkÂ /Â handleSomeModalCancelÂ è¿™äº›å¼¹æ¡†ç±»ç»„ä»¶çš„äº‹ä»¶å›è°ƒä¸­ç»§ç»­é˜…è¯»ä»£ç ã€‚ä¸è¿‡è¿™æ˜¯å¦ä¸€ä¸ªè¯é¢˜äº†ï¼Œä¸å±äºæœ¬æ–‡èŒƒç•´ï¼Œå‡†å¤‡ä»¥åå¦å¤–å¼€å‘å†æ¥è®¨è®ºã€‚

### æ··ä¹±çš„ç¼–ç æŠ‰æ‹©

å›åˆ°ä¸Šè¿°åå°åˆ—è¡¨ç¿»é¡µçš„åœºæ™¯ï¼Œä¸¤ç§è¯·æ±‚æ•°æ®çš„å®ç°æ–¹å¼ï¼ˆuseEffectÂ å’Œäº‹ä»¶å“åº”å‡½æ•°ï¼‰æˆ‘ä»¬å¯èƒ½éƒ½åœ¨ä¸šåŠ¡ä»£ç ä¸­çœ‹åˆ°ï¼Œä½†æ˜¯å¯¹äºå¦å¤–ä¸€äº›æ•°æ®è¯·æ±‚çš„å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬å´å¤§å¤šä¸ä¼šé€‰æ‹©Â useEffectÂ æ¥å®ç°ã€‚æ¯”å¦‚æœ‰æ–‡ç« å±•ç¤ºé¡µé¢ï¼Œéœ€è¦ç‚¹å‡»â€œå±•å¼€è¯¦æƒ…â€æŒ‰é’®æ‰ä¼šè§¦å‘è¯¦æƒ…æ¥å£è¯·æ±‚ï¼Œæˆ‘ä»¬å¤§å¤šä¼šç›´æ¥å†™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼š

```tsx
const [detailVisible, setDetailVisible] = useState(false);
const [detailText, setDetailText] = useState('');

const fetchDetailInfo = async () => {
  if (Boolean(detailText)) {
    console.log('Article detail has been fetched.');
  } else {
    const query = qs.stringify({
      id: props.id, // å‡è®¾ props.id æ˜¯ä¸ä¼šå˜åŒ–çš„
    });
    const response = await fetch(`/article/detail?${query}`);
    const json = await response.json();
    setDetailText(json);
  }
};

const handleShowDetailBtnClick = () => {
  setDetailVisible(true);
  fetchDetailInfo();
};

const handleHideDetailBtnClick = () => {
  setDetailVisible(false);
};
```

å¦‚æœä½¿ç”¨Â useEffectÂ æ¥å®ç°åˆ™æœ‰ç§è„±è£¤å­æ”¾å±çš„æ„Ÿè§‰ï¼Œä»£ç å¦‚ä¸‹ï¼š

```tsx
const [detailVisible, setDetailVisible] = useState(false);
const [detailText, setDetailText] = useState('');

const handleShowDetailBtnClick = () => {
  setDetailVisible(true);
};

const handleHideDetailBtnClick = () => {
  setDetailVisible(false);
};

const fetchDetailInfo = useCallback(
  async () => {
    if (Boolean(detailText)) {
      console.log('Article detail has been fetched.');
    } else {
      const query = qs.stringify({
        id: props.id, // å‡è®¾ props.id æ˜¯ä¸ä¼šå˜åŒ–çš„
      });
      const response = await fetch(`/article/detail?${query}`);
      const json = await response.json();
      setDetailText(json);
    }
  },
  [detailText, props.id],
);

// ğŸŸ¡ ç›‘å¬ detailVisible å®ç°æ•°æ®è¯·æ±‚é€»è¾‘
useEffect(() => {
  if (detailVisible) {
    fetchDetailInfo();
  }
}, [detailVisible, fetchDetailInfo]);

// ...
```

è¿˜æœ‰ä¸€äº›æ¥å£è¯·æ±‚ç±»çš„å‰¯ä½œç”¨é€»è¾‘ï¼Œæ ¹æœ¬æƒ³ä¸åˆ°ä¼šå»ç”¨Â useEffectÂ æ¥å®ç°ï¼š

```tsx
/**
 * ç‚¹å‡»é¡µé¢åˆ·æ–°æŒ‰é’®ï¼Œè§¦å‘ GET æ¥å£
 */
const handleRefreshBtnClick = async () => {
  const response = await fetch(`/page/detail?id=${props.id}`);
  const json = await response.json();
  setPageInfo(json);
};

/**
 * ç‚¹å‡»é¡µé¢æäº¤æŒ‰é’®ï¼Œè§¦å‘ POST æ¥å£
 */
const handleSubmitBtnClick = async () => {
  const response = await fetch('/form/submit' /* ......  */);
  const result = await response.json();
  if (result.success) {
    message.success('æäº¤æˆåŠŸ');
  } else {
    message.error(result.message);
  }
};

```

é‚£ä¸Šè¿°çš„å‡ ä¸ªä¾‹å­ä¸­çš„æ¥å£è¯·æ±‚ç±»å‰¯ä½œç”¨å·®å¼‚ç‚¹åœ¨å“ªå‘¢ï¼Ÿä»”ç»†åˆ†æä¹‹åä¼šå‘ç°æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š

1.  è¿™ä¸ªå‰¯ä½œç”¨é€»è¾‘ä¼šä¸ä¼šåœ¨Â didMountÂ æ—¶è§¦å‘ï¼Ÿä¼šä¸ä¼šåœ¨ç”¨æˆ·äº‹ä»¶ä¸­è§¦å‘ï¼Ÿ
    
2.  è‹¥ä¼šåœ¨ç”¨æˆ·äº‹ä»¶ä¸­è§¦å‘ï¼Œæ˜¯å¦ä¹Ÿä¼šè§¦å‘Â stateÂ çŠ¶æ€å˜åŒ–ï¼Ÿå¹¶ä¸”å¯¹åº”çš„Â stateÂ çŠ¶æ€æ˜¯å¦ä¼šä½œä¸ºå‰¯ä½œç”¨é€»è¾‘çš„å…¥å‚ï¼ˆæ¯”å¦‚è¯·æ±‚çš„å…¥å‚ï¼‰ï¼Ÿ
    

åŸºäºä»¥ä¸Šå‡ ä¸ªå…³é”®ç‚¹ï¼Œå¯¹å‰¯ä½œç”¨è¿›è¡Œåˆ†ç±»æ¢³ç†ï¼š

![å‰¯ä½œç”¨æ¢³ç†.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/6524f2b5-889c-4d6a-bcc8-258f2eaa0b35.png)

å¯ä»¥ä»æ¢³ç†ç»“æœä¸­çœ‹åˆ°ï¼Œå…¶ä¸­æœ‰ä¸‰ä¸ªåœºæ™¯éƒ½å¯ä»¥æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œå¹¶ä¸”**é€‰æ‹©å®ç°æ–¹å¼æ—¶çš„æ ‡å‡†éå¸¸æ¨¡ç³Š**ã€‚

æ‰€ä»¥ä¸ºäº†ä¿æŒä»£ç ç»“æ„ä¸€è‡´æ€§ï¼Œä»¥åŠç¡®ä¿å‡½æ•°è°ƒç”¨å…³ç³»çš„å®Œæ•´æ€§ï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜æˆ‘ä»¬çš„ç»“è®ºå¾ˆæ˜ç¡®ï¼š**ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨é€»è¾‘ï¼Œç¦æ­¢ä½¿ç”¨Â useEffectÂ æ¥å®ç°ï¼Œç›´æ¥å®ç°åœ¨å¯¹åº”çš„ç”¨æˆ·äº‹ä»¶ä¸­å³å¯ã€‚**

## 4ã€useEffectÂ è§£å†³ä¸äº†çš„é—®é¢˜

ç»§ç»­ä¸Šè¿°çš„å‰¯ä½œç”¨åˆ†ç±»è¯é¢˜ï¼Œå¯¹äºâ€œåªéœ€è¦Â componentDidMountÂ ä¸­è§¦å‘çš„å‰¯ä½œç”¨â€ï¼Œå…¶å®è¿™ä¸ªæè¿°å¹¶ä¸å‡†ç¡®ï¼Œå½“æˆ‘ä»¬ç”¨Â useEffectÂ å®ç°è¿™ç±»é—®é¢˜æ—¶ï¼Œä¸ºäº†è§£å†³é—­åŒ…é—®é¢˜ï¼Œå®é™…ä¸Šè®¾ç½®ç›‘å¬ç±»çš„é€»è¾‘ä¼šåœ¨ä¾èµ–å˜åŒ–çš„æ—¶å€™åå¤è§¦å‘ï¼Œè¿™å’Œåœ¨ç±»ç»„ä»¶ä¸­è®¾ç½®ç›‘å¬å®Œå…¨ä¸åŒï¼š

```tsx
useEffect(() => {
  const type = 'my-event';
  const listener = () => {
    console.log('log state:', stateA, stateB);
  };
  window.addEventListener(type, listener);
  return () => {
    window.removeEventListener(type, listener);
  };
}, [stateA, stateB]);
```

**å½“Â stateAÂ æˆ–Â stateBÂ ä¸æ–­å˜åŒ–æ—¶ï¼Œåœ¨ä¸åœåœ°æ‰§è¡ŒÂ removeEventListenerÂ ->Â addEventListenerÂ ->Â removeEventListenerÂ ->Â addEventListenerÂ ->Â removeEventListenerÂ ->Â addEventListenerÂ ......**

OKï¼Œè‡³å°‘åŠŸèƒ½æ²¡é—®é¢˜å°±è¡Œï¼ŒCPUÂ ä¹Ÿä¸ä¼šæœ‰æƒ…ç»ªï¼Œå¹¶ä¸”å¼€å‘è€…æ—¥å¸¸å¯ä»¥å¿½ç•¥è¿™ä¸ªäº‹æƒ…ï¼Œæ­£å¸¸æ ¹æ®Â ESLintÂ è§„åˆ™å»ç»™å‰¯ä½œç”¨æ·»åŠ æ ‡å‡†çš„ä¾èµ–å³å¯ã€‚ä½†ä¸‹é¢æœ‰å‡ ä¸ªç‰¹æ®Šçš„åœºæ™¯ï¼š

### å®šæ—¶å™¨åŠŸèƒ½å¼‚å¸¸

åŠŸèƒ½æè¿°ï¼šé¡µé¢ä¸Šæœ‰ä¸ªÂ InputÂ è¾“å…¥æ¡†ï¼Œç”¨æˆ·éšæ—¶å¯ä»¥ä¿®æ”¹ï¼Œç„¶åå¸Œæœ›æ¯ç§’æ‰“å°ä¸€ä¸‹Â InputÂ è¾“å…¥æ¡†ä¸­å½“å‰çš„å€¼ã€‚

```tsx
const [inputValue, setInputValue] = useState('');

const handleInputChange = (value) => {
  setInputValue(value);
};

useEffect(() => {
  const handler = () => {
    // ğŸ”´ ç”¨æˆ·è¿ç»­ä¸”å¿«é€Ÿæ‰“å­—è¾“å…¥æ—¶ï¼Œlog ä¸ä¼šè§¦å‘
    console.log('log input value per second:', inputValue);
  };
  const intervalId = setInterval(handler, 1000);
  return () => {
    clearInterval(intervalId);
  };
}, [inputValue]);
```

éå¸¸æ ‡å‡†çš„Â useEffectÂ ç”¨æ³•ï¼Œä½†æ˜¯åœ¨ç”¨æˆ·é¢‘ç¹è¾“å…¥å¯¼è‡´Â inputValueÂ å˜åŒ–é—´éš”å°äºÂ 1Â ç§’æ—¶ï¼Œä¼šå¯¼è‡´åœ¨è¿™æœŸé—´å†…æ‰€æœ‰çš„å®šæ—¶å™¨éƒ½è¿˜æ²¡è§¦å‘è¿‡å°±è¢«æ¸…é™¤äº†ï¼Œå³è¿™ä¸ªÂ logÂ é€»è¾‘åœ¨ç”¨æˆ·é¢‘ç¹è¾“å…¥æœŸé—´æ˜¯å¤±æ•ˆçš„ã€‚æœ‰ä¸€ä¸ªå¸¸è§„çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å¦èµ·ä¸€ä¸ªÂ refÂ å»å®æ—¶åŒæ­¥Â inputValueÂ çš„å€¼ï¼ˆè™½ç„¶è¿™è¿èƒŒäº†æœ€å°çŠ¶æ€é‡çš„åŸåˆ™ï¼‰ï¼š

```tsx
const [inputValue, setInputValue] = useState('');

const valueRef = useRef('');

const handleInputChange = (value) => {
  setInputValue(value);
  valueRef.current = value; // å°† inputValue é¢å¤–åŒæ­¥åˆ° valueRef ä¸­
};

useEffect(() => {
  const handler = () => {
    console.log('log input value per second:', valueRef.current);
  };
  const intervalId = setInterval(handler, 1000);
  return () => {
    clearInterval(intervalId);
  };
}, []); // ğŸŸ¢ valueRef ä¸å±äºå“åº”å¼å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦å£°æ˜ä¾èµ–
```

ä½ å¯ä»¥è¯´è¿™ç§æ˜¯ä½çº§é—®é¢˜ï¼Œç¬”è€…æ°´å¹³ä¸å¤Ÿï¼Œè¿™ç§é—®é¢˜æœ¬æ¥å°±åº”è¯¥ç”¨Â refÂ æ¥è§£å†³ï¼Œå¥½ç©çš„æ˜¯æˆ‘å»é—®äº†å¥½å‡ ä¸ªÂ AIï¼ˆå…¶ä¸­Â ChatGPTÂ ç”¨çš„æ˜¯å…è´¹ç‰ˆï¼‰ï¼Œé—®é¢˜æè¿°å¦‚ä¸‹ï¼š_å¸®æˆ‘ç”¨Â reactÂ å‡½æ•°ç»„ä»¶å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼šé¡µé¢ä¸Šæœ‰ä¸ªÂ InputÂ è¾“å…¥æ¡†ï¼Œç”¨æˆ·éšæ—¶å¯ä»¥ä¿®æ”¹ï¼Œç„¶åå¸Œæœ›æ¯ç§’æ‰“å°ä¸€ä¸‹Â InputÂ è¾“å…¥æ¡†ä¸­å½“å‰çš„å€¼ã€‚_

é™¤äº†Â DeepSeekÂ ä¹‹å¤–çš„Â AIï¼Œé¦–æ¬¡å›ç­”éƒ½å®Œç¾è¸©å‘ï¼Œåªæœ‰Â DeepSeekÂ ç›´æ¥æƒ³åˆ°äº†è¦ç”¨Â InputÂ è‡ªå¸¦çš„Â refÂ æ‹¿åˆ°Â DOMÂ å…ƒç´ ä»è€Œè·å–è¾“å…¥æ¡†çš„å€¼ï¼Œè¿˜èŠ‚çœäº†åŒæ­¥é€»è¾‘ï¼Œç‰›å•¤ï¼

ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»¥å‰æ²¡æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜å‘¢ï¼Œå› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹çŠ¶æ€å˜åŒ–ä¸ä¼šè¿™ä¹ˆé¢‘ç¹ï¼Œè¯¯å·®ä¹Ÿä»…å‡ºç°åœ¨çŠ¶æ€å˜åŒ–çš„æ—¶å€™ï¼Œäº§å“åŠŸèƒ½ä¸Šå¤§å¤šéƒ½æ²¡æ„ŸçŸ¥åˆ°è¿™ç‚¹è¯¯å·®ï¼Œä½†ä»é€»è¾‘ä¸Šè¿™æ˜¯ä¸ä¸¥è°¨çš„ã€‚å¹¶ä¸”è¿™ä¸ªåŠŸèƒ½å¦‚æœç”¨ç±»ç»„ä»¶æ¥å®ç°æ—¶ï¼Œå®Œå…¨ä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼š

```tsx
class Demo extends React.Component {
  componentDidMount = () => {
    const handler = () => {
      console.log('log input value per second:', this.state.inputValue);
    };
    this.intervalId = setInterval(handler, 1000);
  };
  componentWillUnmount = () => {
    clearInterval(this.intervalId);
  };
}
```

### ä¸åº”è¯¥çš„Â WebSocketÂ æ€§èƒ½é—®é¢˜

å’Œè®¾ç½®å®šæ—¶å™¨ç±»ä¼¼ï¼Œè®¾ç½®Â WebSocketÂ é€šä¿¡è¿™ä¸ªåœºæ™¯å¹¶ä¸ä¼šå› ä¸ºä¾èµ–çŠ¶æ€çš„å˜åŒ–å¯¼è‡´åŠŸèƒ½é—®é¢˜ï¼Œä½†æ˜¯ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºè¿™æ—¶å€™ä¸åƒÂ addEventListenerÂ é‚£æ ·åªæ˜¯ä¸æ–­ä½¿å”¤Â CPUï¼Œè€Œæ˜¯é‡å¤è°ƒç”¨ç½‘ç»œÂ IOÂ æ¥å£è¿›è¡ŒÂ WebSocketÂ å»ºè¿å’Œæ–­è¿ï¼Œè¦ä¸æ–­ä½¿å”¤ç½‘çº¿äº†ï¼ˆå¤§è¯¯ï¼‰ã€‚

```tsx
// maxLength è¡¨ç¤ºå±•ç¤ºæœåŠ¡ç«¯æ¨é€è¿‡æ¥çš„æ¶ˆæ¯æ—¶å…è®¸çš„æœ€å¤§é•¿åº¦ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶è°ƒæ•´
const [maxLength, setMaxLength] = useState(50);

const handleRangeInputChange = (value) => {
  setMaxLength(value);
};

useEffect(() => {
  // ğŸ”´ æ¯å½“ maxLength å˜åŒ–æ—¶ï¼ŒWebSocket éƒ½ä¼šæ–­å¼€åé‡æ–°è¿æ¥
  const ws = new MyWebSocket({
    url: '/some/websocket/api', // å‡è®¾å»ºè¿ä¸éœ€è¦å…¥å‚ï¼ŒæœåŠ¡ç«¯åˆ¤æ–­ç”¨æˆ· cookie ä¸­çš„ç™»å½•æ€å³å¯
    onMessage: (data = {}) => {
      if (data.userId !== props.userId) {
        console.error('ç”¨æˆ·ä¿¡æ¯ä¸åŒ¹é…');
        return;
      }
      if (data.length > maxLength) {
        console.error('è¶…å‡ºé•¿åº¦é™åˆ¶');
        return;
      }
      console.log('verified data:', data);
    },
  });
  return () => {
    ws.close();
  };
}, [props.userId, maxLength]);

```

è§£å†³è¿™ä¸ªé—®é¢˜çš„å¸¸è§„æ€è·¯ä¹Ÿæ˜¯é¢å¤–åˆ›å»ºÂ refï¼ŒæŠŠÂ stateÂ å’ŒÂ propsÂ åœ¨Â refÂ ä¸­åŒæ­¥é¢å¤–ç»´æŠ¤ä¸€ä»½ï¼š

```tsx
// maxLength è¡¨ç¤ºå±•ç¤ºæœåŠ¡ç«¯æ¨é€è¿‡æ¥çš„æ¶ˆæ¯æ—¶å…è®¸çš„æœ€å¤§é•¿åº¦ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶è°ƒæ•´
const [maxLength, setMaxLength] = useState(50);

const userIdRef = useRef('');
const maxLengthRef = useRef(50);

const handleRangeInputChange = (value) => {
  setMaxLength(value);
  maxLengthRef.current = value;
};

useEffect(() => {
  userIdRef.current = props.userId; // ğŸŸ¡ ä¸å¤ªç¡®å®šåŒæ­¥ props åˆ° ref ä¸­å¹¶ä¸å±äºå®˜æ–¹å®šä¹‰çš„ Effect å‰¯ä½œç”¨
}, [props.userId]);

useEffect(() => {
  const ws = new MyWebSocket({
    url: '/some/websocket/api', // å‡è®¾å»ºè¿ä¸éœ€è¦å…¥å‚ï¼ŒæœåŠ¡ç«¯åˆ¤æ–­ç”¨æˆ· cookie ä¸­çš„ç™»å½•æ€å³å¯
    onMessage: (data = {}) => {
      if (data.userId !== userIdRef.current) {
        console.error('ç”¨æˆ·ä¿¡æ¯ä¸åŒ¹é…');
        return;
      }
      if (data.length > maxLengthRef.current) {
        console.error('è¶…å‡ºé•¿åº¦é™åˆ¶');
        return;
      }
      console.log('verified data:', data);
    },
  });
  return () => {
    ws.close();
  };
}, []); // ğŸŸ¢ userIdRef å’Œ maxLengthRef ä¸å±äºå“åº”å¼å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦å£°æ˜ä¾èµ–

```

ä¸€æ ·çš„è¿˜æœ‰å¦‚æœç”¨ç±»ç»„ä»¶æ¥å®ç°æ—¶ï¼Œä¹Ÿä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å†™ä»£ç äº†ã€‚

## 5ã€é”™è¯¯ä½¿ç”¨Â useEffect

### ç¼ºä¹è­¦ç¤ºæ€§

å…³äºè¿™ä¸ªè¯é¢˜ï¼Œå®˜æ–¹æ–‡æ¡£æœ‰å•ç‹¬çš„æ–‡ç« æ¥è¯´æ˜[ã€ŠÂ ä½ å¯èƒ½ä¸éœ€è¦Â EffectÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect)ï¼Œæˆ‘è¦è¡¥å……çš„è§‚ç‚¹æ˜¯ï¼Œå› ä¸ºÂ useEffectÂ èšåˆäº†å¤ªå¤šèƒ½åŠ›ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸å¤Ÿæœ‰è­¦ç¤ºæ€§ï¼Œå¯¼è‡´çœŸçš„æœ‰äººå†™é”™äº†çš„æ—¶å€™ï¼Œåœ¨Â CodeÂ ReviewÂ ç¯èŠ‚å®¹æ˜“è¢«å¿½ç•¥ã€‚

æ¯”å¦‚ä¸‹é¢è¿™ä¸ªçœŸå®çš„ä½çº§é”™è¯¯ï¼š

```tsx
const [ids, changeIds] = useState([]);

/* ä¸­é—´éš”äº† 200 è¡Œä»£ç  */

useEffect(() => {
  const list = props.projectList.map((p) => p.id);
  changeIds(list); // ğŸŸ¡ changeIds å‘½åä¸è§„èŒƒï¼Œåº”è¯¥å« setIds
}, [props.projectList]);

```

å¦‚æœè¿™ä¸ªä»£ç ä¸­æ²¡æœ‰å‘½åè§„èŒƒçš„é—®é¢˜ï¼Œå…¶å®å°±æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°è¿‡çš„é”™è¯¯ç¤ºä¾‹[æ ¹æ®Â propsÂ æˆ–Â stateÂ æ¥æ›´æ–°Â state](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#updating-state-based-on-props-or-state)ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­æ ¹æœ¬ä¸éœ€è¦Â useStateÂ å’ŒÂ useEffectï¼Œç›´æ¥åœ¨ç»„ä»¶å†…è½¬æ¢Â props.projectListÂ æˆä¸€ä¸ªå¸¸è§„çš„å˜é‡å³å¯ï¼š

```tsx

const { projectList = [] } = props;

// ğŸŸ¢ ç›´æ¥è®¡ç®—å‡ºå±æ€§
const ids = projectList.map((p) => p.id);

// PS: å¦‚æœåŠ ä¸Š useMemo å°±éå¸¸åƒ Vue çš„ computed è®¡ç®—å±æ€§
const ids = useMemo(() => {
  return projectList.map((p) => p.id);
}, [projectList]); // ä»…åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶é‡æ–°è§¦å‘è®¡ç®—é€»è¾‘

```

ç«™åœ¨çŠ¯è¿™ä¸ªé”™çš„æ–°æ‰‹å¼€å‘è€…è§’åº¦ï¼šå·¥ç¨‹ä¸­åˆ°å¤„éƒ½åœ¨ç”¨Â useEffectï¼Œå­¦ä¹ è·¯å¾„ä¸­å¯èƒ½å¹¶æ²¡æœ‰å¾ˆæ˜æ˜¾æ„ŸçŸ¥åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸”ç›®å‰ä¸ºæ­¢åŠŸèƒ½æ²¡å‡ºé—®é¢˜ã€‚

ç«™åœ¨Â CodeÂ ReviewÂ æ‰§è¡Œè€…è§’åº¦ï¼šæ²¡æƒ³åˆ°Â changeIdsÂ ç«Ÿç„¶æ˜¯ä¸€ä¸ªÂ setStateÂ æ–¹æ³•ï¼Œå› ä¸ºæ˜¾ç¤ºå™¨ä¸€å±æ²¡æ³•åŒæ—¶çœ‹åˆ°Â useStateÂ å’ŒÂ useEffectï¼Œæƒ³å½“ç„¶åœ°ä»¥ä¸ºÂ changeIdsÂ é‡Œé¢åŒ…å«äº†å‰¯ä½œç”¨é€»è¾‘ã€‚

ä½†æ˜¯åœ¨ç±»ç»„ä»¶ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½éœ€è¦åœ¨Â componentDidUpdateÂ è¿™ä¸ªç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸä¸­å»å®ç°ï¼Œå½“æˆ‘ä»¬çœ‹åˆ°Â componentDidUpdateÂ çš„æ—¶å€™ï¼Œåº”è¯¥å°±æœ‰ä¸€ç§Â dangerÂ å±é™©çš„æ„Ÿè§‰ï¼Œä¹ æƒ¯æ€§è¦å»å¤šçœ‹ä¸€çœ¼ï¼Œå› ä¸ºç”¨åˆ°è¿™ä¸ªÂ APIÂ æ—¶å¾ˆå¤šäººéƒ½ä¼šçŠ¯é”™è¯¯ã€‚å®˜æ–¹æ–‡æ¡£åœ¨ç”Ÿå‘½å‘¨æœŸçš„ä»‹ç»æ–‡ç« ä¸­ä¹Ÿæ˜ç¡®æŒ‡å‡ºè¿‡ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/0efd9535-89dd-4ede-acd5-a412c49810d6.png)

### æ‰¾ä¸å‡ºé—®é¢˜çš„é”™è¯¯ç”¨æ³•

å¦‚æœä¸Šé¢çš„ä¾‹å­æ˜¯ç¨å¾®æœ‰ä¸€ç‚¹Â ReactÂ HookÂ ç ”å‘ç»éªŒçš„å¼€å‘è€…éƒ½å¯ä»¥é¿å…çš„ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹é¢è¿™ä¸¤ä¸ªä¾‹å­ï¼š

```tsx
/**
 * ğŸŸ¡ é¡µé¢åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦åŸºäºç”¨æˆ·ä¿¡æ¯åˆ¤æ–­æ˜¯å¦è¦å¼¹æ¡†æé†’ç”¨æˆ·ç»‘å®šæ‰‹æœºå·
 */
const Page = () => {
  const [tipModalVisible, setTipModalVisible] = useState(false);

  // ğŸŸ¡ useUserInfo æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€çš„ä¸šåŠ¡ Hookï¼Œä¼šåœ¨ç»„ä»¶ didMount æ—¶è‡ªåŠ¨è¯·æ±‚å½“å‰ç™»å½•ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯
  const userInfo = useUserInfo();

  // æŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯åï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç»‘å®šæ‰‹æœºå·
  useEffect(() => {
    if (userInfo && !userInfo.phone) {
      setTipModalVisible(true); // æ˜¾ç¤ºæç¤ºå¼¹æ¡†
    }
  }, [userInfo]);

  // ...
};

```
```tsx
/**
 * ğŸŸ¡ æŠ½å±‰ç»„ä»¶ä¸­ä¼šæ¸²æŸ“ä¸€ä¸ªé¡¹ç›®åˆ—è¡¨ï¼Œç”¨æˆ·åœ¨æŠ½å±‰å†…é€‰ä¸­ä¸€æ¡é¡¹ç›®æ•°æ®å¹¶åç‚¹å‡»ã€Œç¡®å®šã€æŒ‰é’®åï¼Œä¼šå°†è¿™æ¡é¡¹ç›®æ•°æ®ä¼ é€’ç»™é¡µé¢ä¸­çš„å…¶ä»–ç»„ä»¶
 */
const ProjectSelectDrawer = (props) => {
  const { visible } = props;

  const [selectedProjectId, setSelectedProjectId] = useState(null);

  // ğŸŸ¡ æ— è®ºç”¨æˆ·åœ¨æŠ½å±‰ä¸­ç‚¹å‡»ã€Œç¡®å®šã€è¿˜æ˜¯ç‚¹å‡»ã€Œå–æ¶ˆã€ï¼Œåªè¦æŠ½å±‰å…³é—­äº†ï¼Œéƒ½è¦æ¸…ç©ºå½“å‰é€‰ä¸­é¡¹
  useEffect(() => {
    if (!visible) {
      setSelectedProjectId(null);
    }
  }, [visible]);

  // ...
};

```

ä¹ä¸€çœ¼çœ‹è¿™äº›Â useEffectÂ ä¼šè§‰å¾—æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºå®Œæ•´çš„å®˜æ–¹Â useEffectÂ é”™è¯¯ç¤ºä¾‹æ•™å­¦[ã€ŠÂ ä½ å¯èƒ½ä¸éœ€è¦Â EffectÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#notifying-parent-components-about-state-changes)ä¸­ä¹Ÿæ²¡æœ‰æåˆ°è¿™ç§å¾ˆå¸¸è§çš„æƒ…å†µã€‚æˆ‘ç”šè‡³å»é—®äº†å¾ˆå¤šç›®å‰æµè¡Œçš„Â AIÂ å¤§æ¨¡å‹â€œ_è¿™ä¸ªä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å—_â€ï¼Œæ‰€æœ‰çš„Â AIÂ éƒ½æ²¡æœ‰æŒ‡å‡ºï¼šÂ 

**è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­çš„Â setTipModalVisibleÂ /Â setSelectedProjectIdÂ å¹¶ä¸æ˜¯å‰¯ä½œç”¨é€»è¾‘ï¼Œç†è®ºä¸Šä¸åº”è¯¥æ”¾åœ¨Â useEffectÂ ä¸­ï¼Œå› ä¸ºè¿™äº›ä»£ç éƒ½æ˜¯ç”¨ç›‘å¬æ€ç»´è€Œä¸æ˜¯å‰¯ä½œç”¨æ€ç»´å†™å‡ºæ¥çš„ï¼Œå¹¶ä¸”åƒÂ useUserInfoÂ è¿™ç±»å°è£…äº†Â useEffectÂ çš„åŸºç¡€ä¸šåŠ¡Â HookÂ ä¼šä¸æ–­åœ°å¼•å¯¼æˆ‘ä»¬å»å†™ä¸€äº›ç›‘å¬ç±»çš„é€»è¾‘ï¼Œå½¢æˆæ¶æ€§å¾ªç¯ã€‚**

## 6ã€é—®é¢˜å°ç»“

æœ€åå†æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬åœ¨Â useEffectÂ å®é™…ä½¿ç”¨ä¸­é‡åˆ°çš„å„ç±»é—®é¢˜ï¼š

1.  ç©ºæ•°ç»„çš„Â useEffectÂ å­˜åœ¨æ˜æ˜¾çš„è¯­ä¹‰åŒ–é—®é¢˜ï¼›éœ€è¦ä¹¦å†™ä¾èµ–é¡¹æ—¶ï¼Œå‡†ç¡®å£°æ˜ä¾èµ–é¡¹å’Œä¿ç•™æ¸…æ™°çš„ä»£ç æ„å›¾ä¹‹é—´åˆå­˜åœ¨æ— æ³•è°ƒå’Œçš„çŸ›ç›¾ã€‚
    
2.  å½“Â useEffectÂ çš„ä¾èµ–ä¸­å‡ºç°ç”¨Â useCallbackÂ åŒ…è£¹çš„å‡½æ•°ï¼Œä»£ç ä¸­ä¼šå‡ºç°å¤§é‡çš„å…³äºä¾èµ–é¡¹å£°æ˜çš„å†—ä½™ä»£ç ï¼Œä¸”ç›®å‰çœ‹æ¥è¿™äº›ç¹çè€Œæ²¡æœ‰ä¸šåŠ¡æ„ä¹‰çš„å·¥ä½œéš¾ä»¥è‡ªåŠ¨åŒ–ï¼Œä¸€ç›´éœ€è¦å¼€å‘è€…äººå·¥ç»´æŠ¤ã€‚
    
3.  useEffectÂ ä¼šå¼•å¯¼å¼€å‘è€…å»ç¼–å†™éš¾ä»¥ç»´æŠ¤çš„â€œç›‘å¬â€ç±»çš„é€»è¾‘ï¼Œè¿™äº›é€»è¾‘åœ¨å¤æ‚åœºæ™¯ä¸‹çš„å¯è¯»æ€§éå¸¸å·®ï¼Œåªèƒ½é å›¢é˜Ÿè§„èŒƒæ¥é¿å…è¿™ç§æƒ…å†µã€‚
    
4.  æœ‰äº›åœºæ™¯ç›´æ¥æŒ‰Â useEffectÂ æœ€æ ‡å‡†çš„æ–¹å¼å»å®ç°æ—¶ä¼šå‡ºç°åŠŸèƒ½æ€§é—®é¢˜ï¼Œæ— ç–‘åˆå¢åŠ äº†ä½¿ç”¨éš¾åº¦ã€‚
    
5.  useEffectÂ é›†åˆäº†å¤ªå¤šä½¿ç”¨åœºæ™¯ï¼Œä¸€äº›ç‰¹æ®Šçš„åœºæ™¯åº”è¯¥é…åˆæ›´å…·æœ‰è­¦ç¤ºæ€§çš„Â APIï¼Œé™ä½å¼€å‘è€…çŠ¯é”™çš„æ¦‚ç‡ï¼›ç”šè‡³è¿˜æœ‰ä¸€äº›ç»“åˆè‡ªå®šä¹‰Â HookÂ çš„åœºæ™¯ä¸­ï¼Œçœ‹ä¸Šå»æœ€åˆé€‚çš„æ–¹å¼å°±æ˜¯åœ¨Â useEffectÂ å†…ä¹¦å†™ä¸€äº›éå‰¯ä½œç”¨é€»è¾‘ã€‚
    

# å››ã€å…¨æ–°çš„Â useInitÂ è§£å†³æ–¹æ¡ˆ

## 1ã€é¿å¼€ä¾èµ–é¡¹å£°æ˜

åœ¨ç¬¬äºŒç« ä¸­æåˆ°è¿‡æˆ‘ä¸ä¼šå°†ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„æ¥å£è¯·æ±‚å†™åˆ°Â useEffectÂ ä¸­ã€‚é‚£å¦‚æœé‡åˆ°äº†ä¸€ä¸ªç»„ä»¶çš„æŸä¸ªÂ propsÂ ç¡®å®ä¼šå˜åŒ–æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚Â <ProjectInfoÂ id={id}Â />Â ç»„ä»¶çš„Â idÂ æ˜¯ä¼šåŠ¨æ€å˜åŒ–çš„ï¼Œéœ€è¦ç›‘å¬Â idÂ çš„å˜åŒ–å»é‡æ–°è¯·æ±‚é¡¹ç›®è¯¦æƒ…ä¿¡æ¯ã€‚è¿™ç§æƒ…å†µæˆ‘ä¼šé€‰æ‹©åˆ©ç”¨Â keyÂ è®©è¿™ä¸ªç»„ä»¶é”€æ¯ç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶å®ä¾‹ï¼š

```tsx
// æ¯å½“ key å˜åŒ–
// åŸæœ‰çš„ ProjectInfo ç»„ä»¶å®ä¾‹å°±ä¼šè¢«é”€æ¯
// å…¨æ–°çš„ ProjectInfo ç»„ä»¶ä¼šä» componentDidMount å¼€å§‹é‡å¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸ
const a = <ProjectInfo key={String(id)} id={id} />;

// å¦‚æœåŸæœ¬è¦ç›‘å¬å¤šä¸ªçŠ¶æ€ï¼Œé‚£å°±æ‹¼å¤šä¸ªå˜é‡ä¸ºå­—ç¬¦ä¸²ï¼ˆè™½ç„¶ä¸å¤ªä¼˜é›…ï¼Œä½†æ˜¯éå¸¸å®ç”¨ï¼Œæ„Ÿè§‰åç»­å¯ä»¥æä¸ª HOC ç¨å¾®å°è£…ä¸€ä¸‹æ¨¡æ¿å­—ç¬¦ä¸²çš„é€»è¾‘ï¼‰
const b = <ProjectInfo key={`${id}_${bizType}`} id={id} bizType={bizType} />;
```

å®˜æ–¹å¯¹äºè¿™ä¸ªç‰¹æ€§çš„ä»‹ç»ï¼š[ã€ŠÂ å½“Â propsÂ å˜åŒ–æ—¶é‡ç½®æ‰€æœ‰Â stateÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#resetting-all-state-when-a-prop-changes)å’Œ[ã€ŠÂ æœ‰Â keyÂ çš„éå¯æ§ç»„ä»¶Â ã€‹](https://zh-hans.legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-uncontrolled-component-with-a-key)ï¼Œè¿™æ ·æ¯å½“é‡åˆ°éœ€è¦ç›‘å¬çš„Â propsÂ æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘èƒ½å¦ä½¿ç”¨Â keyÂ è¿™ä¸ªæŠ€å·§è®©åŸç»„ä»¶é”€æ¯ï¼Œä¸éœ€è¦è€ƒè™‘å±æ€§å˜åŒ–ä¹‹åç»„ä»¶å†…éƒ¨è¦å¦‚ä½•ä¿®æ”¹ä¿è¯å¯ä»¥é€‚åº”è¿™ç§å˜åŒ–ï¼ˆé‡ç½®ä¸€äº›çŠ¶æ€ç­‰ï¼‰ï¼Œå› ä¸ºç»„ä»¶ä¸€æ¬¡ç”Ÿå‘½å‘¨æœŸå†…Â idÂ å’ŒÂ bizTypeÂ æ˜¯æ°¸è¿œä¸ä¼šå˜åŒ–çš„ã€‚å› æ­¤æˆ‘å¹³å¸¸å¾ˆå°‘å†™Â useEffectÂ ä¾èµ–ï¼Œç›´åˆ°æœ‰ä¸€æ¬¡å‚ä¸ä¸€ä¸ªç ”å‘å‘¨æœŸæ¯”è¾ƒé•¿çš„é‡ç‚¹é¡¹ç›®é‡æ„ï¼Œå¿…é¡»è¦ç”¨Â addEventListenerÂ è®¾ç½®å¾ˆå¤šç›‘å¬å™¨æ—¶ï¼š

```tsx
const handleFooEvent = (event) => {
  /* ...... */
};

/** ç›‘å¬ foo äº‹ä»¶ */
useEffect(() => {
  const eventName = 'foo-event';
  window.addEventListener(eventName, handleFooEvent);
  return () => window.removeEventListener(eventName, handleFooEvent);
}, [stateA, stateB]); // ğŸŸ¡ __todo ä¸Šçº¿å‰ç¡®è®¤ä¸€éä¾èµ–æ˜¯å¦æ­£ç¡®

const handleBarEvent = (event) => {
  /* ...... */
};

/** ç›‘å¬ bar äº‹ä»¶ */
useEffect(() => {
  const eventName = 'bar-event';
  window.addEventListener(eventName, handleBarEvent);
  return () => window.removeEventListener(eventName, handleBarEvent);
}, [stateC, stateD]); // ğŸŸ¡ __todo ä¸Šçº¿å‰ç¡®è®¤ä¸€éä¾èµ–æ˜¯å¦æ­£ç¡®

/** ç›‘å¬ xxx äº‹ä»¶ */
/** ç›‘å¬ yyy äº‹ä»¶ */
/** ç›‘å¬ zzz äº‹ä»¶ */
```

ä¸ºäº†é¿å…é—­åŒ…é—®é¢˜ï¼Œå¿…é¡»è¦åœ¨Â useEffectÂ ä¸­å£°æ˜ä¾èµ–ï¼Œå› ä¸ºæˆ‘æ—¥å¸¸å¼€å‘å®Œå…¨ä¸ä¼šå‚è€ƒÂ react-hooks/exhaustive-depsÂ è¿™ä¸ªÂ ESLintÂ æ ¡éªŒè§„åˆ™ï¼ˆå°±æ˜¯è¿™ä¹ˆå€”...ï¼‰ï¼Œæ‰€ä»¥åªèƒ½äººå·¥åˆ¤æ–­åœ¨ä¾èµ–ä¸­å£°æ˜å¿…è¦çš„Â stateÂ å’ŒÂ propsï¼Œå› ä¸ºå¼€å‘å‘¨æœŸæ¯”è¾ƒé•¿ï¼Œæˆ‘çŸ¥é“åç»­äº‹ä»¶å“åº”å‡½æ•°çš„å®ç°é€»è¾‘è‚¯å®šä¼šå˜åŒ–ï¼Œä¾èµ–ä¹Ÿå¿…å®šä¼šå†æ¬¡å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä¿ç•™äº†å‡ ä¸ªÂ todoÂ çš„æ³¨é‡Šæé†’è‡ªå·±ã€‚ç›´åˆ°é¡¹ç›®åæœŸè¦å¼€å§‹é€æ¸æ¸…ç†é¡¹ç›®ä¸­çš„Â todoÂ æ—¶ï¼Œæˆ‘å‘ç°è¿™å‡ ä¸ªç¡®è®¤ä¾èµ–çš„Â todoÂ æœ€ä¿é™©çš„è¿˜æ˜¯åœ¨ä¸Šçº¿å½“å‰å†æ¸…ç†ï¼Œå› ä¸ºä½ ä¸çŸ¥é“ä¸Šçº¿å‰ä¼šä¸ä¼šæœ‰Â bugÂ è¦æ”¹åŠ¨äº‹ä»¶å“åº”å‡½æ•°é‡Œçš„é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘æƒ³äº†ä¸€ä¸ªåŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```tsx
const handleFooEvent = (event) => {
  /* ......*/
};

/**
 * ç›‘å¬ foo äº‹ä»¶
 * ğŸŸ¡ ç»´æŠ¤ä¾èµ–å¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”åç»­è¿­ä»£å¢å‡ state çŠ¶æ€ä¹‹åéå¸¸å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶éƒ½æŠŠæœ€æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°åŒæ­¥åˆ° ref ä¸­
 */
const handleFooEventFnRef = useRef(null);
handleFooEventFnRef.current = handleFooEvent;
useEffect(() => {
  const eventName = 'foo-event';
  const handler = (event) => handleFooEventFnRef.current(event);
  window.addEventListener(eventName, handler);
  return () => window.removeEventListener(eventName, handler);
}, []);

const handleBarEvent = (event) => {
  /* ......*/
};

/**
 * ç›‘å¬ bar äº‹ä»¶
 * ğŸŸ¡ ç»´æŠ¤ä¾èµ–å¤ªéº»çƒ¦äº†ï¼Œè€Œä¸”åç»­è¿­ä»£å¢å‡ state çŠ¶æ€ä¹‹åéå¸¸å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶éƒ½æŠŠæœ€æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°åŒæ­¥åˆ° ref ä¸­
 */
const handleBarEventFnRef = useRef(null);
handleBarEventFnRef.current = handleBarEvent;
useEffect(() => {
  const eventName = 'bar-event';
  const handler = (event) => handleBarEventFnRef.current(event);
  window.addEventListener(eventName, handler);
  return () => window.removeEventListener(eventName, handler);
}, []);

```

æˆ‘ç”¨Â refÂ æ¥è§„é¿äº†é—­åŒ…é—®é¢˜ï¼Œæ—¢ç„¶å·²ç»è§„é¿äº†é—­åŒ…é—®é¢˜ï¼Œé‚£å°±å†ä¹Ÿä¸éœ€è¦å£°æ˜ä¾èµ–ï¼Œå› ä¸ºè¿™ä¸ªä»£ç æ²¡æœ‰å¾ˆå¥½çš„å¯è¯»æ€§ï¼ˆæ— æ³•è‡ªè¯´æ˜ï¼‰ï¼Œæ‰€ä»¥æˆ‘ç»™æ¯ä¸ªÂ useEffectÂ éƒ½åŠ äº†å¾ˆå¤šä¸€æ ·çš„æ³¨é‡Šã€‚å†å¾€åå°±æ˜¯åŸºäºè¿™ä¸ªæ¨¡å¼è¿›è¡Œçš„æ·±å…¥æ€è€ƒå’Œè‡ªå®šä¹‰Â HookÂ è®¾è®¡è®¨è®ºï¼Œæœ€ç»ˆçš„äº§ç‰©å°±æ˜¯ä¸¤ä¸ªè‡ªå®šä¹‰Â Hookï¼ˆæºç è¯¦è§Â [fool-proofing-hooks](https://github.com/ZCY-FE/fool-proofing-hooks)ï¼‰ï¼šInitÂ HookÂ å’ŒÂ WatchÂ Hookï¼š

## 2ã€â€œé‡æ–°å­¦ä¹ Â ReactÂ Hookâ€

åœ¨å¼€å§‹ä»‹ç»è¿™ä¸¤ä¸ªÂ HookÂ ä¹‹å‰ï¼Œè¯·å¤§å®¶å…ˆå¿˜æ‰å‰¯ä½œç”¨çš„æ¦‚å¿µï¼Œä¹Ÿå¿˜æ‰Â ReactÂ Hookï¼Œæ›´ä¸çŸ¥é“Â useEffectã€‚è®©æ—¶é—´é‡æ–°å›åˆ°Â 2018Â å¹´ï¼Œä½ æ˜¯ä¸€ä¸ªæœ‰ä¸€å®šç±»ç»„ä»¶å¼€å‘ç»éªŒçš„å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä½ çœ‹åˆ°Â ReactÂ æ­£å¼å‘å¸ƒäº†Â ReactÂ Hookï¼Œä½ å¼€å§‹è·Ÿç€å®˜æ–¹æ–‡æ¡£å­¦ä¹ ï¼š

1.  å…ˆçœ‹äº†Â HookÂ ç®€ä»‹Â å’ŒÂ HookÂ æ¦‚è§ˆ
    
2.  ç„¶åå­¦ä¹ äº†Â StateÂ Hookï¼Œä¹Ÿå°±æ˜¯Â useStateÂ çš„ä½¿ç”¨
    
3.  ä»è¿™é‡Œå¼€å§‹æ‰“ä½ï¼Œåœ¨è¿™ä¸ªâ€œå¹³è¡Œä¸–ç•Œâ€é‡Œä½ å¹¶æ²¡æœ‰å­¦ä¹ Â useEffectÂ è€Œæ˜¯å­¦ä¹ äº†Â useInit
    

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/0a9b6ad6-cef0-4a05-b2f5-5dfa2ca22893.png)

â€œå¹³è¡Œä¸–ç•Œâ€çš„å®˜æ–¹æ–‡æ¡£ï¼šå½“ä½ æƒ³åœ¨Â componentDidMountÂ å’ŒÂ componentWillUnmountÂ è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ç¼–å†™é€»è¾‘æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨Â useInitÂ è¿™ä¸ªç­‰ä»·äºä»¥ä¸Šä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„Â Hookï¼š

### useInitÂ åŸºç¡€ç¤ºä¾‹

```tsx
const Page = (props) => {
  /**
   * -----------------------------------------------------------
   * useInit åŸºç¡€ç¤ºä¾‹ä¸€
   * -----------------------------------------------------------
   */

  // å›è°ƒå‡½æ•°ç­‰ä»·äº componentDidMount
  useInit(() => {
    // mount callback
    console.log('componentDidMount');
  });

  // å›è°ƒå‡½æ•°ä¸­è¿”å›çš„å›è°ƒå‡½æ•°ç­‰ä»·äº componentWillUnmount
  useInit(() => {
    // mount callback

    return () => {
      // unmount callback
      console.log('componentWillUnmount');
    };
  });

  // ä¸¤ä¸ªå›è°ƒå‡½æ•°é…åˆä½¿ç”¨ï¼Œä¾¿äºåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œä¸€äº›æ¸…ç†åŠ¨ä½œï¼Œé¿å…å†…å­˜æ³„éœ²é—®é¢˜
  useInit(() => {
    // mount callback
    const intervalId = setInterval(() => {
      console.log('now:', Date.now());
    }, 1000);

    return () => {
      // unmount callback
      clearInterval(intervalId);
    };
  });

  /**
   * -----------------------------------------------------------
   * useInit åŸºç¡€ç¤ºä¾‹äºŒ
   * ä½¿ç”¨å¤šä¸ª useInit å®ç°å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå³ä¸€ä¸ª Hook åªåšä¸€ä»¶äº‹
   * -----------------------------------------------------------
   */

  // åˆå§‹åŒ–é€»è¾‘
  useInit(() => {
    initPage();
  });

  // æ–°æ‰‹æŒ‡å¼•é€»è¾‘
  useInit(() => {
    const { destroy } = Modal.info({
      title: 'æ–°æ‰‹æŒ‡å¼•',
      content: '......',
    });

    return () => {
      destroy();
    };
  });

  /**
   * -----------------------------------------------------------
   * useInit åŸºç¡€ç¤ºä¾‹ä¸‰
   * å½“ä¸éœ€è¦ç”¨åˆ° unmount å›è°ƒæ—¶ï¼ŒuseInit ç›´æ¥æ”¯æŒ async è¯­æ³•
   * -----------------------------------------------------------
   */

  // useInit ç¬¬ä¸€ä¸ªå…¥å‚æ”¯æŒ async è¯­æ³•çš„å‡½æ•°ï¼ˆå³è¿”å›å€¼ä¸º Promise å®ä¾‹ï¼‰
  useInit(async () => {
    // mount callback
    await sleep(1000); // æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡
    console.log('ç»„ä»¶åˆå§‹åŒ–é€»è¾‘æ‰§è¡ŒæˆåŠŸ');

    // å½“å‰é€»è¾‘ä¸éœ€è¦åœ¨ unmount æ—¶æ‰§è¡Œä»»ä½•æ¸…ç†åŠ¨ä½œ
    // return () => {
    //
    // };
  });

  // ä½†æ˜¯è¦æ³¨æ„ä¸‹ï¼Œç”¨äº† async è¯­æ³•å°±ä¸èƒ½å†è¿”å›ä¸€ä¸ª unmount å›è°ƒå‡½æ•°
  useInit(async () => {
    await sleep(1000);

    // ä½¿ç”¨ async è¯­æ³•æ—¶è‹¥è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œts ç±»å‹ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”è¿è¡Œæ—¶ console é‡Œä¼šå¼‚æ­¥æŠ›å‡ºä¸€ä¸ªä¸å½±å“åç»­é€»è¾‘çš„å¼‚å¸¸
    // Uncaught Error: If callback of ã€ŒuseInitã€ need return a cleanup callback, don't use async syntax.
    return () => {
      // è¿™ä¸ªå‡½æ•°ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œ
      console.log('unmount callback');
    };
  });

  return <div>......</div>;
};

export default Page;

```

### useInitÂ è¿›é˜¶ç¤ºä¾‹

```tsx
const Page = (props) => {
  /**
   * -----------------------------------------------------------
   * useInit è¿›é˜¶ç¤ºä¾‹ä¸€
   * ä½¿ç”¨ useInit çš„ç¬¬äºŒä¸ªå‚æ•°è§„é¿é—­åŒ…é—®é¢˜
   * -----------------------------------------------------------
   */

  // éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š
  // å®šä¹‰ä¸€ä¸ª number ç±»å‹çš„ state å‘½åä¸º inputCount å¹¶å’Œé¡µé¢ä¸­çš„ä¸€ä¸ª input çš„å€¼ç»‘å®š
  // å®šä¹‰ä¸€ä¸ª number ç±»å‹çš„ state å‘½åä¸º randomCount å¹¶å±•ç¤ºåœ¨é¡µé¢ä¸Š
  // æ¯éš” 1 ç§’ç”Ÿæˆä¸ºä¸€ä¸ª 0 ~ 9 çš„éšæœºæ•° X
  //   è‹¥è¯¥éšæœºæ•° X ä¸ç­‰äºå½“å‰çš„ inputCount æˆ– randomCountï¼Œåˆ™æŠŠ randomCount è®¾ç½®ä¸º X
  //   è‹¥è¯¥éšæœºæ•° X ç­‰äºå½“å‰çš„ inputCount æˆ– randomCountï¼Œåˆ™å¿½ç•¥æœ¬æ¬¡éšæœºå‡ºçš„ X

  const [inputCount, setInputCount] = useState('0');
  const [randomCount, setRandomCount] = useState(0);

  const handleInputChange = (e) => {
    setInputCount(e.target.value);
  };

  /**
   * å®šæ—¶å™¨å¤„ç†å‡½æ•°
   *   å‡½æ•°ä¸­çš„é€»è¾‘ä¾èµ–äº†ä¸¤ä¸ªçŠ¶æ€ï¼šinputCount å’Œ randomCount
   *   ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦åœ¨ä»»ä½•åœ°æ–¹å»é¢å¤–æŒ‡å‡ºæˆ‘ä»¬ä¾èµ–äº†è¿™ä¸¤ä¸ªçŠ¶æ€ï¼Œå› ä¸º useInit ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†é—­åŒ…é—®é¢˜
   *   å› æ­¤æˆ‘ä»¬å®ç°å‡½æ•°çš„æ—¶å€™ï¼ŒåŒ…æ‹¬åœ¨åç»­è¿­ä»£çš„æ—¶å€™ï¼Œéƒ½ä¸éœ€è¦è€ƒè™‘é—­åŒ…é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥è®¿é—®åˆ° state å’Œ props çš„æœ€æ–°å€¼
   */
  const handleInterval = () => {
    console.log('interval callback start');
    // ç”Ÿæˆ 0 ~ 9 çš„éšæœºæ•°
    const num = Math.floor(Math.random() * 10);
    const blackList = [Number(inputCount), randomCount];
    if (blackList.includes(num)) {
      console.log(`skip setRandomCount: ${num} is in ${blackList}`);
    } else {
      setRandomCount(num);
    }
  };

  // è®¾ç½®å®šæ—¶å™¨
  useInit(
    /**
     * mount callback
     *
     * è‹¥ useInit ä¼ é€’äº†ç¬¬äºŒä¸ªå‚æ•° funcMapï¼Œåˆ™å›è°ƒå‡½æ•°å¯ä»¥é€šè¿‡ self å¯¹è±¡æ‹¿åˆ°ç‰¹æ®Šå¤„ç†è¿‡çš„ funcMap
     * æ‰€è°“çš„ç‰¹æ®Šå¤„ç†å…¶å®å°±åªæ˜¯å°†åŸæœ¬ funcMap ä¸Šçš„æ–¹æ³•å®æ—¶æ›´æ–°åˆ° ref ä¸­å¹¶å›ºåŒ–å‡½æ•°çš„å¼•ç”¨åœ°å€ï¼Œä»è€Œè§£å†³é—­åŒ…é—®é¢˜
     *
     * @param {typeof funcMap} self - å¯ä»¥æƒ³è±¡æˆç±»ç»„ä»¶ä¸­çš„ç»„ä»¶å®ä¾‹ thisï¼Œä» self ä¸Šæ‹¿åˆ°çš„æ–¹æ³•å°±åƒç±»ç»„ä»¶ä¸­çš„åŸå‹æ–¹æ³•æ˜¯æ²¡æœ‰é—­åŒ…é—®é¢˜çš„
     *   self ä¸Šæœ‰å“ªäº›â€œåŸå‹æ–¹æ³•â€æ˜¯é€šè¿‡ useInit ç¬¬äºŒä¸ªå‚æ•° funcMap å®šä¹‰çš„ï¼Œåªèƒ½åœ¨ self ä¸­å®šä¹‰å‡½æ•°æ–¹æ³•ï¼Œä¸èƒ½å®šä¹‰å­—ç¬¦ä¸²ã€æ•°ç»„ç­‰â€œåŸå‹å±æ€§â€
     *   ä½†æ˜¯ä¸åŒ useInit ä¸­çš„ self ä»¥åŠå…¶ä¸­çš„æ–¹æ³•æ˜¯ç‹¬ç«‹çš„ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ funcMap å®šä¹‰çš„å…¶å®æ˜¯â€œå®ä¾‹æ–¹æ³•â€è€Œéâ€œåŸå‹æ–¹æ³•â€ï¼Œself ä¹Ÿåªæ˜¯â€œå±€éƒ¨ä½œç”¨åŸŸå†…çš„å®ä¾‹æ¦‚å¿µâ€
     *   å¦‚æœæƒ³è¦åœ¨æ•´ä¸ªç»„ä»¶å±‚é¢ä½¿ç”¨å®ä¾‹æ¦‚å¿µå»å®šä¹‰ä¸€äº›â€œå®ä¾‹å±æ€§â€ï¼Œå¹¶èƒ½åœ¨ç»„ä»¶çš„æ‰€æœ‰åœ°æ–¹éƒ½èƒ½å®æ—¶è®¿é—®å’Œä¿®æ”¹ï¼Œè¯·ä½¿ç”¨ useInstanceï¼ˆè¯¦è§ç¬¬å…­ç« ï¼‰ï¼Œå…¶å®å°±æ˜¯ useRef
     * @returns {() => void} unmount callback
     */
    (self) => {
      // mount callback
      const intervalId = setInterval(self.handleInterval, 1000);

      return () => {
        // unmount callback
        clearInterval(intervalId);
      };
    },
    /**
     * ç¬¬äºŒä¸ªå‚æ•° funcMapï¼Œå³å£°æ˜ self ä¸Šæœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è°ƒç”¨ï¼Œç±»ä¼¼åœ¨ class ç»„ä»¶ä¸­å®šä¹‰åŸå‹æ–¹æ³•
     */
    { handleInterval }
  );

  /**
   * -----------------------------------------------------------
   * useInit è¿›é˜¶ç¤ºä¾‹äºŒ
   * è‹¥ WebSocket çš„å›è°ƒä¸­æœ‰ä¾èµ– state / props çš„é€»è¾‘
   * -----------------------------------------------------------
   */

  // éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š
  // ç›‘å¬ WebSocket æ¶ˆæ¯ï¼Œå¹¶åœ¨æ¯æ¬¡æ‹¿åˆ°æ¶ˆæ¯æ—¶ï¼Œå®æ—¶å¯¹æ¯”æ¶ˆæ¯ä¸­çš„ count å€¼
  // è‹¥å¤§äºä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„ randomCount åˆ™ä¿ç•™è¯¥æ¡æ¶ˆæ¯ï¼Œå¦åˆ™å¿½ç•¥è¯¥æ¡æ¶ˆæ¯

  const [wsData, setWsData] = useState({});

  // å¤„ç† WebSocket æ¶ˆæ¯
  const handleMessageEvent = (data) => {
    const { count } = data || {};
    if (count > randomCount) {
      console.log('--- ç¬¦åˆæ¡ä»¶ï¼Œæ¥æ”¶æœ¬æ¬¡ WebSocket æ•°æ® ---', data);
      setWsData(data);
    } else {
      console.log('*** ä¸ç¬¦åˆæ¡ä»¶ï¼Œèˆå¼ƒæœ¬æ¬¡ WebSocket ä¼ è¾“è¿‡æ¥çš„æ•°æ® ***', data);
    }
  };

  useInit(
    (self) => {
      // mount callback
      const ws = new WS('/ws/message');
      ws.onMessage = self.handleMessageEvent;

      return () => {
        // unmount callback
        ws.close();
      };
    },
    { handleMessageEvent }
  );

  return (
    <div>
      <h4>inputCount by user input</h4>
      <input type="number" value={inputCount} onChange={handleInputChange} />
      <br />
      <h4>randomCount by interval</h4>
      <pre>{randomCount}</pre>
      <br />
      <h4>valid WebSocket data</h4>
      <pre>{JSON.stringify(wsData, null, 4)}</pre>
    </div>
  );
};

export default Page;

```

### å¦‚ä½•ç†è§£Â selfÂ å’Œç¬¬äºŒä¸ªå‚æ•°Â funcMap

*   ä¼šè¢«å¤šæ¬¡å¼‚æ­¥æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼Œéƒ½åº”è¯¥å°è£…æˆæ–¹æ³•æ”¾åˆ°Â funcMapÂ ä¸­ï¼Œç±»ä¼¼äºåœ¨Â classÂ ç»„ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç„¶åÂ selfÂ å°±èƒ½åƒÂ classÂ ä¸­çš„Â thisÂ å®ä¾‹ä¸€æ ·å»å®æ—¶è®¿é—®åˆ°æ²¡æœ‰é—­åŒ…é—®é¢˜çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚
    
*   å£°æ˜äº†Â funcMapï¼Œé‚£ä¹ˆÂ useInitÂ Â å›è°ƒä¸­çš„é€»è¾‘å°±åº”è¯¥åªå‰©ä¸‹éå¸¸å°‘é‡çš„ä»£ç ï¼š
    
    *   è®¾ç½®å„ç±»ç›‘å¬å™¨ï¼ˆaddEventListenerÂ /Â WebSocketÂ /Â setIntervalÂ ç­‰ç­‰ï¼‰ï¼Œå¹¶æŠŠÂ selfÂ ä¸Šçš„æ–¹æ³•ç›´æ¥ä½œä¸ºå¤„ç†å‡½æ•°ã€‚
        
    *   æ¸…ç†å¯¹åº”çš„ç›‘å¬å™¨ã€‚
        

```tsx
/** æ³›æŒ‡å„ç±»ä¼šè¢«å¤šæ¬¡å¼‚æ­¥æ‰§è¡Œçš„å¤„ç†å‡½æ•° */
const handleFunc = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

// åœºæ™¯ä¸€
useInit(
  (self) => {
    window.addEventListener('my-event', self.handleFunc);
    
    return () => {
      window.removeEventListener('my-event', self.handleFunc);
    };
  },
  { handleFunc }
);

// åœºæ™¯äºŒ
useInit(
  (self) => {
    const id = setInterval(self.handleFunc, 1000);
    
    return () => {
      clearInterval(id);
    };
  },
  { handleFunc }
);
```

*   funcMapÂ ä¸ŠÂ 95%Â çš„æƒ…å†µä¸­éƒ½åªéœ€è¦å£°æ˜ä¸€ä¸ªæ–¹æ³•ï¼Œå› ä¸ºä»£ç è¦åšåˆ°å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå³ä¸€ä¸ªÂ hookÂ åªåšä¸€ä»¶äº‹ï¼Œè€Œä¸€ä»¶äº‹åˆ™åªåº”è¯¥åªæœ‰ä¸€ä¸ªå…¥å£å‡½æ•°ã€‚å¦å¤–Â 5%Â çš„åœºæ™¯æ˜¯è€ƒè™‘åˆ°å¯èƒ½éƒ¨åˆ†ç›‘å¬å™¨æœ‰å¤šç§å›è°ƒéœ€è¦å¤„ç†ï¼Œæˆ–è€…ç±»ä¼¼çš„å¤–éƒ¨äº‹ä»¶éœ€è¦æ‰¹é‡ç›‘å¬ï¼Œé…ç½®ä¸åŒçš„Â handlerã€‚
    

```tsx
/**
 * æŸäº›ç›‘å¬å™¨å¯èƒ½ä¼šæœ‰å¾ˆå¤šä¸ªå›è°ƒéœ€è¦å¤„ç†
 */

const handleWebSocketConnected = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

const handleWebSocketMessage = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

const handleWebSocketDisconnected = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

useInit(
  (self) => {
    const ws = new MyWebSocket({
      url: '/ws/api',
      onConnected: self.handleWebSocketConnected,
      onMessage: self.handleWebSocketMessage,
      OnDisconnected: self.handleWebSocketDisconnected,
    });

    return () => {
      ws.close();
    };
  },
  {
    handleWebSocketConnected,
    handleWebSocketMessage,
    handleWebSocketDisconnected,
  }
);

```
```tsx
/**
 * ä¸€æ¬¡ hook ä¸­ä¸€æ¬¡æ€§ç›‘å¬å¤šä¸ªç›¸ä¼¼ç±»å‹çš„äº‹ä»¶
 */

const handleEventA = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

const handleEventB = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

const handleEventC = (...args) => {
  // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
};

useInit(
  (self) => {
    window.addEventListener('event-a', self.handleEventA);
    window.addEventListener('event-b', self.handleEventB);
    window.addEventListener('event-c', self.handleEventC);

    return () => {
      window.removeEventListener('event-a', self.handleEventA);
      window.removeEventListener('event-b', self.handleEventB);
      window.removeEventListener('event-c', self.handleEventC);
    };
  },
  {
    handleEventA,
    handleEventB,
    handleEventC,
  }
);

```

### å”¯ä¸€çš„é™·é˜±

å¦‚æœå®Œå…¨æŒ‰ç…§ä¸Šé¢çš„è¯´æ˜æ¥å®šä¹‰Â funcMapÂ å’Œä½¿ç”¨Â selfï¼Œåˆ™ä¸ä¼šé‡åˆ°é—­åŒ…é—®é¢˜ã€‚ä½†æ˜¯ç»™å‡ºæœ€å¸¸è§çš„é”™è¯¯ç¤ºä¾‹ï¼Œä¹Ÿæ˜¯å¾ˆé‡è¦çš„ï¼š

```tsx
const WrongDemo = (props) => {
  const {
    dataId, // dataId åœ¨å½“å‰ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå˜åŒ–
  } = props;

  const [foo, setFoo] = useState(false);

  // ...... ç»„ä»¶çš„å…¶ä»–é€»è¾‘ä¸­ä¼šè°ƒç”¨ setFoo ä¿®æ”¹ foo çš„å€¼ ......

  const handleMyEvent = (...args) => {
    // å¤„ç†å‡½æ•°å†…è®¿é—® state å’Œ props ä¸ä¼šæœ‰é—­åŒ…é—®é¢˜
  };

  // å‘½åå£°æ˜äº† funcMap å¹¶ä½¿ç”¨äº† self è·å–äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯é‡åˆ°é—­åŒ…é—®é¢˜äº†ï¼Ÿ
  useInit(
    (self) => {
      // åŸºäº handleMyEvent å°è£…äº†ä¸€å±‚ 
      const handler = () => {
        if (foo) {
          // ğŸ”´ åŸºäº foo çš„ if é€»è¾‘ä¸å±äºè®¾ç½®ç›‘å¬å™¨ï¼Œä¸åº”è¯¥å‡ºç°åœ¨ useInit çš„å›è°ƒä¸­
          // é—®é¢˜è¯´æ˜ï¼šåœ¨ handler è¢«å¼‚æ­¥æ‰§è¡Œæ—¶ï¼Œfoo æ°¸è¿œæ˜¯åˆå§‹å€¼ false
          self.handleMyEvent();
        }
      };
      const eventName = `my-event-${dataId}`; // å› ä¸ºè¿™ä¸ªåœºæ™¯ä¸­ dataId ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘é—­åŒ…é—®é¢˜
      window.addEventListener(eventName, handler);
      
      return () => {
        window.removeEventListener(eventName, handler);
      };
    },
    { handleMyEvent }
  );

  return <div>......</div>;
};

```

åœ¨Â useInitÂ çš„è®¾ç½®ç›‘å¬å™¨é€»è¾‘ä¸­ï¼Œå·²ç»å°†å¦‚ä½•å¤„ç†è‡ªå®šä¹‰äº‹ä»¶è¿™ä»¶äº‹æŠ½è±¡åœ¨äº†Â handleMyEventÂ è¿™ä¸ªå­å‡½æ•°å†…ï¼Œé‚£ä¹ˆå’Œå¤„ç†è‡ªå®šä¹‰äº‹ä»¶ç›¸å…³çš„æ‰€æœ‰é€»è¾‘ï¼ˆç»†èŠ‚å®ç°ã€å­å‡½æ•°ã€é«˜é˜¶å‡½æ•°ç­‰ç­‰ï¼‰éƒ½ä¸åº”è¯¥å†å‡ºç°åœ¨Â handleMyEventÂ ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªåŠŸèƒ½æ­£ç¡®çš„å®ç°æ–¹å¼æ˜¯ï¼š

```tsx
const RightDemo = (props) => {
  const {
    dataId, // dataId åœ¨å½“å‰ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå˜åŒ–
  } = props;

  const [foo, setFoo] = useState(false);

  // ...... ç»„ä»¶çš„å…¶ä»–é€»è¾‘ä¸­ä¼šè°ƒç”¨ setFoo ä¿®æ”¹ foo çš„å€¼ ......

  /**
   * å†æ¬¡å¼ºè°ƒï¼šåªæœ‰å°† state å’Œ props å†™åœ¨å¼‚æ­¥äº‹ä»¶å¤„ç†å‡½æ•°å†…ï¼Œä¸”æ”¾åˆ° funcMap ä¸­æ—¶æ‰èƒ½é¿å…é—­åŒ…é—®é¢˜
   */
  const handleMyEvent = (...args) => {
    // ğŸŸ¢ åŸºäº foo çš„ if é€»è¾‘åº”è¯¥æ”¾åˆ° handleMyEvent ä¸­
    if (foo) {
      // ......
    }
  };

  /**
   * å½“ä½¿ç”¨äº† useInit çš„ç¬¬äºŒä¸ªå‚æ•° funcMap æ—¶ï¼Œå›è°ƒä¸­çš„é€»è¾‘å°±åº”è¯¥åªå‰©ä¸‹éå¸¸å°‘é‡çš„ä¸¤ç±»ä»£ç ï¼š
   *   1ã€è®¾ç½®å„ç±»ç›‘å¬å™¨ï¼ˆaddEventListener / WebSocket / setInterval ç­‰ç­‰ï¼‰ï¼Œå¹¶æŠŠ self ä¸Šçš„æ–¹æ³•ç›´æ¥ä½œä¸ºå¤„ç†å‡½æ•°
   *   2ã€æ¸…ç†å¯¹åº”çš„ç›‘å¬å™¨
   */
  useInit(
    (self) => {
      // è®¾ç½®ç›‘å¬å™¨
      const eventName = `my-event-${dataId}`; // å› ä¸ºè¿™ä¸ªåœºæ™¯ä¸­ dataId ä¸ä¼šå˜åŒ–ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘é—­åŒ…é—®é¢˜
      window.addEventListener(eventName, self.handleMyEvent);
      
      return () => {
        // æ¸…ç†ç›‘å¬å™¨
        window.removeEventListener(eventName, self.handleMyEvent);
      };
    },
    { handleMyEvent }
  );

  return <div>......</div>;
};

```

### ç”¨Â useWatchÂ å¡«è¡¥æœ€åçš„ç©ºç™½

è®©æˆ‘ä»¬ç»§ç»­ç»™ä¸Šé¢çš„ä¾‹å­å¢åŠ å¤æ‚åº¦ï¼Œå‡è®¾ç»„ä»¶Â propsÂ æ¥å—ä¸€ä¸ªÂ modeÂ å‚æ•°ï¼Œæ ¹æ®Â modeÂ æ¥å†³å®šå…·ä½“ç›‘å¬ä»€ä¹ˆç±»å‹çš„äº‹ä»¶ï¼š

```tsx
enum ControlModeEnum {
  Pending = 'pending', // æ¨¡å¼å¾…å®š
  EventA = 'event-a', // ç›‘å¬ event-a äº‹ä»¶æ§åˆ¶æ•°æ®å˜åŒ–
  EventB = 'event-b', // ç›‘å¬ event-a äº‹ä»¶æ§åˆ¶æ•°æ®å˜åŒ–
}

const DataComponent = (props) => {
  const {
    dataId, // dataId åœ¨å½“å‰ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå˜åŒ–
    mode, // ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œmode ä¸º Pendingï¼Œç”±çˆ¶ç»„ä»¶å¼‚æ­¥å†³å®šæœ€ç»ˆçš„æ§åˆ¶æ¨¡å¼
  } = props;

  const [data, setData] = useState<any>(null);

  const handleEventA = (...args) => {
    // æ ¹æ® event-a äº‹ä»¶ä¿®æ”¹ data
  };

  const handleEventB = (...args) => {
    // æ ¹æ® event-b äº‹ä»¶ä¿®æ”¹ data
  };

  useInit(
    (self) => {
      const eventAName = `event-a-${dataId}`;
      const eventBName = `event-b-${dataId}`;

      // ğŸ”´ åœ¨ didMount æ—¶ï¼Œmode çš„å€¼è‚¯å®šæ˜¯ pending
      if (mode === ControlModeEnum.EventA) {
        window.addEventListener(eventAName, self.handleEventA);
      } else if (mode === ControlModeEnum.EventB) {
        window.addEventListener(eventBName, self.handleEventB);
      } else {
        // do nothing
      }

      return () => {
        if (mode === ControlModeEnum.EventA) {
          window.removeEventListener(eventAName, self.handleEventA);
        } else if (mode === ControlModeEnum.EventB) {
          window.removeEventListener(eventBName, self.handleEventB);
        } else {
          // do nothing
        }
      };
    },
    { handleEventA, handleEventB }
  );

  useInit(async () => {
    const initData = await fetchInitialData(dataId);
    setData(initData);
  });

  return <pre>{JSON.stringify(data, null, 4)}</pre>;
};

```

DataComponentÂ ç»„ä»¶è¦æ ¹æ®Â modeÂ å†³å®šç›‘å¬äº‹ä»¶Â AÂ è¿˜æ˜¯äº‹ä»¶Â Bï¼Œè€ŒÂ modeÂ åˆæ˜¯ä¸€ä¸ªä¼šå˜åŒ–çš„Â propsï¼Œä¸”åœ¨è¿™ä¸ªåœºæ™¯ä¸­è¿˜æœ‰å¦ä¸€ä¸ªÂ useInitÂ åœ¨Â modeÂ åˆå§‹åŒ–ä¹‹å‰ä¼šå…ˆæ‰§è¡ŒÂ fetchInitialDataÂ è¿™ä¸ªåŠ¨ä½œï¼Œè‹¥åœ¨çˆ¶ç»„ä»¶ä¸­ç­‰åˆ°Â modeÂ å¼‚æ­¥ç¡®å®šåå†æ¸²æŸ“Â <DataComponentÂ /\>Â ç»„ä»¶ï¼Œåˆ™ä¼šå¯¼è‡´Â fetchInitialDataÂ çš„æ‰§è¡Œæ—¶æœºè¢«å»¶åï¼ˆå½“ç„¶å¦‚æœä¸šåŠ¡èƒ½æ¥å—è¿™ç‚¹æ€§èƒ½å·®å¼‚ï¼Œé‚£è¿™ä¹ˆåšæ˜¯æœ€ç®€å•çš„ï¼‰ã€‚

Â åŸºäºÂ modeÂ çš„Â ifÂ é€»è¾‘æ˜æ˜¾å±äºè®¾ç½®ç›‘å¬å™¨é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™ä¸ªÂ ifÂ é€»è¾‘å°±åº”è¯¥å®ç°åœ¨Â useInitÂ ä¸­ï¼Œä½†æ˜¯å½“æ‰§è¡ŒÂ useInitÂ å›è°ƒçš„æ—¶å€™ï¼ŒmodeÂ çš„å€¼è‚¯å®šæ˜¯Â pendingï¼Œå‡ºé—®é¢˜äº†ã€‚

å…¶å®æˆ‘ä»¬å¯ä»¥å…ˆæƒ³è±¡ä¸€ä¸‹å¦‚æœç”¨ç±»ç»„ä»¶è¿™ä¸ªåŠŸèƒ½è¯¥å¦‚ä½•å®ç°ã€‚æ—¢ç„¶Â modeÂ æ˜¯ä¼šè¢«çˆ¶ç»„ä»¶å¼‚æ­¥åˆå§‹åŒ–çš„ï¼Œé‚£å¿…ç„¶ä¸èƒ½å°†è®¾ç½®äº‹ä»¶ç›‘å¬å™¨çš„é€»è¾‘å†™åœ¨Â componentDidMountÂ ä¸­ï¼Œå¿…é¡»è¦ç”¨åˆ°Â componentDidUpdateÂ è¿™ä¸ªç”Ÿå‘½å‘¨æœŸï¼š

```tsx
class MyComponent extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      data: null,
    };

    // props.dataId åœ¨å½“å‰ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå˜åŒ–
    this.eventAName = `event-a-${props.dataId}`;
    this.eventBName = `event-b-${props.dataId}`;
  }

  componentDidMount() {
    this.fetchInitialData(this.props.dataId).then((initData) => this.setState({ data: initData }));
  }

  handleEventA = (event) => {
    // æ ¹æ® event-a äº‹ä»¶ä¿®æ”¹ data
  };

  handleEventB = (event) => {
    // æ ¹æ® event-b äº‹ä»¶ä¿®æ”¹ data
  };

  componentDidUpdate(prevProps) {
    const { mode } = this.props;
    const { mode: prevMode } = prevProps;

    // æˆ‘ä»¬å‡è®¾ mode åªä¼šä» Pending å˜ä¸º EventA æˆ– EventBï¼Œå¹¶ä¸ä¼šåœ¨ EventA å’Œ EventB ä¹‹é—´åˆ‡æ¢
    // å¦åˆ™ç”¨ç±»ç»„ä»¶æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ä¼šç•¥å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œè¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬è¦è®¨è®ºçš„é‡ç‚¹
    if (mode !== prevMode) {
      if (mode === ControlModeEnum.EventA) {
        window.addEventListener(this.eventAName, this.handleEventA);
      } else if (mode === ControlModeEnum.EventB) {
        window.addEventListener(this.eventBName, this.handleEventB);
      } else {
        // do nothing
      }
    }
  }

  componentWillUnmount() {
    const { mode } = this.props;
    if (mode === ControlModeEnum.EventA) {
      window.removeEventListener(this.eventAName, this.handleEventA);
    } else if (mode === ControlModeEnum.EventB) {
      window.removeEventListener(this.eventBName, this.handleEventB);
    } else {
      // do nothing
    }
  }

  render() {
    return <pre>{JSON.stringify(this.state.data, null, 4)}</pre>;
  }
}

```

å½“ä¸€ä¸ªåŠŸèƒ½æˆ‘ä»¬åœ¨ç±»ç»„ä»¶ä¸­åªèƒ½é€šè¿‡åœ¨Â componentDidUpdateÂ ä¸­åˆ¤æ–­å±æ€§æˆ–çŠ¶æ€çš„å˜åŒ–æ¥å®ç°çš„æ—¶å€™ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ä½¿ç”¨Â WatchÂ HookÂ æä¾›çš„Â propsÂ /Â stateÂ ç›‘å¬èƒ½åŠ›æ¥å®ç°ï¼š

```tsx
const DataComponent = (props) => {
  const {
    dataId, // dataId åœ¨å½“å‰ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå˜åŒ–
    mode, // ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œmode ä¸º Pendingï¼Œç”±çˆ¶ç»„ä»¶å¼‚æ­¥å†³å®šæœ€ç»ˆçš„æ§åˆ¶æ¨¡å¼
  } = props;

  const [data, setData] = useState<any>(null);

  const handleEventA = (...args) => {
    // æ ¹æ® event-a äº‹ä»¶ä¿®æ”¹ data
  };

  const handleEventB = (...args) => {
    // æ ¹æ® event-b äº‹ä»¶ä¿®æ”¹ data
  };

  // Watch Hook
  useWatch(
    /**
     * deps
     *
     * æ—¢ç„¶è¦ç›‘å¬ props / state çš„å˜åŒ–ï¼Œé‚£ç›‘å¬ä»€ä¹ˆå°±æ˜¯æœ€å…³é”®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠç›‘å¬æ•°ç»„ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°
     */
    [mode], // ğŸŸ¡ ç›‘å¬ä»€ä¹ˆé‚£äº›å“åº”å¼å€¼ï¼ˆå¦‚ state å’Œ propsï¼‰éœ€è¦äººå·¥åˆ¤æ–­
    /**
     * watch callback
     *
     * æ¯å½“ç›‘å¬æ•°ç»„ä¸­çš„ä»»æ„ä¸€ä¸ªä¾èµ–é¡¹å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ä¼šæ‰§è¡Œè¯¥å›è°ƒå‡½æ•°ï¼ˆåœ¨ componentDidMount æ—¶ä¹Ÿä¼šè‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ï¼Œæ­¤æ—¶ prevDeps ä¸­çš„æ‰€æœ‰é¡¹éƒ½æ˜¯ undefinedï¼‰
     *
     * @param {typeof funcMap} self - å’Œ useInit ä¸€æ ·ï¼Œself æ˜¯ç”¨äºè§£å†³é—­åŒ…é—®é¢˜çš„
     * @param {typeof deps} prevDeps - æ•°ç»„ä¸­è®°å½•äº†è¢«ç›‘å¬çš„ä¾èµ–é¡¹åœ¨ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶çš„æ—§å€¼
     *   å½“ç›‘å¬äº†å¤šä¸ªä¾èµ–é¡¹æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¾æ¬¡å¯¹æ¯”æ–°æ—§çš„å€¼æ¥ç¡®å®šç›‘å¬å›è°ƒæ˜¯å› ä¸ºå“ªä¸ªä¾èµ–é¡¹å˜åŒ–è€Œè§¦å‘çš„
     * @returns {() => void} cleanup callback - ç”¨äºæ‰§è¡Œæ¸…ç†åŠ¨ä½œçš„å›è°ƒ
     *   å½“å‰ watch callback è¿”å›çš„ cleanup callback ä¼šä¸‹ä¸€æ¬¡è¢«ç›‘å¬ä¾èµ–é¡¹å‘ç”Ÿå˜åŠ¨åï¼Œä¸‹æ¬¡ watch callback æ‰§è¡Œå‰è¢«æ‰§è¡Œ
     *   æœ€åä¸€æ¬¡ watch callback è¿”å›çš„ cleanup callback ä¼šåœ¨ componentWillUnmount æ—¶è¢«æ‰§è¡Œ
     */
    (self, prevDeps) => {
      // watch callback

      const eventAName = `event-a-${dataId}`;
      const eventBName = `event-b-${dataId}`;

      if (mode === ControlModeEnum.EventA) {
        window.addEventListener(eventAName, self.handleEventA);
      } else if (mode === ControlModeEnum.EventB) {
        window.addEventListener(eventBName, self.handleEventB);
      } else {
        // do nothing
      }

      return () => {
        // cleanup callback

        // åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸º mode ä» Pending å˜ä¸º EventA æˆ– EventB åä¸ä¼šå†å‘ç”Ÿæ”¹å˜
        // æ‰€ä»¥äº‹ä»¶ç›‘å¬å™¨ A / B å°†ä¼šåœ¨ componentWillUnmount æ—¶è§£ç»‘

        if (mode === ControlModeEnum.EventA) {
          window.removeEventListener(eventAName, self.handleEventA);
        } else if (mode === ControlModeEnum.EventB) {
          window.removeEventListener(eventBName, self.handleEventB);
        } else {
          // do nothing
        }
      };
    },
    /**
     * ç¬¬ä¸‰ä¸ªå‚æ•° funcMapï¼Œå³å£°æ˜ self ä¸Šæœ‰ä»€ä¹ˆï¼Œç±»ä¼¼åœ¨ class ç»„ä»¶ä¸­å®šä¹‰åŸå‹æ–¹æ³•
     */
    { handleEventA, handleEventB }
  );

  useInit(async () => {
    const initData = await fetchInitialData(dataId);
    setData(initData);
  });

  return <pre>{JSON.stringify(data, null, 4)}</pre>;
};

```

### è°¨æ…ä½¿ç”¨Â useWatch

ä½†æ˜¯è¦æ³¨æ„Â useWatchÂ æ˜¯ä¸€ä¸ªÂ **danger**Â çš„ç”¨äºå®ç°ç›‘å¬ç±»é€»è¾‘çš„Â Hookï¼ŒçœŸæ­£é€‚ç”¨çš„åœºæ™¯å…¶å®æ¯”è¾ƒå°‘ï¼ˆç»å¤§éƒ¨åˆ†åœºæ™¯æœ‰æ›´é€‚åˆçš„æ–¹æ¡ˆï¼‰ã€‚å½“ä½ æƒ³ç”¨Â useWatchÂ å®ç°æŸä¸ªåŠŸèƒ½ï¼Œæˆ–è€…åœ¨ä»£ç ä¸­çœ‹åˆ°Â useWatchÂ æ—¶ï¼Œ**è¯·ä¼˜å…ˆç¡®è®¤èƒ½å¦ç”¨ä»¥ä¸‹æ–¹æ¡ˆå®ç°è¿™ä¸ªåŠŸèƒ½ï¼š**

*   å¦‚æœè¦ç›‘å¬çš„ä¾èµ–é¡¹æ˜¯è‡ªèº«Â stateï¼š
    
    *   ä¼˜å…ˆè®©å½“å‰ç»„ä»¶åœ¨Â setStateÂ çš„æ—¶å€™é€šè¿‡å‡½æ•°è°ƒç”¨ç›´æ¥è§¦å‘å¯¹åº”é€»è¾‘ã€‚
        
*   å¦‚æœè¦ç›‘å¬çš„ä¾èµ–é¡¹æ˜¯Â propsï¼š
    
    *   å¦‚æœè¿™ä¸ªÂ propsÂ åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­éƒ½æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨Â useInitÂ æ¥å®ç°è¿™ä¸ªé€»è¾‘ã€‚
        
    *   å¦‚æœè¿™ä¸ªÂ propsÂ åªæ˜¯éœ€è¦è¿›è¡Œå¼‚æ­¥åˆå§‹åŒ–ï¼Œåˆ™å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­ç­‰å¼‚æ­¥åˆå§‹åŒ–å®Œæˆåå†æ¸²æŸ“å½“å‰ç»„ä»¶ã€‚
        
    *   å¦‚æœè¿™ä¸ªÂ propsÂ ç¡®å®æ˜¯ä¼šä¸æ–­å˜åŒ–ï¼Œåˆ™ï¼š
        
        *   ä¼˜å…ˆè€ƒè™‘åœ¨çˆ¶ç»„ä»¶ä¸­ç»™å½“å‰ç»„ä»¶è®¾ç½®Â keyÂ å®ç°ç»„ä»¶åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶è‡ªåŠ¨é”€æ¯å¹¶åˆ›å»ºæ–°ç»„ä»¶ï¼Œå…·ä½“å‚è€ƒ[ã€ŠÂ å½“Â propsÂ å˜åŒ–æ—¶é‡ç½®æ‰€æœ‰Â stateÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#resetting-all-state-when-a-prop-changes)å’Œ[ã€ŠÂ æœ‰Â keyÂ çš„éå¯æ§ç»„ä»¶Â ã€‹](https://zh-hans.legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-uncontrolled-component-with-a-key)ã€‚åœ¨ä¸€äº›éœ€è¦å¼‚æ­¥åˆå§‹åŒ–çš„ä¸šåŠ¡ç»„ä»¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°çš„Â UIÂ ç•Œé¢æŠ–åŠ¨é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨éª¨æ¶å›¾ã€CSSÂ TransitionsÂ ç­‰æ–¹å¼è§£å†³ã€‚
            
        *   å¯ä»¥è€ƒè™‘å°†ä¾èµ–é¡¹å˜åŒ–æ—¶è¦æ‰§è¡Œçš„é€»è¾‘æŠ½ç¦»æˆç‹¬ç«‹çš„å‡½æ•°æ–¹æ³•ï¼Œé€šè¿‡Â useImperativeHandleÂ å°†å‡½æ•°æ–¹æ³•æŒ‚è½½åˆ°Â refÂ ä¸Šï¼Œä»è€Œè®©çˆ¶ç»„ä»¶ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¾‹å¦‚ä¸€äº›å¼¹æ¡†/æŠ½å±‰ç±»ç»„ä»¶å¯ä»¥é€šè¿‡Â refÂ å‘å¤–æš´éœ²ä¸€äº›Â showModal/showDrawerÂ æ–¹æ³•é¿å…åœ¨è¿™äº›ç»„ä»¶å†…éƒ¨ç›‘å¬Â visibleÂ å±æ€§æ‰§è¡Œéƒ¨åˆ†Â stateÂ çš„é‡ç½®é€»è¾‘ã€‚ä½†è‹¥Â propsÂ é€ä¼ å±‚çº§è¿‡æ·±ï¼Œæˆ–æŠ½ç¦»çš„å‡½æ•°æ–¹æ³•ä¸é€‚åˆè¢«çˆ¶ç»„ä»¶è°ƒç”¨ï¼ˆæ¯”å¦‚çˆ¶ç»„ä»¶ä¸åº”è¯¥å…³å¿ƒè¿™ä¸ªå­ç»„ä»¶å†…éƒ¨è¿‡ç¨‹ï¼‰ï¼Œåˆ™ä¸é€‚ç”¨è¿™ä¸ªæ–¹å¼ã€‚
            

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½ä¸èƒ½å¾ˆå¥½åœ°å®ç°ä½ çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆä½ æ‰å¯èƒ½éœ€è¦ä½¿ç”¨Â useWatchã€‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š

```tsx
/**
 * ğŸŸ¡ useWatch å’Œ unInit ä¸€æ ·ï¼Œå¯ä»¥ä¸å£°æ˜ funcMap å‚æ•°ï¼Œå¯ä»¥ä¸è¿”å› cleanup callback
 */
useWatch([foo, bar], () => {
  console.log('watch:', foo, bar);
});

/**
 * ğŸŸ¡ ä½¿ç”¨ useWatch å’Œåœ¨ componentDidUpdate åˆ¤æ–­ä¾èµ–æœ‰ä¸€ä¸ªå°å·®å¼‚
 * å³ useWatch åœ¨é¦–æ¬¡æ¸²æŸ“ä¹‹åä¹Ÿä¼šæ‰§è¡Œï¼Œæ­¤æ—¶çš„ prevDeps æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯ undefined
 */
useWatch([foo, bar], (_, prevDeps) => {
  /**
   * å®é™…æ‰“å°ï¼š
   * prevDeps: [undefined, undefined]
   * prevDeps: [..., ...]
   * prevDeps: [..., ...]
   * prevDeps: [..., ...]
   */
  console.log('prevDeps:', prevDeps);
});

/**
 * ğŸŸ¡ useWatch ç›‘å¬å“ªäº›ä¾èµ–å’Œå›è°ƒå‡½æ•°ä¸­ä¼šç”¨åˆ°å“ªäº› props / state æ˜¯æ²¡æœ‰ä»»ä½•å…³è”çš„ï¼Œè¯·è‡ªè¡Œç¡®ç›‘å¬ç›®æ ‡å£°æ˜æ­£ç¡®
 */
useWatch([lastName, firstName], () => {
  // ä»…åœ¨å§“åå˜åŒ–çš„æ—¶å€™è¿›è¡Œæ‰“å°ï¼Œç›‘å¬äº† 2 ä¸ªçŠ¶æ€ï¼Œç”¨åˆ°äº† 3 ä¸ªçŠ¶æ€
  console.log(`The name was changed to ${firstName} ${lastName} at ${timestamp}.`);
});

```

æœ€ååœ¨ç”¨åˆ°Â useWatchÂ çš„åœºæ™¯ä¸­ï¼Œä¹Ÿå»ºè®®ä¸»åŠ¨æ‰¾é è°±çš„åŒäº‹è¿›è¡ŒÂ CodeÂ ReviewÂ ç›¸äº’ç¡®è®¤ä¸€ä¸‹ï¼Œä»¥åŠç¡®ä¿æœ‰åˆé€‚çš„æ³¨é‡Šèƒ½è®©ä»£ç æœ‰è¾ƒé«˜çš„å¯è¯»æ€§ã€‚

è‡³æ­¤ï¼Œç°åœ¨è¿™ä¸ªâ€œå¹³è¡Œä¸–ç•Œâ€çš„Â ReactÂ HookÂ æ–¹æ¡ˆå·²ç»ä»‹ç»å®Œäº†ï¼Œåœ¨ç¼–å†™å¹³æ—¶çš„ä¸šåŠ¡ä»£ç æ—¶ï¼Œç›¸æ¯”äºåŸæœ¬çš„Â useEffectÂ æ–¹æ¡ˆï¼š

*   **ä½ å‡ ä¹ä¸ç”¨å†™ä¾èµ–**ï¼ˆé™¤äº†æå°‘æ•°åœºæ™¯éœ€è¦å¿…é¡»è¦ç”¨åˆ°Â useWatchÂ æ—¶ï¼Œè¦æ˜ç¡®è¦ç›‘å¬çš„æ•°æ®æ˜¯ä»€ä¹ˆï¼‰
    
*   **å¾ˆå°‘ä¼šæ„ŸçŸ¥åˆ°é—­åŒ…é—®é¢˜**
    

å†é…åˆç¬¬ä¸€ç« ä¸­å¯¹äºÂ useCallbackÂ å’ŒÂ useMemoÂ çš„è§‚ç‚¹ï¼šPureComponentÂ å¼çš„ä¼˜åŒ–æ–¹æ¡ˆåœ¨è¿­ä»£ä¸­æ˜¯æå…¶è„†å¼±çš„ï¼Œåº”è¯¥ä¼˜å…ˆç”¨å…¶ä»–æ–¹å¼è§£å†³æ€§èƒ½é—®é¢˜ï¼š

*   **ä½ å®Œå…¨ä¸ç”¨å†™Â useCallbackï¼Œæ˜¯çš„æˆ‘ä»¬é¡ºä¾¿ä¹Ÿæ¶ˆé™¤äº†Â 100%Â çš„Â useCallback**
    
*   **ä½ å‡ ä¹ä¸ä¼šç”¨åˆ°Â useMemo**ï¼ˆä»…åœ¨åŸºäºÂ stateÂ /Â propsÂ è¿›è¡Œæ˜‚è´µçš„è¡ç”Ÿè®¡ç®—æ—¶éœ€è¦ä½¿ç”¨ï¼‰
    

> PS:Â ä¸è¿‡åœ¨å†™ä¸€äº›éœ€è¦å°è£…åˆ°Â npmÂ åŒ…ä¸­çš„éå¸¸åŸºç¡€çš„ä¸šåŠ¡Â HookÂ æ—¶ï¼Œå› ä¸ºè€ƒè™‘åˆ°Â npmÂ åŒ…å¼•ç”¨æ–¹çš„ç¯å¢ƒä¸å¯æ§ï¼ˆæ¯”å¦‚é™¤äº†ä¿®å¤é—®é¢˜ä¹‹å¤–ä¸å†è¿›è¡ŒåŠŸèƒ½è¿­ä»£çš„å†å²é¡¹ç›®å·¥ç¨‹ï¼‰ï¼Œåœ¨ç¡®ä¿ä»£ç è´¨é‡çš„å‰æä¸‹ï¼Œåœ¨å‘å¤–æš´éœ²å˜é‡æ—¶è¿˜æ˜¯è¦å°½é‡ç”¨ä¸€ä¸‹Â useMemoÂ å’ŒÂ useCallbackÂ æ­£ç¡®åŒ…è£¹ã€‚

å›é¡¾ç¬¬ä¸‰ç« ä¸­æåˆ°çš„æ‰€æœ‰Â useEffectÂ çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„æ–°æ–¹æ¡ˆåŸºæœ¬éƒ½å¾ˆå¥½åœ°è§£å†³æˆ–è€…è§„é¿äº†ã€‚

**PerfectÂ !Â ç«‹é©¬åœ¨å›¢é˜Ÿå†…æ‰¾å‡ ä¸ªå‰ç«¯å·¥ç¨‹è¯•è¡Œè¿™å¥—æ–°çš„Â ReactÂ HookÂ ç¼–ç èŒƒå¼ï¼Œä»¥åæ–°çš„éœ€æ±‚å¯¹åº”çš„å®ç°ä»£ç ä¸å…è®¸å†ä½¿ç”¨**Â **useCallbackå’Œ**Â **useEffect****ã€‚**

## 3ã€è‡ªå®šä¹‰Â HookÂ è®¾è®¡é—®é¢˜

### ä¾èµ–å¼‚æ­¥æ•°æ®çš„åˆå§‹åŒ–é€»è¾‘

åœ¨è¯•è¡Œè¿™å¥—æ–°çš„æ–¹æ¡ˆæ—¶ï¼Œå¾ˆå¿«æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼ŒuseInitÂ å’Œå¾ˆå¤šåŸæœ‰çš„è‡ªå®šä¹‰Â HookÂ ä¸å¤ªå…¼å®¹ï¼Œä¾‹å¦‚æˆ‘ä»¬åŸæœ¬å°è£…äº†ä¸€ä¸ªå…¬å…±çš„è‡ªå®šä¹‰Â HookÂ å«åšÂ useProjectInfoï¼š

```tsx
/** æŸä¸ªå‰ç«¯å·¥ç¨‹ä¸­å…¬å…±çš„â€œæŸ¥è¯¢é¡¹ç›®ä¿¡æ¯ Hookâ€ */
const useProjectInfo = () => {
  const [info, setInfo] = useState(null);

  const fetchInfo = async () => {
    const { projectId } = qs.parse(location.search.slice(1));
    const query = qs.stringify({ projectId });
    const response = await fetch(`/project/detail?${query}`);
    const data = await response.json();
    setInfo(data);
  };

  useEffect(() => {
    fetchInfo();
  }, []);

  return {
    projectInfo: info,
  };
};

/** é¡µé¢ç»„ä»¶ */
const Page = (props) => {
  const { projectInfo } = useProjectInfo();

  if (!projectInfo) {
    return null;
  }

  return <pre>{JSON.stringify(projectInfo, null, 4)}</pre>;
};

```

å½“æŸæ¬¡è¿­ä»£ä¸­ï¼ŒæœåŠ¡ç«¯åœ¨æ¥å£è¿”å›ä¸­å¢åŠ äº†ä¸€äº›é…ç½®ä¿¡æ¯æˆ–è€…éœ€è¦å°†Â projectInfoÂ ä¸­çš„éƒ¨åˆ†æ•°æ®å•ç‹¬ä½œä¸ºÂ stateÂ æ—¶ï¼ŒåŸæœ¬ç”¨Â useEffectÂ æˆ‘ä»¬å¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š

```tsx
/** é¡µé¢ç»„ä»¶ */
const Page = (props) => {
  const { projectInfo } = useProjectInfo();

  const [itemList, setItemList] = useState([]);

  const handleAddItemBtnClick = () => {
    setItemList([
      ...itemList,
      {
        name: 'å•†å“åç§°',
        createTime: Date.now(),
      },
    ]);
  };

  const handleDeleteItemBtnClick = () => {
    // ......
  };

  const handleSaveBtnClick = async () => {
    await saveProjectInfo();
    await message.success('ä¿å­˜æˆåŠŸï¼Œé¡µé¢å°†è‡ªåŠ¨åˆ·æ–°ã€‚');
    window.location.reload();
  };

  useEffect(() => {
    if (!projectInfo) {
      return;
    }

    // è·å–åˆ°é¡¹ç›®çº§ä¿¡æ¯åï¼Œæ‰§è¡Œä»¥ä¸‹é¢å¤–é€»è¾‘ï¼š

    // è¯»å–æŸäº›é…ç½®ï¼Œç»™äºˆç”¨æˆ·æç¤º
    if (projectInfo.configuration.needTip) {
      Modal.info({
        title: 'æé†’',
        content: 'è¯·æ³¨æ„......',
      });
    }

    // å°†éƒ¨åˆ†æ•°æ®å•ç‹¬è®¾ä¸º stateï¼Œå› ä¸ºé¡µé¢ä¸­æ–°å¢äº†å•†å“æ–°å¢ã€åˆ é™¤ç±»åŠŸèƒ½ï¼ˆä¿å­˜ä¹‹å‰ä¸ç”Ÿæ•ˆï¼‰
    // è€Œ projectInfo ä¸­çš„ itemList åˆ™è§†ä¸ºæœåŠ¡ç«¯ç›®å‰å®é™…å­˜å‚¨çš„å•†å“æ•°æ®
    setItemList(_.clone(projectInfo.itemList || []));
  }, [projectInfo]);

  if (!projectInfo) {
    return null;
  }

  return (
    <div>
      <div>......</div>
      <pre>{JSON.stringify(projectInfo, null, 4)}</pre>
    </div>
  );
};

```

è¿™ç§ä»£ç Â useEffectÂ ç”¨æ³•åœ¨æˆ‘ä»¬å›¢é˜Ÿä¸­æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œæˆ‘ä»¬ç”¨Â useWatchÂ ä¹Ÿèƒ½å®ç°ï¼š

```tsx
const { projectInfo } = useProjectInfo();

// ......

useWatch([projectInfo], () => {
  if (!projectInfo) {
    return;
  }

  // ...... å‰©ä½™ä»£ç å’Œ useEffect å®Œå…¨ç›¸åŒ
});
```

ä½†æ˜¯å¦‚æœè¿™ä¹ˆç©ï¼ŒuseWatchÂ çš„ä½¿ç”¨ä¹Ÿä¼šåœ¨å·¥ç¨‹ä¸­æ³›æ»¥ï¼Œè¿™ç§ç”¨æ³•æ ¹æœ¬ä¸åœ¨æˆ‘ä»¬Â useWatchÂ çš„è®¾è®¡é¢„æœŸå†…ï¼Œå› ä¸ºè¿™äº›é€»è¾‘æœ¬è´¨ä¸Šè¿˜æ˜¯å±äºç»„ä»¶åˆå§‹åŒ–é˜¶æ®µçš„ä¸€æ¬¡æ€§é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•è¿‡æ–°å¢äº†ä¸€ä¸ªÂ HookÂ æ”¯æŒè¿™ç§ä¾èµ–å¼‚æ­¥æ•°æ®çš„ç»„ä»¶åˆå§‹åŒ–é€»è¾‘ï¼ˆç›®å‰è¯¥Â HookÂ å·²è¢«åºŸå¼ƒï¼‰ï¼š

```tsx
const { projectInfo } = useProjectInfo();

// ......

// ğŸŸ¡ useInitWhenReady å†…éƒ¨ä¼šè‡ªåŠ¨ç›‘å¬ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç­‰åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºçœŸå€¼æ—¶ï¼Œå†æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
useInitWhenReady(Boolean(projectInfo), () => {
  // è·å–åˆ°é¡¹ç›®çº§ä¿¡æ¯åï¼Œæ‰§è¡Œä»¥ä¸‹é¢å¤–é€»è¾‘ï¼š

  // è¯»å–æŸäº›é…ç½®ï¼Œç»™äºˆç”¨æˆ·æç¤º
  if (projectInfo.configuration.needTip) {
    Modal.info({
      title: 'æé†’',
      content: 'è¯·æ³¨æ„......',
    });
  }

  // å°†éƒ¨åˆ†æ•°æ®å•ç‹¬è®¾ä¸º stateï¼Œå› ä¸ºé¡µé¢ä¸­æ–°å¢äº†å•†å“æ–°å¢ã€åˆ é™¤ç±»åŠŸèƒ½ï¼ˆä¿å­˜ä¹‹å‰ä¸ç”Ÿæ•ˆï¼‰
  // è€Œ projectInfo ä¸­çš„ itemList åˆ™è§†ä¸ºæœåŠ¡ç«¯ç›®å‰å®é™…å­˜å‚¨çš„å•†å“æ•°æ®
  setItemList(_.clone(projectInfo.itemList || []));
});

```

ç›¸æ¯”äºÂ useEffectÂ å’ŒÂ useWatchÂ è¯­ä¹‰åŒ–ç¡®å®æ›´å¼ºäº†ï¼Œä¹Ÿèƒ½å¤ç”¨å„ç§å·²æœ‰çš„ä¸šåŠ¡Â Hookï¼Œè€Œä¸”è¿˜å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå¼‚æ­¥ä¾èµ–ï¼š

```tsx
const { projectInfo } = useProjectInfo();
const { articleInfo } = useArticleInfo();
const { announcementInfo } = useAnnouncementInfo();

// ......

useInitWhenReady(
  Boolean(projectInfo) && Boolean(articleInfo) && Boolean(announcementInfo), 
  () => {
    // å¼‚æ­¥è·å–åˆ°å„ç§ä¿¡æ¯åï¼Œå†æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘
  },
);
```

çœ‹èµ·èµ·æ¥å¾ˆä¸é”™ï¼Œé™¤äº†Â isReadyÂ çš„åˆ¤æ–­æœ‰ç‚¹ä¸‘ï¼Œä½†å¦‚æœæŸä¸ªé¡µé¢åœ¨è¿­ä»£åÂ articleInfoÂ å’ŒÂ announcementInfoÂ çš„è¯·æ±‚å…¥å‚ä¸­éœ€è¦é¢å¤–ä¼ å…¥Â projectInfoÂ ä¸­çš„éƒ¨åˆ†æ•°æ®ï¼ˆè¿™é‡Œä¸è®¨è®ºæœåŠ¡ç«¯æ¥å£åˆå¹¶ï¼Œè¿™æ˜¯ä¸¤ä¸ªè¯é¢˜ï¼‰ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è°ƒæ•´è‡ªå®šä¹‰ä¸šåŠ¡Â HookÂ ä¸­çš„é€»è¾‘ï¼Œè®©ä»–ä»¬æ”¯æŒç±»ä¼¼Â ahooksÂ ä¸­çš„Â [useRequestÂ æ‰‹åŠ¨è§¦å‘æ¨¡å¼](https://ahooks.js.org/zh-CN/hooks/use-request/basic#%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91)ï¼š

```tsx
// useProjectInfo é€»è¾‘ä¸ç”¨ä¿®æ”¹
const useProjectInfo = () => {
  /* ...... */
};

// ä¿®æ”¹ useArticleInfo é€»è¾‘ä½¿å…¶æ”¯æŒæ‰‹åŠ¨è§¦å‘æ¥å£è¯·æ±‚
const useArticleInfo = (options) => {
  const {
    manual = false, // ğŸŸ¡ å› ä¸º useArticleInfo ä½œä¸ºé€šç”¨ä¸šåŠ¡ Hook è¢«å¼•ç”¨çš„åœ°æ–¹å¾ˆå¤šï¼Œæ‰€ä»¥é€šè¿‡å¢åŠ é…ç½®é¡¹çš„æ–¹å¼æ¥å®ç°è¯¥åŠŸèƒ½ä»¥å…¼å®¹å…¶ä»–åœºæ™¯
  } = options | {};

  const [info, setInfo] = useState(null);

  const fetchInfo = async (extraParams = {}) => {
    const { projectId } = qs.parse(location.search.slice(1));
    const params = {
      projectId,
      ...(manual ? extraParams : {}),
    };
    const query = qs.stringify(params);
    const response = await fetch(`/article/detail?${query}`);
    const data = await response.json();
    setInfo(data);
    return data;
  };

  useEffect(() => {
    // ğŸŸ¡ æ‰‹åŠ¨æ¨¡å¼æ—¶ï¼Œä¸è‡ªåŠ¨è§¦å‘è¯·æ±‚
    if (!manual) {
      fetchInfo();
    }
  }, []);

  return {
    articleInfo: info,
    fetchArticleInfo: fetchInfo,
  };
};

// ä¿®æ”¹ useAnnouncementInfo é€»è¾‘ä½¿å…¶æ”¯æŒæ‰‹åŠ¨è§¦å‘æ¥å£è¯·æ±‚
const useAnnouncementInfo = (params, options) => {
  /* ...... ä»£ç ä¿®æ”¹æ–¹å¼åŒ useArticleInfo ...... */
};

/** é¡µé¢ç»„ä»¶ */
const Page = (props) => {
  const { projectInfo } = useProjectInfo();
  const { articleInfo, fetchArticleInfo } = useArticleInfo({ manual: true });
  const { announcementInfo, fetchAnnouncementInfo } = useAnnouncementInfo({ manual: true });

  useInitWhenReady(Boolean(projectInfo), () => {
    fetchArticleInfo({
      bizId: projectInfo.bizId, // 
    });
    fetchAnnouncementInfo({
      type: projectInfo.announcementType,
    });
  });

  if (!projectInfo) {
    return null;
  }

  return (
    <div>
      <div>......</div>
      <pre>{JSON.stringify(projectInfo, null, 4)}</pre>
      <pre>{JSON.stringify(articleInfo, null, 4)}</pre>
      <pre>{JSON.stringify(announcementInfo, null, 4)}</pre>
    </div>
  );
};

```

æˆ–è€…æˆ‘ä»¬å¹²è„†ä¹Ÿè®©Â useProjectInfoÂ æ”¯æŒÂ manualÂ æ¨¡å¼ï¼Œè¿™æ ·æˆ‘ä»¬ä¹Ÿå°±å¯ä»¥ç”¨å›Â useInitÂ äº†ï¼š

```tsx
useInit(async () => {
  const projectInfo = await fetchProjectInfo();
  fetchArticleInfo({
    bizId: projectInfo.bizId,
  });
  fetchAnnouncementInfo({
    type: projectInfo.announcementType,
  });
});

```

### å…³äºè‡ªå®šä¹‰Â HookÂ çš„é¢å¤–è§„èŒƒ

ä¾‹å­è¯´å®Œäº†ï¼Œåˆ†æä»¥ä¸Šåœºæ™¯ï¼Œæ„Ÿè§‰Â useInitWhenReadyÂ åœ¨ä¸€äº›åœºæ™¯ä¸­ç¡®å®æœ‰å¿…è¦ï¼Œé‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜æ˜¯æŠŠè¿™ä¸ªÂ HookÂ åºŸå¼ƒäº†å‘¢ï¼Ÿå…¶å®ä¸»è¦æ˜¯å›åˆ°äº†æˆ‘ä»¬ç¬¬ä¸€ç« ä¸­çš„è§‚ç‚¹ï¼šâ€œ**ä»£ç æ„å›¾çš„æ­£ç¡®ä¼ è¾¾**â€å’Œâ€œ**ä¿æŒä»£ç ç»“æ„ä¸€è‡´æ€§**â€ã€‚

*   åœ¨æœ€åç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨Â useInitÂ çš„ä»£ç è¯­ä¹‰åŒ–æ˜æ˜¾å¥½äºÂ useInitWhenReadyï¼Œå› ä¸ºåªçœ‹è¿™åè¡Œå·¦å³çš„ä»£ç ï¼Œä½ æ— æ³•çŸ¥é“Â projectInfoÂ æ˜¯ä»å“ªæ¥çš„ã€‚å…¶å®å¾ˆå¤šæ—¶å€™å¦‚ä½•åˆ¤æ–­è¯­ä¹‰åŒ–æ˜¯å¦ä¼˜ç§€ï¼Œ**å¯ä»¥æŠŠä»£ç å½“ä½œè‡ªç„¶è¯­è¨€ï¼ˆä¸­æ–‡Â /Â è‹±è¯­ï¼‰æ¥é˜…è¯»**ï¼Œè¶Šé€šé¡ºè¶Šå¥½ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°ç¡®ä¿ä»£ç æ„å›¾çš„æ­£ç¡®ä¼ è¾¾ã€‚![Code 2025-03-04 ä¸‹åˆ2.15.32.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/57996e0b-9bf1-47e8-a5d3-ea84bde73c24.png)
    

*   åœ¨ä¸Šé¢çš„å‡ æ¬¡è¿­ä»£ä¸­ï¼Œå› ä¸ºå¤šäº†ä¸€ä¸ªÂ HookÂ ä¹‹åå®ç°æ–¹å¼çš„é€‰æ‹©å˜å¤šï¼Œå¯¼è‡´æˆ‘ä»¬çš„**ä»£ç ç»“æ„åœ¨ä¸æ–­åœ°å˜åŒ–**ï¼š
    
    *   å¼•å…¥Â useInitWhenReady
        
    *   ä¿®æ”¹éƒ¨åˆ†è‡ªå®šä¹‰ä¸šåŠ¡Â HookÂ é¢å¤–æ”¯æŒÂ manualÂ æ‰‹åŠ¨æ¨¡å¼
        
    *   ä¿®æ”¹å…¨éƒ¨è‡ªå®šä¹‰ä¸šåŠ¡Â HookÂ é¢å¤–æ”¯æŒÂ manualÂ æ‰‹åŠ¨æ¨¡å¼
        
    *   åˆ é™¤Â useInitWhenReadyÂ æ”¹å›Â useInit
        
    *   ......
        
    *   è€Œä¸”æˆ‘ä»¬å®Œå…¨æœ‰ç†ç”±å»çŒœæµ‹ï¼Œä»¥åÂ useInitWhenReadyÂ ä¼šè¢«ç”¨åœ¨ä¸€äº›ä¸åœ¨è®¾è®¡æ„å›¾å†…çš„é”™è¯¯åœºæ™¯ä¸­ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§éªšæ“ä½œï¼š![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/bfc1b36e-c10a-4923-9602-582156eb4ee1.png)
        

æ‰€ä»¥æœ€åçš„ç»“è®ºæ˜¯å¼ƒç”¨Â useInitWhenReadyï¼Œå¹¶åœ¨æˆ‘ä»¬å…¨æ–°çš„Â ReactÂ HookÂ ç¼–ç èŒƒå¼ä¸­ï¼Œå¯¹æ‰€æœ‰çš„ä¸šåŠ¡è‡ªå®šä¹‰Â HookÂ è®¾è®¡æœ‰ä¸€å±‚é¢å¤–çš„çº¦æŸï¼š

*   **å°è£…äº†ä¸šåŠ¡æ¥å£è¯·æ±‚çš„è‡ªå®šä¹‰Â HookÂ åªèƒ½åŒ…å«çŠ¶æ€å’Œå‡½æ•°çš„å®šä¹‰ï¼Œä¸èƒ½åœ¨è‡ªå®šä¹‰Â HookÂ å†…åŒ…å«ä¼šè‡ªåŠ¨æ‰§è¡Œçš„é€»è¾‘ï¼Œå³ä¸èƒ½åŒ…å«Â useInitÂ å’ŒÂ useWatchÂ è¿™ä¸¤ä¸ªÂ Hookã€‚**
    
*   **ä¸è¿‡å¯ä»¥å°†Â useInitÂ å’ŒÂ useWatchÂ å…¶å°è£…åˆ°ç»‘å®šç›‘å¬å™¨ç±»çš„è‡ªå®šä¹‰Â HookÂ ä¸­ï¼ˆä¾‹å¦‚**Â [**useOnlineStatus**](https://zh-hans.react.dev/learn/reusing-logic-with-custom-hooks#extracting-your-own-custom-hook-from-a-component)**ï¼‰ï¼Œå› ä¸ºç»‘å®šç›‘å¬å™¨çš„é€»è¾‘ä¸€èˆ¬ä¸ä¼šæœ‰æ‰§è¡Œé¡ºåºè¦æ±‚ï¼Œè€Œä¸”ç›‘å¬å›è°ƒæœ¬è´¨ä¸Šä¹Ÿä¸æ˜¯ç”±ç»„ä»¶å†…éƒ¨è§¦å‘çš„ã€‚**
    

é‚£ä¹ˆæ‰€æœ‰å¸¸è§çš„æ•°æ®è¯·æ±‚ç±»çš„è‡ªå®šä¹‰Â HookÂ éƒ½åº”è¯¥æ˜¯ç±»ä¼¼è¿™æ ·çš„ï¼Œæœ‰ç‚¹ç±»ä¼¼åªæ”¯æŒÂ manualÂ æ‰‹åŠ¨æ¨¡å¼çš„Â [useRequest](https://ahooks.js.org/zh-CN/hooks/use-request/basic#%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91)ï¼Œä½†å’ŒÂ useRequsetÂ ä¸åŒçš„æ˜¯ï¼Œæ— è®ºæ˜¯æ‰‹åŠ¨è§¦å‘è¯·æ±‚çš„å‡½æ•°è¿˜æ˜¯Â HookÂ æœ¬èº«ï¼Œéƒ½ä¼šè¿”å›Â stateï¼Œä¸€ä¸ªç”¨äºÂ UIÂ æ¸²æŸ“ï¼Œä¸€ä¸ªç”¨äºÂ JSÂ é€»è¾‘ï¼š

```tsx
/**
 * è‡ªå®šä¹‰ Hook ä¸­åªèƒ½åŒ…å« useStateã€useRef ä»¥åŠå¸¸è§„å‡½æ•°ã€å˜é‡çš„å®šä¹‰
 */
const useXxxInfo = () => {
  const [info, setInfo] = useState(null);

  const fetchInfo = async (params = {}) => {
    const query = qs.stringify(params);
    const response = await fetch(`/project/detail?${query}`);
    const data = await response.json();
    // ğŸŸ¡ æ³¨æ„ä¸‹é¢ä¸¤è¡Œä»£ç 
    setInfo(data); // è¯·æ±‚æˆåŠŸåè‡ªåŠ¨æ›´æ–° state ç”¨äº UI æ¸²æŸ“
    return data; // åŒæ—¶å¼‚æ­¥å‘å¤–æš´éœ²æœ€æ–°çš„ state å€¼ç”¨äº JS é€»è¾‘
  };

  // å‘å¤–æš´éœ² state å’Œå¯¹åº”çš„æ–¹æ³•ï¼Œéœ€è¦åœ¨å¤–éƒ¨æ‰‹åŠ¨è°ƒç”¨è¿™äº›æ–¹æ³•æ¥è§¦å‘ Hook ä¸­å°è£…çš„é€»è¾‘
  return {
    projectInfo: info,
    fetchXxxInfo: fetchInfo,
  };
};

```

è¿™ç§å°è£…æ–¹å¼æ—¢ä¿è¯äº†è‰¯å¥½çš„å¯è¯»æ€§ï¼Œåªçœ‹æ‰€æœ‰çš„Â useInitÂ å°±å¯ä»¥æ¸…æ™°åœ°äº†è§£åˆå§‹åŒ–é€»è¾‘ã€‚ä¹Ÿç¡®ä¿äº†åœ¨ä¸æ–­çš„éœ€æ±‚è¿­ä»£ä¸­ï¼Œä»£ç æ•´ä½“ç»“æ„å°½é‡ä¸å‘ç”Ÿå¤§çš„å˜åŒ–ï¼Œå› ä¸ºæ‰€æœ‰çš„åˆå§‹åŒ–é€»è¾‘è°ƒæ•´éƒ½å°†æ”¶æ•›åœ¨Â useInitÂ ä¸­ï¼š

```tsx
const { projectInfo, fetchProjectInfo } = useProjectInfo();
const { articleInfo, fetchArticleInfo } = useArticleInfo();
const { announcementInfo, fetchAnnouncementInfo } = useAnnouncementInfo();

// åœºæ™¯ä¸€ï¼šè¯·æ±‚æ²¡æœ‰å…ˆåé¡ºåº
useInit(async () => {
  fetchProjectInfo();
  fetchArticleInfo();
  fetchAnnouncementInfo();
});

// åœºæ™¯äºŒï¼šå…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¦å‰ç½®ï¼ˆè¢«å¦å¤–æ‰€æœ‰æ¥å£ä¾èµ–ï¼‰
useInit(async () => {
  const pInfo = await fetchProjectInfo();
  fetchArticleInfo({
    bizId: pInfo.bizId,
  });
  fetchAnnouncementInfo({
    type: pInfo.announcementType,
  });
});

// åœºæ™¯ä¸‰ï¼šå…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¦å‰ç½®ï¼ˆè¢«å¦å¤–ä¸€ä¸ªæ¥å£ä¾èµ–ï¼‰
useInit(async () => {
  fetchArticleInfo();
  const pInfo = await fetchProjectInfo();
  fetchAnnouncementInfo({
    type: pInfo.announcementType,
  });
});

// åœºæ™¯å››ï¼šå…¶ä¸­å¤šä¸ªè¯·æ±‚è¦å‰ç½®ï¼ˆè¢«å¦ä¸€ä¸ªæ¥å£ä¾èµ–ï¼‰
useInit(async () => {
  const [pInfo, aInfo] = await Promise.all([fetchProjectInfo(), fetchArticleInfo()]);
  fetchAnnouncementInfo({
    type: pInfo.announcementType,
    articleId: aInfo.id,
  });
});

```

ä¸è¿‡è¿™æ ·è‡ªå®šä¹‰Â HookÂ è®¾è®¡è§„èŒƒåæœŸæ˜¯æ— æ³•å®ç°ç›®å‰ç¤¾åŒºä¸­Â SWRÂ ç±»çš„ç¼“å­˜ä¼˜åŒ–çš„ï¼ˆä¾‹å¦‚Â [useSWR](https://swr.vercel.app/zh-CN)ï¼‰ã€‚ä¸è¿‡åœ¨è¿™ä¸ªÂ [useSWRÂ çš„å…¥é—¨ç¤ºä¾‹](https://swr.vercel.app/zh-CN/docs/getting-started)Â ä¸­ï¼Œæˆ‘å€’è®¤ä¸ºÂ _<NavbarÂ user={user}Â />_Â ç”¨å—æ§ç»„ä»¶å½¢å¼å»æ¥æ”¶Â userÂ å¯¹è±¡ä¹Ÿæ²¡å•¥å¤§é—®é¢˜ï¼Œå¦‚æœåœ¨ä½¿ç”¨äº†Â useSWRÂ åå½“è¿™ä¸ªÂ NavbarÂ ç»„ä»¶éœ€è¦è·¨ä¸šåŠ¡åœºæ™¯å¤ç”¨æ—¶ï¼Œä½ åè€Œä¼šå‘ç°è¿™ä¸ªç»„ä»¶å’Œå…·ä½“æ•°æ®æ¥å£è€¦åˆäº†ã€‚è¿˜æœ‰ä¸€äº›ç¡®å®è¦åœ¨çŸ­æ—¶é—´å†…å‡å°‘ç½‘ç»œæ¥å£è¯·æ±‚çš„åœºæ™¯ä¸­ï¼ˆæ¯”å¦‚ç§»åŠ¨ç«¯å¼±ç½‘åœºæ™¯ï¼‰ï¼Œå…¶å®å¯ä»¥å…ˆè®©æœåŠ¡ç«¯å…ˆç”¨ä¼ ç»Ÿçš„Â HTTPÂ ç¼“å­˜ç­–ç•¥è¿›è¡Œä¼˜åŒ–ï¼Œè¿™æ ·çš„ç¼“å­˜ç­–ç•¥ä¹Ÿä¸ä¼šå…¥ä¾µåˆ°å‰ç«¯ä»£ç ï¼Œä¸”å“ªäº›æ¥å£èƒ½ç¼“å­˜ã€å¯ä»¥ç¼“å­˜å¤šä¹…æœ¬æ¥å°±æ˜¯æœåŠ¡ç«¯è¦è¯„ä¼°å’Œç»´æŠ¤çš„ã€‚

è‡³æ­¤ï¼Œå¯¹äºæˆ‘ä»¬æ–°çš„Â ReactÂ HookÂ ç¼–ç èŒƒå¼çš„ä»‹ç»å·²ç»“æŸï¼

# äº”ã€EffectÂ å’Œâ€œåŒæ­¥â€

åœ¨æ¢³ç†å®Œæœ¬æ–‡ç¬¬ä¸‰ç« ä¸­æè¿°çš„é‚£äº›é—®é¢˜æ—¶ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ç”¨ä¸€ä¸ªæ–°çš„æ–¹æ¡ˆå»ä»£æ›¿Â useEffectï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¦æ¨å¹¿å’Œä»‹ç»Â useInitÂ æ–¹æ¡ˆå‰ï¼ŒçœŸæ­£ç†è§£Â EffectÂ HookÂ æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæ‰€ä»¥æœ¬ç« å°†è¾ƒä¸ºæ·±å…¥ä¸”è¾©è¯åœ°è®¨è®ºÂ EffectÂ HookÂ çš„è®¾è®¡å“²å­¦ï¼Œå¹¶æ¶‰åŠåˆ°äº†å‡ ä¸ªå…³é”®çš„é—®é¢˜ï¼š

1.  ä¸ºä»€ä¹ˆÂ ReactÂ HookÂ è¦å¼•å…¥**å‰¯ä½œç”¨ï¼ˆSideÂ Effectsï¼‰**è¿™ä¸ªæ¦‚å¿µï¼Œä»¥åŠÂ ReactÂ ä¸­çš„Â EffectÂ è¡¨ç¤ºä»€ä¹ˆï¼Ÿ
    
2.  ReactÂ å®˜æ–¹æ–‡æ¡£ä¸ºä»€ä¹ˆæ²¡æœ‰å¼ºè°ƒ**ä¸åº”è¯¥ç”¨Â EffectÂ å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼ˆåŒ…æ‹¬è·å–æ•°æ®ï¼‰**ï¼Œè€Œåªæ˜¯å§”å©‰åœ°æäº†ä¸€å¥ï¼Œç”šè‡³ä¸¾äº†å¾ˆå¤šå……æ»¡è¿·æƒ‘æ€§çš„ç¤ºä¾‹ã€‚
    
3.  æ”¯æŒäº†Â ReactÂ HookÂ å‡½æ•°ç»„ä»¶ä¸ºä»€ä¹ˆ**é€‰æ‹©äº†åŒæ­¥çš„å¿ƒæ™ºæ¨¡å‹ï¼ˆuseEffectï¼‰ï¼Œè€Œä¸æ˜¯ç»§ç»­æ²¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„å¿ƒæ™ºæ¨¡å‹**ï¼Œå¦åˆ™å½“åˆå®˜æ–¹å®Œå…¨å¯ä»¥æä¸€å¥—ç±»ä¼¼Â useMountÂ /Â useUpdateÂ /Â useUnmountÂ çš„Â Hookï¼Œå‰è€…åˆ°åº•å¥½åœ¨å“ªï¼Ÿ
    

## 1ã€SideÂ Effects

### å‡½æ•°å¼ç¼–ç¨‹

é¦–å…ˆï¼Œå‰¯ä½œç”¨ï¼ˆSideÂ Effectsï¼‰çš„æ¦‚å¿µåº”è¯¥æ˜¯æ¥æºäºå‡½æ•°å¼ç¼–ç¨‹ï¼Œå› ä¸ºæˆ‘å…¶å®å¹¶ä¸äº†è§£å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ‰€ä»¥é—®äº†ä¸‹Â DeepSeekï¼Œä»¥ä¸‹æ˜¯Â DeepSeekÂ å›ç­”çš„éƒ¨åˆ†å†…å®¹ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/03077872-4292-4868-9f16-c7f78fe1b635.png)

_ä¸å¯å˜æ•°æ®_Â å¾ˆå¥½ç†è§£ï¼Œæ¯”å¦‚Â JavaScriptÂ ä¸­é€šè¿‡å­—é¢é‡å½¢å¼åˆ›å»ºçš„å¯¹è±¡ã€æ•°ç»„ç­‰å¼•ç”¨ç±»å‹æ•°æ®ï¼Œéƒ½æ˜¯å¯å˜çš„æ•°æ®ï¼Œå˜é‡å®šä¹‰å¥½äº†ä¹‹åå¯ä»¥åœ¨ä»»æ„èƒ½è®¿é—®åˆ°è¿™ä¸ªå˜é‡çš„åœ°æ–¹å»ä¿®æ”¹å¯¹è±¡ã€æ•°ç»„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Â Object.freezeÂ æˆ–è€…å€ŸåŠ©å…¶ä»–ç¬¬ä¸‰æ–¹åº“åˆ›å»ºä¸å¯å˜çš„æ•°æ®ã€‚

é‚£ä»€ä¹ˆæ˜¯Â _çº¯å‡½æ•°_Â å‘¢ï¼Ÿç»§ç»­é—®ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/7cee7281-5667-4964-9c6f-a6e9ec70d593.png)

OKï¼Œç°åœ¨å…³äºÂ _å‡½æ•°å¼ç¼–ç¨‹_ã€_çº¯å‡½æ•°_ã€_å‰¯ä½œç”¨_Â çš„æ¦‚å¿µå¾ˆæ¸…æ™°äº†ã€‚

### useEffectÂ çš„Â Effect

å†æ¥çœ‹Â ReactÂ å¯¹äºÂ EffectÂ çš„å®šä¹‰ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/ce39eedb-5545-4549-b169-ed6fb8bf2d5a.png)

ä»Â ReactÂ å®˜æ–¹ä»‹ç»ä¸­å¯ä»¥çœ‹å‡ºï¼Œåœ¨Â ReactÂ ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è§¦å‘å‰¯ä½œç”¨ï¼ˆæ”¹å˜ç¨‹åºçŠ¶æ€æˆ–å¤–éƒ¨ç³»ç»Ÿçš„è¡Œä¸ºï¼‰ï¼š

*   ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨ï¼Œæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»äº‹ä»¶çš„äº‹ä»¶å“åº”å‡½æ•°ä¸­è§¦å‘äº†ä¸€ä¸ªÂ HTTPÂ æ¥å£è°ƒç”¨ï¼Œæˆ–è¯»å–äº†Â localStorageÂ ä¸­çš„å€¼ç­‰ã€‚
    
*   æ¸²æŸ“è¿‡ç¨‹è‡ªèº«å¼•å‘çš„å‰¯ä½œç”¨ï¼Œæ¯”å¦‚æ ¹æ®Â titleÂ è¿™ä¸ªÂ stateÂ å»ä¿®æ”¹Â document.titleï¼Œæˆ–æ ¹æ®Â URLÂ ä¸­çš„Â queryÂ å‚æ•°å»æŸ¥è¯¢æ•°æ®ç­‰ã€‚
    

**åªæœ‰å‰è€…æ‰è¢«å®šä¹‰ä¸ºÂ Effectï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥è®¤ä¸ºÂ useEffectÂ æ˜¯Â useSideEffectNotTriggeredByUserEventÂ çš„ç®€ç§°ï¼Œå› ä¸ºåœ¨è¿™ä¸ªå®šä¹‰ä¸­ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨å®Œå…¨ä¸å±äºÂ EffectÂ ï¼**

æœç„¶åªæ˜¯æˆ‘ä»¬ç”¨é”™äº†Â useEffectï¼Œè¿™ä¹ˆçœ‹æ¥å¦‚æœæ­£ç¡®ä½¿ç”¨Â useEffectÂ ï¼Œé‚£ä¹ˆæ ¹æœ¬å°±ä¸ä¼šé‡åˆ°æœ¬æ–‡ç¬¬ä¸‰ç« ä¸­â€œè¿‡åº¦çš„å“åº”å¼ç¼–ç¨‹â€é‡Œæåˆ°çš„é—®é¢˜ã€‚ç„¶è€Œæˆ‘Â GoogleÂ ç®€å•æœäº†ä¸‹ï¼Œåœ¨Â 2023Â å¹´Â 6Â æœˆï¼ˆæ–°ç‰ˆå®˜æ–¹æ–‡æ¡£å‘å¸ƒï¼‰ä¹‹å‰ï¼Œç»å¤§éƒ¨åˆ†å…³äºÂ HookÂ çš„è®¨è®ºéƒ½æ²¡æœ‰æåˆ°è¿™ä¸ªè§‚ç‚¹ï¼Œæˆ‘åªæœåˆ°Â [ã€ŠÂ ä¸ºä»€ä¹ˆä½ ä¸åº”è¯¥åœ¨Â ReactÂ ä¸­ç›´æ¥ä½¿ç”¨Â useEffectÂ ä»Â APIÂ è·å–æ•°æ®Â ã€‹](https://blog.skk.moe/post/why-you-should-not-fetch-data-directly-in-use-effect/)Â è¿™ä¸€ç¯‡æŠ€æœ¯æ–‡ç« æåˆ°äº†ä¸€å¥â€œ_ç»å¤§éƒ¨åˆ†è§¦å‘ç½‘ç»œè¯·æ±‚çš„åŸå› éƒ½æ˜¯ç”¨æˆ·æ“ä½œï¼Œåº”è¯¥åœ¨Â EventÂ HandlerÂ ä¸­å‘é€ç½‘ç»œè¯·æ±‚_â€ã€‚æ‰€ä»¥å³ä½¿å®˜æ–¹æ–‡æ¡£è¿™ä¹ˆå®šä¹‰äº†ï¼Œç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨ä¸å±äºÂ EffectÂ å¹¶ä¸æ˜¯å¼€å‘è€…çš„å…±è¯†ï¼ˆå¯èƒ½å› ä¸ºå®˜æ–¹ä¸¾çš„æ–‡å­—ç¤ºä¾‹éƒ½æ˜¯ç”±ç”¨æˆ·äº‹ä»¶å¼•å‘çš„æäº¤ç±»Â HTTPÂ æ¥å£ï¼Œä½†æ˜¯æŸ¥è¯¢ç±»Â HTTPÂ æ¥å£ä¸€æ ·å±äºå‰¯ä½œç”¨ï¼‰ã€‚

### ReactÂ ä¸­çš„å‰¯ä½œç”¨

å½“æˆ‘ç»§ç»­è®¤çœŸå¯¹æ¯”Â _å‡½æ•°å¼ç¼–ç¨‹_Â å’ŒÂ ReactÂ ä¸­å‰¯ä½œç”¨çš„æ¦‚å¿µæ—¶ï¼Œæˆ‘è¿˜å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæ”¹å˜å‡½æ•°å¤–éƒ¨çŠ¶æ€çš„è¡Œä¸ºéƒ½å±äºå‰¯ä½œç”¨ï¼Œé‚£ä¹ˆÂ ReactÂ å‡½æ•°ç»„ä»¶ä¸­çš„Â setStateÂ æ˜¯ä¸æ˜¯ä¹Ÿåº”è¯¥å±äºå‰¯ä½œç”¨ï¼Œè€Œä¸”å‡½æ•°ç»„ä»¶æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å…¥å‚æ˜¯Â propsï¼Œåœ¨æ•´ä¸ªç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå³ä½¿Â propsÂ ä¸å˜ï¼Œå‡½æ•°ç»„ä»¶è¿”å›çš„Â JSXÂ æ˜¯ä¸å›ºå®šçš„ï¼Œå› ä¸ºæ¯æ¬¡Â updateÂ å‡½æ•°ç»„ä»¶éƒ½ä»å‡½æ•°å¤–éƒ¨è¯»å–äº†å¯èƒ½ä¼šå˜åŒ–çš„Â stateÂ çŠ¶æ€ã€‚

ä½†æ˜¯çœ‹å®˜æ–¹å¯¹äºÂ EffectÂ çš„å„ç§ç¤ºä¾‹ä¸­ä»æ¥æ²¡æœ‰æåˆ°è¿‡Â setStateï¼Œä¹Ÿä»æ¥æ²¡æœ‰è¯´è¿‡Â setStateÂ ä¸æ˜¯å‰¯ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘åªèƒ½è°ƒæˆÂ DeepSeekÂ äº†ï¼Œæˆ‘æ–°å»ºäº†ä¸‰ä¸ªä¼šè¯ï¼ˆé¿å…åœ¨å¤§æ¨¡å‹ä¸€ä¸ªä¼šè¯é‡Œæ ¹æ®ä¸Šä¸‹æ–‡å‡ºç°å¢™å¤´è‰è¡Œä¸ºï¼‰åˆ†åˆ«é—®äº†ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜ï¼š

1.  _ä¸ºä»€ä¹ˆÂ ReactÂ å‡½æ•°ç»„ä»¶ä¸­çš„Â setStateÂ å±äºå‰¯ä½œç”¨ï¼Ÿ_
    
2.  _ä¸ºä»€ä¹ˆÂ ReactÂ å‡½æ•°ç»„ä»¶ä¸­çš„Â setStateÂ ä¸å±äºå‰¯ä½œç”¨ï¼Ÿ_
    
3.  _ReactÂ å‡½æ•°ç»„ä»¶ä¸­çš„Â setStateÂ æ˜¯å¦å±äºå‰¯ä½œç”¨ï¼Ÿ_
    

ä»Â DeepSeekÂ çš„å›ç­”ä¸­ï¼Œæˆ‘ä¹Ÿæ„Ÿå—åˆ°äº†æ­£åä¸¤ç§è§‚ç‚¹ï¼Œä¸è¿‡ç¬¬Â 3Â ä¸ªé—®é¢˜çš„å›ç­”æ˜¯è®¤ä¸ºÂ setStateÂ ä¸å±äºå‰¯ä½œç”¨çš„ã€‚åœ¨è¿™å‡ ä¸ªé—®é¢˜çš„å›ç­”ä¸­ï¼Œæœ€èƒ½è¯´æœæˆ‘çš„å¯èƒ½æ˜¯Â DeepSeekÂ æåˆ°çš„ä»¥ä¸‹è¿™éƒ¨åˆ†è§‚ç‚¹ï¼š

![Snipaste 2025-03-16 ä¸‹åˆ3.10.58.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/34ee1503-6b1f-42f3-a939-20950ae46552.png)

![Snipaste 2025-03-16 ä¸‹åˆ3.10.53.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/6efacfd3-5e20-44fb-ab9f-77e5c03edc25.png)

**ReactÂ åªæ˜¯å€Ÿé‰´äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³ï¼Œç‰¹åˆ«æ˜¯å°†è§†è§’é™å®šåœ¨å‡½æ•°ç»„ä»¶çš„å•æ¬¡æ¸²æŸ“æ—¶ï¼ŒsetStateÂ å¹¶æ²¡æœ‰ä¿®æ”¹å› é—­åŒ…è€Œå½¢æˆçš„æ—¶é—´åˆ‡ç‰‡ä¸­Â stateÂ çš„å€¼ï¼ˆåœ¨è¿™ä¸ªæ¯”å–»ä¸­ç±»ç»„ä»¶çš„Â thisÂ å’Œå‡½æ•°ç»„ä»¶çš„Â refÂ å°±åƒæ˜¯å¯ä»¥ç©¿è¶Šåˆ°æœªæ¥çš„æ—¶å…‰æœºï¼‰ã€‚**

## 2ã€é‡æ–°è®¤è¯†Â useEffect

åœ¨çŸ¥é“äº†ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨ä¸å±äºÂ EffectÂ åï¼Œæˆ‘å°±åœ¨æƒ³æœ¬æ–‡ç¬¬ä¸‰ç« æåˆ°çš„è¿™äº›é—®é¢˜ä¼šä¸ä¼šéƒ½æ˜¯é”™è¯¯ä½¿ç”¨Â useEffectÂ é€ æˆçš„ï¼Ÿæ‰€ä»¥æˆ‘å†³å®šé‡æ–°ä»”ä»”ç»†ç»†åœ°çœ‹ä¸€éÂ ReactÂ å®˜æ–¹æ–‡æ¡£ã€‚åˆæ°å¥½Â 2023Â å¹´Â 6Â æœˆä¸Šçº¿äº†æ–°çš„Â ReactÂ å®˜æ–¹æ–‡æ¡£[ã€ŠÂ ä»‹ç»Â react.devÂ ã€‹](https://zh-hans.react.dev/blog/2023/03/16/introducing-react-dev)ï¼Œåœ¨æ–°ç‰ˆå®˜æ–¹æ–‡æ¡£çš„æ•™ç¨‹ä¸­å·²ç»å®Œå…¨æŠ›å¼ƒäº†ç±»ç»„ä»¶å’Œç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œå› æ­¤æˆ‘ä¹Ÿå¯ä»¥ä½“éªŒä¸€ä¸‹ä»é›¶å¼€å§‹çš„Â ReactÂ HookÂ å­¦ä¹ è·¯å¾„ã€‚

### è„±å›´æœºåˆ¶Â vsÂ åŸºç¡€Â Hook

é¦–å…ˆé€šè¿‡è§‚å¯Ÿæ–°ç‰ˆå®˜æ–¹æ•™ç¨‹ä¸­Â [ã€ŠÂ è„±å›´æœºåˆ¶ï¼ˆEscapeÂ Hatchesï¼‰Â ã€‹](https://zh-hans.react.dev/learn/escape-hatches)Â å·¦ä¾§çš„ç›®å½•è®¾è®¡ï¼Œä½ ä¼šå‘ç°Â refÂ å’ŒÂ EffectÂ ç­‰çš„ä»‹ç»éƒ½å½’å±äºâ€œè„±å›´æœºåˆ¶â€ï¼Œå®˜æ–¹æ–‡æ¡£ä¹ŸæŒ‡å‡ºäº†è¿™æ˜¯ä¸€ä¸ªé«˜çº§çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å’Œâ€œè„±å›´æœºåˆ¶â€è¿™ä¸ªåå­—è¡¨ç¤ºçš„æ„ä¹‰ä¸€æ ·ï¼Œå®˜æ–¹ä¹Ÿè¯´äº†å¤§å¤šæ•°åº”ç”¨ä¸åº”è¯¥ç”¨åˆ°è¿™äº›åŠŸèƒ½ã€‚

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/e1de9239-2926-4a3d-a9fc-60346442d610.png)

ç„¶è€Œè¿™å’Œæˆ‘ä»¬æ—¥å¸¸çš„æ„ŸçŸ¥æ˜¯æˆªç„¶ç›¸åçš„ï¼Œæˆ‘ä»æ¥æ²¡è§è¿‡å“ªä¸ªç”¨åˆ°äº†Â ReactÂ HookÂ çš„å‰ç«¯é¡µé¢å¯ä»¥ä¸ä½¿ç”¨Â useEffectÂ æ¥å®ç°ä¸šåŠ¡åŠŸèƒ½ã€‚ä¸ºä»€ä¹ˆÂ useEfectÂ ä¸åƒÂ useStateÂ ä¸€æ ·æ˜¯è¢«ä½œä¸ºä¸€ä¸ªå¿…è¦ä¸”åŸºç¡€çš„Â HookÂ æ¥ä»‹ç»ï¼Œè€Œæ˜¯å½“ä½œä¸€ä¸ªè²Œä¼¼Â ReactÂ åˆå­¦è€…å¯ä»¥å…ˆä¸ç”¨å­¦ä¹ çš„é«˜çº§Â HookÂ æ¥ä»‹ç»ï¼Œæˆ‘ä¸ç†è§£ã€‚

### é™¡å³­çš„Â useEffectÂ å­¦ä¹ æ›²çº¿

æˆ‘ä»¬ç»§ç»­çœ‹å®˜æ–¹å¯¹äºÂ useEffectÂ çš„ä»‹ç»è¿‡ç¨‹ï¼Œæ€»å…±åˆ†äº†äº”ç« 

1.  [ã€ŠÂ ä½¿ç”¨Â EffectÂ è¿›è¡ŒåŒæ­¥Â ã€‹](https://zh-hans.react.dev/learn/synchronizing-with-effects)ä»‹ç»äº†Â useEffectÂ æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚ä½•ç¡®å®šÂ useEffectÂ ä¾èµ–é¡¹ã€‚
    
2.  [ã€ŠÂ ä½ å¯èƒ½ä¸éœ€è¦Â EffectÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect)ä»‹ç»äº†ä¸€äº›ä¸åº”è¯¥ä½¿ç”¨Â useEffectÂ çš„åœºæ™¯ã€‚
    
3.  [ã€ŠÂ å“åº”å¼Â EffectÂ çš„ç”Ÿå‘½å‘¨æœŸÂ ã€‹](https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects)åˆ†æäº†Â useEffectÂ å›è°ƒå‡½æ•°çš„è§¦å‘é€»è¾‘ã€‚
    
4.  [ã€ŠÂ å°†äº‹ä»¶ä»Â EffectÂ ä¸­åˆ†å¼€Â ã€‹](https://zh-hans.react.dev/learn/separating-events-from-effects)è¿™ä¸ªæ ‡é¢˜å¾ˆæ€ªï¼Œå…¶å®æ˜¯ä»‹ç»äº†åœ¨ä¸€ç±»ç‰¹æ®Šçš„åœºæ™¯ä¸­ï¼Œå¦‚æœç”¨åŸæ¥å®˜æ–¹æ ‡å‡†çš„åˆ¤æ–­Â useEffectÂ ä¾èµ–çš„æ–¹å¼å»å®ç°ï¼Œåˆ™ä¼šé‡åˆ°åŠŸèƒ½æ€§é—®é¢˜ï¼Œä¸ºäº†åº”å¯¹è¿™ä¸ªåœºæ™¯è€Œä»‹ç»äº†ä¸€ä¸ªè¿˜æ²¡æœ‰å‘å¸ƒçš„å®éªŒæ€§Â HookÂ åŠå…¶å¯¹åº”çš„å±€é™æ€§ã€‚
    
5.  [ã€ŠÂ ç§»é™¤Â EffectÂ ä¾èµ–Â ã€‹](https://zh-hans.react.dev/learn/removing-effect-dependencies)å¼ºè°ƒäº†ä¾èµ–é¡¹å¿…é¡»å’Œå›è°ƒä¸­å®é™…çš„å¼•ç”¨æƒ…å†µä¿æŒä¸€è‡´ï¼Œä»¥åŠä¿æŒäº†ä¸€è‡´å´è¿˜æ˜¯å‡ºç°é—®é¢˜æ—¶è¦å¦‚ä½•è°ƒæ•´ä»£ç å’Œä¾èµ–é¡¹ã€‚
    

**å½“æˆ‘æŠŠè‡ªå·±æƒ³è±¡æˆä¸€ä¸ªåˆå­¦è€…æ—¶ï¼Œæˆ‘è®¤ä¸ºå‰ä¸¤ç« è¿˜å¯ä»¥æ¥å—ï¼Œä½†æ˜¯å†åŠ ä¸Šåä¸‰ç« ï¼Œæˆ‘ä¸å¾—ä¸è¯´ç›¸æ¯”äºè€ç‰ˆå®˜æ–¹æ–‡æ¡£ï¼Œæ–°ç‰ˆæ–‡æ¡£å¯¹äºÂ useEffectÂ çš„ä»‹ç»å®åœ¨æ˜¯å¤ªè¯¦ç»†äº†ï¼Œé¢é¢ä¿±åˆ°ï¼Œè€Œä¸”å¦‚æ­¤ä¹‹å¤šçš„ç« èŠ‚å’Œç¤ºä¾‹ï¼ŒçœŸçš„èƒ½è®©å¤§éƒ¨åˆ†å¼€å‘è€…å­¦æ˜ç™½å—ï¼Ÿ**

ä¸‹é¢è¿™ä¸ªå›¾çœŸçš„ä¸åªæ˜¯æç¬‘çš„ï¼ˆæˆ‘ç°åœ¨å°±è®¤ä¸ºÂ useEffectÂ å°±æ˜¯æ„å»ºå±å±±çš„ä¸€æŠŠåˆ©å™¨ï¼‰ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/678c8c58-d448-4b32-baf4-c77c1190d27b.png)

æˆ‘åæ¥ç»Ÿè®¡äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£çš„ä¸­æ–‡å­—ç¬¦æ•°ï¼Œä»‹ç»Â useEffectÂ è¿™ä¸€ä¸ªÂ HookÂ çš„Â 5Â ç¯‡å®˜æ–¹ä¸­æ–‡æ•™ç¨‹ï¼ˆé™¤å»ä¸¤ä¾§çš„ç›®å½•å’Œæ¯ç¯‡æ•™ç¨‹åº•éƒ¨çš„æŒ‘æˆ˜ä¹ é¢˜ï¼‰åŠ èµ·æ¥å¤§æ¦‚æœ‰Â 2.9wÂ ä¸ªä¸­æ–‡å­—ç¬¦ã€‚

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/e4ad872d-84e6-4355-88e2-b0508d564863.png)

ä½œä¸ºå¯¹æ¯”æœ¬æ–‡å…¨æ–‡ä¹Ÿæœ‰å¤§æ¦‚Â 3wÂ ä¸ªä¸­æ–‡å­—ç¬¦ï¼ˆå¿«é€ƒï¼ï¼‰ï¼Œä½†æ˜¯å…¶ä¸­ä»‹ç»Â useEffectÂ æ›¿ä»£æ–¹æ¡ˆçš„ç¬¬å››ç« ä¸­æ–‡å­—ç¬¦è¿˜ä¸åˆ°Â 7kï¼Œä¸åˆ°å®˜æ–¹æ–‡æ¡£çš„å››åˆ†ä¹‹ä¸€ï¼Œè€Œä¸”è¿˜ä»‹ç»äº†ä¸¤ä¸ªÂ Hookï¼Œå¹³å‡ä¸€ä¸ªÂ 3.5kï¼Œç®€ç›´ç‰©è¶…æ‰€å€¼ï¼Â 

### ç”¨æˆ·äº‹ä»¶è§¦å‘çš„æ¥å£è¯·æ±‚

> ReactÂ å®˜æ–¹æ–‡æ¡£ä¸­ä»ç”¨é€”ä¸ŠæŠŠÂ HTTPÂ æ¥å£è¯·æ±‚çš„æ¦‚å¿µåˆ†ä¸ºäº†â€œæ•°æ®è¯·æ±‚â€ï¼ˆåº”è¯¥æŒ‡Â GETÂ è¯·æ±‚ï¼‰å’Œâ€œPOSTÂ è¯·æ±‚â€ã€‚

é˜…è¯»Â [ã€ŠÂ ä½ å¯èƒ½ä¸éœ€è¦Â EffectÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect)Â è¿™ä¸ªç« èŠ‚æ—¶ï¼Œæˆ‘å¯¹äºå…¶ä¸­å…³äº**â€œç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„æ¥å£è¯·æ±‚â€**çš„æè¿°å’Œç¤ºä¾‹äº§ç”Ÿäº†**æå¤§çš„å›°æƒ‘**ã€‚å…¶ä¸­Â [å¦‚ä½•ç§»é™¤ä¸å¿…è¦çš„Â Effect](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#how-to-remove-unnecessary-effects)ã€[å‘é€Â POSTÂ è¯·æ±‚](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#sending-a-post-request)ã€[è·å–æ•°æ®](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#fetching-data)Â è¿™ä¸‰ä¸ªå°èŠ‚éƒ½æåˆ°äº†ç›¸å…³æè¿°å’Œç¤ºä¾‹ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/1568291f-6d0d-4b33-b281-bda184d0c264.png)

å¯¹äºÂ _**å¦‚æœä½¿ç”¨Â EffectÂ æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œå½“ä¸€ä¸ªÂ EffectÂ è¿è¡Œæ—¶ï¼Œä½ æ— æ³•çŸ¥é“ç”¨æˆ·åšäº†ä»€ä¹ˆï¼ˆä¾‹å¦‚ï¼Œç‚¹å‡»äº†å“ªä¸ªæŒ‰é’®ï¼‰**_Â è¿™ä¸ªè¯´æ³•ï¼Œæˆ‘éå¸¸éå¸¸è®¤åŒï¼Œä¹Ÿå°±æ˜¯æœ¬æ–‡åœ¨ç¬¬ä¸‰ç« ä¸­â€œè¿‡åº¦çš„å“åº”å¼ç¼–ç¨‹â€é‡Œæåˆ°çš„ï¼Œä½¿ç”¨Â useEffectÂ æ—¶ä¼šä¸¢å¤±â€œä»ç”¨æˆ·è¡Œä¸ºåˆ°æ¥å£è¯·æ±‚â€ä¹‹é—´çš„å‡½æ•°è°ƒç”¨å…³ç³»ï¼Œç‰¹åˆ«æ˜¯å½“é¡µé¢é€»è¾‘å˜å¾—å¤æ‚æ—¶ä¼šè®©è¿™ä¸ªé—®é¢˜æˆå€åœ°æ”¾å¤§ã€‚

ç„¶è€Œåœ¨Â [è·å–æ•°æ®](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#fetching-data)Â ä¸­ï¼Œå´è¯´åˆ†é¡µè¯·æ±‚çš„é€»è¾‘æ”¾åœ¨Â useEffectÂ ä¸­æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çœ‹è¿‡Â ReactÂ å¯¹äºÂ _Effect_Â çš„å®šä¹‰å…¶å®æ˜¯Â _**sideÂ effectsÂ thatÂ areÂ notÂ triggeredÂ byÂ userÂ events**_ï¼Œè€Œè¿™é‡Œä¹ä¸€çœ¼çœ‹ä¸Šå»å°±æ˜¯ç”¨æˆ·ç‚¹å‡»ä¸‹ä¸€é¡µç­‰äº¤äº’æ“ä½œè§¦å‘çš„æ¥å£è¯·æ±‚ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/1ea2ef27-dcb4-4cee-90a3-f1067de74ec5.png)

æŒ‰ç…§ç¤ºä¾‹ä¸­å¯¹ä»£ç é€»è¾‘çš„åˆ†æï¼Œæˆ‘ç†è§£å®Œæ•´çš„ä»£ç åº”è¯¥æ˜¯Â queryÂ åœ¨çˆ¶ç»„ä»¶ä¸­å¹¶ä¸æ˜¯ä¸€ä¸ªÂ stateÂ çŠ¶æ€ï¼Œç”¨æˆ·æ¯æ¬¡ä¿®æ”¹å…³é”®è¯åäº‹ä»¶å¤„ç†å‡½æ•°ä¼šå°†å…¶è‡ªåŠ¨å¡«å……åˆ°å½“å‰çš„Â URLÂ ä¸­ï¼Œè·¯ç”±æ›´æ–°è®©çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œçˆ¶ç»„ä»¶ä»Â URLÂ ä¸­è¯»å–Â queryÂ å‚æ•°å¹¶ä¼ é€’ç»™å­ç»„ä»¶ï¼š

```tsx
const getUrlParams = () => qs.parse(window.location.search.slice(1));

/**
 * å‡è®¾ SearchPage æ˜¯ SearchResults çš„çˆ¶ç»„ä»¶
 */
const SearchPage = (props) => {
  const { query = '' } = getUrlParams();

  const [searchInputValue, setSearchInputValue] = useState('');

  const handleInputSearchChange = (e) => {
    const value = e.target.value;
    setSearchInputValue(value);
  };

  const handleSearchBtnClick = () => {
    if (!searchInputValue) {
      return;
    }
    const queryString = qs.stringify({
      query: searchInputValue,
    });
    // ğŸŸ¢ ç‚¹å‡»æœç´¢æ—¶è§¦å‘è·¯ç”±å˜åŒ–ï¼Œå› ä¸ºåªæ˜¯æ›´æ–° query å‚æ•°ï¼Œæ‰€ä»¥åªæ˜¯è§¦å‘å½“å‰ SearchPage ç»„ä»¶çš„æ›´æ–°ï¼Œæ›´æ–°å getUrlParams æ–¹æ³•è¯»å–åˆ°æ–°çš„ query å€¼
    props.history.push(`/search-page?${queryString}`);
  };

  return (
    <>
      <div>
        <input value={searchInputValue} onChange={handleInputSearchChange} />
        <button onClick={handleSearchBtnClick}>Search</button>
      </div>
      <SearchResults query={query} />
    </>
  );
};

```

åŸºäºè¿™ä¸ªè®¾å®šç¡®å®Â queryÂ çš„å˜åŒ–ä¸æ˜¯ç”±ç”¨æˆ·äº‹ä»¶ç›´æ¥è§¦å‘çš„ï¼Œæ‰€ä»¥æ–‡ä¸­Â _**queryÂ çš„æ¥æºä¸é‡è¦**_Â è¿™å¥è¯å‹‰å¼ºè¯´å¾—é€šã€‚ä½†æ˜¯ä»Â handleNextPageClickÂ è§¦å‘çš„ç¿»é¡µé€»è¾‘ä¸­çœ‹å‡ºï¼Œè¡¨ç¤ºé¡µç çš„Â pageÂ çŠ¶æ€å¹¶ä¸éœ€è¦å¡«å……åˆ°Â URLÂ ä¸­ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§„çš„ç”¨æˆ·äº‹ä»¶ç›´æ¥è§¦å‘æ¥å£è¯·æ±‚çš„é€»è¾‘ï¼Œé‚£ä¹ˆæ–‡ä¸­Â _**pageÂ çš„æ¥æºä¸é‡è¦**_Â è¿™å¥è¯å°±æ˜¯**å®Œå…¨é”™è¯¯çš„****ï¼Œ**å› æ­¤ç‚¹å‡»ä¸‹ä¸€é¡µæŒ‰é’®è§¦å‘çš„æ•°æ®è¯·æ±‚ï¼Œå°±åº”è¯¥æ”¾åœ¨äº‹ä»¶å“åº”å‡½æ•°ä¸­ï¼Œæ‰€ä»¥ä»£ç åº”è¯¥è¿™ä¹ˆå†™ï¼š

```tsx
function SearchResults({ query }) {
  const [results, setResults] = useState([]);
  const [page, setPage] = useState(1);

  const fetchData = (queryStr, pageNo) => {
    fetchResults(queryStr, pageNo).then((json) => {
      setResults(json);
    });
  };

  useEffect(() => {
    fetchData(query, page);
  }, [query]); // åªç›‘å¬æ¥æºäº URL ä¸­çš„ query å˜é‡å˜åŒ–

  function handleNextPageClick() {
    const targetPage = page + 1;
    setPage(targetPage);
    fetchData(query, targetPage);
  }
  
  // ...
}

```

**è°ƒæ•´è¿‡åçš„ä»£ç çš„åŠŸèƒ½å’ŒåŸæ¥å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°Â useEffectÂ ä¸­çš„ä¾èµ–é¡¹æ•°ç»„ä¸­åªæœ‰Â queryï¼Œè€Œå›è°ƒå‡½æ•°ä¸­å´ä¾èµ–äº†Â queryÂ å’ŒÂ pageÂ ä¸¤ä¸ªçŠ¶æ€ï¼**æ‰€ä»¥æˆ‘æ€€ç–‘æ˜¯å› ä¸ºè¿™æ ·å†™ä¼šå¯¼è‡´ä¾èµ–é¡¹å’ŒÂ react-hooks/exhaustive-depsÂ è¿™ä¸ªÂ ESLintÂ è§„åˆ™ç›¸å†²çªï¼Œæ‰€ä»¥å®˜æ–¹çš„è¿™ä¸ªç¤ºä¾‹ä¸­å°±æŠŠæ‰€æœ‰çš„å‰¯ä½œç”¨é€»è¾‘éƒ½å®ç°åœ¨äº†Â useEffectÂ ä¸­ï¼Œ**å› ä¸ºå’ŒÂ ESLintÂ è§„åˆ™å†²çªæœ¬è´¨ä¸Šæ˜¯å’ŒÂ useEffectÂ çš„è®¾è®¡ç†å¿µç›¸è¿èƒŒäº†**ï¼Œå‚è€ƒ[ã€ŠÂ ä½¿ç”¨Â EffectÂ è¿›è¡ŒåŒæ­¥Â ã€‹](https://zh-hans.react.dev/learn/synchronizing-with-effects#step-2-specify-the-effect-dependencies)å’Œ[ã€ŠÂ useEffectÂ ã€‹](https://zh-hans.react.dev/reference/react/useEffect#reference)ä¸­å…³äºå¼€å‘è€…åº”è¯¥å¦‚ä½•ä¹¦å†™ä¾èµ–é¡¹çš„æè¿°ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/944ea43c-ee8b-4493-ba4b-e7d401cc6b2c.png)

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/5723d1a2-e47a-4a41-be46-4a505de91272.png)

ä¸è¿‡å¦‚æœä»ç›‘å¬æ€ç»´æ¥è§£è¯»ä¿®æ”¹åçš„ä»£ç æ˜¯å¾ˆå¥½ç†è§£çš„ï¼š**æˆ‘ä»¬è¦ç›‘å¬Â URLÂ ä¸­Â queryÂ çš„å˜åŒ–ï¼Œä¸€æ—¦Â queryÂ å˜åŒ–åï¼Œå°±æ‰§è¡Œè¯·æ±‚é€»è¾‘ï¼Œè¯·æ±‚é€»è¾‘ä¼šç”¨åˆ°å“ªäº›çŠ¶æ€å’Œç›‘å¬ä»€ä¹ˆå¹¶æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚**

æ‰€ä»¥æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå½“ä½ ä¸éœ€è¦æŠŠçŠ¶æ€åŒæ­¥åˆ°Â URLÂ ä¸­æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸åº”è¯¥ä½¿ç”¨Â useEffectÂ çš„ï¼Œè¡¥å……è¯´æ˜[ã€ŠÂ ä½ å¯èƒ½ä¸éœ€è¦Â EffectÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect)ä¸­å¼€å¤´è¯´é‚£å¥è¯å°±æ˜¯ï¼š

> _**ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸å¿…ä½¿ç”¨Â EffectÂ æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼ˆåŒ…æ‹¬Â GETÂ è¯·æ±‚ï¼‰ï¼Œè¯·ä¼˜å…ˆ**__**å°†ç”¨æˆ·äº‹ä»¶ç›¸å…³çš„å‰¯ä½œç”¨é€»è¾‘å†™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­**__**ï¼**_

> _**ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸å¿…ä½¿ç”¨Â EffectÂ æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼ˆåŒ…æ‹¬Â GETÂ è¯·æ±‚ï¼‰ï¼Œè¯·ä¼˜å…ˆ**__**å°†**__**ç”¨æˆ·äº‹ä»¶ç›¸å…³çš„å‰¯ä½œç”¨é€»è¾‘å†™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼**_

> _**ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ ä¸å¿…ä½¿ç”¨Â EffectÂ æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼ˆåŒ…æ‹¬Â GETÂ è¯·æ±‚ï¼‰ï¼Œè¯·ä¼˜å…ˆ**__**å°†**__**ç”¨æˆ·äº‹ä»¶ç›¸å…³çš„å‰¯ä½œç”¨é€»è¾‘å†™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼**_

ç„¶è€Œæˆ‘å‘ç°è¿™ä¹ˆé‡è¦çš„äº‹æƒ…ï¼Œå…¶å®å¹¶ä¸æ˜¯Â ReactÂ å¼€å‘è€…ä»¬çš„å…±åŒè®¤çŸ¥ï¼Œå› ä¸ºåœ¨Â 2018Â å¹´Â ReactÂ HookÂ å‘å¸ƒæ—¶çš„è€ç‰ˆçš„å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿæ²¡æœ‰æåˆ°ä¸åº”è¯¥ç”¨Â EffectÂ æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œ2023Â å¹´æ–°ç‰ˆå®˜æ–¹æ–‡æ¡£æå‡ºè¿™ä¸ªè§‚ç‚¹æ—¶ï¼Œä¹Ÿåªæ˜¯é…äº†è¿™ä¹ˆä¸€ä¸ªå……æ»¡è¿·æƒ‘æ€§çš„Â [è·å–æ•°æ®](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#fetching-data)Â ç¤ºä¾‹ã€‚

æˆ‘çœŸçš„è§‰å¾—è¿™ä¸ªäº‹æƒ…çš„é‡è¦ç¨‹åº¦å®Œå…¨å€¼å¾—å°†Â useEffectÂ æ”¹åä¸ºæˆ‘å‰é¢æ‰€è¯´çš„Â **useSideEffectNotTriggeredByUserEvent**ï¼Œå› ä¸ºÂ **useEffect**Â è¿™ä¸ªåå­—å°±åƒæœ‰é­”æ³•ä¸€æ ·ï¼Œä¸æ–­åœ°åœ¨å¸å¼•å¼€å‘è€…æŠŠæ‰€æœ‰çš„å‰¯ä½œç”¨é€»è¾‘å°½å¯èƒ½åœ°æ”¾åˆ°é‡Œé¢ã€‚

æ›´è¿·æƒ‘çš„æ˜¯ï¼Œå®˜æ–¹æ•™ç¨‹è¿˜åŸºäºè¿™ä¸ªä¾‹å­æ•™ä½ æŠŠÂ useEffectÂ è¿›ä¸€æ­¥å°è£…æˆè‡ªå®šä¹‰Â Hookï¼Œå¹¶ä¸æ˜¯è¿™ä¸ªä¾‹å­é”™äº†ï¼Œè€Œæ˜¯è¿™æ ·ä¼šè¿›ä¸€æ­¥å¼•å¯¼å¼€å‘è€…è®¤ä¸ºæ‰€æœ‰çš„Â GETÂ è¯·æ±‚éƒ½æ¨èè¿™ä¹ˆå°è£…ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/8eb50b05-cb96-4c1e-b617-8b08e2bc5205.png)

**ä½†æ˜¯å®é™…ä¸šåŠ¡ä»£ç ä¸­ï¼Œå¾ˆå¤§éƒ¨åˆ†çš„ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„æ¥å£è¯·æ±‚ï¼Œå¹¶ä¸éœ€è¦æŠŠæ¥å£å…¥å‚åŒæ­¥åˆ°Â URLÂ ä¸­ï¼Œæ›´ä¸åº”è¯¥å°è£…æˆè¿™æ ·çš„è‡ªå®šä¹‰Â Hookï¼Œå› ä¸ºè¿™æ ·ä¼šè¿›ä¸€æ­¥åŠ å¤§é˜…è¯»äº‹ä»¶å“åº”å‡½æ•°ä¸­ä»£ç é€»è¾‘çš„éš¾åº¦ï¼Œå¹¶ä¸”ä¿®æ”¹Â useEffectÂ ä¸­çš„ä»£ç æ—¶éš¾ä»¥è¯„ä¼°å½±å“é¢**ã€‚Â 

æ‰€ä»¥ä¸ºä»€ä¹ˆå®˜æ–¹æ•™ç¨‹ä¸åœ¨æ•™ç¨‹æœ€æ˜¾çœ¼çš„ä½ç½®ï¼Œç›´æ¥å¤§å¤§æ–¹æ–¹ç”¨ä¸€ä¸ªä»£ç ç¤ºä¾‹å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¹ˆåšæ˜¯ä¸æ¨èçš„ï¼Œæ¯”å¦‚ï¼š

```tsx
// å¦‚æœ query å’Œ page éƒ½æ˜¯å•çº¯çš„ React State

// ğŸ”´ é‚£ä¹ˆä¸‹é¢çš„ç¤ºä¾‹æ˜¯ä¸æ¨èçš„ ï¼
// ğŸ”´ é‚£ä¹ˆä¸‹é¢çš„ç¤ºä¾‹æ˜¯ä¸æ¨èçš„ ï¼
// ğŸ”´ é‚£ä¹ˆä¸‹é¢çš„ç¤ºä¾‹æ˜¯ä¸æ¨èçš„ ï¼
function SearchResults() {
  const [results, setResults] = useState([]);
  const [query, setQuery] = useState('React');
  const [page, setPage] = useState(1);

  useEffect(() => {
    // ğŸ”´ é¿å…ï¼šå› ä¸º query å’Œ page éƒ½æ˜¯å•çº¯çš„ React Stateï¼Œæ‰€ä»¥å‰¯ä½œç”¨é€»è¾‘ä¸åº”è¯¥ç”¨ useEffect æ¥å¤„ç†
    fetchResults(query, page).then((json) => {
      setResults(json);
    });
  }, [query, page]);

  function handleNextPageClick() {
    setPage(page + 1);
  }

  function handleQueryInputChange(e) {
    const value = e.target.value;
    setQuery(value);
  }

  // ...
}


// ğŸŸ¡ å¹¶ä¸”å¾ˆå®¹æ˜“å‡ºé—®é¢˜ ï¼
// ğŸŸ¡ å¹¶ä¸”å¾ˆå®¹æ˜“å‡ºé—®é¢˜ ï¼
// ğŸŸ¡ å¹¶ä¸”å¾ˆå®¹æ˜“å‡ºé—®é¢˜ ï¼
function SearchResults() {
  const [results, setResults] = useState([]);
  const [query, setQuery] = useState('React');
  const [page, setPage] = useState(1);

  const theme = useContext(ThemeContext);

  // å¦‚æœåœ¨è¯·æ±‚ç»“æŸåè¦ç”¨åˆ°å…¶ä»–çŠ¶æ€ï¼Œå‚è€ƒ useEffect å®˜æ–¹çš„ä¾èµ–é¡¹å£°æ˜è§„åˆ™ï¼Œéœ€è¦æŠŠè¿™äº›çŠ¶æ€ä¹Ÿå£°æ˜ä¸ºä¾èµ–é¡¹
  useEffect(() => {
    fetchResults(query, page).then((json) => {
      setResults(json);
      showNotification('Data fetched!', theme);
    });
  }, [query, page, theme]); // ğŸ”´ BUGï¼šä»… theme å˜åŠ¨æ—¶ä¹Ÿè§¦å‘äº†ä¸å¿…è¦çš„æ¥å£è¯·æ±‚å’Œç”¨æˆ·é€šçŸ¥

  // è§£å†³æ–¹æ¡ˆï¼šç§»é™¤ theme ä¾èµ–é¡¹ï¼Œå¹¶å¿½ç•¥è¿™ä¸ª ESLint ä¾èµ–æ ¡éªŒ
  // ä½†è¿™æ ·ä¼šå¯¼è‡´åç»­è¯·æ±‚å¢åŠ çŠ¶æ€å…¥å‚æ—¶éå¸¸å®¹æ˜“é—æ¼ä¾èµ–
  // eslint-disable-next-line react-hooks/exhaustive-deps
  // }, [query, page]);
  

  function handleNextPageClick() {
    setPage(page + 1);
  }

  function handleQueryInputChange(e) {
    const value = e.target.value;
    setQuery(value);
  }

  // ...
}


// ğŸŸ¢ æ¨èç¤ºä¾‹ï¼Œå°†é¦–æ¬¡ä¹‹å¤–çš„æ¥å£è¯·æ±‚ï¼Œéƒ½å®ç°åœ¨ç”¨æˆ·äº‹ä»¶ä¸­ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„
// ğŸŸ¢ æ¨èç¤ºä¾‹ï¼Œå°†é¦–æ¬¡ä¹‹å¤–çš„æ¥å£è¯·æ±‚ï¼Œéƒ½å®ç°åœ¨ç”¨æˆ·äº‹ä»¶ä¸­ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„
// ğŸŸ¢ æ¨èç¤ºä¾‹ï¼Œå°†é¦–æ¬¡ä¹‹å¤–çš„æ¥å£è¯·æ±‚ï¼Œéƒ½å®ç°åœ¨ç”¨æˆ·äº‹ä»¶ä¸­ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„
function SearchResults() {
  const [results, setResults] = useState([]);
  const [query, setQuery] = useState('React');
  const [page, setPage] = useState(1);

  const theme = useContext(ThemeContext);

  const fetchList = (queryText, pageNo) => {
    fetchResults(queryText, pageNo).then((json) => {
      setResults(json);
      showNotification('Data fetched!', theme);
    });
  };

  const handleNextPageClick = () => {
    const targetPage = page + 1;
    setPage(targetPage);
    // ğŸŸ¢ æŸ¥è¯¢ä¸‹ä¸€é¡µè¡Œä¸ºæ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯ç”±ç‰¹å®šçš„äº¤äº’å¼•èµ·çš„ã€‚
    fetchList(query, targetPage);
  };

  const handleQueryInputChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    // ğŸŸ¢ è¾“å…¥è¡Œä¸ºæ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯ç”±ç‰¹å®šçš„äº¤äº’å¼•èµ·çš„ã€‚
    fetchList(value, page);
  };

  useEffect(() => {
    fetchList(query, page);

  // ğŸŸ¡ åˆå§‹è¯·æ±‚å¾ˆç¡®å®šåªéœ€è¦åœ¨ didMount æ—¶è§¦å‘ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½å¿½ç•¥ ESLint ä¾èµ–æ ¡éªŒ
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  // ...
}


```

æˆ‘è§‰å¾—Â ReactÂ å®˜æ–¹æ˜¯çŸ¥é“è¿™ä»¶äº‹æƒ…çš„ï¼Œå´åˆ»æ„æ²¡æœ‰ä½¿ç”¨ä»£ç ç¤ºä¾‹æ¥å¼ºè°ƒè¯´æ˜ã€‚**å¦‚æœå‰ç«¯å¼€å‘è€…ä»¬èƒ½åœ¨Â 2018Â å¹´å°±è¢«æ˜ç¡®åœ°å‘ŠçŸ¥ä¸åº”è¯¥ç”¨Â EffectÂ å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œä¼°è®¡ä¹Ÿä¸ä¼šæœ‰ä»Šå¤©è¿™ç¯‡æ–‡ç« ã€‚ä½†Â 2025Â å¹´çš„ä»Šå¤©ï¼Œä»…é å¼€å‘è§„èŒƒçš„çº¦æŸå·²ç»å®Œå…¨æ— æ³•è®©å¼€å‘è€…ä»¬è¾¾æˆÂ useEffectÂ ä½¿ç”¨æ–¹å¼ä¸Šçš„å…±è¯†äº†ï¼ˆæ›´åˆ«ææœ¬æ–‡ç¬¬ä¸‰ç« æåˆ°çš„å„ç§å…¶ä»–é—®é¢˜ï¼‰**ã€‚

ä¸ºæ­¤æˆ‘åˆå¾€å‰çœ‹äº†çœ‹å®˜æ–¹æ–‡æ¡£[ã€ŠÂ ä½¿ç”¨Â EffectÂ è¿›è¡ŒåŒæ­¥Â ã€‹](https://zh-hans.react.dev/learn/synchronizing-with-effects#fetching-data)ä¸­çš„å¦ä¸€ä¸ªÂ _è·å–æ•°æ®_Â çš„å®˜æ–¹ç¤ºä¾‹ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­Â useEffectÂ çš„ä¾èµ–é¡¹æ˜¯Â userIdï¼Œå¯ä»¥çŒœæµ‹è¿™ç¡®å®ä¸æ˜¯ç”±ç”¨æˆ·è§¦å‘çš„å‰¯ä½œç”¨ã€‚ä½†æ˜¯ç´§æ¥å…¶åçš„Â _æ·±å…¥æ¢è®¨_Â ä¸­ï¼Œæåˆ°äº†ä¸€ç¯‡ä½œè€…ä¸ºÂ RobinÂ WieruchÂ çš„åšå®¢[ã€ŠÂ HowÂ toÂ fetchÂ dataÂ withÂ ReactÂ HooksÂ ã€‹](https://www.robinwieruch.de/react-hooks-fetch-data/)ï¼Œè¿™ç¯‡åšå®¢å°±æ˜¯â€œå®Œç¾åœ°â€ç”¨Â useEffectÂ æ¥å¤„ç†äº†ç”±ç”¨æˆ·äº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨ï¼Œæœ€åç”šè‡³è¿˜é¢å¤–åŠ äº†ä¸€ä¸ªÂ UIÂ æ¸²æŸ“æ—¶ç”¨ä¸åˆ°åä¸ºÂ activeSearchÂ çš„Â stateÂ ä½œä¸ºÂ useEffectÂ çš„ä¾èµ–é¡¹å®ç°ç‚¹å‡»æœç´¢æŒ‰é’®è§¦å‘æ¥å£è¯·æ±‚ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/80694c96-5d8a-4755-ac55-22bdf7610555.png)

æˆ‘è®¤ä¸ºè¿™ç®€ç›´æ˜¯é­”æ€”äº†ï¼Œé¦–å…ˆåœ¨Â UIÂ æ¸²æŸ“ä¸­ç”¨ä¸åˆ°çš„å˜é‡ï¼Œä¸åº”è¯¥å®šä¹‰ä¸ºÂ stateï¼Œå…¶æ¬¡Â EffectÂ çš„å®šä¹‰æ˜¯Â _ç”±æ¸²æŸ“è‡ªèº«å¼•èµ·çš„å‰¯ä½œç”¨_ï¼Œè€ŒÂ activeSearchÂ çš„å˜åŒ–å¹¶ä¸ä¼šæ”¹å˜Â UIÂ è§†å›¾ï¼Œ**æ‰€ä»¥è¿™ä¸ªÂ useEffectÂ å…¶å®æ˜¯ç”¨ç›‘å¬æ€ç»´å†™å‡ºæ¥çš„ï¼**

ä½†æ˜¯å®˜æ–¹è®¤ä¸ºè¿™ä¸ªç¤ºä¾‹çš„é—®é¢˜ä¸åœ¨äºç”¨Â useEffectÂ æ¥å¤„ç†äº†ç”±ç”¨æˆ·äº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨ï¼Œä¹Ÿä¸åœ¨äºç”¨ç›‘å¬æ€ç»´ä½¿ç”¨Â useEffectï¼Œè€Œåœ¨äºç›´æ¥ä½¿ç”¨Â useEffectÂ æ— æ³•æ”¯æŒÂ SSRã€å¯èƒ½ä¼šäº§ç”Ÿç½‘ç»œç€‘å¸ƒã€æ— æ³•è¿›è¡Œç¼“å­˜ä¼˜åŒ–ã€éœ€è¦æ‰‹åŠ¨å¤„ç†ç«æ€æ¡ä»¶ç­‰ç­‰ï¼š

![Google Chrome 2025-03-17 ä¸‹åˆ8.50.33.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/f8b24a9a-afaa-47cb-b2eb-9e71294bd41c.png)

å®˜æ–¹æ–‡æ¡£æ¨èäº†ä¸€äº›æ”¯æŒç¼“å­˜çš„è¯·æ±‚åº“ï¼Œæ¯”å¦‚Â [ReactÂ Query](https://tanstack.com/query/latest/docs/framework/react/examples/pagination)Â å’ŒÂ [useSWR](https://swr.vercel.app/zh-CN/docs/pagination)ï¼Œç„¶è€Œåœ¨å°†ä¸šåŠ¡ä¸­æ‰€æœ‰çš„è·å–æ•°æ®é€»è¾‘éƒ½ç”¨è¿™äº›ç±»åº“æ¥å®ç°æ—¶ï¼Œæœ¬è´¨ä¸Šå…¶å®ä¹Ÿéƒ½æ˜¯åœ¨ç”¨Â useEffectÂ æ¥å¤„ç†ç”±ç”¨æˆ·äº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/7a4d8734-9257-43b5-8039-fea2047547dc.png)

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/c9011806-242d-4666-9f7c-7878782a24f2.png)

è¢«æ¨èçš„æ–¹æ¡ˆè¿˜æœ‰ä¾‹å¦‚Â [Next.js](https://nextjs.org/)Â ç­‰çš„æ¡†æ¶ï¼Œè¿™äº›æ¡†æ¶æ”¯æŒäº†Â [<Suspense>](https://zh-hans.react.dev/reference/react/Suspense#reference)Â å’Œæµå¼æœåŠ¡å™¨æ¸²æŸ“ï¼ˆStreamingÂ ServerÂ Renderingï¼‰ç­‰èƒ½åŠ›ï¼Œå¯¹æœåŠ¡ç«¯æ¸²æŸ“çš„æ”¯æŒä¸Šéå¸¸å¥½ï¼Œä½“ç°äº†Â ReactÂ å¼ºå¤§çš„ç”Ÿæ€ã€‚

ä¸è¿‡ä»¥ä¸Šè¿™äº›ä¼˜åŒ–æ–¹æ¡ˆéƒ½æ˜¯æœ‰é€‚ç”¨åœºæ™¯çš„ï¼Œå½“æˆ‘ä»¬è¦æ„å»ºä¸€äº›æœ‰å¤æ‚äº¤äº’é€»è¾‘çš„é¡µé¢æ—¶ï¼Œå¾€å¾€ä¸éœ€è¦ç”¨åˆ°ä»¥ä¸Šçš„ä¼˜åŒ–æ‰‹æ®µï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯å…ˆæŠŠä»£ç é€»è¾‘å†™å¾—è¶³å¤Ÿæ¸…æ¥šï¼

**æ‰€ä»¥æˆ‘è®¤ä¸ºÂ ReactÂ æ²¡æœ‰åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ç€é‡å¼ºè°ƒâ€œä¸åº”è¯¥ç”¨Â useEffectÂ æ¥å¤„ç†ç”±ç”¨æˆ·äº‹ä»¶å¼•èµ·çš„è·å–æ•°æ®ç±»å‰¯ä½œç”¨é€»è¾‘â€ï¼Œæ˜¯å› ä¸ºè§£å†³ç¼“å­˜ã€æœåŠ¡ç«¯æ¸²æŸ“ç­‰é—®é¢˜çš„å„ç§ä¼˜åŒ–æ–¹æ¡ˆï¼Œéå¸¸é€‚åˆç”¨å°è£…äº†Â useEffectÂ çš„è‡ªå®šä¹‰Â HookÂ æ¥å®ç°ï¼Œå› æ­¤å¾ˆè‡ªç„¶åœ°ä¹Ÿé¡ºå¸¦å°†æ‰€æœ‰çš„è·å–æ•°æ®é€»è¾‘ï¼ˆä¸ç®¡æ˜¯å¦ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘ï¼‰éƒ½æ”¾åˆ°äº†Â EffectÂ ä¸­ï¼Œå³ä¾¿è¿™å’ŒÂ EffectÂ çš„è®¾è®¡ç†å¿µç›¸å†²çªã€‚**

**å¼ºçƒˆå»ºè®®æ‰€æœ‰å¼€å‘è€…è¯„ä¼°ä¸€ä¸‹å¯¹åº”çš„ä¸šåŠ¡å½¢æ€ï¼Œå¦‚æœå‰ç«¯äº¤äº’é€»è¾‘æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¹¶ä¸”ä¸éœ€è¦ç”¨åˆ°ä»¥ä¸Šè¿™äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œè¯·è°¨ç”¨Â useEffectï¼Œæ›´å»ºè®®å®Œæ•´çœ‹å®Œæœ¬æ–‡åè€ƒè™‘ä¸‹æ˜¯å¦è¦æ›¿æ¢Â useEffectÂ è¿™ä¸ªÂ Hookï¼Œå¦åˆ™éšç€äº§å“åŠŸèƒ½çš„ä¸æ–­å åŠ ï¼ŒåŸºäºÂ useEffectÂ æ„å»ºçš„é¡µé¢ä¼šå¤§å¤§é™ä½ç ”å‘æ•ˆç‡ã€‚**

### åœ¨è¯·æ±‚æ–¹æ³•ä¸­å¤„ç†ç«æ€æ¡ä»¶

[**è·å–æ•°æ®**](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#fetching-data)Â **ä¸­ä¹Ÿæåˆ°äº†**Â _**ç«æ€æ¡ä»¶**_Â **é—®é¢˜ï¼Œä½†æ˜¯è¿™ç§åœºæ™¯ä¸‹è‚¯å®šæ˜¯è¦ä¼˜å…ˆä½¿ç”¨é˜²æŠ–Â debounceÂ æ¥å¤„ç†é«˜é¢‘çš„ç”¨æˆ·è¾“å…¥äº‹ä»¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é˜²æŠ–å¤„ç†åå‡ºç°ç«æ€é—®é¢˜çš„å‡ ç‡å°±å¾ˆä½äº†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬å¹¶æ²¡æœ‰æ„ŸçŸ¥åˆ°ç«æ€é—®é¢˜çš„åŸå› ã€‚**

ä½†å¦‚æœç½‘ç»œç¯å¢ƒé•¿æœŸæ³¢åŠ¨ï¼Œæˆ–è€…æœåŠ¡ç«¯å¤„ç†è¯·æ±‚çš„æ—¶é—´æœ‰è¾ƒå¤§æ³¢åŠ¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æƒ³åŠæ³•è§£å†³ç«æ€é—®é¢˜ã€‚åŒæ—¶æˆ‘ä»¬ä¾æ—§è¦é¿å…å°†ç”±ç”¨æˆ·äº‹ä»¶è§¦å‘çš„å‰¯ä½œç”¨é€»è¾‘å®ç°åœ¨Â EffectÂ ä¸­ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆå°±æ˜¯ç›´æ¥åœ¨è¯·æ±‚æ–¹æ³•ä¸­å¤„ç†ç«æ€æ¡ä»¶ï¼š

```tsx
// æ–¹æ¡ˆ 1
// ğŸŸ¢ ç»™æ¯ä¸ªè¯·æ±‚è®¾å®šæ ‡è¯†ç¬¦
function SearchResults() {
  const requestIdRef = useRef(0);

  const fetchList = useCallback(async (queryText, pageNo) => {
    const currentRequestId = ++requestIdRef.current;
    const json = await fetchResults(queryText, pageNo);
    // åªå¤„ç†æœ€åä¸€æ¬¡è¯·æ±‚çš„å“åº”
    if (currentRequestId === requestIdRef.current) {
      setResults(json);
    }
  }, []);

  useEffect(() => {
    return () => {
      // ç»„ä»¶å¸è½½æ—¶ä¿®æ”¹æ ‡è¯†ç¬¦ï¼Œå¤„ç†æ¥å£è¯·æ±‚åœ¨ç»„ä»¶é”€æ¯åæ‰æ‹¿åˆ°å“åº”çš„åœºæ™¯
      requestIdRef.current++;
    };
  }, []);
}

```
```tsx
// æ–¹æ¡ˆ 2
// ğŸŸ¢ åˆ©ç”¨ AbortController å–æ¶ˆè¿‡æœŸè¯·æ±‚
function SearchResults() {
  const abortControllerRef = useRef(null);

  const fetchList = useCallback(async (queryText, pageNo) => {
    // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }
    const controller = new AbortController();
    abortControllerRef.current = controller;

    try {
      const json = await fetchResults(queryText, pageNo, { signal: controller.signal });
      setResults(json);
    } catch (err) {
      if (err.name !== 'AbortError') {
        // å¤„ç†çœŸå®é”™è¯¯
      }
    }
  }, []);

  useEffect(() => {
    return () => {
      // ç»„ä»¶å¸è½½æ—¶å–æ¶ˆæœªå®Œæˆçš„è¯·æ±‚
      if (abortControllerRef.current) {
        abortControllerRef.current.abort();
        abortControllerRef.current = null;
      }
    };
  }, []);

  // ...
}

```

### ç‰µå¼ºçš„Â useEffectEvent

[ã€ŠÂ å°†äº‹ä»¶ä»Â EffectÂ ä¸­åˆ†å¼€Â ã€‹](https://zh-hans.react.dev/learn/separating-events-from-effects)è¿™ä¸ªç« èŠ‚çš„æ ‡é¢˜å¾ˆç»•ï¼Œè¿™ä¸€ç« å…¶å®æ˜¯ä»‹ç»äº†ä¸€ç±»ç‰¹æ®Šçš„åœºæ™¯ï¼Œå¦‚æœç”¨åŸæ¥å®˜æ–¹æ ‡å‡†çš„åˆ¤æ–­Â useEffectÂ ä¾èµ–çš„æ–¹å¼å»å®ç°ï¼Œåˆ™ä¼šé‡åˆ°åŠŸèƒ½æ€§é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®˜æ–¹ä»‹ç»äº†ä¸€ä¸ªè¿˜æ²¡æœ‰å‘å¸ƒçš„å®éªŒæ€§Â APIÂ [useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)ã€‚

è¿™ä¸€ç±»ç‰¹æ®Šçš„åœºæ™¯ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ç›‘å¬æ€ç»´å»ä½¿ç”¨Â useEffectÂ æ—¶ï¼Œå°±å¾ˆå¥½æè¿°ï¼š**useEffectÂ è¦ç›‘å¬çš„ä¾èµ–é¡¹å’ŒÂ useEffectÂ å›è°ƒä¸­å®é™…è¦ä½¿ç”¨çš„ä¾èµ–é¡¹ä¸ä¸€è‡´**ï¼ˆå…¶å®å°±æ˜¯æœ¬æ–‡ç¬¬ä¸‰ç« çš„â€œä¸åº”è¯¥çš„Â WebSocketÂ æ€§èƒ½é—®é¢˜â€å’Œâ€œæ‰¾ä¸å‡ºé—®é¢˜çš„é”™è¯¯ç”¨æ³•â€ä¸­æåŠè¿‡çš„é—®é¢˜ï¼‰ã€‚

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/f7b87dcf-6b01-4f4b-a880-81a179a967f2.png)

åœ¨æˆªå›¾çš„ç¤ºä¾‹ä¸­ï¼Œå¼€å‘è€…çš„â€œæœ¬æ„â€æ˜¯åªæƒ³ç›‘å¬Â roomIdï¼Œä½†æ˜¯Â useEffectÂ å›è°ƒä¸­ä¾èµ–äº†ä¸€ä¸ªä¼šä¸æ–­å˜åŒ–çš„Â props.themeï¼š

*   å¦‚æœä¸æŠŠÂ themeÂ æ”¾åˆ°Â useEffectÂ ä¾èµ–ä¸­ï¼Œåˆ™ä¼šé‡åˆ°é—­åŒ…é—®é¢˜ï¼ŒnotificationÂ æç¤ºä¸­çš„Â themeÂ å¯èƒ½ä¼šæ˜¯æ—§çš„å€¼ã€‚
    
*   å¦‚æœæŠŠÂ themeÂ æ”¾åˆ°Â useEffectÂ ä¾èµ–ä¸­ï¼Œæ¯æ¬¡Â roomIdÂ æ²¡å˜ï¼Œåªæ˜¯Â themeÂ å˜åŒ–æ—¶ä¹Ÿä¼šé‡æ–°æ–­è¿å’Œå»ºè¿å¹¶é€šè¿‡Â notificationÂ é€šçŸ¥ç”¨æˆ·ã€‚
    

é™·å…¥äº†ä¸¤éš¾ï¼Œæ‰€ä»¥å®˜æ–¹å¼•å…¥äº†ä¸€ä¸ªå®éªŒæ€§Â APIÂ [useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)Â æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/a74eaf49-96af-42a2-ae03-44c7f03ba8da.png)

ä»å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»æ¥çœ‹ï¼Œæˆ‘è®¤ä¸ºÂ useEffectEventÂ çš„å®é™…åŠŸèƒ½å’ŒÂ ahooksÂ ä¸­çš„Â [useMemoizedFn](https://ahooks.js.org/zh-CN/hooks/use-memoized-fn/)Â æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåˆ†æÂ useMemoizedFnÂ çš„Â [æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useMemoizedFn/index.ts)Â å¯ä»¥å‘ç°ï¼Œå…¶å®Â useMemoizedFnÂ ä¹Ÿæ˜¯åˆ©ç”¨äº†Â refÂ æ¥ä¿æŒå¼•ç”¨åœ°å€ä¸å˜å¹¶åœ¨æ¯æ¬¡ç»„ä»¶Â updateÂ æ—¶æ›´æ–°å‡½æ•°å†…éƒ¨å®ç°ï¼Œä»è€Œç»•è¿‡äº†é—­åŒ…é—®é¢˜ï¼Œå³ç”¨Â useEffectEventÂ /Â useMemoizedFnÂ åŒ…è£¹åå‡½æ•°å¯ä»¥ä¸€ç›´è®¿é—®åˆ°æœ€æ–°çš„Â stateÂ /Â propsã€‚ä¸è¿‡Â ahooksÂ ä¸­å¯¹Â useMemoizedFnÂ çš„å®šä½æ˜¯æ€§èƒ½ä¼˜åŒ–ï¼Œè§£å†³é—­åŒ…é—®é¢˜åˆ™æ¨èç”¨Â [useLatest](https://ahooks.js.org/zh-CN/hooks/use-latest)Â åŒ…è£¹å•ä¸ªçš„Â stateÂ æˆ–Â propsï¼Œä½†æ˜¯æˆ‘ä¸ªäººè§‰å¾—Â useMemoizedFnÂ æ¥è§£å†³é—­åŒ…é—®é¢˜æ¯”Â useLatestÂ æ›´åˆé€‚ã€‚

è€ŒÂ useEffectEventÂ å’ŒÂ useMemoizedFnÂ å”¯ä¸€çš„ä¸åŒå¯ä»¥é€šè¿‡ä¸‹ä¸€ä¸ªå®˜æ–¹ç¤ºä¾‹å¯ä»¥æ„Ÿå—åˆ°ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/06e8054e-d8a9-45a2-bc58-b221eb8f4543.png)

å†æ¬¡å¼•ç”¨[ã€ŠÂ ä½¿ç”¨Â EffectÂ è¿›è¡ŒåŒæ­¥Â ã€‹](https://zh-hans.react.dev/learn/synchronizing-with-effects#step-2-specify-the-effect-dependencies)å’Œ[ã€ŠÂ useEffectÂ ã€‹](https://zh-hans.react.dev/reference/react/useEffect#reference)ä¸­æåˆ°çš„å…³äºå¼€å‘è€…åº”è¯¥å¦‚ä½•ä¹¦å†™ä¾èµ–é¡¹çš„æè¿°ï¼š_**å“åº”å¼å€¼åŒ…æ‹¬Â propsã€stateÂ ä»¥åŠæ‰€æœ‰ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚**_åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­Â onVisitÂ æ˜¯ä¸€ä¸ªåœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡ï¼Œå´ä¸éœ€è¦å†™åˆ°Â useEffectÂ ä¾èµ–ä¸­ï¼Œæ‰€ä»¥Â useEffectEventÂ å’ŒÂ useMemoizedFnÂ å”¯ä¸€çš„ä¸åŒå°±æ˜¯å®˜æ–¹çš„Â ESLintÂ ä»£ç æ ¡éªŒä¼šè‡ªåŠ¨å¿½ç•¥ç”±Â useEffectEventÂ å¯¼å‡ºçš„å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹ä¾‹ã€‚

åœ¨[ã€ŠÂ å°†äº‹ä»¶ä»Â EffectÂ ä¸­åˆ†å¼€Â ã€‹](https://zh-hans.react.dev/learn/separating-events-from-effects)ä¸­è¿˜å†™äº†ä¸€ç¯‡æ³¨æ„äº‹é¡¹æ¥è¡¥å……è¯´æ˜äº†å¦ä¸€ä¸ªé—®é¢˜ï¼ˆæˆªå›¾ä¸­çš„çº¢å­—æ˜¯æˆ‘ä¸ªäººçš„è§£è¯»ï¼‰ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/01f9ae04-9eee-4e43-9aac-5d6ec0c5a47e.png)

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/9d7be147-60af-42f0-bc46-b3a97985d3f5.png)

ä¸è¿‡æˆ‘æ„Ÿè§‰Â setTimeoutÂ è¿™ä¸ªä¾‹å­å¾ˆç‰µå¼ºï¼ŒæŠŠÂ urlÂ å’ŒÂ setTimeoutÂ éƒ½æ”¾åˆ°Â useEffectEventÂ ä¸­ä¸å°±å¥½äº†ï¼š

```tsx
const onVisit = useEffectEvent( => {
  setTimeout(() => {
    logVisit(url, numberOfItems);
  }, 5000); // å»¶è¿Ÿè®°å½•è®¿é—®
});

// ä¾èµ–ä¸ä¸€è‡´ï¼Œä½†æ˜¯åŠŸèƒ½ä¾æ—§æ²¡é—®é¢˜
useEffect(() => {
  onVisit();
}, [url]);
```

å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°çš„Â [æŠ‘åˆ¶ä¾èµ–é¡¹æ£€æŸ¥æ˜¯å¯è¡Œçš„å—ï¼Ÿ](https://zh-hans.react.dev/learn/separating-events-from-effects#is-it-okay-to-suppress-the-dependency-linter-instead)ä¹Ÿè¯´æ˜äº†æˆ‘ä»¬å¹³å¸¸å¿½ç•¥Â ESLIintÂ ä»£ç æç¤ºå¯èƒ½ä¼šé€ æˆçš„é—®é¢˜ï¼ˆä¸è¿‡è¿™ä¸ªä¾‹å­ä¹Ÿæ°æ°ä½“ç°äº†æœ¬æ–‡æå‡ºçš„Â useInitÂ è§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿ï¼‰ï¼Œå¹¶ç»™å‡ºäº†æœ€é‡è¦çš„ç›®çš„ï¼š_**ç­‰Â useEffectEventÂ æˆä¸ºÂ ReactÂ ç¨³å®šéƒ¨åˆ†åï¼Œæˆ‘ä»¬ä¼šæ¨èÂ æ°¸è¿œä¸è¦æŠ‘åˆ¶ä»£ç æ£€æŸ¥å·¥å…·ã€‚**_Â Â Â 

åœ¨Â [EffectÂ EventÂ çš„å±€é™æ€§](https://zh-hans.react.dev/learn/separating-events-from-effects#limitations-of-effect-events)Â ä¸­è¿˜æåˆ°äº†ä¸¤æ¡ä½¿ç”¨ä¸Šçš„çº¦å®šï¼š

*   åªåœ¨Â EffectÂ å†…éƒ¨è°ƒç”¨ä»–ä»¬ã€‚
    
*   æ°¸è¿œä¸è¦æŠŠä»–ä»¬ä¼ ç»™å…¶ä»–çš„ç»„ä»¶æˆ–è€…Â Hookã€‚
    

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/1e417778-ebd2-4e15-8e3e-4df9a62ab395.png)![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/1c0115ef-e5d2-445f-9bf2-a492780e82cc.png)

è™¾ä»çŒªå¿ƒçš„æ—¶å€™åˆ°äº†ï¼Œå¦‚æœä½ æ˜¯ä»å¤´é˜…è¯»æœ¬æ–‡çš„ï¼Œä½ å¯èƒ½ä¼šæ„Ÿå—åˆ°ï¼šuseEffectEventÂ çš„æœ€æ ¸å¿ƒæœ¬è´¨ä¸æ˜¯ä¸€ä¸ªæ–°çš„Â APIï¼ˆå•çº¯è¦è§£å†³é—­åŒ…é—®é¢˜å¯ä»¥ç›´æ¥ä½¿ç”¨Â [useMemoizedFn](https://ahooks.js.org/zh-CN/hooks/use-memoized-fn/)Â è¿™ç±»Â Hookï¼‰ï¼Œè€Œæ˜¯æˆ‘åœ¨ç¬¬ä¸‰ç« â€œéš¾ä»¥è‡ªåŠ¨åŒ–â€çš„æœ€åæåˆ°è¿‡çš„ï¼Œå¦‚æœè¦åœ¨æ„å»ºæ—¶è‡ªåŠ¨åŒ–è®¡ç®—å‡ºÂ useEffectÂ ä¾èµ–ï¼Œéœ€è¦æ‰€æœ‰å¼€å‘è€…å¯¹ç°æœ‰ä»£ç åšä¸€ä¸ªæ’æŸ¥å¹¶è¿›è¡Œä¸€äº›â€œæ ‡è®°â€ï¼Œæ ‡è®°å“ªäº›å˜é‡æ˜¯ä¸éœ€è¦è¿›è¡ŒÂ ESLintÂ ä¾èµ–é¡¹è‡ªåŠ¨æ£€æŸ¥çš„ã€‚å› ä¸ºè‡ªåŠ¨åŒ–çš„å‰æå°±æ˜¯æœ‰ä¸€ä¸ªå›ºå®šçš„è§„åˆ™å¯ä»¥è®©å¼€å‘è€…æ— è„‘éµå¾ªï¼Œä¹‹å‰Â _â€œå“åº”å¼å€¼åŒ…æ‹¬Â propsã€stateÂ ä»¥åŠæ‰€æœ‰ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨å£°æ˜çš„å˜é‡å’Œå‡½æ•°â€_Â è¿™ä¸ªå®˜æ–¹è§„åˆ™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¯æœ‰æ¼æ´çš„ï¼Œè€ŒÂ useEffectEventÂ åˆ™å¡«è¡¥äº†è¿™ä¸ªæ¼æ´ã€‚

ä¸è¿‡ä½ åº”è¯¥ä¹Ÿèƒ½æ˜æ˜¾åœ°æ„Ÿå—åˆ°ï¼Œç”¨Â useEffectEventÂ æ¥å¡«è¡¥è¿™ä¸ªæ¼æ´éå¸¸ç‰µå¼ºï¼Œå› ä¸ºæŒ‰ç…§å®˜ç½‘è¯´çš„å¦‚ä½•ä½¿ç”¨Â useEffectEventÂ è¿™ä¸ªÂ HookÂ æœ¬èº«å°±å¹¶ä¸æ— è„‘ï¼Œç›¸åä½ è¦ååˆ†å°å¿ƒåœ°å»ç¡®ä¿æ¯ä¸€ä¸ªÂ useEffectÂ ä¸­çš„ä¾èµ–é¡¹ï¼ˆæ’é™¤Â useEffectEventÂ å¯¼å‡ºçš„ç‰¹æ®Šå‡½æ•°ï¼‰å’Œå®˜æ–¹Â ESLintÂ æ ¡éªŒè§„åˆ™ä¸€è‡´ã€‚æ•´ä»¶äº‹æƒ…è®©æˆ‘è§‰å¾—ä¸æ˜¯å®˜æ–¹Â ESLintÂ æ’ä»¶åœ¨å¸®åŠ©å¼€å‘è€…æå‡ç¼–ç æ•ˆç‡ï¼Œè€Œæ˜¯åœ¨è®©å¼€å‘è€…å¸®åŠ©å®˜æ–¹Â ESLintÂ æ’ä»¶æé«˜ä¾èµ–æ£€æŸ¥çš„æ­£ç¡®ç‡ï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆÂ useEffectEventÂ è¿™ä¸ªÂ APIÂ è¿™ä¹ˆä¹…äº†è¿˜ä¸€ç›´å¤„äºå®éªŒæ€§Â APIÂ çš„é˜¶æ®µã€‚

**è‡³äº**[**ã€ŠÂ å°†äº‹ä»¶ä»Â EffectÂ ä¸­åˆ†å¼€Â ã€‹**](https://zh-hans.react.dev/learn/separating-events-from-effects)**è¿™ä¸ªå¥‡æ€ªçš„æ ‡é¢˜ï¼Œå…¶å®å°±æ˜¯æƒ³è¦é€šè¿‡â€œå“åº”å¼çš„Â Effectâ€å’Œâ€œéå“åº”å¼çš„ç”¨æˆ·äº‹ä»¶â€è¿™ä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µè¡ç”Ÿï¼Œä»è®¾è®¡æ€æƒ³ä¸Šå¼•å¯¼å¼€å‘è€…å¦‚ä½•æ­£ç¡®åœ°ä½¿ç”¨Â useEffectEventã€‚**

**ä½†å…¶å®Â ReactÂ åœ¨Â useEffectÂ è¿™ä¸ªÂ APIÂ ä¸Šå°±ä»æ¥æ²¡æœ‰åšåˆ°è¿‡ç»Ÿä¸€å¼€å‘è€…æ€æƒ³ï¼šä»Â 2018Â åˆ°Â 2025Â å¹´ï¼Œæ‰€æœ‰çš„å®˜æ–¹æ–‡æ¡£åœ¨ä»‹ç»Â useEffectÂ æ—¶éƒ½æ²¡æœ‰ç”¨åˆ°â€œç›‘å¬ä¾èµ–é¡¹â€è¿™ç±»è¯æ±‡ï¼ˆå¹¶ä¸”ä»Â useEffectÂ å…¥å‚æŠŠå›è°ƒå‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°è€Œä¸æ˜¯ä¾èµ–é¡¹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œä¸€ç›´ç”¨çš„æ˜¯â€œå‰¯ä½œç”¨â€ã€â€œä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥â€ç­‰ç­‰çš„æ¦‚å¿µã€‚ç„¶è€Œæ¯æ¬¡å½“æˆ‘ä»¬è®¨è®ºå’ŒÂ useEffectÂ æœ‰å…³çš„ä»£ç æ—¶ï¼Œç»å¤§éƒ¨åˆ†äººè¯´çš„éƒ½æ˜¯â€œç›‘å¬äº†Â xxxÂ è¯·æ±‚å¾—åˆ°Â yyyâ€ï¼Œè€Œä¸æ˜¯â€œyyyÂ é€šè¿‡ç½‘ç»œå’ŒÂ xxxÂ è¿›è¡ŒåŒæ­¥â€ã€‚**

**æ‰€ä»¥æˆ‘è®¤ä¸ºè¿™æ˜¯Â ReactÂ HookÂ è®¾è®¡éå¸¸å¤±è´¥çš„åœ°æ–¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å¼€å‘è€…ä¸€ç›´ä¹ æƒ¯ç”¨ç›‘å¬æ€ç»´ç†è§£Â useEffectï¼Œå› æ­¤å¯¼è‡´å„ç§é”™è¯¯çš„ä½¿ç”¨æ–¹å¼å±‚å‡ºä¸ç©·ã€‚è€ŒÂ ReactÂ å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆæ˜¯ç»§ç»­å †å è¿™ç±»å’Œæ™®é€šäººä¹ æƒ¯æ€§è®¤çŸ¥ç›¸å†²çªçš„å„ç§æ¦‚å¿µï¼Œå¦„æƒ³é€šè¿‡ä¸æ–­åœ°â€œè¯´æ•™â€æ¥æ”¹å˜å¼€å‘è€…çš„æ€ç»´æ–¹å¼ã€‚**

æœ€åé¢å¤–æä¸€å¥ï¼Œ[useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)Â æˆ–Â [useMemoizedFn](https://ahooks.js.org/zh-CN/hooks/use-memoized-fn/)Â è¿™ç±»Â HookÂ å¯¼å‡ºçš„å‡½æ•°è‹¥ä½œä¸ºÂ renderÂ propsÂ ä¼ é€’ç»™å­ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å­ç»„ä»¶æ— æ³•åŠæ—¶æ›´æ–°çš„é—®é¢˜ï¼š

```tsx
import React, { useState, useEffect } from "react";
import { useMemoizedFn } from "ahooks";

const MemoizedPanel = React.memo((props) => {
  return (
    <>
      <h1>
        {typeof props.header === "function" ? props.header() : props.header}
      </h1>
      <p>{props.children}</p>
    </>
  );
});

const Page = () => {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setCount((c) => c + 1);
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  const renderHeader = useMemoizedFn(() => {
    return `header count: ${count}`;
  });

  return (
    <>
      <p>real count: {count}</p>
      <br />
      <MemoizedPanel header={renderHeader}>
        Panel çš„å†…å®¹
      </MemoizedPanel>
    </>
  );
};

export default Page;

```

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/29d5d774-9e53-40cc-b130-71653ee91c23.png)

å…³é”®æ˜¯è¿™ç±»é—®é¢˜æ˜¯éå¸¸éšæ€§çš„ï¼Œå¦‚æœÂ PanelÂ ç»„ä»¶ä¸ç”¨Â React.memoÂ åŒ…è£¹æˆ–è€…Â PageÂ ç»„ä»¶å†™æˆä¸‹é¢è¿™æ ·è¿™ä¸ªé—®é¢˜å°±è¢«æ©ç›–äº†ï¼šÂ 

```tsx
const Page = () => {
  
  // ...
  
  return (
    <>
      <p>real count: {count}</p>
      <br />
      <MemoizedPanel header={renderHeader}>
        <span>Panel çš„å†…å®¹</span>
      </MemoizedPanel>
    </>
  );
};

export default Page;
```

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/41236ef8-5352-455a-b68f-3a281a63f91e.png)

åœ¨ç±»ç»„ä»¶ä¸­å¦‚æœå°†ç±»æ–¹æ³•ç›´æ¥ä½œä¸ºÂ renderÂ propsÂ ä¼ é€’ç»™Â PureComponetÂ ç±»å‹çš„å­ç»„ä»¶ï¼Œä¹Ÿä¼šå‡ºç°è¿™ç§â€œæ¸²æŸ“ä¼˜åŒ–è¿‡åº¦â€çš„æƒ…å†µã€‚ä¸è¿‡åœ¨å‡½æ•°ç»„ä»¶ä¸­å› ä¸ºæ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œåœ¨ç»„ä»¶å†…å®šä¹‰çš„å‡½æ•°éƒ½æ˜¯æ–°çš„å¼•ç”¨ï¼Œå…¶å®åŸæœ¬ä¸ä¼šå‡ºç°è¿™ç±»é—®é¢˜ã€‚æ‰€ä»¥ä½¿ç”¨Â [useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)Â æˆ–Â [useMemoizedFn](https://ahooks.js.org/zh-CN/hooks/use-memoized-fn/)æ—¶è¿˜è¦æ³¨æ„ä¸è¦ç”¨äºÂ renderÂ propsÂ è¿™ç§åœºæ™¯ã€‚å…¶å®ç±»ç»„ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰åŸå‹æ–¹æ³•å¦‚æœä½œä¸ºÂ renderÂ propsÂ ä¹Ÿä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºåŸå‹æ–¹æ³•çš„å¼•ç”¨åœ°å€ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å‡½æ•°ç»„ä»¶ä¼˜äºç±»ç»„ä»¶çš„ä¸€ä¸ªæ–¹é¢ã€‚

### å£°æ˜ä¾èµ–é¡¹å¢åŠ äº†å¤æ‚åº¦

[ã€ŠÂ ç§»é™¤Â EffectÂ ä¾èµ–Â ã€‹](https://zh-hans.react.dev/learn/removing-effect-dependencies)è¿™ä¸€ç« èŠ‚ä¸­å¼ºè°ƒäº†ä¾èµ–é¡¹å¿…é¡»å’Œå›è°ƒä¸­å®é™…çš„å¼•ç”¨æƒ…å†µä¿æŒä¸€è‡´ï¼Œå¹¶åˆ—ä¸¾äº†ä¸€äº›ä¿æŒä¸€è‡´åè¿˜æ˜¯å‡ºé—®é¢˜äº†çš„ç¤ºä¾‹åŠå…¶å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­éƒ¨åˆ†ç¤ºä¾‹å…¶å®åœ¨å®˜æ–¹æ–‡æ¡£å‰åºç« èŠ‚éƒ½æœ‰ä»‹ç»äº†ã€‚çœ‹å®Œè¿™ä¸ªç« èŠ‚ï¼Œæˆ‘é™¤äº†è§‰å¾—å£°æ˜ä¾èµ–é¡¹åˆå¤æ‚åˆç¹çä¹‹å¤–ï¼Œè¿˜æƒ³å¯¹å…¶ä¸­çš„ä¸€ä¸ªç¤ºä¾‹æå‡ºå¼‚è®®ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/21f6e60b-0dd3-4312-bc90-c855c861d118.png)

**è¿™ç§åœºæ™¯éå¸¸éå¸¸å¤šï¼Œå› æ­¤å¿½ç•¥Â linterÂ æ ¡éªŒçš„å¼€å‘è€…ä¹Ÿéå¸¸å¤šï¼Œè€ŒÂ ReactÂ è¿˜æ˜¯ä¸€ç›´åšæŒå€¡å¯¼å°†Â roomIdÂ å†™åˆ°Â useEffectÂ ä¾èµ–ä¸­ï¼Œæˆ‘è®¤ä¸ºå°†Â roomIdÂ å†™åˆ°Â useEffectÂ ä¸­åè€Œä¼šè®©ä»£ç ä¸¢å¤±å¼€å‘è€…çš„è®¾è®¡æ„å›¾ï¼Œå³ä½ æ— æ³•çŸ¥é“è¿™ä¸ªÂ roomIdÂ åœ¨ç»„ä»¶çš„å•æ¬¡ç”Ÿå‘½å‘¨æœŸä¸­åˆ°åº•æ˜¯ä¼šå˜çš„è¿˜æ˜¯ä¸ä¼šå˜çš„ã€‚**

å½“ç„¶å¦‚æœÂ useEffectÂ ä¿æŒç©ºä¾èµ–Â \[\]ï¼Œå½“Â ChatRoomÂ è¿™ä¸ªç»„ä»¶ä½œä¸ºä¸€ä¸ªéœ€è¦ç¼–å†™è¯¦ç»†æ–‡æ¡£çš„åŸºç¡€ç»„ä»¶æ—¶ï¼Œéœ€è¦æŒ‡å‡ºÂ props.roomIdÂ æ˜¯ä¸æ˜¯å“åº”å¼çš„ï¼Œå³å¼€å‘è€…åœ¨é¦–æ¬¡æ¸²æŸ“Â <ChatRoomÂ />Â æ—¶å°±å¿…é¡»ç¡®å®šÂ roomIdÂ çš„å€¼å¹¶ç¡®ä¿åœ¨æ•´ä¸ªÂ ChatRoomÂ ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šå˜åŒ–ã€‚è¿™ç§æƒ…å†µå…¶å®æ˜¯å¾ˆå¸¸è§çš„ï¼Œåªæ˜¯å¤§å¤šæ•°æ­¤ç±»Â ComponentÂ /Â HookÂ çš„æ–‡æ¡£å¹¶æ²¡æœ‰æ˜¾å¼åœ°æ ‡è®°å‡ºè¿™äº›å±æ€§ï¼Œæ¯”å¦‚Â ahooksÂ ä¸­çš„ç”¨äºç”Ÿæˆé˜²æŠ–å‡½æ•°çš„Â [useDebounceFn](https://ahooks.js.org/zh-CN/hooks/use-debounce-fn)Â æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­çš„Â waitÂ ç­‰å‚æ•°å°±ä¸æ˜¯å“åº”å¼çš„ï¼š

```tsx
import React, { useState, useEffect } from "react";
import { useDebounceFn } from "ahooks";

const DebounceDemo = () => {
  const [debounceWait, setDebounceWait] = useState(100);

  useEffect(() => {
    setTimeout(() => {
      setDebounceWait(1000);
    }, 5000);
  }, []);

  const { run: handleSubmitBtnClick } = useDebounceFn(
    () => {
      console.log("btn clicked.");
    },
    {
      wait: debounceWait, // ğŸ”´ å®é™… debounce çš„ wait ä¸ä¼šä» 100 å˜ä¸º 1000ï¼Œå› ä¸º useDebounceFn å†…éƒ¨åªä¼šè¯»å– wait çš„åˆå§‹å€¼
    }
  );

  return <button onClick={handleSubmitBtnClick}>Submit</button>;
};

export default DebounceDemo;

```

æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¯èƒ½è¿˜çœ‹åˆ°è¿‡ç›´æ¥ä½¿ç”¨Â lodashÂ [debounce](https://www.lodashjs.com/docs/lodash.debounce/)Â çš„ä»£ç ï¼Œä½†æ˜¯åœ¨å‡½æ•°ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨Â debounceÂ çš„ä»£ç å…¶å®éƒ½æ˜¯ä¸å¥å£®çš„ï¼Œå› ä¸ºè¿™æ ·å®ç°çš„é˜²æŠ–åŠŸèƒ½åœ¨è¿­ä»£ä¸­æ˜¯éå¸¸è„†å¼±çš„ã€‚æ¯”å¦‚å°†ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ä¸­çš„Â ButtonAÂ ->Â ButtonBÂ ->Â ButtonCÂ æƒ³è±¡æˆçš„åŠŸèƒ½çš„æŒç»­è¿­ä»£è¿‡ç¨‹ï¼š

```tsx
import React, { useState, useCallback, useMemo } from "react";
import { debounce } from "lodash";

const ButtonA = () => {
  const handleBtnClick = debounce(
    () => {
      console.log("Button A clicked."); // ğŸŸ¢ é˜²æŠ–æˆåŠŸï¼šç”¨æˆ·é¢‘ç¹ç‚¹å‡»æ—¶ï¼Œç¡®å®ä¹Ÿåª log äº†ä¸€æ¬¡
    },
    500,
    { leading: true, trailing: false } // ç”¨ debounce é˜²æ­¢ç”¨æˆ·é¢‘ç¹ç‚¹å‡»æ—¶ï¼Œä¸€èˆ¬åªéœ€å“åº”ç¬¬ä¸€æ¬¡ç”¨æˆ·ç‚¹å‡»å³å¯
  );

  return (
    <div>
      <button onClick={handleBtnClick}>Button A</button>
    </div>
  );
};

const ButtonB = () => {
  const [count, setCount] = useState(0);

  // ğŸ”´ é˜²æŠ–å¤±æ•ˆï¼šæ¯æ¬¡ç‚¹å‡»è§¦å‘å‡½æ•°ç»„ä»¶æ›´æ–°ï¼Œå¯¼è‡´æ¯æ¬¡éƒ½ç”Ÿæˆäº†æ–°çš„ handleBtn1Click é˜²æŠ–å‡½æ•°
  const handleBtn1Click = debounce(
    () => {
      setCount(count + 1);
      console.log("Button B1 clicked.");
    },
    500,
    { leading: true, trailing: false }
  );

  // ğŸŸ¢ è§£å†³æ–¹æ¡ˆï¼šè¿™ä¸ªåœºæ™¯å¯ä»¥ä½¿ç”¨ state æ›´æ–°å‡½æ•° å’Œ useMemo é¿å…åå¤åˆ›å»ºæ–°çš„é˜²æŠ–å‡½æ•°
  //   React Hook useCallback received a function whose dependencies are unknown. Pass an inline function instead.
  const handleBtn2Click = useMemo(
    () =>
      debounce(
        () => {
          setCount((c) => c + 1); // æ”¹ç”¨ state æ›´æ–°å‡½æ•°
          console.log("Button B2 clicked.");
        },
        500,
        { leading: true, trailing: false }
      ),
    []
  );

  // ğŸŸ¡ ä¸ºä»€ä¹ˆä¸ç”¨ useCallback ï¼Ÿ
  // å› ä¸º react-hooks/exhaustive-deps çš„æ ¡éªŒè§„åˆ™è²Œä¼¼ä¸æ”¯æŒ debounce è¿™ç§é«˜é˜¶å‡½æ•°ï¼Œä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯
  /*
  const handleBtn2Click = useCallback( // React Hook useCallback received a function whose dependencies are unknown. Pass an inline function instead.
    debounce(
      () => {
        setCount((c) => c + 1); // æ”¹ç”¨ state æ›´æ–°å‡½æ•°
        console.log("Button B2 clicked.");
      },
      500,
      { leading: true, trailing: false }
    ),
    []
  );
  */

  return (
    <div>
      <button onClick={handleBtn1Click}>Button B1</button>
      <button onClick={handleBtn2Click}>Button B2</button>
      <span>clicked {count} times</span>
    </div>
  );
};

const ButtonC = () => {
  const [count, setCount] = useState(0);

  // ğŸ”´ é˜²æŠ–å†æ¬¡å¤±æ•ˆï¼šå½“ handleBtnClick å†…çš„é€»è¾‘å¿…é¡»ä¾èµ– count æ—¶ï¼ŒuseMemo ä¹Ÿæ— æ³•é˜»æ­¢é˜²æŠ–å†æ¬¡å¤±æ•ˆ
  const handleBtnClick = useMemo(
    () =>
      debounce(
        () => {
          setCount((c) => c + 1);
          if (count < 10) {
            console.log("Button C clicked.");
          } else {
            console.log("Button C was clicked too many times.");
          }
        },
        500,
        { leading: true, trailing: false }
      ),
    [count]
  );

  return (
    <div>
      <button onClick={handleBtnClick}>Button C</button>
      <span>clicked {count} times</span>
    </div>
  );
};

const DebounceButtons = () => {
  return (
    <div>
      <ButtonA />
      <ButtonB />
      <ButtonC />
    </div>
  );
};

export default DebounceButtons;

```

![btns.gif](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/72b0ed8f-4f02-442c-814c-94aba8e3d25e.gif)

æ‰€ä»¥æ¯å½“éœ€è¦åœ¨å‡½æ•°ç»„ä»¶ä¸­åˆ›å»ºé˜²æŠ–å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ä¸€å¼€å§‹å°±ä½¿ç”¨Â useDebounceFnÂ è¿™ç±»å°è£…å¥½çš„Â HookÂ å·¥å…·ã€‚å›åˆ°Â ahooksÂ çš„Â [useDebounceFn](https://ahooks.js.org/zh-CN/hooks/use-debounce-fn)Â æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹[æºç ](https://github.com/alibaba/hooks/blob/master/packages/hooks/src/useDebounceFn/index.ts)ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/44270c3b-5ccb-49c1-af72-e8610966ad8e.png)

ä¸‹é¢æ˜¯æˆ‘å°è¯•åœ¨Â useDebounceFnÂ çš„æºç åŸºç¡€ä¸Šæ”¯æŒæ‰€æœ‰Â optionsÂ å‚æ•°å“åº”å¼åçš„æ»¡è¡€ç‰ˆÂ useDebounceFnï¼ˆä»£ç å¹¶æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„æµ‹è¯•ï¼Œè¯·ä¸è¦ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰ï¼š

```tsx
import React, { useState, useEffect, useMemo, useRef } from "react";
import _ from "lodash";
import { useLatest, useUnmount, useMemoizedFn } from "ahooks";

type noop = (...args: any[]) => any;

interface DebounceOptions {
  wait?: number;
  leading?: boolean;
  trailing?: boolean;
  maxWait?: number;
}

/**
 * â€œæ»¡è¡€ç‰ˆâ€ useDebounceFn
 */
function useDebounceFn<T extends noop>(fn: T, options?: DebounceOptions) {
  // ...

  const fnRef = useLatest(fn);

  const wait = options?.wait ?? 1000;

  // ğŸŸ¡ å› ä¸º options åœ¨å¤–éƒ¨å¿…å®šæ˜¯å­—é¢é‡å½¢å¼å®šä¹‰çš„ï¼Œå¯¼è‡´æ¯æ¬¡å¤–éƒ¨ç»„ä»¶ update æ—¶ options çš„å¼•ç”¨åœ°å€éƒ½å˜åŒ–
  // æ‰€ä»¥ä¸èƒ½ç›´æ¥æŠŠ options æ”¾åˆ° useMemo çš„ä¾èµ–é¡¹ä¸­ï¼Œéœ€è¦åœ¨ useMemo å¤–é¢æŠŠæ‰€æœ‰å±æ€§åœ¨ä» options è§£æ„å‡ºæ¥
  const { maxWait, leading, trailing } = options || {};

  const previousDebouncedFn = useRef<any>(null);

  const debouncedFn = useMemo(() => {
    const debounced = _.debounce(
      (...args: Parameters<T>): ReturnType<T> => {
        return fnRef.current(...args);
      },
      wait,
      // ğŸŸ¡ è¿™é‡Œè¸©äº†ä¸ªå‘ï¼š_.debounce æ–¹æ³•çš„ options ä¸­å„ä¸ªé€‰é¡¹ä¸æ”¯æŒä¼ å…¥ undefinedï¼Œéœ€è¦è¿‡æ»¤ä¸€ä¸‹
      _.omitBy(
        {
          maxWait,
          leading,
          trailing,
        },
        _.isNil
      )
    );

    // ğŸŸ¡ æ¯å½“é‡æ–°ç”Ÿæˆæ–°çš„é˜²æŠ–å‡½æ•°æ—¶ï¼Œéƒ½å…ˆå»å–æ¶ˆä¹‹å‰çš„é˜²æŠ–å‡½æ•°çš„åœ¨é€”å»¶è¿Ÿä»»åŠ¡ï¼ˆè¿™ä¸ªé€»è¾‘åº”è¯¥æŠ½æˆé…ç½®é¡¹è®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦å¼€å¯ï¼‰
    previousDebouncedFn.current?.cancel?.();

    previousDebouncedFn.current = debounced;

    return debounced;
  }, [fnRef, wait, maxWait, leading, trailing]);

  useUnmount(() => {
    debouncedFn.cancel();
  });

  const memoizedDebouncedFn = useMemoizedFn(debouncedFn);
  const memoizedDebouncedFnCancel = useMemoizedFn(debouncedFn.cancel);
  const memoizedDebouncedFnFlush = useMemoizedFn(debouncedFn.flush);

  return {
    run: memoizedDebouncedFn,
    cancel: memoizedDebouncedFnCancel,
    flush: memoizedDebouncedFnFlush,
  };
}

const DebounceDemo = () => {
  const [debounceWait, setDebounceWait] = useState(100);

  useEffect(() => {
    setTimeout(() => {
      setDebounceWait(1000);
    }, 5000);
  }, []);

  const { run: handleSubmitBtnClick } = useDebounceFn(
    () => {
      console.log("btn clicked."); // ğŸŸ¢ å®é™… debounce çš„ wait æ”¯æŒä» 100 å˜ä¸º 1000 å•¦
    },
    {
      wait: debounceWait,
    }
  );

  return <button onClick={handleSubmitBtnClick}>Submit</button>;
};

export default DebounceDemo;

```

ä¸è¿‡è¿™å°±è¯´æ˜åŸæœ¬Â ahooksÂ å®˜æ–¹çš„Â useDebounceFnÂ è¿™ä¸ªæ–¹æ³•æœ‰ç¼ºé™·å—ï¼Ÿæˆ‘è®¤ä¸ºå®Œå…¨ä¸æ˜¯ï¼Œå› ä¸ºåœ¨ç»å¤§éƒ¨åˆ†é˜²æŠ–çš„åœºæ™¯ä¸­ï¼Œwaitã€maxWaitã€leadingã€trailingÂ è¿™å‡ ä¸ªÂ debounceÂ çš„å‚æ•°æ˜¯ä¸éœ€è¦å˜åŒ–çš„ï¼ˆå³ä¸éœ€è¦æ”¯æŒå“åº”å¼ï¼‰ï¼Œä»…è¯»å–åˆå§‹å€¼å®Œå…¨å¤Ÿç”¨äº†ã€‚åœ¨æˆ‘å®ç°Â â€œæ»¡è¡€ç‰ˆâ€Â useDebounceFnÂ çš„è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸åªæ˜¯æ— è„‘è®©Â useMemoÂ çš„ä¾èµ–é¡¹å’ŒÂ linterÂ ä¿æŒä¸€è‡´å³å¯ï¼Œè¿˜éœ€è¦é¢å¤–å›ºå®šé˜²æŠ–å‡½æ•°çš„å¼•ç”¨åœ°å€ï¼Œä»¥åŠåœ¨Â optionsÂ å‚æ•°å˜åŒ–æ—¶å–æ¶ˆå…ˆå‰çš„é˜²æŠ–å‡½æ•°å¯¹åº”çš„åœ¨é€”å»¶è¿Ÿä»»åŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªä»£ç è¿˜æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„æµ‹è¯•ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å…¶ä»–Â bugã€‚Â 

**ä¼—æ‰€å‘¨çŸ¥ï¼Œå ç”¨ç›¸åŒçš„æµ‹è¯•èµ„æºæ—¶ï¼Œç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¤æ‚åº¦å¿…å®šæ˜¯è´Ÿç›¸å…³çš„ã€‚å½“ä¸€ä¸ªåŠŸèƒ½å·²ç»å¯ä»¥æ»¡è¶³ç»å¤§å¤šæ•°åœºæ™¯æ—¶ï¼Œä¸ºäº†å…¼å®¹æå°‘éƒ¨åˆ†åœºæ™¯è€Œå¤§å¤§å¢åŠ ç³»ç»Ÿå¤æ‚åº¦æ˜¯éœ€è¦è¿›è¡Œè®¤çœŸè¯„ä¼°çš„ï¼Œå› ä¸ºå¢åŠ äº†å¤æ‚åº¦ä¹‹åï¼Œè¦ä¿è¯åŸæœ¬çš„ç¨³å®šæ€§ï¼Œéœ€è¦æŠ•å…¥æ›´å¤šçš„æµ‹è¯•æˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¼˜å…ˆè€ƒè™‘èƒ½å¦ä¼˜åŒ–æˆ–è€…è°ƒæ•´è¿™äº›å°‘æ•°åœºæ™¯çš„å®ç°æ–¹å¼ï¼Œä»è€Œé™ä½æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦ã€‚**

**åœ¨é˜…è¯»å®Œæ‰€æœ‰å®˜ç½‘æ–‡æ¡£ä¸­å…³äºÂ useEffectÂ ç« èŠ‚åï¼Œæˆ‘ä¸ªäººæ›´åŠ ç¡®ä¿¡å›´ç»•ä¾èµ–é¡¹çš„å„ç±»é—®é¢˜ï¼ˆå¦‚ä½•ç¡®å®šä¾èµ–é¡¹ã€ä½¿ç”¨æˆ·äº‹ä»¶å“åº”é€»è¾‘å˜å¾—éš¾ä»¥é˜…è¯»ã€å¿½ç•¥ä¾èµ–æ£€æŸ¥å¼•å‘é—®é¢˜ã€ä¿®æ”¹ä¾èµ–å›°éš¾ã€ä»£ç å™ªéŸ³ç­‰ç­‰ï¼‰ï¼Œå°±æ˜¯ä»ç±»ç»„ä»¶è¿‡æ¸¡åˆ°å‡½æ•°ç»„ä»¶åå¼•å…¥çš„æœ€å¤§é—®é¢˜ã€‚**

## 3ã€AÂ CompleteÂ GuideÂ toÂ useEffect

é‚£ä¹ˆåˆ°åº•ä¸ºä»€ä¹ˆÂ ReactÂ HookÂ å½“åˆè¦è®¾è®¡Â useEffectÂ è¿™ä¹ˆä¸€ä¸ªéš¾ç”¨çš„Â HookÂ å‘¢ï¼Ÿå¹¶ä¸”æˆ‘ä¹Ÿå¾ˆå¥½å¥‡ï¼Œéš¾é“åˆ«çš„å›¢é˜Ÿä¹Ÿä¸€ç›´æ²¡æœ‰æ„Ÿå—åˆ°è¿™äº›é—®é¢˜å—ï¼Ÿæ‰€ä»¥æˆ‘åˆé—®äº†Â DeepSeekï¼š

> _å‰ç«¯æŠ€æœ¯ç¤¾åŒºé‡Œæœ‰æ²¡æœ‰æ‰¹åˆ¤Â useEffectÂ çš„è§‚ç‚¹æˆ–è€…æ–‡ç« ç­‰å†…å®¹ï¼Ÿ_

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/5d7ea506-f14b-43ca-be9d-9726846ddbe8.png)

DeepSeekÂ æåˆ°äº†Â DanÂ AbramovÂ çš„è¿™ç¯‡å†™äºÂ 2019Â å¹´çš„æ–‡ç« [ã€ŠÂ AÂ CompleteÂ GuideÂ toÂ useEffectÂ ã€‹](https://overreacted.io/a-complete-guide-to-useeffect/)ï¼Œæ‰€ä»¥æˆ‘åˆå°è¯•ä»è¿™ç¯‡æ–‡ç« ä¸­å¯»æ‰¾Â useEffectÂ è®¾è®¡çš„ç”±æ¥ï¼š

### è§£é‡Šé—­åŒ…ç‰¹æ€§

æ–‡ç« çš„å‰ä¸‰ä¸ªç« èŠ‚Â _EachÂ RenderÂ HasÂ ItsÂ OwnÂ Xxx_Â ä¸­è§£é‡Šäº†åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå› ä¸ºé—­åŒ…ç‰¹æ€§ï¼Œå…¶å®æ¯æ¬¡æ¸²æŸ“ä¸­æ‰€æœ‰çš„å˜é‡ï¼ˆpropsã€stateã€äº‹ä»¶å¤„ç†ç¨‹åºï¼‰éƒ½æ˜¯ä¸€æ¬¡æ¸²æŸ“çš„å¿«ç…§ï¼Œä»¥åŠæ¯æ¬¡æ¸²æŸ“è¿‡ç¨‹ä¸­éƒ½ä¼´éšç€ä¸€æ¬¡Â effectÂ çš„æ‰§è¡Œï¼ˆå½“ä¸ä¼ é€’Â useEffectÂ çš„ç¬¬äºŒä¸ªå‚æ•°æ—¶ï¼‰ã€‚

### åœ¨å¿«ç…§ä¸­è®¿é—®æœªæ¥çš„çŠ¶æ€

_EachÂ RenderÂ HasÂ ItsÂ Ownâ€¦Â Everything_Â è¿™ä¸ªç« èŠ‚ä¸­æåˆ°äº†ç±»ç»„ä»¶çš„Â setTimeoutÂ ä¸­çš„Â this.state.countÂ ä¼šä¸€ç›´å–åˆ°æœ€æ–°å€¼çš„é—®é¢˜ï¼Œå¹¶ä¸”åŸæ–‡ä¹Ÿç»™å‡ºäº†å¦‚ä½•å–åˆ°ç‚¹å‡»æ—¶çš„å€¼çš„è§£å†³æ–¹æ¡ˆï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/3fdd4e03-d59b-4a07-9fba-e8199092510d.png)

ç±»ç»„ä»¶ä¸­è¿™ç±»ä»£ç ç¡®å®æ¯”è¾ƒè„†å¼±ï¼Œå»ºè®®æ·»åŠ ä¸Šæ³¨é‡Šè¡¨æ˜ä»£ç æ„å›¾ï¼Œå¦åˆ™åœ¨è¿­ä»£ä¸­ç¨ä½œè°ƒæ•´å°±ä¼šæ„å¤–åœ°è¯»å–åˆ°æœ€æ–°å€¼/ç‚¹å‡»æ—¶çš„å€¼ï¼š

```tsx
class ComponentA extends React.Component {
  state = { count: 0 };

  handleClick = () => {
    setTimeout(() => {
      // ğŸŸ¡ è¾“å‡ºçš„æ˜¯å½“å‰æœ€æ–°çš„ state.countï¼Œè€Œéç‚¹å‡»æ—¶çš„å€¼
      console.log(this.state.count);
    }, 1000);
    this.setState({ count: this.state.count + 1 });
  };

  // ...
}


class ComponentB extends React.Component {
  state = { count: 0 };

  handleClick = () => {
    // è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨é—­åŒ…
    const count = this.state.count;
    setTimeout(() => {
      // ğŸŸ¡ è¾“å‡ºçš„æ°¸è¿œæ˜¯ç‚¹å‡»æ—¶çš„ state.countï¼Œè€Œä¸ä¼šçªå˜æˆæœ€æ–°çš„å€¼
      console.log(count);
    }, 1000);
    this.setState({ count: count + 1 });
  };

  // ...
}

```

è€Œå‡½æ•°ç»„ä»¶ä¸­ï¼Œé»˜è®¤åªèƒ½æ‹¿åˆ°ç‚¹å‡»æ—¶çš„å€¼ï¼Œä½†æ˜¯å½“ä½ æƒ³è¦æ‹¿åˆ°æœ€æ–°å€¼æ—¶ï¼Œä½ å¿…é¡»ä¸æ–­åœ°å°†Â countÂ çŠ¶æ€é¢å¤–åŒæ­¥åˆ°Â refÂ ä¸­ï¼š

```tsx
const ComponentA = () => {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setTimeout(() => {
      console.log(count); // ğŸŸ¡ è¾“å‡ºçš„æ˜¯ç‚¹å‡»æ—¶çš„å€¼ï¼Œè€Œéæœ€æ–°å€¼
    }, 1000);
    setCount(count + 1);
  };

  return <button onClick={handleClick}>Click {count}</button>;
};


const ComponentB = () => {
  const [count, setCount] = useState(0);

  const countRef = useRef(count);
  countRef.current = count; // åŒæ­¥æœ€æ–°å€¼åˆ° ref

  const handleClick = () => {
    setTimeout(() => {
      console.log(countRef.current); // ğŸŸ¡ æ€»æ˜¯è¾“å‡ºæœ€æ–°å€¼
    }, 1000);
    const c = ;
    setCount(count + 1);
  };

  return <button onClick={handleClick}>Click {count}</button>;
};

```

æ‰€ä»¥è€ƒè™‘åˆ°ä»£ç åœ¨è¿­ä»£ä¸­çš„ç¨³å®šæ€§ï¼Œè™½ç„¶å‡½æ•°ç»„ä»¶è¯»å–æœ€æ–°å€¼ä»£ç ä¼šæ›´å†—ä½™ä¸€ç‚¹ï¼Œä½†æ˜¯è¿™ä¹Ÿå°†ä¸¤ç§æ¨¡å¼æ˜æ˜¾åœ°åŒºåˆ†å¼€æ¥äº†ï¼Œå‡½æ•°ç»„ä»¶ç¡®å®æ˜¯æ›´ä¼˜çš„è®¾è®¡ã€‚

ä¸è¿‡æ–‡ç« ä¸­è¿˜è¡¨è¾¾äº†ä¸€ä¸ªè§‚ç‚¹ï¼š_åœ¨è¿‡å»çš„æ¸²æŸ“å¿«ç…§ä¸­è¯•å›¾è®¿é—®æœªæ¥çš„çŠ¶æ€ï¼Œæ˜¯ä¸€ç§é€†åŠ¿è€Œä¸ºï¼ˆSwimmingÂ AgainstÂ theÂ Tideï¼‰ã€‚_ä½†æˆ‘è®¤ä¸ºè¿™ä¸¤ç§æƒ…å†µå®Œå…¨æ²¡æœ‰å¥½åä¹‹åˆ†ï¼Œè¦æ‹¿åˆ°æœ€æ–°å€¼è¿˜æ˜¯ç‚¹å‡»æ—¶çš„å€¼ï¼Œå®Œå…¨å–å†³äºéœ€æ±‚ç›®çš„ï¼Œä¸¤è€…åªæ˜¯å®ç°åŠŸèƒ½æ—¶ä¸åŒçš„é€‰æ‹©ã€‚è€Œä¸”è‹¥æŒ‰ç…§è¿™ä¸ªè§‚ç‚¹å»è¯„ä»·çš„è¯ï¼Œé‚£åæ¥æå‡ºçš„Â [useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)Â è¿™ä¸ªÂ APIÂ æ˜¯ä¸æ˜¯å¯ä»¥è¯´æ˜¯å®˜æ–¹Â _é€†åŠ¿è€Œä¸º_Â çš„æ–¹æ³•äº†ï¼Œå› ä¸ºè¿™ä¸ªÂ APIÂ æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä»å†å²çš„æ¸²æŸ“å¿«ç…§ä¸­è®¿é—®åˆ°æœªæ¥çš„çŠ¶æ€ã€‚

æœ€åï¼Œè¿™ä¸ªè¯é¢˜å…¶å®åªå’Œé—­åŒ…æœ‰å…³ï¼Œä¸Â EffectÂ å…³ç³»ä¸å¤§ï¼Œæ‰€ä»¥ç»§ç»­çœ‹â€¦â€¦

### åŒæ­¥æ€ç»´çš„ç”±æ¥

_Synchronization,Â NotÂ Lifecycle_Â è¿™ä¸€ç« ä¸­ä»‹ç»äº†åŒæ­¥æ¦‚å¿µçš„ç”±æ¥ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/e6798102-2dd7-44c6-acbd-629fe8c1a369.png)

åŸæ–‡æåˆ°ï¼Œç›¸æ¯”äºÂ jQueryÂ éœ€è¦å…³æ³¨Â DOMÂ æ“ä½œè¿‡ç¨‹ï¼ŒReactÂ ç”Ÿæ¥å°±åªéœ€è¦å…³æ³¨æ¸²æŸ“ç»“æœï¼Œ**å³åœ¨Â ReactÂ ä¸­é‡è¦çš„æ˜¯ç›®çš„åœ°ï¼Œè€Œä¸æ˜¯è¿‡ç¨‹**ã€‚è€Œä¹‹å‰ç±»ç»„ä»¶ä¸­åªæœ‰Â UIÂ æ¸²æŸ“æ˜¯å…³æ³¨ç›®çš„åœ°ï¼ˆæ²¡æœ‰Â mountÂ å’ŒÂ updateÂ çš„åŒºåˆ«ï¼Œéƒ½æ˜¯ç›´æ¥æ‰§è¡ŒÂ renderÂ å‡½æ•°ï¼‰ï¼Œè€Œç”Ÿå‘½å‘¨æœŸè¿™ä¸€å¥—åˆ™æ˜¯é¢å‘è¿‡ç¨‹çš„ï¼Œå› ä¸ºå¼€å‘è€…è¦æ„ŸçŸ¥åˆ°Â _mountÂ /Â updateÂ /Â unmount_Â è¿™ä¸ªå¿ƒæ™ºæ¨¡å‹ã€‚

æ‰€ä»¥åœ¨æ”¯æŒäº†Â HookÂ çš„å‡½æ•°ç»„ä»¶ä¸­ä¸ä»…ä»…æ˜¯Â UIÂ æ¸²æŸ“ï¼Œæ‰€æœ‰çš„äº‹ç‰©éƒ½å°†åªå…³æ³¨ç›®çš„åœ°ã€‚ä¸ºæ­¤å‡½æ•°ç»„ä»¶ä¸­Â UIÂ æ¸²æŸ“ä¹‹å¤–çš„æ‰€æœ‰é€»è¾‘ï¼ˆç°åœ¨è¢«ç§°ä¸ºå‰¯ä½œç”¨ï¼‰ï¼Œå°±åƒÂ UIÂ æ¸²æŸ“æ˜¯Â _æ ¹æ®Â propsÂ å’ŒÂ stateÂ â€œåŒæ­¥â€Â DOM_ï¼Œå‰©ä½™çš„é€»è¾‘ä¹Ÿéœ€è¦å¼€å‘è€…æ”¹æˆÂ _ç”¨æ ¹æ®Â propsÂ å’ŒÂ stateÂ â€œåŒæ­¥â€Â ReactÂ ç»„ä»¶æ ‘ä¹‹å¤–çš„äº‹ç‰©_Â çš„å¿ƒæ™ºæ¨¡å‹ï¼ˆè€Œä¸æ˜¯åŸæœ¬Â _mountÂ /Â updateÂ /Â unmount_Â çš„å¿ƒæ™ºæ¨¡å‹ï¼‰è¿›è¡Œå¼€å‘ã€‚

æ„Ÿè§‰æ˜¯ç»Ÿä¸€äº†Â ReactÂ ç»„ä»¶å†…æ‰€æœ‰äº‹ç‰©çš„å¿ƒæ™ºæ¨¡å‹ï¼šå…³æ³¨ç›®çš„åœ°ã€åŒæ­¥ã€‚**è®²å®è¯è¿˜æ˜¯æŒºæŠ½è±¡çš„ï¼Œå……æ»¡å“²å­¦æ„å‘³ï¼Œä½†æ˜¯è¿™ä¹ˆåšæœ¬èº«çš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåªæ˜¯ä¸ºäº†ç»Ÿä¸€ä¸­å¿ƒæ€æƒ³ï¼Ÿè¿™æ ·åšç›¸æ¯”äºåœ¨å‡½æ•°ç»„ä»¶ä¸­ä¹Ÿæä¸€å¥—ç±»ä¼¼Â useMountÂ /Â useUpdateÂ /Â useUnmountÂ çš„ç”Ÿå‘½å‘¨æœŸÂ HookÂ æœ‰ä»€ä¹ˆé¢å¤–çš„ä¼˜åŠ¿å‘¢ï¼Ÿ**ä¸çŸ¥é“ï¼Œç»§ç»­çœ‹â€¦â€¦

### setIntervalÂ é¢‘ç¹åˆ›å»ºé—®é¢˜

_DecouplingÂ UpdatesÂ fromÂ Actions_Â å’ŒÂ _WhyÂ useReducerÂ IsÂ theÂ CheatÂ ModeÂ ofÂ Hooks_Â è¿™ä¸¤ç« ä¸­ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨Â useReducerÂ å»è§£å†³Â setIntervalÂ è¢«é¢‘ç¹åˆ›å»ºçš„é—®é¢˜ã€‚

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/22df0142-b6c9-4e3d-99d9-34428e169e23.png)

ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªæ–¹æ³•å¤ªç»•äº†ï¼ŒçœŸè¿˜ä¸å¦‚ç”¨Â refÂ ç»•è¿‡é—­åŒ…é—®é¢˜ï¼Œæˆ–è€…ä½¿ç”¨Â [useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)Â æ¥å¾—ç›´æ¥ï¼Œæ­£å¸¸äººæƒ³ä¸åˆ°çš„ï¼ˆå¯¹ä¸èµ·ï¼Œè¿˜æ˜¯å¿ä¸ä½åæ§½äº†ï¼‰ã€‚è€Œä¸”åˆ©ç”¨Â useReducerÂ çš„è¿™ä¸ªæ–¹æ³•æœ¬è´¨ä¸Šæ˜¯æŠŠå¤šä¸ªçŠ¶æ€å¼ºè¡Œåˆå¹¶æˆäº†ä¸€ä¸ªçŠ¶æ€ï¼Œç„¶åç»§ç»­ç”¨Â setStateÂ çš„å‡½æ•°å¼æ›´æ–°æ¥ç»•è¿‡é—­åŒ…é—®é¢˜ï¼Œä½†æ˜¯å¾ˆå¤šä¸šåŠ¡åœºæ™¯ä¸­è¿™äº›çŠ¶æ€å°±åº”è¯¥æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶ä¸é€‚åˆåˆå¹¶çŠ¶æ€ã€‚

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/3d42a17e-9c23-4ffb-b376-f4dd0101a2a0.png)

æŠŠÂ reducerÂ å®šä¹‰åœ¨å‡½æ•°ç»„ä»¶å†…éƒ¨æ¥è§£å†³Â propsÂ çš„é—­åŒ…é—®é¢˜ï¼Œemm......Â ç¡®å®æœ‰ç§å®˜æ–¹å¤§ä½¬ä¸‹åœºæ•™ä½ åé—¨éªšæ“ä½œçš„æ„Ÿè§‰ã€‚

è¿™ä¸ªè¯é¢˜ä¾æ—§åªå’Œé—­åŒ…æœ‰å…³ï¼Œä¸Â EffectÂ å…³ç³»ä¹Ÿä¸å¤§ï¼Œè¿˜æ˜¯ç»§ç»­çœ‹â€¦â€¦

### JustÂ letÂ itÂ throwÂ !

åœ¨Â _MovingÂ FunctionsÂ InsideÂ Effects_Â è¿™ç« ä¸­ï¼Œæˆ‘æ„Ÿè§‰æˆ‘ç»ˆäºæ‰¾åˆ°æˆ‘æƒ³çŸ¥é“çš„ä¸œè¥¿äº†ï¼

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/0162a6cf-7f35-4c4f-b96b-828556534c10.png)

å› ä¸ºçœ‹åˆ°è¿™é‡Œä¹‹å‰æˆ‘çš„è§‚ç‚¹å’ŒÂ DanÂ æˆªç„¶ç›¸åï¼Œæˆ‘è®¤ä¸ºå¤§éƒ¨åˆ†æƒ…å†µä¸‹Â **Weâ€™reÂ justÂ â€œappeasingÂ Reactâ€**ï¼Œä¹Ÿå°±æ˜¯æˆ‘åœ¨æœ¬æ–‡çš„ç¬¬ä¸‰ç« çš„â€œå¤§é‡çš„å†—ä½™ä»£ç â€ä¸­æåˆ°çš„æ„Ÿè§‰ï¼šä¸æ˜¯Â ReactÂ åœ¨ç»™æˆ‘ä»¬ææ•ˆï¼Œè€Œæ˜¯æˆ‘ä»¬åœ¨ç»™Â ReactÂ å½“ç‰›é©¬ã€‚ä½†æ˜¯Â DanÂ æåˆ°äº†ä¸€ä¸ªå¾ˆé‡è¦çš„è§‚ç‚¹ï¼š

> **TheÂ designÂ ofÂ useEffectÂ forcesÂ youÂ toÂ noticeÂ theÂ changeÂ inÂ ourÂ dataÂ flowÂ andÂ chooseÂ howÂ ourÂ effectsÂ shouldÂ synchronizeÂ itÂ â€”Â insteadÂ ofÂ ignoringÂ itÂ untilÂ ourÂ productÂ usersÂ hitÂ aÂ bug.**

> **useEffectÂ çš„è®¾è®¡è¿«ä½¿æˆ‘ä»¬è¦æ³¨æ„åˆ°æ•°æ®æµä¸­çš„å˜åŒ–ï¼Œå¹¶æ€è€ƒæˆ‘ä»¬çš„Â EffectÂ åº”è¯¥å¦‚ä½•åŒæ­¥å®ƒï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒï¼Œå¦åˆ™æˆ‘ä»¬äº§å“çš„çœŸå®ç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°å› æ­¤äº§ç”Ÿçš„Â Bugã€‚**

æˆ‘å¤§æ¦‚Â getÂ åˆ°Â DanÂ çš„æ„æ€äº†ï¼šå¦‚æœæˆ‘ä»¬ä¸¥æ ¼éµå®ˆÂ useEfectÂ çš„ä¾èµ–é¡¹å£°æ˜è§„åˆ™ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç³»ç»Ÿåœ¨åº”å¯¹å¤–éƒ¨å˜é‡çš„å˜åŒ–æ—¶ï¼Œå°†ä¼šå˜å¾—éå¸¸å¥å£®ï¼Œå› ä¸ºè¿™èƒ½è®©æ•´ä¸ªÂ ReactÂ ç³»ç»Ÿéƒ½èƒ½æ ¹æ®Â useEffectÂ ä¾èµ–é¡¹è¿›è¡Œå®Œç¾çš„â€œåŒæ­¥â€ã€‚æˆ‘æƒ³åˆ°ä¸€ä¸ªä¸æ°å½“çš„æ¯”å–»ï¼šç”¨Â useEffectÂ è¿™å¥—æ–°çš„Â ReactÂ å“²å­¦æ„å»ºå‡ºæ¥çš„é«˜æ¥¼ï¼Œé»˜è®¤èƒ½æŠ—å…«çº§åœ°éœ‡ï¼Œéå¸¸å¯é ï¼

ç„¶åæˆ‘é¡ºç€è¿™ä¸ªæ€è·¯ç»§ç»­æƒ³ï¼Œé‚£æˆ‘ä»¬ä¸šåŠ¡ä¸­æœ‰æ²¡æœ‰é‡åˆ°è¿‡ç±»ä¼¼çš„å› ä¸ºå¤–éƒ¨å˜é‡å˜åŒ–å¯¼è‡´çš„çœŸçº¿é—®é¢˜å‘¢ï¼ˆå› ä¸ºæˆ‘ä»¬å›¢é˜Ÿæ˜¾ç„¶æ²¡æœ‰ä¸¥æ ¼éµå®ˆÂ useEfectÂ çš„ä¾èµ–é¡¹å£°æ˜è§„åˆ™ï¼Œç©ºæ•°ç»„Â \[\]Â çš„ä¾èµ–é¡¹å£°æ˜éšå¤„å¯è§ï¼‰ï¼Ÿæˆ‘çªç„¶æƒ³åˆ°äº†ä¸€ä¸ªå®é™…é‡åˆ°è¿‡çš„é—®é¢˜ï¼ŒèƒŒæ™¯æ˜¯æœ‰ä¸€ä¸ªé¡¹ç›®é¡µé¢ï¼Œä¸åŒé¡µé¢çŠ¶æ€å¤ç”¨åŒä¸€ä¸ªé¡µé¢çº§ç»„ä»¶ï¼Œå³åŒ¹é…äº†å¤šä¸ªè·¯ç”±ï¼š

```tsx
// --------------- ProjectPage.jsx ---------------
import React, { Component } from "react";
// ...

class ProjectPage extends Component {
  constructor(props) {
    super(props);
    this.state = {
      // ...
    };
  }

  componentDidMount() {
    const { action } = this.props?.match?.params || {};
    // ğŸŸ¡ æ ¹æ® action æ‰§è¡Œä¸åŒçš„åˆå§‹åŒ–é€»è¾‘
    if (action === "create") {
      // ...
    } else if (action === "edit") {
      // ...
    } else if (action === "audit") {
      // ...
    } else if (action === "detail") {
      // ...
    }
  }

  // ... 1000 å¤šè¡Œå…¶ä»–é€»è¾‘ï¼Œä»¥åŠå„ç§å­ç»„ä»¶å¼•ç”¨ï¼ˆéƒ¨åˆ†æ˜¯å‡½æ•°ç»„ä»¶ï¼‰
}

export default ProjectPage;


// --------------- router.js ---------------

import ProjectPage from "./ProjectPage.jsx";

export default [
  {
    /**
     * é¡¹ç›® åˆ›å»º/ç¼–è¾‘/å®¡æ ¸/è¯¦æƒ… é¡µé¢
     *
     * action æ“ä½œç±»å‹ï¼šcreate | edit | audit | detail
     */
    url: "/project/:action",
    component: ProjectPage,
  },
];

```

é—®é¢˜å‡ºåœ¨åŒä¸€ä¸ªé¡¹ç›®åœ¨ä¸åŒÂ actionÂ çŠ¶æ€ä¹‹é—´è·³è½¬çš„æ—¶å€™ï¼š

```tsx
// åŸæœ¬ä»£ç ä¸­çš„è·³è½¬éƒ½æ˜¯é€šè¿‡åˆ·æ–°æµè§ˆå™¨é¡µé¢çš„å½¢å¼è¿›è¡Œè·³è½¬çš„
window.location.href = `/base-route/project/${targetAction}`;

// å›¢é˜Ÿæ¥äº†ä¸€ä¸ªæ–°æˆå‘˜ï¼Œè®¤ä¸ºè¿™æ˜¯é¡¹ç›®å†…éƒ¨è·³è½¬ï¼Œåº”è¯¥ä½¿ç”¨ react-router è¿›è¡Œè·³è½¬
props.history.push(`/project/${targetAction}`);
```

æ–°æˆå‘˜è¯´å¾—å¾ˆå¯¹ï¼Œä½†å¾ˆæ˜¾ç„¶è¿™ä¸ªÂ classÂ ç»„ä»¶åªåœ¨Â componentDidMountÂ ä¸­åˆ¤æ–­äº†Â actionï¼Œå¦‚æœä½¿ç”¨Â react-routerÂ çš„Â [History](https://developer.mozilla.org/zh-CN/docs/Web/API/History)Â è·¯ç”±è¿›è¡Œè·³è½¬ï¼ŒReactÂ ä¼šæ²¿ç”¨åŸæ¥çš„ç»„ä»¶å®ä¾‹ï¼Œå¯¼è‡´Â targetActionÂ å¯¹åº”çš„åˆå§‹åŒ–é€»è¾‘ä¸ä¼šè¢«æ‰§è¡Œã€‚å½“æ—¶æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡å®šä¹‰å¤šä¸ªè·¯ç”±å’Œå¤šä¸ªé¡µé¢çº§ç»„ä»¶çš„æ–¹å¼è®©Â ReactÂ æ— æ³•å¤ç”¨ç»„ä»¶ï¼š

```tsx
// --------------- ProjectPage.jsx ---------------
import React, { Component } from "react";
// ...

class ProjectPage extends Component {
  // ...

  componentDidMount() {
    // const { action } = this.props?.match?.params || {};
    const { action } = this.props || {}; // ç›´æ¥ä» props ä¸­è¯»å– action

    // ...
  }

  // ...
}

const withAction = (Comp, action) => {
  return (props) => <ProjectPage {...props} action={action} />;
};
// ğŸŸ¢ åˆ©ç”¨ HOC é«˜é˜¶ç»„ä»¶åˆ›å»ºäº†å››ä¸ªä¸åŒçš„å¥—å£³ Page ç»„ä»¶
export const ProjectCreatePage = withAction(ProjectPage, "create");
export const ProjectEditPage = withAction(ProjectPage, "edit");
export const ProjectAuditPage = withAction(ProjectPage, "audit");
export const ProjectDetailPage = withAction(ProjectPage, "detail");

// --------------- router.js ---------------

import {
  ProjectCreatePage,
  ProjectEditPage,
  ProjectAuditPage,
  ProjectDetailPage,
} from "./ProjectPage.jsx";

export default [
  {
    /**
     * é¡¹ç›®åˆ›å»ºé¡µé¢
     */
    url: "/project/create",
    component: ProjectCreatePage,
  },
  {
    /**
     * é¡¹ç›®ç¼–è¾‘é¡µé¢
     */
    url: "/project/edit",
    component: ProjectEditPage,
  },
  {
    /**
     * é¡¹ç›®å®¡æ ¸é¡µé¢
     */
    url: "/project/audit",
    component: ProjectAuditPage,
  },
  {
    /**
     * é¡¹ç›®è¯¦æƒ…é¡µé¢
     */
    url: "/project/detail",
    component: ProjectDetailPage,
  },
];

```

åæ¥æˆ‘ä»¬è¿˜å‘ç°ï¼Œreact-routerÂ åªè¦è·¯ç”±ä¸åŒï¼Œå³ä½¿ç»„ä»¶ç›¸åŒï¼Œä¹Ÿä¸ä¼šå¤ç”¨ç»„ä»¶å®ä¾‹ï¼Œæ‰€ä»¥è¿˜æœ‰ä¸€ä¸ªæ›´ç®€å•çš„éªšæ“ä½œï¼Œç»„ä»¶æºç å®Œå…¨ä¸ç”¨æ”¹ï¼Œå®šä¹‰å¤šä¸ªè·¯ç”±ä¸”ä¾æ—§ä¿æŒÂ actionÂ ä¸ºåŠ¨æ€è·¯ç”±å‚æ•°ï¼Œä½†æ˜¯æ¯ä¸ªè·¯ç”±ä»…é™å®šä¸€ä¸ªÂ actionÂ æšä¸¾å€¼ï¼š

```tsx
// --------------- ProjectPage.jsx ---------------
import React, { Component } from "react";
// ...

class ProjectPage extends Component {
  // ... ä¸åšä»»ä½•ä¿®æ”¹
}

export default ProjectPage;


// --------------- router.js ---------------

import ProjectPage from "./ProjectPage.jsx";

export default [
  {
    /**
     * é¡¹ç›®åˆ›å»ºé¡µé¢
     */
    url: "/project/:action(create)", // ğŸŸ¢ ä¸€ä¸ªè·¯ç”±ä»…å…è®¸ä¸€ä¸ª action æšä¸¾å€¼
    component: ProjectPage,
  },
  {
    /**
     * é¡¹ç›®ç¼–è¾‘é¡µé¢
     */
    url: "/project/:action(edit)",
    component: ProjectPage,
  },
  {
    /**
     * é¡¹ç›®å®¡æ ¸é¡µé¢
     */
    url: "/project/:action(audit)",
    component: ProjectPage,
  },
  {
    /**
     * é¡¹ç›®è¯¦æƒ…é¡µé¢
     */
    url: "/project/:action(detail)",
    component: ProjectPage,
  },
];

```

å½“æ—¶åœ¨å¤„ç†è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰è€ƒè™‘è¿‡è®©Â ProjectPageÂ ç»„ä»¶åŠå…¶æ‰€æœ‰çš„å­ç»„ä»¶éƒ½ç›‘å¬Â actionÂ çš„å˜åŒ–ï¼Œä½¿å…¶æ”¯æŒåœ¨æ•´ä¸ªé¡µé¢çš„ç”Ÿå‘½å‘¨æœŸå†…æ”¯æŒÂ actionÂ çš„å˜åŒ–ï¼ŒåŸå› ä¹Ÿéå¸¸æ˜æ˜¾ï¼šæ”¯æŒäº†ç»„ä»¶é”€æ¯ä¹‹åçš„Â HistoryÂ è·¯ç”±åˆ‡æ¢åœ¨ä½“éªŒä¸Šä¹Ÿå·²ç»æ¯”ç›´æ¥ä¿®æ”¹Â location.hrefÂ è§¦å‘æ•´ä¸ªé¡µé¢èµ„æºçš„é‡æ–°åŠ è½½å¥½äº†å¾ˆå¤šã€‚è¿›ä¸€æ­¥è®©æ•´ä¸ªé¡µé¢å®Œå…¨æ”¯æŒÂ actionÂ åŠ¨æ€å˜åŒ–èƒ½å¤Ÿå¸¦æ¥çš„æ€§èƒ½å—ç›Šå®Œå…¨å–å†³äºä¸åŒÂ actionÂ ä¹‹é—´é¡µé¢çš„å·®å¼‚åŒ–é€»è¾‘æœ‰å¤šå°‘ï¼Œå·®å¼‚åŒ–é€»è¾‘è¶Šå¤šï¼Œå—ç›Šè¶Šå°ã€‚å†µä¸”è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„å†å²é¡µé¢ï¼Œç»¼åˆè€ƒè™‘ä¸‹æ¥ï¼Œè¿™ä¹ˆåšçš„Â ROIï¼ˆæŠ•å…¥äº§å‡ºæ¯”ï¼‰Â å®åœ¨æ˜¯å¤ªä½äº†ã€‚

ä½†æ˜¯å¦‚æœè¿™ä¸ªé¡µé¢åŠå…¶æ‰€æœ‰å­ç»„ä»¶éƒ½æ˜¯ç”±ä¸€ä¸ªå®Œå…¨éµå®ˆäº†Â useEffectÂ ä¾èµ–é¡¹å£°æ˜è§„åˆ™çš„å¼€å‘è€…æ¥å®ç°çš„ï¼Œå°±èƒ½å®Œå…¨é¿å…è¿™ä¸ªé—®é¢˜äº†ï¼å› ä¸ºæ•´ä¸ªé¡µé¢å¯ä»¥å®Œç¾åœ°æ ¹æ®Â actionÂ è¿›è¡Œâ€œåŒæ­¥â€ï¼š

```tsx
const { action } = props?.match?.params || {}

useEffect(() => {
  if (action === "create") {
    // ...
  } else if (action === "edit") {
    // ...
  } else if (action === "audit") {
    // ...
  } else if (action === "detail") {
    // ...
  }

// }, []); // ğŸŸ¡ åŸæœ¬çš„ç±»ç»„ä»¶åªåœ¨ didMount æ—¶æ‰æ‰§è¡Œçš„é€»è¾‘ï¼Œç›¸å½“äºæ¬ºéª—äº† Effect æ²¡æœ‰ä¾èµ–é¡¹

}, [action, /* ... */]); // ğŸŸ¢ ä¾èµ–é¡¹å£°æ˜å®Œå…¨éµå®ˆ react-hooks/exhaustive-deps ç»™å‡ºçš„æç¤º


useEffect(() => {
  // ...
}, [/* ... */]); // ğŸŸ¢ ä¾èµ–é¡¹å£°æ˜å®Œå…¨éµå®ˆ react-hooks/exhaustive-deps ç»™å‡ºçš„æç¤º

useEffect(() => {
  // ...
}, [/* ... */]); // ğŸŸ¢ ä¾èµ–é¡¹å£°æ˜å®Œå…¨éµå®ˆ react-hooks/exhaustive-deps ç»™å‡ºçš„æç¤º

// ...
```

**åœ¨æˆ‘Â getÂ åˆ°è¿™ä¸ªæ„æ€çš„æ—¶å€™ï¼Œæˆ‘ç¡®å®æ˜¯è¢«éœ‡æ’¼åˆ°äº†ï¼Œæ„Ÿè§‰Â useEffectÂ æ˜¯éå¸¸è¶…å‰çš„è®¾è®¡ï¼Œç”šè‡³æœ‰å‡ åˆ†**Â _**ä¸Šå·¥æ²»æœªç—…**_Â **çš„æ„Ÿè§‰ã€‚**

ä½†æ˜¯å½“æˆ‘å†·é™ä¸‹æ¥ä»”ç»†æ€è€ƒæ—¶ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªå¾ˆå¤§çš„æ¼æ´ï¼š**æœ‰äº›æ—¶å€™å³ä½¿æˆ‘ä»¬å°†æŸäº›ç»„ä»¶ä¸­åŸæœ¬åˆ»æ„å£°æ˜äº†ç©ºä¾èµ–Â \[\]Â çš„Â useEffectÂ æ”¹æˆçœŸå®çš„ä¾èµ–é¡¹ï¼Œä¹Ÿæ— æ³•å¾—åˆ°ä¸€ä¸ªâ€œå®Œç¾çš„å“åº”å¼ç»„ä»¶â€ï¼ˆå¯ä»¥å…¼å®¹ä»»æ„Â propsÂ åœ¨ä¸­é€”å˜åŒ–çš„ç»„ä»¶ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬å¿˜äº†è¦é‡ç½®Â stateÂ çŠ¶æ€ã€‚**

è¿˜æ˜¯ä¸¾æˆ‘ä»¬å¸¸è§çš„ä¸­åå°åˆ—è¡¨æŸ¥è¯¢é¡µçš„ä¾‹å­ï¼Œå†é¢å¤–åŠ ä¸Šä¸€ä¸ªåˆ—è¡¨æ•°æ®æ‰¹é‡é€‰æ‹©ååˆ é™¤çš„åŠŸèƒ½ï¼Œå‡è®¾Â URLÂ ä¸­çš„Â projectTypeÂ åœ¨ä¸€ä¸ªé¡µé¢çš„ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š

```tsx
/**
 * projectType ä» URL ä¸­çš„ query ä¸­è¯»å–
 * 
 * pageSize ä»é«˜é˜¶ç»„ä»¶ withPageSize ä¸­è·å–
 */
const ProjectListPage = (props) => {
  const { projectType, pageSize } = props;

  const [pageNo, setPageNo] = useState(1);
  const [projectList, setProjectList] = useState([]);
  const [selectedProjectIds, setSelectedProjectIds] = useState([]);

  const fetchProjectList = useCallback(
    async (params = {}) => {
      const query = qs.stringify({
        projectType,
        pageSize,
        pageNo: params.pageNo ?? 1,
      });
      const response = await fetch(`/project/list?${query}`);
      const json = await response.json();
      setProjectList(json);
    },
    [projectType, pageSize] // ğŸŸ¢ ä¾èµ–é¡¹å£°æ˜å®Œå…¨éµå®ˆ react-hooks/exhaustive-deps ç»™å‡ºçš„æç¤º
  );

  /** ç‚¹å‡»æ¯æ¡é¡¹ç›®çš„ checkbox */
  const handleProjectItemSelect = (item) => {
    const { id } = item || {};
    if (selectedProjectIds.includes(id)) {
      setSelectedProjectIds(selectedProjectIds.filter((pId) => pId !== id));
    } else {
      setSelectedProjectIds([...selectedProjectIds, id]);
    }
  };

  /** ç‚¹å‡»ã€Œæ‰¹é‡åˆ é™¤ã€æŒ‰é’® */
  const handleBatchDeleteBtnClick = () => {
    if (selectedProjectIds.length === 0) {
      message.warn('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®');
      return;
    }
    // æ ¹æ® selectedProjectIds è°ƒç”¨æ‰¹é‡åˆ é™¤æ¥å£
  };

  const handlePageNoBtnClick = (targetPageNo) => {
    setPageNo(targetPageNo);
    fetchProjectList({ pageNo: targetPageNo });
  };

  const handleNextPageBtnClick = () => {
    /* ... */
  };
  const handlePrevPageBtnClick = () => {
    /* ... */
  };

  useEffect(() => {
    fetchProjectList();
  }, [fetchProjectList]); // ğŸŸ¢ ä¾èµ–é¡¹å£°æ˜å®Œå…¨éµå®ˆ react-hooks/exhaustive-deps ç»™å‡ºçš„æç¤º

  return <div>{/* ... */}</div>;
};

export default withPageSize(ProjectListPage, 20);

```

ç³»ç»Ÿæ­£å¸¸è¿è¡Œå®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œå‡è®¾åœ¨ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„åœºæ™¯ä¸­ï¼ŒprojectTypeÂ ä¸­é€”å˜åŒ–äº†ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°Â pageNoÂ å’ŒÂ selectedProjectIdsÂ è¿™ä¸¤ä¸ªçŠ¶æ€å¹¶æ²¡æœ‰é‡ç½®ï¼š

```tsx
const ProjectListPage = (props) => {
  const { projectType, pageSize } = props;

  const [pageNo, setPageNo] = useState(1);
  const [selectedProjectIds, setSelectedProjectIds] = useState([]);

  /** ç‚¹å‡»ã€Œæ‰¹é‡åˆ é™¤ã€æŒ‰é’® */
  const handleBatchDeleteBtnClick = () => {
    if (selectedProjectIds.length === 0) {
      message.warn('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®');
      return;
    }
    // æ ¹æ® selectedProjectIds è°ƒç”¨æ‰¹é‡åˆ é™¤æ¥å£
  };

  // ...

  useEffect(() => {
    // å¦‚æœ URL ä¸­çš„ projectType å˜åŒ–äº†ï¼ŒfetchProjectList ç¡®å®é‡æ–°ä¼šé‡æ–°æ‰§è¡Œè¯·æ±‚åˆ°ç¬¬ä¸€é¡µçš„æ•°æ®
    // ğŸ”´ ä½†é¡µé¢ä¼šæœ‰å¦‚ä¸‹é—®é¢˜ï¼š
    //    1ã€æœ€ä¸¥é‡çš„å°±æ˜¯ selectedProjectIds æ²¡æœ‰æ¸…ç©ºï¼Œå¯èƒ½å¯¼è‡´ç”¨æˆ·é”™è¯¯åˆ é™¤é¡µé¢ä¸­æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥çš„é¡¹ç›®
    //    2ã€é¡µé¢ä¸Šå±•ç¤ºçš„æ˜¯æ–°çš„ projectType çš„ç¬¬ 1 é¡µçš„æ•°æ®ï¼Œä½†æ˜¯é¡µé¢ä¸Šçš„ç¿»é¡µå™¨ä¸­å¯èƒ½å±•ç¤ºçš„å¹¶ä¸æ˜¯ç¬¬ 1 é¡µ
    fetchProjectList();
  }, [fetchProjectList]);

  return <div>{/* ... */}</div>;
};

```

å…¶ä¸­Â selectedProjectIdsÂ æ²¡æœ‰æ¸…ç©ºçš„é—®é¢˜ç”šè‡³è®©æˆ‘è§‰å¾—è¿˜ä¸å¦‚Â useEffectÂ çš„ä¾èµ–ä¸­å†™ä¸ªç©ºæ•°ç»„ï¼Œå› ä¸ºé‚£æ ·è™½ç„¶Â projectTypeÂ å˜åŒ–ä¹‹ååˆ—è¡¨æ•°æ®å®Œå…¨ä¸ä¼šå˜åŒ–ï¼Œä½†æ˜¯è‡³å°‘ä¸ä¼šå¯¼è‡´ç”¨æˆ·è¯¯åˆ æ•°æ®ã€‚æ‰€ä»¥æˆ‘æ„Ÿè§‰ç”¨Â useEffectÂ è¿™å¥—æ–°çš„Â ReactÂ å“²å­¦æ„å»ºå‡ºæ¥çš„é«˜æ¥¼ï¼Œå…¶å®å¹¶æŠ—ä¸ä½å…«çº§åœ°éœ‡ï¼Œåè€Œæ›´åƒæ˜¯ä¸€åº§éå¸¸æ˜‚è´µï¼ˆéœ€è¦å¼€å‘è€…ç»´æŠ¤å¥½æ‰€æœ‰ä¾èµ–é¡¹ï¼‰ä½†å´ä¸€ç¢°å°±ç¢çš„æ°´æ™¶ç‰ç’ƒå¡”ï¼ˆçº¯ç²¹ä¸ªäººè§‚ç‚¹ï¼‰ã€‚

ç„¶åå½“æˆ‘è¯•å›¾åœ¨è¿™ä¸ªä»£ç çš„åŸºç¡€ä¸Šä¿®å¤è¿™ä¸¤ä¸ªé—®é¢˜æ—¶ï¼Œå‘ç”Ÿäº†ä¸€ä¸ªæ›´è¯¡å¼‚çš„äº‹æƒ…ï¼Œæˆ‘ä¸è‡ªè§‰åœ°å†™å‡ºäº†ä¸€ä¸ªå®Œå…¨é”™è¯¯çš„Â useEffectÂ ç¤ºä¾‹ï¼š

```tsx
/**
 * projectType ä» URL ä¸­çš„ query ä¸­è¯»å–
 * 
 * pageSize ä»é«˜é˜¶ç»„ä»¶ withPageSize ä¸­è·å–
 */
const ProjectListPage = (props) => {
  const { projectType, pageSize } = props;

  const [pageNo, setPageNo] = useState(1);
  const [projectList, setProjectList] = useState([]);
  const [selectedProjectIds, setSelectedProjectIds] = useState([]);

  const fetchProjectList = useCallback(
    async (params = {}) => {
      const query = qs.stringify({
        projectType,
        pageSize,
        pageNo: params.pageNo ?? 1,
      });
      const response = await fetch(`/project/list?${query}`);
      const json = await response.json();
      setProjectList(json);
    },
    [projectType, pageSize]
  );

  // ...

  useEffect(() => {
    // ğŸŸ¡ ä¸èƒ½è¿™æ ·ä¿®å¤ï¼Œå› ä¸ºæ¯å½“ projectType æˆ– pageSize å˜åŒ–æ—¶ä¼šè§¦å‘è¿™ä¸ª Effectï¼Œè€Œ pageSize å˜åŒ–æ—¶ä¸éœ€è¦é‡ç½® state çŠ¶æ€
    //    PS: è¿™ä¸ªç¤ºä¾‹ä¸­çš„ pageSize å¯èƒ½ä¸é‚£ä¹ˆè´´åˆä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„å…¶å®æ˜¯å¾ˆå¤šç»„ä»¶ä¸­è¿™ç±»åŸæœ¬åªéœ€åœ¨ didMout æ—¶æ‰§è¡Œçš„ Effect å…¶å®ä¼šæœ‰å¾ˆå¤šä¾èµ–é¡¹
    // setPageNo(1);
    // setProjectList([]);
    // selectedProjectIds([]);

    fetchProjectList();
  }, [fetchProjectList]);

  useEffect(() => {
    // æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ˜ç¡®åªåœ¨ projectType å˜åŒ–æ—¶è¿›è¡Œ state çŠ¶æ€é‡ç½®
    setPageNo(1);
    setProjectList([]);
    selectedProjectIds([]);
  }, [projectType]); // ğŸ”´ ä½†æ˜¯è¿™ä¹ˆåšçš„è¯ä¾èµ–é¡¹å£°æ˜å°±å®Œå…¨ä¸ç¬¦åˆ useEffect ä¾èµ–é¡¹å£°æ˜è§„åˆ™ï¼Œæ ¹æ® Effect ä¸­çš„ä»£ç ï¼Œåº”è¯¥å£°æ˜ç©ºæ•°ç»„ [] ä¾èµ– 


  return <div>{/* ... */}</div>;
};

export default withPageSize(ProjectListPage, 20);

```

ä½ å¯èƒ½è¿˜ä¼šå‘ç°ï¼Œæˆ‘åœ¨ç¬¬äºŒä¸ªÂ useEffectÂ ä¸­å®ç°çš„å…¶å®å¹¶ä¸æ˜¯å‰¯ä½œç”¨é€»è¾‘ï¼ŒsetStateÂ ç±»çš„æ–¹æ³•æ˜¯å®Œå…¨å±äºÂ UIÂ æ¸²æŸ“çš„é€»è¾‘ï¼Œå› ä¸ºç¬¬äºŒä¸ªÂ useEffectÂ æ˜¯æˆ‘ç”¨ç›‘å¬æ€ç»´å†™å‡ºæ¥çš„ï¼ä½†æ˜¯é—®é¢˜ç¡®å®æ˜¯è¢«æˆ‘ä¿®å¤äº†ã€‚

**è¿™è²Œä¼¼å½¢æˆäº†ä¸€ä¸ªæ‚–è®ºï¼Œå½“æˆ‘æƒ³é€šè¿‡å®Œå…¨éµå®ˆÂ useEffectÂ ä¾èµ–é¡¹å£°æ˜è§„åˆ™æ¥å¾—åˆ°ä¸€ä¸ªâ€œå®Œç¾çš„å“åº”å¼ç»„ä»¶â€æ—¶ï¼Œæˆ‘å´ä¾èµ–äº†ä¸€ä¸ªå®Œå…¨ä¸éµå®ˆä¾èµ–é¡¹å£°æ˜è§„åˆ™çš„Â useEffectâ€¦â€¦æˆ‘è®¤ä¸ºè¿™æ˜¯Â EffectÂ â€œåŒæ­¥â€å¿ƒæ™ºæ¨¡å‹ä¸­éå¸¸å¤§çš„æ¼æ´ã€‚**

æŠ›å¼€è¿™ä¸ªæ‚–è®ºï¼Œå½“æˆ‘ä»¬å†æ¥åˆ†æä¸€ä¸‹åšå®Œå…¨åšåˆ°éµå®ˆÂ useEffectÂ ä¾èµ–é¡¹å£°æ˜è§„åˆ™è¿™ä¸ªäº‹æƒ…ï¼Œå…¶å®æ˜¯éå¸¸éš¾çš„ï¼Œå¹¶ä¸”éå¸¸è„†å¼±çš„ï¼Œç»¼åˆè€ƒé‡ä¸‹æ¥çš„Â ROIÂ ä¹Ÿæ˜¯éå¸¸ä½çš„ï¼š

*   æ•´ä¸ªå‰ç«¯å·¥ç¨‹ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¾èµ–çš„äºŒæ–¹åŒ…ã€ä¸‰æ–¹åŒ…ä¸­çš„æ‰€æœ‰ä»£ç éƒ½è¦éµå®ˆÂ useEffectÂ ä¾èµ–é¡¹å£°æ˜è§„åˆ™ï¼Œé¦–å…ˆæ¶‰åŠçš„ä»£ç èŒƒå›´éå¸¸å¹¿ï¼Œä¸‰æ–¹åŒ…ç”šè‡³æ˜¯ä¸å¯æ§çš„ï¼Œå…¶æ¬¡åœ¨æ¯ä¸ªç»„ä»¶ä¸­å»å…³æ³¨æ‰€æœ‰Â EffectÂ ä¸­çš„æ•°æ®æµå˜åŒ–ï¼Œæ˜¯éå¸¸è€—è´¹å¼€å‘äººå‘˜å¿ƒæ™ºçš„ï¼Œæç«¯çš„ä¾‹å­å°±æ˜¯å‰é¢æåˆ°è¿‡çš„â€œæ»¡è¡€ç‰ˆâ€Â useDebounceFnï¼Œå¸¸è§çš„ä¾‹å­å°±æ˜¯è¿™é‡Œçš„åˆ—è¡¨æ‰¹é‡åˆ é™¤ã€‚
    
*   ç›®å‰çš„æ­£å¼ç‰ˆÂ ReactÂ å¯¹åº”çš„Â useEffectÂ ä¾èµ–é¡¹å£°æ˜è§„åˆ™æ˜¯æœ‰æ¼æ´çš„ï¼Œä½†è‹¥çœŸçš„åœ¨æ­£å¼ç‰ˆæœ¬ä¸­å¼•å…¥äº†Â [useEffectEvent](https://zh-hans.react.dev/reference/react/experimental_useEffectEvent)Â è¿™ä¸ªÂ APIï¼Œå¯¹å¼€å‘è€…çš„å¿ƒæ™ºè´Ÿæ‹…åˆä¼šå¤§å¤§å¢åŠ ï¼ŒåŠ ä¸ŠåŸæœ¬å°±æœ‰å¾ˆå¤šäººåœ¨ç”¨ç›‘å¬æ€ç»´ä½¿ç”¨Â useEffectï¼Œå¯æƒ³è€ŒçŸ¥Â eslint-disable-next-lineÂ çš„æƒ…å†µä¾æ—§ä¼šå¾ˆå¤šï¼Œè¿™æ˜¯å…¸å‹çš„ç ´çª—æ•ˆåº”ã€‚
    
*   DanÂ åœ¨åç»­çš„Â _AreÂ FunctionsÂ PartÂ ofÂ theÂ DataÂ Flow?_Â è¿™ä¸€ç« ä¸­ä¹Ÿè¯´äº†ï¼Œå¦‚æœæ•´ä¸ªå·¥ç¨‹ä¸­å­˜åœ¨ç±»ç»„ä»¶ï¼Œç±»ç»„ä»¶çš„åŸå‹æ–¹æ³•å› ä¸ºå¼•ç”¨åœ°å€æ˜¯å›ºå®šçš„ï¼ˆæˆ‘ä»¬å‰é¢æåˆ°è¿‡çš„Â renderÂ propsÂ é—®é¢˜ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼‰ï¼Œå°†ç±»æ–¹æ³•ä¼ é€’ç»™å­ç»„ä»¶çš„Â useEffectÂ ä¾èµ–é¡¹æ—¶ï¼Œæ˜¯å¯¹è¿™ç§æ•°æ®æµçš„ä¸€ç§ç ´åï¼Œå³ç±»ç»„ä»¶ä¼šè®©è¿™ä¸ªæ¨¡å¼åœ¨è¿­ä»£ä¸­å˜å¾—éå¸¸è„†å¼±ï¼Œå› æ­¤æ•´ä¸ªå‰ç«¯å·¥ç¨‹åŒ…æ‹¬æ‰€æœ‰ä¾èµ–çš„äºŒæ–¹åŒ…ã€ä¸‰æ–¹åŒ…æœ€å¥½ä¸åŒ…å«ä»»ä½•ç±»ç»„ä»¶ã€‚
    

å†å›åˆ°åˆšæ‰çš„ç¤ºä¾‹ï¼Œäº‹å®ä¸Šï¼š

*   è‹¥Â projectTypeÂ å˜åŒ–æ—¶ï¼Œè¦é‡ç½®ç»„ä»¶å†…çš„æ‰€æœ‰Â stateï¼Œé‚£æˆ‘ä»¬åº”è¯¥åœ¨çˆ¶ç»„ä»¶ä¸­ï¼ˆè¿™é‡Œè™½ç„¶æ²¡æœ‰çˆ¶ç»„ä»¶ä½†ä¹Ÿå¯ä»¥è®¾è®¡ä¸€ä¸ªä¾‹å¦‚Â withProjectTypeÂ çš„é«˜é˜¶ç»„ä»¶ï¼‰ç»™å½“å‰ç»„ä»¶è®¾ç½®Â key={projectType}Â ä½¿Â ProjectListPageÂ ç»„ä»¶åœ¨Â projectTypeÂ å˜åŒ–æ—¶è‡ªåŠ¨é”€æ¯å¹¶åˆ›å»ºæ–°ç»„ä»¶ï¼ˆå…·ä½“å‚è€ƒ[ã€ŠÂ å½“Â propsÂ å˜åŒ–æ—¶é‡ç½®æ‰€æœ‰Â stateÂ ã€‹](https://zh-hans.react.dev/learn/you-might-not-need-an-effect#resetting-all-state-when-a-prop-changes)å’Œ[ã€ŠÂ æœ‰Â keyÂ çš„éå¯æ§ç»„ä»¶Â ã€‹](https://zh-hans.legacy.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-uncontrolled-component-with-a-key)ï¼‰ã€‚
    
*   è‹¥Â projectTypeÂ å˜åŒ–æ—¶ï¼Œåªéœ€è¦ç»„ä»¶å†…çš„éƒ¨åˆ†Â stateï¼Œé‚£ä½ åªèƒ½å†™ä¸€ä¸ªä¸Šæ–¹ç¤ºä¾‹ä¸­çš„ç›‘å¬æ€ç»´çš„Â useEffectÂ å»é‡ç½®éƒ¨åˆ†Â stateï¼Œæˆ–è€…é‡æ„Â ProjectListPageÂ ç»„ä»¶ï¼Œå°†éœ€è¦é‡ç½®çš„Â stateÂ å’Œä¸éœ€è¦é‡ç½®çš„Â stateÂ åˆ†åˆ«æ”¶æ•›åˆ°ä¸åŒçš„å­ç»„ä»¶ä¸­ï¼Œå¹¶ç»™ä¸­ä¸€ä¸ªå­ç»„ä»¶è®¾ç½®Â key={projectType}Â å®ç°éƒ¨åˆ†Â stateÂ çš„é‡ç½®ã€‚
    

**ç„¶è€Œä¸ç®¡æ˜¯å“ªç§æƒ…å†µï¼Œæ˜¯å¦éµå®ˆÂ useEffectÂ çš„ä¾èµ–é¡¹å£°æ˜è§„åˆ™å¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œæˆ–è€…è¯´éµå®ˆäº†Â useEffectÂ çš„ä¾èµ–é¡¹å£°æ˜è§„åˆ™å¹¶ä¸èƒ½æå‰é¢„é˜²é—®é¢˜çš„å‘ç”Ÿï¼Œç”šè‡³å¯èƒ½å¸®å€’å¿™ï¼ˆåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¢åŠ äº†ç”¨æˆ·è¯¯åˆ æ•°æ®çš„å¯èƒ½æ€§ï¼‰ã€‚**

åœ¨æˆ‘ä»¬çš„Â useInitÂ æ–¹æ¡ˆä¸­ï¼Œå¦‚æœè®¾è®¡ä¸Šä¸éœ€è¦è¿‡è€ƒè™‘Â projectTypeÂ çš„å˜åŒ–ï¼Œé‚£å°±ä¸ç”¨ç‰¹æ„å»å…³æ³¨ä»€ä¹ˆæ•°æ®æµçš„å˜åŒ–ï¼š

```tsx
const ProjectListPage = (props) => {
  // ...

  // ğŸŸ¢ æœ€ç®€å•çš„å‡½æ•°å®šä¹‰ï¼Œæ°¸è¿œä¸éœ€è¦ useCallbackï¼Œæ°¸è¿œä¸ç”¨å…³å¿ƒå‡½æ•°å®ç°ä¸­çš„ä¾èµ–é¡¹
  const fetchProjectList = async (params = {}) => {
    const query = qs.stringify({
      projectType,
      pageSize,
      pageNo: params.pageNo ?? 1,
    });
    const response = await fetch(`/project/list?${query}`);
    const json = await response.json();
    setProjectList(json);
  };

  // ...

  // ğŸŸ¢ ä»£ç å¯ä»¥â€œè‡ªè¯´æ˜â€ï¼šä»…éœ€åœ¨åˆå§‹åŒ–çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ fetchProjectList å³å¯ï¼Œä¾æ—§ä¸å¿…å…³å¿ƒä»€ä¹ˆä¾èµ–é¡¹
  useInit(() => {
    fetchProjectList();
  });

  return <div>{/* ... */}</div>;
};

```

æ‰€ä»¥æˆ‘ç†æƒ³ä¸­çš„ç ”å‘æµç¨‹æ˜¯è¿™æ ·çš„ï¼š

1.  é¦–å…ˆåœ¨å¹³æ—¶å¼€å‘æ—¶ï¼Œå¯¹äºä¸€ä¸ªç»„ä»¶çš„Â propsÂ å±æ€§ï¼ˆä»¥åŠå…¶ä»–å¤–éƒ¨ç³»ç»Ÿçš„å˜é‡ï¼‰ï¼Œå“ªäº›æ˜¯ä¼šå˜çš„ï¼Œå“ªäº›æ˜¯ä¸ä¼šå˜çš„ï¼Œæˆ‘ä»¬è¦æœ‰æ˜ç¡®çš„é¢„æœŸï¼ˆæ ¹æ®äº§å“éœ€æ±‚åˆ¶å®šæŠ€æœ¯æ–¹æ¡ˆçš„æ—¶å€™è¦ç¡®å®šï¼‰ï¼Œæ ¹æ®è¿™ä¸ªé¢„æœŸå»å†™ä»£ç ï¼šè‹¥Â propsÂ å·²æ˜ç¡®ä¸ä¼šå˜åŒ–ï¼Œé‚£ä¹ˆå¯¹åº”çš„é€»è¾‘åˆ™åªéœ€è¦äº‹å…ˆåœ¨Â didMountÂ ä¸­ï¼›è‹¥Â propsÂ æ˜¯æ˜ç¡®ä¼šå˜åŒ–çš„ï¼Œåˆ™éœ€è¦ç”¨åˆé€‚çš„æ–¹æ³•å»å…¼å®¹è¿™ç§å˜åŒ–ã€‚
    
2.  å¦‚æœé‡åˆ°åŸæœ¬é¢„æœŸä¸ä¼šå˜åŒ–çš„Â propsÂ å‡ºç°äº†å˜åŒ–ï¼Œåˆ™éœ€è¦åˆ†ä¸¤ç§æƒ…å†µï¼šè‹¥åˆ†æåè®¤ä¸ºè¯¥Â propsÂ ç¡®å®åº”è¯¥å˜åŒ–ï¼Œè¯´æ˜æŠ€æœ¯æ–¹æ¡ˆåˆ¶å®šå¾—æœ‰é—®é¢˜ï¼Œéœ€è¦é‡æ–°æ‰§è¡ŒÂ 1Â çš„æµç¨‹ï¼›è‹¥è®¤ä¸ºè¯¥Â propsÂ ä¸åº”è¯¥å˜åŒ–ï¼Œåˆ™åº”è¯¥è°ƒæ•´ä»£ç è®©è¿™ä¸ªÂ propsÂ ä¸å†å˜åŒ–ã€‚
    

è‡³äºå¦‚ä½•å…¼å®¹Â propsÂ å±æ€§ï¼ˆä»¥åŠå…¶ä»–å¤–éƒ¨ç³»ç»Ÿçš„å˜é‡ï¼‰çš„å˜åŒ–ï¼Œåœ¨æœ¬æ–‡ç¬¬å››ç« çš„â€œè°¨æ…ä½¿ç”¨Â useWatchâ€ä¸­å·²ç»æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œç›‘å¬æ€ç»´ï¼ˆå³åˆ—è¡¨æŸ¥è¯¢ç¤ºä¾‹ä¸­ç”¨äºé‡ç½®çŠ¶æ€çš„Â useEffectï¼‰åº”è¯¥æ˜¯æˆ‘ä»¬æœ€åçš„æ‰‹æ®µã€‚

**è¿™å…¶å®å°±æ˜¯åŸæœ¬çš„ç±»ç»„ä»¶çš„ç ”å‘ä¹ æƒ¯ï¼Œå› ä¸ºè¿™å¾ˆç¬¦åˆå¼€å‘è€…çš„ç›´è§‰ï¼ŒåŸæœ¬çš„ç±»ç»„ä»¶ç ”å‘ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰æ„ŸçŸ¥åˆ°è¿™ä¸ªç‚¹æ˜¯éå¸¸ä¸¥é‡çš„ç—›ç‚¹é—®é¢˜ï¼Œç±»ç»„ä»¶çš„é—®é¢˜ä¸»è¦è¿˜æ˜¯åœ¨äºé€»è¾‘å¤ç”¨å›°éš¾ä»¥åŠå›´ç»•Â thisÂ å‡ºç°çš„ä¸€å †â€œéº»çƒ¦äº‹â€ï¼Œæ‰€ä»¥åœ¨Â ReactÂ HookÂ ä¸­èŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å»ç»´æŠ¤ä¾èµ–é¡¹æ˜¯å¾ˆæ²¡æœ‰é“ç†çš„ï¼Œè¿™ä¸ä»…æ²¡æœ‰å¸¦æ¥ä»€ä¹ˆæ”¶ç›Šï¼Œåè€Œå¼•æ¥äº†å¦ä¸€å †å›´ç»•ä¾èµ–é¡¹çš„â€œéº»çƒ¦äº‹â€ã€‚**

**æœ€åå†æ¬¡æ˜ç¡®æˆ‘çš„è§‚ç‚¹ï¼šå½“æˆ‘ä»¬å·²ç»åœ¨æ­£å‘ç ”å‘ç¯èŠ‚åšå¥½äº†ä»£ç è®¾è®¡è¿™ä¸ªç¯èŠ‚çš„å·¥ä½œï¼Œå¹¶ä¸éœ€è¦æå‰å»å…³æ³¨æ‰€æœ‰ç»„ä»¶çš„æ•°æ®æµå˜åŒ–ï¼Œè€Œåº”è¯¥åŸºäºå®é™…éœ€æ±‚å»å…³æ³¨æ•°æ®æµå˜åŒ–ï¼Œä¸è¦è¿‡äºæ‹…å¿ƒå› ä¸ºæ•°æ®æµå˜åŒ–è€Œå¼•å‘æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ä¸‡ä¸€é—®é¢˜çœŸçš„å‘ç”Ÿäº†ï¼š**

> **Just**Â **letÂ itÂ throwÂ !**

### ç«æ€æ¡ä»¶

åœ¨Â _SpeakingÂ ofÂ RaceÂ Conditions_Â è¿™ä¸€ç« ä¸­æåˆ°äº†Â useEffectÂ å¦‚ä½•å¤„ç†ç«æ€æ¡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªé—®é¢˜åœ¨ç±»ç»„ä»¶ä¸­ä¹Ÿæ˜¯ä¸€æ ·å¯ä»¥å¤„ç†çš„ã€‚å‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†åœ¨è¯·æ±‚æ–¹æ³•ä¸­ä½¿ç”¨Â _æ ‡è¯†ç¬¦_Â å’ŒÂ _AbortController_Â è¿™ä¸¤ç§å®ç°æ–¹å¼å¤„ç†ç«æ€æ¡ä»¶ï¼Œåœ¨ç±»ç»„ä»¶ä¸­åªéœ€å°†Â refÂ æ¢æˆÂ thisÂ å³å¯ã€‚æ‰€ä»¥è¿™ä¸€ç‚¹ä¸Šä¹Ÿå¹¶ä¸èƒ½ä½“ç°Â EffectÂ çš„â€œåŒæ­¥â€æ¨¡å‹ä¼˜äºç”Ÿå‘½å‘¨æœŸæ¨¡å‹ã€‚Â 

### â€œæ›´ä¸Šä¸€å±‚æ¥¼â€

çœ‹åˆ°Â _RaisingÂ theÂ Bar_Â è¿™ä¸€ç« æ—¶ï¼Œæˆ‘æ„Ÿè§‰è™½ç„¶è¿™ä¸€ç« æ²¡æœ‰å‡ºç°ä»»ä½•ä»£ç ï¼Œä½†æ˜¯è¿™é‡Œè¯´çš„å…¨éƒ¨éƒ½æ˜¯é‡ç‚¹ä¸­çš„é‡ç‚¹ï¼ä¹Ÿè¯´æ˜äº†Â Â ReactÂ æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ä»¬å…¶å®ä¹Ÿå¾ˆæ¸…æ¥šæˆ‘å‰é¢æ‰€è¯´çš„è¿™äº›å…³äºÂ useEffectÂ çš„æƒ…å†µã€‚

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/b50f7637-1cd4-4e5e-9ec4-9cd3ca9ac383.png)

*   è¯•å›¾ä½¿ç”¨Â useEffectÂ å¯¹åº”çš„â€œåŒæ­¥â€æ€ç»´å»å¤„ç†æ‰€æœ‰ç†è®ºä¸Šçš„è¾¹ç¼˜æƒ…å†µï¼Œè¿™ä¸ªå‰æœŸæˆæœ¬éå¸¸é«˜ï¼ˆéœ€è¦è€—è´¹å¼€å‘è€…éå¸¸å¤šçš„é¢å¤–ç²¾åŠ›ï¼‰ï¼Œå¹¶ä¸”ç›¸æ¯”äºé‚£ç§åªåœ¨Â didMountÂ æ—¶æ‰§è¡Œä¸€æ¬¡çš„å‰¯ä½œç”¨é€»è¾‘ï¼Œè¦å›°éš¾å¾—å¤šã€‚
    
*   å®˜æ–¹å¯¹Â useEffectÂ çš„å®šä½å…¶å®æ˜¯ä¸€ä¸ªåº•å±‚çš„Â APIï¼Œåœ¨Â ReactÂ HookÂ å‘å±•çš„åˆæœŸå¯èƒ½åœ¨å„ç§æ•™ç¨‹ä¸­é¢‘ç¹å‡ºç°ï¼Œå¹¶ä¸”å¼€å‘è€…å¹³æ—¶ä¹Ÿä¼šç”¨åˆ°ï¼Œä½†æ˜¯éšç€ç¤¾åŒºç”Ÿæ€çš„å‘å±•ï¼Œå¯¹äºå¤§å¤šæ•°äººè€Œè¨€Â useEffectÂ åº”è¯¥æ˜¯ä¸€ä¸ªä½¿ç”¨é¢‘ç‡éå¸¸éå¸¸ä½Â Hookï¼Œä¸šåŠ¡ä»£ç ä¸­åº”è¯¥ä½¿ç”¨è¿›ä¸€æ­¥å°è£…è¿‡åçš„æ›´é«˜çº§çš„Â HookÂ æ¥å®ç°å„ç§åŠŸèƒ½ã€‚
    
*   ç›®å‰ä¸ºæ­¢å¼€å‘è€…ä»¬ä½¿ç”¨Â useEffectÂ æœ€å¤šçš„åœºæ™¯è¿˜æ˜¯å£°æ˜ç©ºæ•°ç»„Â \[\]Â ä¾èµ–é¡¹ï¼Œç„¶ååœ¨å›è°ƒä¸­è¿›è¡Œæ•°æ®æ¥å£çš„è¯·æ±‚ï¼Œè¿™æ˜¯å®Œå…¨è¿èƒŒâ€œåŒæ­¥â€ç†å¿µçš„ã€‚
    

**åœ¨ç©ºæ•°ç»„Â \[\]Â ä¾èµ–é¡¹çš„Â useEffectÂ ä¸­è·å–æ¥å£æ•°æ®çš„æƒ…å†µï¼Œç›´åˆ°ç°åœ¨Â 2025Â å¹´ä¹Ÿä¾æ—§è¿˜æ˜¯å¾ˆå¸¸è§ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ä¸æ˜¯Â ReactÂ ç”¨æˆ·æœ‰é—®é¢˜ï¼Œè€Œæ˜¯è¿™ä¸ªâ€œåŒæ­¥â€çš„è®¾è®¡ç†å¿µæœ¬èº«å°±æ˜¯åœ¨**Â _**é€†åŠ¿è€Œä¸º**_Â **ï¼Ÿ**

ä¾é ç¤¾åŒºç”Ÿæ€çš„å‘å±•é€æ¸é™ä½Â useEffectÂ ä½¿ç”¨é¢‘ç‡çš„è¿™ä¸ªè§‚ç‚¹ï¼Œè®©æˆ‘æƒ³èµ·äº†Â ReactÂ å¯¹è‡ªå·±çš„å®šä½ï¼Œä»å§‹è‡³ç»ˆÂ ReactÂ éƒ½è®¤ä¸ºè‡ªå·±åªæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºÂ UIÂ ç•Œé¢çš„åº“ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/6f819063-84cf-4115-9d44-0246fd3c9b2d.png)

æ‰€ä»¥å‰¯ä½œç”¨é™¤äº†ä½œä¸ºå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¿˜å¯ä»¥è®¤ä¸ºÂ ReactÂ è¿™ä¸ªåº“æœ¬èº«å¹¶ä¸åº”è¯¥è´Ÿè´£Â UIÂ æ¸²æŸ“ä¹‹å¤–çš„æ‰€æœ‰é€»è¾‘ï¼ŒuseEffectÂ åªæ˜¯Â ReactÂ å¹²çš„â€œå‰¯ä¸šâ€ã€‚ä½†æ˜¯è¯´Â ReactÂ æ˜¯ä¸€ä¸ªæ™®é€šçš„åº“ä¹Ÿä¸å¯¹ï¼Œè´Ÿè´£Â UIÂ æ¸²æŸ“çš„åº“æ˜¯æ•´ä¸ªå‰ç«¯æŠ€æœ¯æ ˆé€‰å‹çš„åŸºç¡€ï¼Œåªè¦é€‰æ‹©äº†Â Reactï¼Œåœ¨Â UIÂ æ¸²æŸ“ä¹‹å¤–çš„å…¶ä»–æŠ€æœ¯éœ€æ±‚ï¼Œä¹Ÿåªèƒ½åœ¨Â ReactÂ ç”Ÿæ€ä¸­é€‰æ‹©åˆé€‚çš„ä¸‰æ–¹åº“ï¼Œå› ä¸ºä¸åŒçš„Â UIÂ æ¸²æŸ“åº“å¯¹äºå‰¯ä½œç”¨çš„æ”¯æŒå½¢å¼æ˜¯ä¸ä¸€æ ·çš„ï¼ˆåœ¨Â ReactÂ ä¸­åŸæ¥æ˜¯ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œç°åœ¨æ˜¯Â useEffectï¼‰ã€‚**æ‰€ä»¥Â useEffectÂ æ›´åƒæ˜¯ä¸€äº›å¤§å…¬å¸çš„å¼€æ”¾å¹³å°ç»™å„ç§Â ISVÂ å…¬å¸æä¾›çš„Â APIï¼Œå¹¶ä¸æ˜¯åº”è¯¥è®©ç”¨æˆ·ç›´æ¥ä½¿ç”¨çš„èƒ½åŠ›ï¼**

**é‚£ä¹ˆä½¿ç”¨Â useInitÂ /Â useWatchÂ å®Œå…¨æ›¿ä»£Â useEffectÂ ä¹Ÿæ˜¯éå¸¸åˆç†äº†ï¼Œåªä¸è¿‡æˆ‘ä»¬è¿˜æŠŠÂ EffectÂ å‰¯ä½œç”¨å’Œâ€œåŒæ­¥â€çš„ç†å¿µä¹Ÿä¸€é”…ç«¯äº†ï¼Œæœ‰ç‚¹å€’åå¤©ç½¡ã€æ¬ºå¸ˆç­ç¥–çš„å‘³äº†â€¦â€¦**Â 

# å…­ã€useInitÂ æ–¹æ¡ˆçš„è®¾è®¡ç”±æ¥

é¦–å…ˆè¿™ä¸¤ä¸ªæ›¿ä»£Â HookÂ çš„è®¾è®¡æ€è·¯ï¼Œè‚¯å®šæ˜¯ç«™åœ¨äº†Â useEffectÂ è¿™ä¸ªå·¨äººçš„è‚©è†€ä¸Šï¼Œä¾‹å¦‚æ¸…ç†å‡½æ•°ï¼ˆcleanupÂ callbackï¼‰çš„è®¾è®¡è®©ä¸¤ä¸ªÂ callbackï¼ˆsetupÂ å’ŒÂ cleanupï¼‰å¤©ç„¶å°±æœ‰äº†å…±äº«çš„ç§æœ‰ä½œç”¨åŸŸï¼Œéå¸¸å·§å¦™ã€‚

åœ¨æ­¤ä¹‹å¤–ï¼Œæœ¬ç« ä¼šç®€å•è®²è¿°ä¸€ä¸‹æˆ‘ä»¬æ–°çš„Â ReactÂ HookÂ ç¼–ç èŒƒå¼çš„å…¶ä»–è®¾è®¡ç”±æ¥ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£ç”¨Â useInitÂ å’Œå°‘é‡Â useWatchÂ æ›¿ä»£Â useEffectÂ çš„è¿™å¥—èŒƒå¼ã€‚

## 1ã€å¿˜ä¸æ‰çš„Â ClassÂ æ¨¡å‹

å½“æˆ‘ä»¬åœ¨å­¦ä¹ Â ReactÂ HookÂ çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„è§‚ç‚¹ï¼šæˆ‘ä»¬è¦å…ˆå­¦ä¼šå¿˜è®°ç±»ç»„ä»¶å’Œç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºä¹‹å‰çš„å­¦ä¹ ç»éªŒä¼šé˜»ç¢ä½ è¿›ä¸€æ­¥å­¦ä¹ ã€‚æˆ‘ä»¬è¦é‡æ–°ç”¨åŒæ­¥æ€ç»´å–ä»£ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œå‘Šè¯‰Â ReactÂ å¦‚ä½•å¯¹æ¯”Â Effectsï¼Œä»¥åŠä¸è¦å¯¹Â DependenciesÂ æ’’è°â€¦â€¦

> â€œUnlearnÂ whatÂ youÂ haveÂ learned.â€Â â€”Â Yoda

æˆ‘ä»¬å¯ä»¥å°è¯•å¿˜è®°ç±»ç»„ä»¶ã€å¿˜è®°ç”Ÿå‘½å‘¨æœŸï¼Œä½†æ˜¯Â ReactÂ HookÂ å¿…é¡»è¦ç¡®ä¿å½“æˆ‘ä»¬å·²ç»åœ¨ç”¨æ–°çš„æ€ç»´å†™ä»£ç æ—¶ï¼Œåœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œéƒ½åº”è¯¥ä¼˜äºç±»ç»„ä»¶å’Œç”Ÿå‘½å‘¨æœŸã€‚å¯å°±æˆ‘è§‚å¯Ÿåˆ°çš„äº‹å®ï¼Œå¹¶éå¦‚æ­¤ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºÂ ClassÂ è¿™ä¸ªæ¨¡å‹ï¼ŒåŒ…æ‹¬ç”Ÿå‘½å‘¨æœŸç­‰çš„æ¦‚å¿µæœ¬èº«æ˜¯éå¸¸é€‚åˆç”¨åœ¨Â UIÂ ç»„ä»¶è¿™ä¸ªåœºæ™¯ä¸­çš„ï¼Œä¸èƒ½å› ä¸ºÂ thisÂ å’Œå¤ç”¨ä»£ç çš„é—®é¢˜ï¼Œå°±å¿˜è®°äº†å®ƒçš„ä¼˜ç‚¹ã€‚

> â€œIfÂ youÂ donâ€™tÂ knowÂ whereÂ youâ€™reÂ from,Â youâ€™llÂ neverÂ knowÂ whereÂ youâ€™reÂ going.â€Â â€”Â é²è¿…

è¨€å½’æ­£ä¼ ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬è®¾è®¡Â stateÂ çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåŸåˆ™æ˜¯åªæŠŠæ¸²æŸ“è¿‡ç¨‹éœ€è¦ç”¨åˆ°çš„å˜é‡ä½œä¸ºÂ stateï¼Œé‚£ä¹ˆæœ‰æ—¶å€™ä¸€äº›æ¸²æŸ“è¿‡ç¨‹ç”¨ä¸åˆ°çš„ï¼Œä¸éœ€è¦å“åº”å¼çš„å˜é‡å®šä¹‰åœ¨å“ªé‡Œå‘¢ï¼Ÿåœ¨ç±»ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®šä¹‰åœ¨å®ä¾‹ä¸Šï¼Œæˆ‘è§‰å¾—è¿™éå¸¸åˆç†ï¼Œæ¯”å¦‚ä¹‹å‰çš„å®šæ—¶å™¨ç¤ºä¾‹ï¼š

```tsx
class Demo extends React.Component {
  constructor(props) {
    super(props);

    // ğŸŸ¢ ç›´æ¥åœ¨ this å®ä¾‹ä¸Šå®šä¹‰ä¸€äº›éå“åº”å¼çš„å€¼
    this.renderCount = 0; 
  };
}
```

åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”¨Â refÂ æ¥åšç±»ä¼¼çš„äº‹æƒ…ï¼Œæ¯”å¦‚åœ¨é¡¹ç›®åˆ—è¡¨é¡µç‚¹å‡»æŸä¸€æ¡æ•°æ®çš„â€œåˆ†æ´¾â€æŒ‰é’®ï¼Œå…ˆå”¤èµ·ä¸€ä¸ªé€šç”¨å¼¹æ¡†è¿›è¡Œåˆ†æ´¾ç›®æ ‡çš„é€‰æ‹©ï¼Œç„¶åè°ƒç”¨æ¥å£è¿›è¡Œåˆ†æ´¾ï¼š

```tsx
const projectInfoRef = useRef(null);

const handleAssignBtnClick = (row) => {
  projectInfoRef.current = row;
  setCommonSelectModalVisible(true);
};

const handleCommonSelectModalOk = async (personInfo) => {
  setCommonSelectModalVisible(false);
  const projectInfo = projectInfoRef.current;
  // ......ï¼ˆæ ¹æ® projectInfo å’Œ personInfo å‘é€åˆ†æ´¾æ¥å£è¯·æ±‚ï¼‰
};

const handleCommonSelectModalCancel = () => {
  setCommonSelectModalVisible(false);
};
```

æˆ‘è®¤ä¸ºÂ projectInfoRefÂ è¿™ä¸ªè¯­ä¹‰æ˜¯ä¸å¥½çš„ï¼Œå› ä¸ºÂ refÂ çš„åŸæœ¬è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªç»„ä»¶çš„å¼•ç”¨ï¼Œåªçœ‹å‘½åå¯èƒ½ä¼šè§‰å¾—è¿™æ˜¯Â <ProjectInfoÂ />Â ç»„ä»¶çš„å¼•ç”¨ã€‚è€Œä¸”æ¯æ¬¡å¯¹å…¶èµ‹å€¼å’Œè¯»å–çš„æ—¶å€™éƒ½è¦ç”¨åˆ°Â currentÂ è¿™ä¸€å±‚æ²¡æœ‰ä»»ä½•è¯­ä¹‰çš„â€œå‘½åç©ºé—´â€ã€‚æ‰€ä»¥æˆ‘å†™äº†ä¸€ä¸ªè‡ªå®šä¹‰Â HookÂ æ¥æ¨¡ä»¿ç±»ç»„ä»¶ä¸­çš„Â thisÂ å®ç°æ›´å¥½çš„è¯­ä¹‰åŒ–ï¼š

```typescript
const useInstance = <T extends {}>(defaultParams: T): T => {
  const ref = useRef(defaultParams);
  return ref.current;
};
```

æ”¹å†™ä¸Šè¿°ä¾‹å­ä¹‹åä»£ç ç»“æ„æ²¡æœ‰å˜åŒ–ï¼Œè¯­ä¹‰ä¼šæ›´å¥½ä¸€äº›ï¼š

```typescript
// åœ¨è¿™ä¸ªç”¨æ³•ä¸­ instance å°±ç­‰åŒäºç±»ç»„ä»¶ä¸­çš„ this å¯ä»¥æŒ‚è½½è‡ªå®šä¹‰å®ä¾‹å±æ€§
const instance = useInstance({ projectInfo: null });

const handleAssignBtnClick = (row) => {
  instance.projectInfo = row;
  setCommonSelectModalVisible(true);
};

const handleCommonSelectModalOk = async (personInfo) => {
  setCommonSelectModalVisible(false);
  const projectInfo = instance.projectInfo;
  // ......ï¼ˆæ ¹æ® projectInfo å’Œ personInfo å‘é€åˆ†æ´¾æ¥å£è¯·æ±‚ï¼‰
};

const handleCommonSelectModalCancel = () => {
  setCommonSelectModalVisible(false);
};
```

å¹¶ä¸”å½“ä½ æ·±å…¥äº†è§£è¿‡ç¤¾åŒºé‡Œçš„å„ç§å‡½æ•°ç»„ä»¶é—­åŒ…è§£å†³æ–¹æ¡ˆæ—¶ï¼Œä½ ä¼šå‘ç°æ‰€æœ‰çš„æ–¹æ¡ˆå…¶å®éƒ½ç¦»ä¸å¼€Â useRefï¼Œåœ¨è¿™äº›åœºæ™¯ä¸­Â refÂ å¹¶ä¸æ˜¯æŒ‡åŸç”Ÿç»„ä»¶æˆ–è€…è‡ªå®šä¹‰ç»„ä»¶çš„å¼•ç”¨ï¼ˆreferenceï¼‰ï¼Œè€Œæ˜¯æ›´åƒÂ classÂ ç»„ä»¶ä¸­ä¸éœ€è¦è§¦å‘å“åº”å¼æ›´æ–°ä¸”æ²¡æœ‰é—­åŒ…é—®é¢˜çš„å®ä¾‹å±æ€§ã€‚

## 2ã€ç±»ç»„ä»¶Â vsÂ å‡½æ•°ç»„ä»¶

åœ¨å›¢é˜Ÿå†…è¯•è¡Œè¿™å¥—æ–°çš„ç¼–ç èŒƒå¼ä¹‹å‰ï¼Œæˆ‘è¯¦ç»†å¯¹æ¯”å¹¶åˆ†äº«è¿‡ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„ä¼˜ç¼ºç‚¹ï¼š

![image.png](https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/a2QnVX8P0z7zO4XB/img/f81270c5-4ada-4807-b4fc-f33d9ab6264b.png)

å¾ˆæ˜æ˜¾ï¼Œæ”¯æŒäº†Â HookÂ ä¹‹åçš„å‡½æ•°ç»„ä»¶åœ¨è§£å†³äº†ç±»ç»„ä»¶çš„é—®é¢˜ä¹‹åï¼Œå´å¸¦æ¥äº†æ–°çš„é—®é¢˜ã€‚å¯¼è‡´å¾ˆå¤šåŸæ¥åœ¨ç±»ç»„ä»¶ä¸­æˆ‘ä»¬å¯ä»¥ç›´æ¥å†™åŸç”Ÿä»£ç å°±èƒ½å¿«é€Ÿå®ç°çš„åŠŸèƒ½ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­å˜å¾—ååˆ†å¤æ‚ï¼Œä»¥è‡³äºæˆ‘ä»¬éœ€è¦ä¾èµ–ä¸€äº›ä¸‰æ–¹Â HookÂ å·¥å…·æ¥ååŠ©å®Œæˆè¿™äº›åŠŸèƒ½ã€‚

æ¯”å¦‚é˜²æŠ–åŠŸèƒ½åœ¨ç±»ç»„ä»¶ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨Â loadshÂ çš„Â debounceÂ æ–¹æ³•å®ç°ï¼Œä½†æ˜¯åœ¨å‡½æ•°ç»„ä»¶ä¸­æˆ‘ä»¬å¿…é¡»ä½¿ç”¨Â useDebounceFnÂ è¿™ç±»å·¥å…·Â HookÂ æ¥å®Œæˆã€‚æ‹¥æŠ±å‡½æ•°ç»„ä»¶åï¼Œé—­åŒ…é—®é¢˜ç­‰ä»æ ¹æœ¬ä¸Šæ˜¯æ— æ³•é¿å…çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥è®¾è®¡ä¸€å¥—èƒ½è®©å¼€å‘è€…èƒ½å°½å¯èƒ½é¿å¼€è¿™äº›é—®é¢˜çš„åŸºç¡€Â Hookï¼Œè€ŒÂ useEffectÂ è®¾è®¡ä¸ä»…æ²¡èƒ½è®©æˆ‘ä»¬é¿å¼€è¿™äº›é—®é¢˜ï¼Œè¿˜å¼•å…¥äº†æ›´æ¶å¿ƒçš„ä¾èµ–é¡¹ç®¡ç†é—®é¢˜ã€‚

**æ‰€ä»¥æˆ‘ä»¬çš„è®¾è®¡æ€è·¯å°±æ˜¯æŠŠä¸¤è€…çš„ä¼˜ç‚¹éƒ½ç»“åˆèµ·æ¥ï¼ŒæŠŠç¼ºç‚¹éƒ½è§„é¿æ‰ï¼Œæ‰¬é•¿é¿çŸ­ã€‚**

## 3ã€ç¹ç®€ä¸€è‡´çš„ç¼–ç æ€è·¯

åœ¨ä½¿ç”¨Â useEffectÂ æ—¶ï¼Œæˆ‘éœ€è¦ä¸æ–­åœ°å’Œæ–°åŠ å…¥æˆ‘ä»¬å›¢é˜Ÿçš„æˆå‘˜æ²Ÿé€šå¦‚ä½•ç”¨å¥½Â useEffectï¼Œç„¶è€Œåœ¨Â useInitÂ æ–¹æ¡ˆä¸­ï¼Œæˆ‘æ ¹æœ¬ä¸å†éœ€è¦èŠ±è´¹ç²¾åŠ›å»åšæ²Ÿé€šè¿™ä¹ˆåŸºç¡€çš„äº‹æƒ…ã€‚**æ–°çš„Â useInitÂ æ–¹æ¡ˆä¹Ÿåªæ˜¯åœ¨åŸæœ¬çš„Â ReactÂ HookÂ åŸºç¡€ä¸Šå»æ‰å‰¯ä½œç”¨çš„æ¦‚å¿µï¼Œåªæ˜¯ä¿ç•™äº†ç»„ä»¶å®ä¾‹çš„å¿ƒæ™ºæ¨¡å‹ï¼Œä»¥åŠåˆå§‹åŒ–å’Œç›‘å¬çš„æ¦‚å¿µï¼ˆå‹‰å¼ºç®—ç®€åŒ–åçš„ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚**

åœ¨ä¹ æƒ¯äº†è¿™ä¸ªæ–¹å¼å†™ä»£ç æ—¶ï¼Œé™¤äº†ç¬¬å››ç« ä¸­æåˆ°çš„å¯ä»¥æå¤§åœ°é¿å…ä¾èµ–é¡¹å£°æ˜ã€é—­åŒ…é—®é¢˜ã€ä¸å¿…è¦çš„Â useCallbackÂ å’ŒÂ useMemoï¼Œè¿˜æœ‰ä¸€ä¸ªå…³é”®çš„ä¼˜åŠ¿ï¼š**ä¸è®ºé‡åˆ°ä»€ä¹ˆåœºæ™¯ï¼Œå†™ä»£ç çš„æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚**å½“é‡åˆ°[ã€ŠÂ å°†äº‹ä»¶ä»Â EffectÂ ä¸­åˆ†å¼€Â ã€‹](https://zh-hans.react.dev/learn/separating-events-from-effects)ä¸­æåˆ°çš„åœºæ™¯ï¼ˆç±»ä¼¼ç¬¬å››ç« ä¸­çš„â€œuseEffectÂ è§£å†³ä¸äº†çš„é—®é¢˜â€ï¼‰æ—¶ï¼Œç”¨æˆ‘ä»¬çš„æ–¹æ¡ˆå»å†™ä»£ç ï¼Œå’Œå…¶ä»–ä»»ä½•å¸¸è§„çš„åœºæ™¯æ²¡æœ‰å·®åˆ«ï¼Œæ›´ä¸éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„Â APIï¼Œå°±åƒåœ¨ç±»ç»„ä»¶ä¸­è¿™äº›åœºæ™¯åŸæœ¬å°±ä¸æ˜¯ä»€ä¹ˆç‰¹æ®Šæƒ…å†µï¼š

```typescript
function ChatRoom({ roomId, theme }) {
  const handleConnectedEvent = () => {
    showNotification('Connected!', theme);
  };

  /**
   * å’Œ useInit ä¸€æ ·ï¼Œå½“ä½¿ç”¨äº† useWatch çš„ç¬¬ä¸‰ä¸ªå‚æ•° funcMap æ—¶ï¼Œå›è°ƒä¸­çš„é€»è¾‘å°±åº”è¯¥åªå‰©ä¸‹éå¸¸å°‘é‡çš„ä¸¤ç±»ä»£ç ï¼š
   *   1ã€è®¾ç½®å„ç±»ç›‘å¬å™¨ï¼ˆaddEventListener / WebSocket / setInterval ç­‰ç­‰ï¼‰ï¼Œå¹¶æŠŠ self ä¸Šçš„æ–¹æ³•ç›´æ¥ä½œä¸ºå¤„ç†å‡½æ•°
   *   2ã€æ¸…ç†å¯¹åº”çš„ç›‘å¬å™¨
   */
  useWatch(
    [roomId],
    (self) => {
      // è®¾ç½®ç›‘å¬å™¨
      const connection = createConnection(serverUrl, roomId);
      connection.on('connected', self.handleConnectedEvent);
      connection.connect();
      return () => {
        // æ¸…ç†ç›‘å¬å™¨
        connection.disconnect();
      };
    },
    {
      handleConnectedEvent,
    }
  );

  return <h1>Welcome to the {roomId} room!</h1>;
}

```
```typescript
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  useWatch([url], () => {
    logVisit(url, numberOfItems);
  });

  // ...
}

```

ä¸è¿‡è¿˜æ˜¯è¦å†æ¬¡æé†’ï¼Œå³ä½¿è¿™ä¸ªä»£ç å®ç°èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨Â useWatchÂ å‰ï¼Œè¿˜æ˜¯è¦å‚è€ƒç¬¬å››ç« ä¸­â€œè°¨æ…ä½¿ç”¨Â useWatchâ€Â é‡Œæåˆ°çš„æ–¹å¼å»åˆ¤æ–­èƒ½å¦ä¼˜å…ˆé‡‡ç”¨å…¶ä»–å®ç°æ–¹æ¡ˆï¼Œå› ä¸ºå…¶ä»–å®ç°æ–¹æ¡ˆç›¸æ¯”äºç›‘å¬æ–¹æ¡ˆæ˜¯æ›´æ˜“ç»´æŠ¤çš„ã€‚

**å¹¶ä¸”æˆ‘ä»¬çš„æ–¹æ¡ˆä¹Ÿæ²¡æœ‰ç±»ä¼¼**Â [EffectÂ EventÂ çš„å±€é™æ€§](https://zh-hans.react.dev/learn/separating-events-from-effects#limitations-of-effect-events)Â **ä¸­æåˆ°çš„é—®é¢˜ï¼Œå› ä¸ºÂ useInitÂ å’ŒÂ useWatchÂ åœ¨ç”¨Â refÂ è§£å†³é—­åŒ…é—®é¢˜æ—¶ï¼Œå°†â€œé—­åŒ…æ¶ˆé™¤é­”æ³•â€çš„ç”Ÿæ•ˆèŒƒå›´å¾ˆå¥½åœ°æ§åˆ¶åœ¨äº†Â useInitÂ å’ŒÂ useWatchÂ ä¸­ã€‚**

## 4ã€é˜²å‘†è®¾è®¡

åœ¨æˆ‘ä»¬å›¢é˜Ÿå¯¹Â useEffectÂ æœ€åˆçš„è®¨è®ºä¸­ï¼Œå°±è®¤ä¸ºÂ useEffectÂ å¤ªçµæ´»äº†ï¼Œçœ‹ä¼¼é—¨æ§›å¾ˆä½ï¼Œå…¶å®éå¸¸å®¹æ˜“ç©è„±ï¼Œå³Â useEffectÂ å¤§å¤§æé«˜äº†å†™å‡ºå¥½ä»£ç çš„é—¨æ§›ï¼Œä¹Ÿæ­£å› ä¸ºå…¶çµæ´»æ€§ï¼Œå¯¼è‡´æ— æ³•åšåˆ°æœ¬æ–‡å¼€å¤´è¯´çš„ä¸¤ä¸ªç‚¹ï¼š_**ä¿æŒä»£ç ç»“æ„ä¸€è‡´æ€§**_Â å’ŒÂ _**ä»£ç æ„å›¾çš„æ­£ç¡®ä¼ è¾¾**_ã€‚å¦‚æœè®©æˆ‘å¯¹Â useEffectÂ çš„é—®é¢˜åšä¸€ä¸ªæŠ½è±¡çš„æ€»ç»“ï¼Œæˆ‘ä¼šè¿™ä¹ˆè¯´ï¼š

**useEffectÂ çœ‹ä¼¼å¾ˆç®€å•ï¼Œç„¶è€Œè¦ç”¨å¥½Â useEffectÂ åˆ™å¯¹å¼€å‘è€…çš„è¦æ±‚å¾ˆé«˜ã€‚å°±åƒä½ å®Œå…¨å¯ä»¥æŠŠè‡ªåŠ¨æŒ¡æ±½è½¦å½“ä½œç¢°ç¢°è½¦å¼€ä¸Šè·¯ï¼Œä½†æ˜¯å¦‚æœæ¯ä¸ªäººéƒ½åªä¼šæ²¹é—¨åˆ¹è½¦å´ä¸æ‡‚äº¤é€šè§„åˆ™ã€ä¸æ‡‚é˜²å¾¡æ€§é©¾é©¶ï¼Œæ•´ä¸ªåŸå¸‚çš„äº¤é€šä¼šè¿…é€Ÿé™·å…¥ç˜«ç—ªã€‚å¹¶ä¸”å¾ˆå¤šå¼€å‘è€…å…¶å®å¹¶æ²¡æœ‰æ³¨æ„åˆ°ä½¿ç”¨Â useEffectÂ è¿˜è¦æ³¨æ„è¿™ä¹ˆå¤šè§„åˆ™ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯å› ä¸ºå¤§å¤šæ•°æ—¶å€™è¿™äº›é¢å¤–çš„è§„åˆ™å¹¶æ²¡æœ‰å¸¦æ¥å¯¹åº”çš„é¢å¤–æ”¶ç›Šã€‚**

å‰é¢æåˆ°è¿‡Â DanÂ è®¤ä¸ºÂ useEffectÂ çš„è®¾è®¡è¿«ä½¿æˆ‘ä»¬è¦æ³¨æ„åˆ°æ•°æ®æµä¸­çš„å˜åŒ–ï¼Œä»è€Œèƒ½æå‰é’ˆå¯¹æ•°æ®å˜åŒ–å»ºç«‹é˜²å¾¡æ€§æªæ–½ï¼Œè¿™å…¶å®å±äºç³»ç»Ÿç¨³å®šæ€§çš„è¯é¢˜ã€‚å³ä½¿è¿™ä¹ˆåšçœŸçš„èƒ½å¸¦æ¥ç¨³å®šæ€§æ”¶ç›Šï¼Œå¾ˆå¤šå¼€å‘è€…ä¾æ—§éƒ½æ²¡æœ‰å®Œå…¨éµå®ˆå®˜æ–¹Â ESlintÂ æ’ä»¶æ¥å†™ä»£ç ï¼Œæˆ‘è®¤ä¸ºè¿™å…¶ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„è®¾è®¡åŸå› ï¼Œå°±æ˜¯è¿™ä¸ªÂ useEffectÂ çš„è®¾è®¡ä¸­æ²¡æœ‰ä»»ä½•[**é˜²å‘†ï¼ˆFool-proofingï¼‰**](https://baike.baidu.com/item/%E9%98%B2%E5%91%86)æªæ–½ï¼š**é¦–å…ˆÂ react-hooks/exhaustive-depsÂ è¿™ä¸ªÂ ESLintÂ æ ¡éªŒè§„åˆ™ä¸é˜²å‘†ï¼Œä¸ä»…ä»…å› ä¸ºç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µå…¶å®ä¾æ—§æ·±å…¥äººå¿ƒï¼Œå¯¼è‡´å¤§å¤šæ•°å¼€å‘è€…éƒ½æ˜¯é è‡ªå·±çš„æ„Ÿè§‰æ¥å†³å®šè¦ä¸è¦å‚è€ƒè¿™ä¸ªæ ¡éªŒè§„åˆ™ï¼Œè€Œä¸”æœ¬èº«è¿™å¥—æ ¡éªŒè§„åˆ™å°±æœ‰æ¼æ´ï¼Œå¯¹åº”çš„Â useEffectEventÂ è§£å†³æ–¹æ¡ˆä¹Ÿè¿˜åªæ˜¯å®éªŒæ€§Â APIï¼›å…¶æ¬¡Â useEffectÂ åˆ°åº•åº”è¯¥ç”¨åœ¨å“ªäº›åœºæ™¯ï¼Œä¸åº”è¯¥ç”¨åœ¨å“ªäº›åœºæ™¯ï¼Œè¿™ä¹Ÿéå¸¸ä¸é˜²å‘†ï¼Œä½ éœ€è¦é˜…è¯»å®Œå®˜ç½‘Â 5Â ç¯‡æ€»è®¡Â 3wÂ å­—çš„æ•™ç¨‹æ‰å¯èƒ½ææ˜ç™½â€¦â€¦**

åœ¨å·¥ä¸šç”Ÿäº§ä¸­ã€åœ¨ç”Ÿæ´»ä¸­ï¼Œå„ç§é¢†åŸŸéƒ½æœ‰å¾ˆå¤šä¼˜ç§€çš„é˜²å‘†è®¾è®¡ï¼š

*   ç”µè„‘çš„å›ºæ€ã€å†…å­˜æ¡ä¸Šéƒ½æœ‰é˜²æ­¢åå‘é”™è¯¯å®‰è£…è€Œè®¾è®¡çš„éå¯¹ç§°ç¼ºå£ã€‚
    
*   æ‰€æœ‰æ‰‹æœºçš„å…³æœºéƒ½éœ€è¦é•¿æŒ‰æˆ–äºŒæ¬¡ç¡®è®¤ä»¥é˜²è¯¯è§¦ã€‚
    
*   å„ç§åœºæ™¯ä¸­çš„æ˜¾è‘—æ ‡è¯†ï¼šçº¢è‰²è¡¨ç¤ºç´§æ€¥ï¼Œç»¿è‰²è¡¨ç¤ºé€šè¡Œç­‰ç­‰ã€‚
    
*   â€¦â€¦
    

é˜²å‘†è®¾è®¡é€šè¿‡ä¸€äº›é™åˆ¶æ‰‹æ®µæˆ–è€…æ˜¾è‘—æ ‡è¯†æ¥é™ä½ä¸€ä¸ªè¡Œä¸ºå¯¹äºæ“ä½œäººç²¾åŠ›ã€ç»éªŒä¸ä¸“ä¸šçŸ¥è¯†çš„è¦æ±‚ï¼Œä»è€Œè¾¾åˆ°é¢„é˜²é”™è¯¯çš„ç›®çš„ã€‚ä¸è®ºæ–°æ‰‹ã€è€æ‰‹ï¼›ä¸è®ºä½ å¤´è„‘æ¸…é†’ï¼Œè¿˜æ˜¯ç–²æƒ«ä¸å ªï¼›ä¸è®ºæ˜¯ç¹å¿™çš„å¹¶è¡Œå·¥ä½œï¼Œè¿˜æ˜¯å®‰é™çš„ä¸“æ³¨å·¥ä½œï¼Œéƒ½èƒ½ä¾é é˜²å‘†è®¾è®¡æ­£ç¡®å®Œæˆä»»åŠ¡ã€‚

**å›åˆ°Â useInitÂ çš„è®¾è®¡ï¼Œå°±åƒÂ initializationÂ è¿™ä¸ªå•è¯è¡¨ç¤ºçš„æ„æ€ä¸€æ ·ï¼Œä½ åªèƒ½åº”è¯¥æ”¾ä¸€äº›ç»„ä»¶åˆå§‹åŒ–æ—¶çš„é€»è¾‘ï¼Œå¹¶ä¸”å› ä¸ºå°±åƒÂ componentDidMountÂ ä¸€æ ·ï¼ŒuseInitÂ çš„Â callbackÂ åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œä»»è°ä¹Ÿç©ä¸å‡ºèŠ±æ¥ã€‚è€ŒÂ useWatchÂ å°±æ˜¯æœ€åçš„å…œåº•æ‰‹æ®µï¼Œç”¨ç›‘å¬æ€ç»´å»å®ç°ä¸€äº›é€»è¾‘ï¼Œä¸è¿‡é—æ†¾çš„æ˜¯æˆ‘ä»¬ä¹Ÿåªèƒ½é€šè¿‡ä¸€äº›æ˜¾è‘—çš„çº¦å®šæ¥å‘Šè¯‰å¼€å‘è€…ï¼Œè¿™æ˜¯ä¸€ä¸ªÂ dangerÂ çš„Â Hookï¼Œè¦è°¨æ…ä½¿ç”¨ã€‚**

**Overï¼Œæ„Ÿè°¢é˜…è¯»ï¼**